   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade - Version 2.2 (r1239) - Wed 28 Jun 2006 04:59:55 PM CEST
   !  
   !  Differentiation of getsurfacenormalsforcesadj in reverse (adjoint) mode:
   !   gradient, with respect to input variables: pts
   !   of linear combination of output variables: pts normadj
   SUBROUTINE GETSURFACENORMALSFORCESADJ_B(pts, ptsb, normadj, normadjb, &
   &  righthanded)
   USE constants
   IMPLICIT NONE
   REAL(KIND=REALTYPE) :: normadj(3, 2, 2), normadjb(3, 2, 2)
   REAL(KIND=REALTYPE), DIMENSION(3, 3, 3), INTENT(IN) :: pts
   REAL(KIND=REALTYPE) :: ptsb(3, 3, 3)
   LOGICAL, INTENT(IN) :: righthanded
   INTEGER :: branch
   REAL(KIND=REALTYPE) :: fact2, v1(3), v1b(3), v2(3), v2b(3)
   INTEGER(KIND=INTTYPE) :: i, j
   REAL(KIND=REALTYPE) :: tempb, tempb0, tempb1
   ! Subroutine Arguments
   ! Local Variables
   IF (righthanded) THEN
   fact2 = half
   CALL PUSHINTEGER4(0)
   ELSE
   fact2 = -half
   CALL PUSHINTEGER4(1)
   END IF
   DO j=1,2
   DO i=1,2
   CALL PUSHREAL8ARRAY(v1, 3)
   v1(:) = pts(:, i+1, j+1) - pts(:, i, j)
   CALL PUSHREAL8ARRAY(v2, 3)
   v2(:) = pts(:, i, j+1) - pts(:, i+1, j)
   ! The face normal, which is the cross product of the two
   ! diagonal vectors times fact; remember that fact2 is
   ! either -0.5 or 0.5.
   END DO
   END DO
   v1b(1:3) = 0.0
   v2b(1:3) = 0.0
   DO j=2,1,-1
   DO i=2,1,-1
   tempb = fact2*normadjb(3, i, j)
   v1b(1) = v1b(1) + v2(2)*tempb
   v2b(2) = v2b(2) + v1(1)*tempb
   v1b(2) = v1b(2) - v2(1)*tempb
   normadjb(3, i, j) = 0.0
   tempb0 = fact2*normadjb(2, i, j)
   v2b(1) = v2b(1) + v1(3)*tempb0 - v1(2)*tempb
   v1b(3) = v1b(3) + v2(1)*tempb0
   v1b(1) = v1b(1) - v2(3)*tempb0
   normadjb(2, i, j) = 0.0
   tempb1 = fact2*normadjb(1, i, j)
   v2b(3) = v2b(3) + v1(2)*tempb1 - v1(1)*tempb0
   v1b(2) = v1b(2) + v2(3)*tempb1
   v1b(3) = v1b(3) - v2(2)*tempb1
   v2b(2) = v2b(2) - v1(3)*tempb1
   normadjb(1, i, j) = 0.0
   CALL POPREAL8ARRAY(v2, 3)
   ptsb(:, i, j+1) = ptsb(:, i, j+1) + v2b(:)
   ptsb(:, i+1, j) = ptsb(:, i+1, j) - v2b(:)
   v2b(:) = 0.0
   CALL POPREAL8ARRAY(v1, 3)
   ptsb(:, i+1, j+1) = ptsb(:, i+1, j+1) + v1b(:)
   ptsb(:, i, j) = ptsb(:, i, j) - v1b(:)
   v1b(:) = 0.0
   END DO
   END DO
   CALL POPINTEGER4(branch)
   END SUBROUTINE GETSURFACENORMALSFORCESADJ_B
