   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade - Version 2.2 (r1239) - Wed 28 Jun 2006 04:59:55 PM CEST
   !  
   !  Differentiation of setflowinfinitystateadjts in reverse (adjoint) mode:
   !   gradient, with respect to input variables: uinfadj veldirfreestreamadj
   !   of linear combination of output variables: winfadj pinfcorradj
   !                veldirfreestreamadj
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          setFlowInfinityStateAdj.f90                     *
   !      * Author:        Edwin van der Weide, Georgi Kalitzin            *
   !      *                C.A.(Sandy) Mader
   !      * Starting date: 02-21-2003                                      *
   !      * Last modified: 05-14-2008                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE SETFLOWINFINITYSTATEADJTS_B(veldirfreestreamadj, &
   &  veldirfreestreamadjb, liftdirectionadj, dragdirectionadj, machadj, &
   &  machcoefadj, uinfadj, uinfadjb, winfadj, winfadjb, prefadj, rhorefadj&
   &  , pinfdimadj, rhoinfdimadj, rhoinfadj, pinfadj, murefadj, timerefadj&
   &  , pinfcorradj, pinfcorradjb)
   USE constants
   USE flowvarrefstate
   IMPLICIT NONE
   REAL(KIND=REALTYPE) :: dragdirectionadj(3)
   REAL(KIND=REALTYPE) :: liftdirectionadj(3)
   REAL(KIND=REALTYPE) :: machadj, machcoefadj, pinfcorradj, pinfcorradjb&
   &  , uinfadj, uinfadjb
   REAL(KIND=REALTYPE) :: murefadj, timerefadj
   REAL(KIND=REALTYPE) :: pinfdimadj, rhoinfdimadj
   REAL(KIND=REALTYPE) :: pinfadj, rhoinfadj
   REAL(KIND=REALTYPE) :: prefadj, rhorefadj
   REAL(KIND=REALTYPE) :: veldirfreestreamadj(3), veldirfreestreamadjb(3)
   REAL(KIND=REALTYPE) :: winfadj(nw), winfadjb(nw)
   INTEGER :: branch, ierr
   REAL(KIND=REALTYPE) :: sanuknowneddyratio
   REAL(KIND=REALTYPE) :: ktmp, nuinf, uinf2, vtmp, wtmp
   !
   !      ******************************************************************
   !      *                                                                *
   !      * setFlowInfinityState sets the free stream state vector of      *
   !      * the flow variables. If nothing is specified for each of the    *
   !      * farfield boundaries, these values will be taken to define the  *
   !      * free stream.                                                   *
   !      *                                                                *
   !      ******************************************************************
   !
   !
   !      subroutine Variables
   !
   !
   !      Local variables
   !
   !
   !      Function definition
   !
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Compute the velocity squared based on MachCoef;
   ! needed for the initialization of the turbulent energy,
   ! especially for moving geometries.
   !!$       ! Allocate the memory for wInf.
   !!$
   !!$       allocate(wInf(nw), stat=ierr)
   !!$       if(ierr /= 0)                             &
   !!$         call terminate("setFlowReferenceState", &
   !!$                        "Memory allocation failure for wInf")
   ! Set the reference value of the flow variables, except the total
   ! energy. This will be computed at the end of this routine.
   !!$       ! Set the turbulent variables if transport variables are
   !!$       ! to be solved.
   !!$
   !!$       if(equations == RANSEquations) then
   !!$
   !!$         nuInf  = muInf/rhoInf
   !!$
   !!$         select case(turbModel)
   !!$
   !!$           case (spalartAllmaras, spalartAllmarasEdwards)
   !!$
   !!$             wInf(itu1) = saNuKnownEddyRatio(eddyVisInfRatio, nuInf)
   !!$         !   wInf(itu1) = 1.341946*nuInf   ! eddyVis = 0.009*lamVis
   !!$
   !!$           !=============================================================
   !!$
   !!$           case (komegaWilcox, komegaModified, menterSST)
   !!$
   !!$             wInf(itu1) = 1.5_realType*uInf2*turbIntensityInf**2
   !!$             wInf(itu2) = wInf(itu1)/(eddyVisInfRatio*nuInf)
   !!$
   !!$           !=============================================================
   !!$
   !!$           case (ktau)
   !!$
   !!$             wInf(itu1) = 1.5_realType*uInf2*turbIntensityInf**2
   !!$             wInf(itu2) = eddyVisInfRatio*nuInf/wInf(itu1)
   !!$
   !!$           !=============================================================
   !!$
   !!$           case (v2f)
   !!$
   !!$             wInf(itu1) = 1.5_realType*uInf2*turbIntensityInf**2
   !!$             wInf(itu2) = 0.09_realType*wInf(itu1)**2 &
   !!$                        / (eddyVisInfRatio*nuInf)
   !!$             wInf(itu3) = 0.666666_realType*wInf(itu1)
   !!$             wInf(itu4) = 0.0_realType
   !!$
   !!$         end select
   !!$
   !!$       endif
   ! Set the value of pInfCorr. In case a k-equation is present
   ! add 2/3 times rho*k.
   IF (kpresent) THEN
   CALL PUSHINTEGER4(1)
   ELSE
   CALL PUSHINTEGER4(0)
   END IF
   CALL ETOTARRAYADJTS_B(rhoinfadj, uinfadj, uinfadjb, vtmp, wtmp, &
   &                  pinfcorradj, pinfcorradjb, ktmp, winfadj(irhoe), &
   &                  winfadjb(irhoe), kpresent, 1)
   CALL POPINTEGER4(branch)
   IF (.NOT.branch .LT. 1) winfadjb(itu1) = winfadjb(itu1) + two*third*&
   &      rhoinfadj*pinfcorradjb
   uinfadjb = uinfadjb + veldirfreestreamadj(3)*winfadjb(ivz)
   veldirfreestreamadjb(3) = veldirfreestreamadjb(3) + uinfadj*winfadjb(&
   &    ivz)
   winfadjb(ivz) = 0.0
   uinfadjb = uinfadjb + veldirfreestreamadj(2)*winfadjb(ivy)
   veldirfreestreamadjb(2) = veldirfreestreamadjb(2) + uinfadj*winfadjb(&
   &    ivy)
   winfadjb(ivy) = 0.0
   uinfadjb = uinfadjb + veldirfreestreamadj(1)*winfadjb(ivx)
   veldirfreestreamadjb(1) = veldirfreestreamadjb(1) + uinfadj*winfadjb(&
   &    ivx)
   END SUBROUTINE SETFLOWINFINITYSTATEADJTS_B
