   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08
   !
   !  Differentiation of extractbcstatesnkpc in reverse (adjoint) mode:
   !   gradient     of useful results: padj0 padj1 padj2 padj padj3
   !                wadj wadj0 wadj1 wadj2 wadj3
   !   with respect to varying inputs: padj0 padj1 padj2 padj padj3
   !                wadj wadj0 wadj1 wadj2 wadj3
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          extractBCStatesAdj.f90                             *
   !      * Author:        C.A.(Sandy) Mader                               *
   !      * Starting date: 04-16-2008                                      *
   !      * Last modified: 04-16-2008                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE EXTRACTBCSTATESNKPC_B(nn, wadj, wadjb, padj, padjb, wadj0, &
   &  wadj0b, wadj1, wadj1b, wadj2, wadj2b, wadj3, wadj3b, padj0, padj0b, &
   &  padj1, padj1b, padj2, padj2b, padj3, padj3b, rlvadj, revadj, rlvadj1, &
   &  rlvadj2, revadj1, revadj2, ioffset, joffset, koffset, icell, jcell, &
   &  kcell, isbeg, jsbeg, ksbeg, isend, jsend, ksend, ibbeg, jbbeg, kbbeg, &
   &  ibend, jbend, kbend, icbeg, jcbeg, icend, jcend, secondhalo, nnn, &
   &  level, sps, sps2)
   USE BLOCKPOINTERS, ONLY : ie, ib, je, jb, ke, kb, nbocos, bcfaceid, &
   &  bctype, bcdata
   USE INPUTTIMESPECTRAL
   USE BCTYPES
   USE FLOWVARREFSTATE
   IMPLICIT NONE
   !      ******************************************************************
   !      *                                                                *
   !      * copyBCStatesAdj copies the states needed for the boundary      *
   !      * condition treatment on a general face, such that the boundary  *
   !      * routines are only implemented once instead of 6 times.         *
   !      * This routine takes the place of setBCPointers in the orginal   *
   !      * Code                                                           *
   !      *                                                                *
   !      ******************************************************************
   !
   !nIntervalTimespectral
   !
   !      Subroutine arguments.
   !
   !, offset
   INTEGER(kind=inttype), INTENT(IN) :: nn, nnn, level, sps, sps2
   INTEGER(kind=inttype), INTENT(IN) :: icell, jcell, kcell
   INTEGER(kind=inttype), INTENT(IN) :: isbeg, jsbeg, ksbeg, isend, jsend&
   &  , ksend
   INTEGER(kind=inttype), INTENT(IN) :: ibbeg, jbbeg, kbbeg, ibend, jbend&
   &  , kbend
   INTEGER(kind=inttype) :: icbeg, jcbeg, icend, jcend
   INTEGER(kind=inttype) :: irbeg, jrbeg, krbeg, irend, jrend, krend
   INTEGER(kind=inttype) :: ioffset, joffset, koffset
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, nw, &
   &  ntimeintervalsspectral), INTENT(IN) :: wadj
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, nw, &
   &  ntimeintervalsspectral) :: wadjb
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, &
   &  ntimeintervalsspectral), INTENT(IN) :: padj
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, &
   &  ntimeintervalsspectral) :: padjb
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, nw) :: wadj0, wadj1
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, nw) :: wadj0b, wadj1b
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, nw) :: wadj2, wadj3
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, nw) :: wadj2b, wadj3b
   REAL(kind=realtype), DIMENSION(-2:2, -2:2) :: padj0, padj1
   REAL(kind=realtype), DIMENSION(-2:2, -2:2) :: padj0b, padj1b
   REAL(kind=realtype), DIMENSION(-2:2, -2:2) :: padj2, padj3
   REAL(kind=realtype), DIMENSION(-2:2, -2:2) :: padj2b, padj3b
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2) :: rlvadj, revadj
   REAL(kind=realtype), DIMENSION(-2:2, -2:2) :: rlvadj1, rlvadj2
   REAL(kind=realtype), DIMENSION(-2:2, -2:2) :: revadj1, revadj2
   LOGICAL :: ioverlap, joverlap, koverlap
   !logical,intent(inout) :: secondHalo
   LOGICAL :: secondhalo
   INTRINSIC MAX
   INTRINSIC MIN
   IF (isbeg .LT. ibbeg) THEN
   irbeg = ibbeg
   ELSE
   irbeg = isbeg
   END IF
   IF (isend .GT. ibend) THEN
   irend = ibend
   ELSE
   irend = isend
   END IF
   IF (jsbeg .LT. jbbeg) THEN
   jrbeg = jbbeg
   ELSE
   jrbeg = jsbeg
   END IF
   IF (jsend .GT. jbend) THEN
   jrend = jbend
   ELSE
   jrend = jsend
   END IF
   IF (ksbeg .LT. kbbeg) THEN
   krbeg = kbbeg
   ELSE
   krbeg = ksbeg
   END IF
   IF (ksend .GT. kbend) THEN
   krend = kbend
   ELSE
   krend = ksend
   END IF
   ! Set some pointers depending on the situation.
   SELECT CASE  (bcfaceid(nn)) 
   CASE (imin) 
   CALL PUSHBOOLEAN(secondhalo)
   ! Other straightforward stuff.
   secondhalo = .true.
   IF (irbeg .EQ. irend) secondhalo = .false.
   IF (secondhalo) THEN
   padjb(1, -2:2, -2:2, sps2) = padjb(1, -2:2, -2:2, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(0, -2:2, -2:2, sps2) = padjb(0, -2:2, -2:2, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(-1, -2:2, -2:2, sps2) = padjb(-1, -2:2, -2:2, sps2) + padj1b&
   &        (-2:2, -2:2)
   padj1b = 0.0
   padjb(-2, -2:2, -2:2, sps2) = padjb(-2, -2:2, -2:2, sps2) + padj0b&
   &        (-2:2, -2:2)
   padj0b = 0.0
   wadjb(1, -2:2, -2:2, 1:nw, sps2) = wadjb(1, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(0, -2:2, -2:2, 1:nw, sps2) = wadjb(0, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-1, -2:2, -2:2, 1:nw, sps2) = wadjb(-1, -2:2, -2:2, 1:nw, &
   &        sps2) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   wadjb(-2, -2:2, -2:2, 1:nw, sps2) = wadjb(-2, -2:2, -2:2, 1:nw, &
   &        sps2) + wadj0b(-2:2, -2:2, 1:nw)
   wadj0b = 0.0
   ELSE
   padjb(0, -2:2, -2:2, sps2) = padjb(0, -2:2, -2:2, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(-1, -2:2, -2:2, sps2) = padjb(-1, -2:2, -2:2, sps2) + padj2b&
   &        (-2:2, -2:2)
   padj2b = 0.0
   padjb(-2, -2:2, -2:2, sps2) = padjb(-2, -2:2, -2:2, sps2) + padj1b&
   &        (-2:2, -2:2)
   padj1b = 0.0
   wadjb(0, -2:2, -2:2, 1:nw, sps2) = wadjb(0, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-1, -2:2, -2:2, 1:nw, sps2) = wadjb(-1, -2:2, -2:2, 1:nw, &
   &        sps2) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2, -2:2, -2:2, 1:nw, sps2) = wadjb(-2, -2:2, -2:2, 1:nw, &
   &        sps2) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   END IF
   CALL POPBOOLEAN(secondhalo)
   CASE (imax) 
   CALL PUSHBOOLEAN(secondhalo)
   ! Other straightforward stuff.
   secondhalo = .true.
   IF (irbeg .EQ. irend) secondhalo = .false.
   IF (secondhalo) THEN
   padjb(-1, -2:2, -2:2, sps2) = padjb(-1, -2:2, -2:2, sps2) + padj3b&
   &        (-2:2, -2:2)
   padj3b = 0.0
   padjb(0, -2:2, -2:2, sps2) = padjb(0, -2:2, -2:2, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(1, -2:2, -2:2, sps2) = padjb(1, -2:2, -2:2, sps2) + padj1b(-&
   &        2:2, -2:2)
   padj1b = 0.0
   padjb(2, -2:2, -2:2, sps2) = padjb(2, -2:2, -2:2, sps2) + padj0b(-&
   &        2:2, -2:2)
   padj0b = 0.0
   wadjb(-1, -2:2, -2:2, 1:nw, sps2) = wadjb(-1, -2:2, -2:2, 1:nw, &
   &        sps2) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(0, -2:2, -2:2, 1:nw, sps2) = wadjb(0, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(1, -2:2, -2:2, 1:nw, sps2) = wadjb(1, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   wadjb(2, -2:2, -2:2, 1:nw, sps2) = wadjb(2, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj0b(-2:2, -2:2, 1:nw)
   wadj0b = 0.0
   ELSE
   padjb(0, -2:2, -2:2, sps2) = padjb(0, -2:2, -2:2, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(1, -2:2, -2:2, sps2) = padjb(1, -2:2, -2:2, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(2, -2:2, -2:2, sps2) = padjb(2, -2:2, -2:2, sps2) + padj1b(-&
   &        2:2, -2:2)
   padj1b = 0.0
   wadjb(0, -2:2, -2:2, 1:nw, sps2) = wadjb(0, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(1, -2:2, -2:2, 1:nw, sps2) = wadjb(1, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(2, -2:2, -2:2, 1:nw, sps2) = wadjb(2, -2:2, -2:2, 1:nw, sps2&
   &        ) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   END IF
   CALL POPBOOLEAN(secondhalo)
   CASE (jmin) 
   CALL PUSHBOOLEAN(secondhalo)
   ! Other straightforward stuff.
   secondhalo = .true.
   IF (jrbeg .EQ. jrend) secondhalo = .false.
   IF (secondhalo) THEN
   padjb(-2:2, 1, -2:2, sps2) = padjb(-2:2, 1, -2:2, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, 0, -2:2, sps2) = padjb(-2:2, 0, -2:2, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, -1, -2:2, sps2) = padjb(-2:2, -1, -2:2, sps2) + padj1b&
   &        (-2:2, -2:2)
   padj1b = 0.0
   padjb(-2:2, -2, -2:2, sps2) = padjb(-2:2, -2, -2:2, sps2) + padj0b&
   &        (-2:2, -2:2)
   padj0b = 0.0
   wadjb(-2:2, 1, -2:2, 1:nw, sps2) = wadjb(-2:2, 1, -2:2, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, 0, -2:2, 1:nw, sps2) = wadjb(-2:2, 0, -2:2, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, -1, -2:2, 1:nw, sps2) = wadjb(-2:2, -1, -2:2, 1:nw, &
   &        sps2) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   wadjb(-2:2, -2, -2:2, 1:nw, sps2) = wadjb(-2:2, -2, -2:2, 1:nw, &
   &        sps2) + wadj0b(-2:2, -2:2, 1:nw)
   wadj0b = 0.0
   ELSE
   padjb(-2:2, 0, -2:2, sps2) = padjb(-2:2, 0, -2:2, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, -1, -2:2, sps2) = padjb(-2:2, -1, -2:2, sps2) + padj2b&
   &        (-2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, -2, -2:2, sps2) = padjb(-2:2, -2, -2:2, sps2) + padj1b&
   &        (-2:2, -2:2)
   padj1b = 0.0
   wadjb(-2:2, 0, -2:2, 1:nw, sps2) = wadjb(-2:2, 0, -2:2, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, -1, -2:2, 1:nw, sps2) = wadjb(-2:2, -1, -2:2, 1:nw, &
   &        sps2) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, -2, -2:2, 1:nw, sps2) = wadjb(-2:2, -2, -2:2, 1:nw, &
   &        sps2) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   END IF
   CALL POPBOOLEAN(secondhalo)
   CASE (jmax) 
   CALL PUSHBOOLEAN(secondhalo)
   ! Other straightforward stuff.
   secondhalo = .true.
   IF (jrbeg .EQ. jrend) secondhalo = .false.
   IF (secondhalo) THEN
   padjb(-2:2, -1, -2:2, sps2) = padjb(-2:2, -1, -2:2, sps2) + padj3b&
   &        (-2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, 0, -2:2, sps2) = padjb(-2:2, 0, -2:2, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, 1, -2:2, sps2) = padjb(-2:2, 1, -2:2, sps2) + padj1b(-&
   &        2:2, -2:2)
   padj1b = 0.0
   padjb(-2:2, 2, -2:2, sps2) = padjb(-2:2, 2, -2:2, sps2) + padj0b(-&
   &        2:2, -2:2)
   padj0b = 0.0
   wadjb(-2:2, -1, -2:2, 1:nw, sps2) = wadjb(-2:2, -1, -2:2, 1:nw, &
   &        sps2) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, 0, -2:2, 1:nw, sps2) = wadjb(-2:2, 0, -2:2, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, 1, -2:2, 1:nw, sps2) = wadjb(-2:2, 1, -2:2, 1:nw, sps2&
   &        ) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   wadjb(-2:2, 2, -2:2, 1:nw, sps2) = wadjb(-2:2, 2, -2:2, 1:nw, sps2&
   &        ) + wadj0b(-2:2, -2:2, 1:nw)
   wadj0b = 0.0
   ELSE
   padjb(-2:2, 0, -2:2, sps2) = padjb(-2:2, 0, -2:2, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, 1, -2:2, sps2) = padjb(-2:2, 1, -2:2, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, 2, -2:2, sps2) = padjb(-2:2, 2, -2:2, sps2) + padj1b(-&
   &        2:2, -2:2)
   padj1b = 0.0
   wadjb(-2:2, 0, -2:2, 1:nw, sps2) = wadjb(-2:2, 0, -2:2, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, 1, -2:2, 1:nw, sps2) = wadjb(-2:2, 1, -2:2, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, 2, -2:2, 1:nw, sps2) = wadjb(-2:2, 2, -2:2, 1:nw, sps2&
   &        ) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   END IF
   CALL POPBOOLEAN(secondhalo)
   CASE (kmin) 
   CALL PUSHBOOLEAN(secondhalo)
   ! Other straightforward stuff.
   secondhalo = .true.
   IF (krbeg .EQ. krend) secondhalo = .false.
   IF (secondhalo) THEN
   padjb(-2:2, -2:2, 1, sps2) = padjb(-2:2, -2:2, 1, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, -2:2, 0, sps2) = padjb(-2:2, -2:2, 0, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, -2:2, -1, sps2) = padjb(-2:2, -2:2, -1, sps2) + padj1b&
   &        (-2:2, -2:2)
   padj1b = 0.0
   padjb(-2:2, -2:2, -2, sps2) = padjb(-2:2, -2:2, -2, sps2) + padj0b&
   &        (-2:2, -2:2)
   padj0b = 0.0
   wadjb(-2:2, -2:2, 1, 1:nw, sps2) = wadjb(-2:2, -2:2, 1, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, -2:2, 0, 1:nw, sps2) = wadjb(-2:2, -2:2, 0, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, -2:2, -1, 1:nw, sps2) = wadjb(-2:2, -2:2, -1, 1:nw, &
   &        sps2) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   wadjb(-2:2, -2:2, -2, 1:nw, sps2) = wadjb(-2:2, -2:2, -2, 1:nw, &
   &        sps2) + wadj0b(-2:2, -2:2, 1:nw)
   wadj0b = 0.0
   ELSE
   padjb(-2:2, -2:2, 0, sps2) = padjb(-2:2, -2:2, 0, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, -2:2, -1, sps2) = padjb(-2:2, -2:2, -1, sps2) + padj2b&
   &        (-2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, -2:2, -2, sps2) = padjb(-2:2, -2:2, -2, sps2) + padj1b&
   &        (-2:2, -2:2)
   padj1b = 0.0
   wadjb(-2:2, -2:2, 0, 1:nw, sps2) = wadjb(-2:2, -2:2, 0, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, -2:2, -1, 1:nw, sps2) = wadjb(-2:2, -2:2, -1, 1:nw, &
   &        sps2) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, -2:2, -2, 1:nw, sps2) = wadjb(-2:2, -2:2, -2, 1:nw, &
   &        sps2) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   END IF
   CALL POPBOOLEAN(secondhalo)
   CASE (kmax) 
   CALL PUSHBOOLEAN(secondhalo)
   ! Other straightforward stuff.
   secondhalo = .true.
   IF (krbeg .EQ. krend) secondhalo = .false.
   IF (secondhalo) THEN
   padjb(-2:2, -2:2, -1, sps2) = padjb(-2:2, -2:2, -1, sps2) + padj3b&
   &        (-2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, -2:2, 0, sps2) = padjb(-2:2, -2:2, 0, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, -2:2, 1, sps2) = padjb(-2:2, -2:2, 1, sps2) + padj1b(-&
   &        2:2, -2:2)
   padj1b = 0.0
   padjb(-2:2, -2:2, 2, sps2) = padjb(-2:2, -2:2, 2, sps2) + padj0b(-&
   &        2:2, -2:2)
   padj0b = 0.0
   wadjb(-2:2, -2:2, -1, 1:nw, sps2) = wadjb(-2:2, -2:2, -1, 1:nw, &
   &        sps2) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, -2:2, 0, 1:nw, sps2) = wadjb(-2:2, -2:2, 0, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, -2:2, 1, 1:nw, sps2) = wadjb(-2:2, -2:2, 1, 1:nw, sps2&
   &        ) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   wadjb(-2:2, -2:2, 2, 1:nw, sps2) = wadjb(-2:2, -2:2, 2, 1:nw, sps2&
   &        ) + wadj0b(-2:2, -2:2, 1:nw)
   wadj0b = 0.0
   ELSE
   padjb(-2:2, -2:2, 0, sps2) = padjb(-2:2, -2:2, 0, sps2) + padj3b(-&
   &        2:2, -2:2)
   padj3b = 0.0
   padjb(-2:2, -2:2, 1, sps2) = padjb(-2:2, -2:2, 1, sps2) + padj2b(-&
   &        2:2, -2:2)
   padj2b = 0.0
   padjb(-2:2, -2:2, 2, sps2) = padjb(-2:2, -2:2, 2, sps2) + padj1b(-&
   &        2:2, -2:2)
   padj1b = 0.0
   wadjb(-2:2, -2:2, 0, 1:nw, sps2) = wadjb(-2:2, -2:2, 0, 1:nw, sps2&
   &        ) + wadj3b(-2:2, -2:2, 1:nw)
   wadj3b = 0.0
   wadjb(-2:2, -2:2, 1, 1:nw, sps2) = wadjb(-2:2, -2:2, 1, 1:nw, sps2&
   &        ) + wadj2b(-2:2, -2:2, 1:nw)
   wadj2b = 0.0
   wadjb(-2:2, -2:2, 2, 1:nw, sps2) = wadjb(-2:2, -2:2, 2, 1:nw, sps2&
   &        ) + wadj1b(-2:2, -2:2, 1:nw)
   wadj1b = 0.0
   END IF
   CALL POPBOOLEAN(secondhalo)
   END SELECT
   END SUBROUTINE EXTRACTBCSTATESNKPC_B
