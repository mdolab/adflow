   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08
   !
   !  Differentiation of computepressurenkpc in forward (tangent) mode:
   !   variations   of useful results: padj
   !   with respect to varying inputs: padj wadj
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          computePressureAdj.f90                          *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 03-19-2006                                      *
   !      * Last modified: 03-20-2006                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE COMPUTEPRESSURENKPC_D(wadj, wadjd, padj, padjd, nn, level, &
   &  sps, sps2)
   USE FLOWVARREFSTATE
   USE INPUTTIMESPECTRAL
   USE INPUTPHYSICS
   IMPLICIT NONE
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Simple routine to compute the pressure from the variables w.   *
   !      * A calorically perfect gas, i.e. constant gamma, is assumed.    *
   !      *                                                                *
   !      ******************************************************************
   !
   !nIntervalTimespectral
   !
   !      Subroutine arguments
   !
   INTEGER(kind=inttype) :: nn, level, sps, sps2
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, nw, &
   &  ntimeintervalsspectral), INTENT(IN) :: wadj
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, nw, &
   &  ntimeintervalsspectral), INTENT(IN) :: wadjd
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, &
   &  ntimeintervalsspectral) :: padj
   REAL(kind=realtype), DIMENSION(-2:2, -2:2, -2:2, &
   &  ntimeintervalsspectral) :: padjd
   !
   !      Local variables
   !
   INTEGER(kind=inttype) :: i, j, k
   REAL(kind=realtype) :: gm1, factk, v2
   REAL(kind=realtype) :: v2d
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   gm1 = gammaconstant - one
   ! Check the situation.
   IF (kpresent) THEN
   ! A separate equation for the turbulent kinetic energy is
   ! present. This variable must be taken into account.
   factk = five*third - gammaconstant
   DO k=-2,2
   DO j=-2,2
   DO i=-2,2
   v2d = 2*wadj(i, j, k, ivx, sps2)*wadjd(i, j, k, ivx, sps2) + 2&
   &            *wadj(i, j, k, ivy, sps2)*wadjd(i, j, k, ivy, sps2) + 2*wadj&
   &            (i, j, k, ivz, sps2)*wadjd(i, j, k, ivz, sps2)
   v2 = wadj(i, j, k, ivx, sps2)**2 + wadj(i, j, k, ivy, sps2)**2&
   &            + wadj(i, j, k, ivz, sps2)**2
   padjd(i, j, k, sps2) = gm1*(wadjd(i, j, k, irhoe, sps2)-half*(&
   &            wadjd(i, j, k, irho, sps2)*v2+wadj(i, j, k, irho, sps2)*v2d)&
   &            ) + factk*(wadjd(i, j, k, irho, sps2)*wadj(i, j, k, itu1, &
   &            sps2)+wadj(i, j, k, irho, sps2)*wadjd(i, j, k, itu1, sps2))
   padj(i, j, k, sps2) = gm1*(wadj(i, j, k, irhoe, sps2)-half*&
   &            wadj(i, j, k, irho, sps2)*v2) + factk*wadj(i, j, k, irho, &
   &            sps2)*wadj(i, j, k, itu1, sps2)
   END DO
   END DO
   END DO
   ELSE
   ! No separate equation for the turbulent kinetic enery.
   ! Use the standard formula.
   DO k=-2,2
   DO j=-2,2
   DO i=-2,2
   v2d = 2*wadj(i, j, k, ivx, sps2)*wadjd(i, j, k, ivx, sps2) + 2&
   &            *wadj(i, j, k, ivy, sps2)*wadjd(i, j, k, ivy, sps2) + 2*wadj&
   &            (i, j, k, ivz, sps2)*wadjd(i, j, k, ivz, sps2)
   v2 = wadj(i, j, k, ivx, sps2)**2 + wadj(i, j, k, ivy, sps2)**2&
   &            + wadj(i, j, k, ivz, sps2)**2
   padjd(i, j, k, sps2) = gm1*(wadjd(i, j, k, irhoe, sps2)-half*(&
   &            wadjd(i, j, k, irho, sps2)*v2+wadj(i, j, k, irho, sps2)*v2d)&
   &            )
   padj(i, j, k, sps2) = gm1*(wadj(i, j, k, irhoe, sps2)-half*&
   &            wadj(i, j, k, irho, sps2)*v2)
   END DO
   END DO
   END DO
   END IF
   END SUBROUTINE COMPUTEPRESSURENKPC_D
