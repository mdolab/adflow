!        generated by tapenade     (inria, tropics team)
!  tapenade 3.10 (r5363) -  9 sep 2014 09:53
!
!  differentiation of computerootbendingmoment in forward (tangent) mode (with options i4 dr8 r8):
!   variations   of useful results: bendingmoment
!   with respect to varying inputs: lengthref pointref cf cm
!
!****************************************************
!
!   filename: rootbendingmomentanalysis.f90
!   author: c.a.(sandy) mader
!   date started: july 10, 2011
!   date modified: july 10,2011
!
!****************************************************
subroutine computerootbendingmoment_d(cf, cfd, cm, cmd, liftindex, &
& bendingmoment, bendingmomentd)
!*******************************************************
!                                                      *
! compute a normalized bending moment coefficient from *
! the force and moment coefficient. at the moment this *
! routine only works for a half body. additional logic *
! would be needed for a full body.                     *
!                                                      *
!*******************************************************
  use inputphysics
  use costfunctions
  use communication
  use inputiteration
  implicit none
!input/output variables
  real(kind=realtype), dimension(3), intent(in) :: cf, cm
  real(kind=realtype), dimension(3), intent(in) :: cfd, cmd
  integer(kind=inttype), intent(in) :: liftindex
  real(kind=realtype), intent(out) :: bendingmoment
  real(kind=realtype), intent(out) :: bendingmomentd
!subroutine variables
  real(kind=realtype) :: elasticmomentx, elasticmomenty, elasticmomentz
  real(kind=realtype) :: elasticmomentxd, elasticmomentyd, &
& elasticmomentzd
  intrinsic sqrt
  real(kind=realtype) :: arg1
  real(kind=realtype) :: arg1d
  bendingmoment = zero
  if (liftindex .eq. 2) then
!z out wing sum momentx,momentz
    elasticmomentxd = cmd(1) + ((cfd(2)*(pointrefec(3)-pointref(3))-cf(2&
&     )*pointrefd(3))*lengthref-cf(2)*(pointrefec(3)-pointref(3))*&
&     lengthrefd)/lengthref**2 - ((cfd(3)*(pointrefec(2)-pointref(2))-cf&
&     (3)*pointrefd(2))*lengthref-cf(3)*(pointrefec(2)-pointref(2))*&
&     lengthrefd)/lengthref**2
    elasticmomentx = cm(1) + cf(2)*(pointrefec(3)-pointref(3))/lengthref&
&     - cf(3)*(pointrefec(2)-pointref(2))/lengthref
    elasticmomentzd = cmd(3) - ((cfd(2)*(pointrefec(1)-pointref(1))-cf(2&
&     )*pointrefd(1))*lengthref-cf(2)*(pointrefec(1)-pointref(1))*&
&     lengthrefd)/lengthref**2 + ((cfd(1)*(pointrefec(2)-pointref(2))-cf&
&     (1)*pointrefd(2))*lengthref-cf(1)*(pointrefec(2)-pointref(2))*&
&     lengthrefd)/lengthref**2
    elasticmomentz = cm(3) - cf(2)*(pointrefec(1)-pointref(1))/lengthref&
&     + cf(1)*(pointrefec(2)-pointref(2))/lengthref
    arg1d = 2*elasticmomentx*elasticmomentxd + 2*elasticmomentz*&
&     elasticmomentzd
    arg1 = elasticmomentx**2 + elasticmomentz**2
    if (arg1 .eq. 0.0_8) then
      bendingmomentd = 0.0_8
    else
      bendingmomentd = arg1d/(2.0*sqrt(arg1))
    end if
    bendingmoment = sqrt(arg1)
  else if (liftindex .eq. 3) then
!y out wing sum momentx,momenty
    elasticmomentxd = cmd(1) + ((cfd(3)*(pointrefec(2)-pointref(2))-cf(3&
&     )*pointrefd(2))*lengthref-cf(3)*(pointrefec(2)-pointref(2))*&
&     lengthrefd)/lengthref**2 + ((cfd(3)*(pointrefec(3)-pointref(3))-cf&
&     (3)*pointrefd(3))*lengthref-cf(3)*(pointrefec(3)-pointref(3))*&
&     lengthrefd)/lengthref**2
    elasticmomentx = cm(1) + cf(3)*(pointrefec(2)-pointref(2))/lengthref&
&     + cf(3)*(pointrefec(3)-pointref(3))/lengthref
    elasticmomentyd = cmd(2) + ((cfd(3)*(pointrefec(1)-pointref(1))-cf(3&
&     )*pointrefd(1))*lengthref-cf(3)*(pointrefec(1)-pointref(1))*&
&     lengthrefd)/lengthref**2 + ((cfd(1)*(pointrefec(3)-pointref(3))-cf&
&     (1)*pointrefd(3))*lengthref-cf(1)*(pointrefec(3)-pointref(3))*&
&     lengthrefd)/lengthref**2
    elasticmomenty = cm(2) + cf(3)*(pointrefec(1)-pointref(1))/lengthref&
&     + cf(1)*(pointrefec(3)-pointref(3))/lengthref
    arg1d = 2*elasticmomentx*elasticmomentxd + 2*elasticmomenty*&
&     elasticmomentyd
    arg1 = elasticmomentx**2 + elasticmomenty**2
    if (arg1 .eq. 0.0_8) then
      bendingmomentd = 0.0_8
    else
      bendingmomentd = arg1d/(2.0*sqrt(arg1))
    end if
    bendingmoment = sqrt(arg1)
  else
    bendingmomentd = 0.0_8
  end if
end subroutine computerootbendingmoment_d
