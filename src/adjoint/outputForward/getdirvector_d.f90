!        generated by tapenade     (inria, tropics team)
!  tapenade 3.10 (r5363) -  9 sep 2014 09:53
!
!  differentiation of getdirvector in forward (tangent) mode (with options i4 dr8 r8):
!   variations   of useful results: winddirection
!   with respect to varying inputs: alpha beta
!
!     ******************************************************************
!     *                                                                *
!     * file:          getdirvector.f90                                *
!     * author:        andre c. marta                                  *
!     * starting date: 10-25-2005                                      *
!     * last modified: 10-26-2006                                      *
!     *                                                                *
!     ******************************************************************
!
subroutine getdirvector_d(refdirection, alpha, alphad, beta, betad, &
& winddirection, winddirectiond, liftindex)
!(xb,yb,zb,alpha,beta,xw,yw,zw)
!
!     ******************************************************************
!     *                                                                *
!     * convert the angle of attack and side slip angle to wind axes.  *
!     * the components of the wind direction vector (xw,yw,zw) are     *
!     * computed given the direction angles in radians and the body    *
!     * direction by performing two rotations on the original          *
!     * direction vector:                                              *
!     *   1) rotation about the zb or yb-axis: alpha clockwise (cw)    *
!     *      (xb,yb,zb) -> (x1,y1,z1)                                  *
!     *                                                                *
!     *   2) rotation about the yl or z1-axis: beta counter-clockwise  *
!     *      (ccw)  (x1,y1,z1) -> (xw,yw,zw)                           *
!     *                                                                *
!     *    input arguments:                                            *
!     *       alpha    = angle of attack in radians                    *
!     *       beta     = side slip angle in radians                    *
!     *       refdirection = reference direction vector                *
!     *    output arguments:                                           *
!     *       winddirection = unit wind vector in body axes            *
!     *                                                                *
!     ******************************************************************
!
  use constants
  use utils_d, only : terminate
  implicit none
!
!     subroutine arguments.
!
  real(kind=realtype), dimension(3), intent(in) :: refdirection
  real(kind=realtype) :: alpha, beta
  real(kind=realtype) :: alphad, betad
  real(kind=realtype), dimension(3), intent(out) :: winddirection
  real(kind=realtype), dimension(3), intent(out) :: winddirectiond
  integer(kind=inttype) :: liftindex
!
!     local variables.
!
  real(kind=realtype) :: rnorm, x1, y1, z1, xbn, ybn, zbn, xw, yw, zw
  real(kind=realtype) :: x1d, y1d, z1d, xbnd, ybnd, zbnd, xwd, ywd, zwd
  real(kind=realtype) :: tmp
  real(kind=realtype) :: tmpd
  intrinsic sqrt
  real(kind=realtype) :: arg1
!     ******************************************************************
!     *                                                                *
!     * begin execution.                                               *
!     *                                                                *
!     ******************************************************************
!
! normalize the input vector.
  arg1 = refdirection(1)**2 + refdirection(2)**2 + refdirection(3)**2
  rnorm = sqrt(arg1)
  xbn = refdirection(1)/rnorm
  ybn = refdirection(2)/rnorm
  zbn = refdirection(3)/rnorm
!!$      ! compute the wind direction vector.
!!$
!!$      ! 1) rotate alpha radians cw about y-axis
!!$      !    ( <=> rotate y-axis alpha radians ccw)
!!$
!!$      call vectorrotation(x1, y1, z1, 2, alpha, xbn, ybn, zbn)
!!$
!!$      ! 2) rotate beta radians ccw about z-axis
!!$      !    ( <=> rotate z-axis -beta radians ccw)
!!$
!!$      call vectorrotation(xw, yw, zw, 3, -beta, x1, y1, z1)
  if (liftindex .eq. 2) then
! compute the wind direction vector.aerosurf axes different!!
! 1) rotate alpha radians cw about z-axis
!    ( <=> rotate z-axis alpha radians ccw)
    tmpd = -alphad
    tmp = -alpha
    zbnd = 0.0_8
    ybnd = 0.0_8
    xbnd = 0.0_8
    call vectorrotation_d(x1, x1d, y1, y1d, z1, z1d, 3, tmp, tmpd, xbn, &
&                   xbnd, ybn, ybnd, zbn, zbnd)
! 2) rotate beta radians ccw about y-axis
!    ( <=> rotate z-axis -beta radians ccw)
    tmpd = -betad
    tmp = -beta
    call vectorrotation_d(xw, xwd, yw, ywd, zw, zwd, 2, tmp, tmpd, x1, &
&                   x1d, y1, y1d, z1, z1d)
  else if (liftindex .eq. 3) then
! compute the wind direction vector.aerosurf axes different!!
! 1) rotate alpha radians cw about z-axis
!    ( <=> rotate z-axis alpha radians ccw)
    zbnd = 0.0_8
    ybnd = 0.0_8
    xbnd = 0.0_8
    call vectorrotation_d(x1, x1d, y1, y1d, z1, z1d, 2, alpha, alphad, &
&                   xbn, xbnd, ybn, ybnd, zbn, zbnd)
! 2) rotate beta radians ccw about y-axis
!    ( <=> rotate z-axis -beta radians ccw)
    call vectorrotation_d(xw, xwd, yw, ywd, zw, zwd, 3, beta, betad, x1&
&                   , x1d, y1, y1d, z1, z1d)
  else
    call terminate('getdirvector', 'invalid lift direction')
    zwd = 0.0_8
    xwd = 0.0_8
    ywd = 0.0_8
  end if
  winddirectiond = 0.0_8
  winddirectiond(1) = xwd
  winddirection(1) = xw
  winddirectiond(2) = ywd
  winddirection(2) = yw
  winddirectiond(3) = zwd
  winddirection(3) = zw
end subroutine getdirvector_d
