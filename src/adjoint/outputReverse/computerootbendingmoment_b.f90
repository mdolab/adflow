!        generated by tapenade     (inria, tropics team)
!  tapenade 3.10 (r5363) -  9 sep 2014 09:53
!
!  differentiation of computerootbendingmoment in reverse (adjoint) mode (with options i4 dr8 r8 noisize):
!   gradient     of useful results: lengthref pointref bendingmoment
!   with respect to varying inputs: lengthref pointref cf cm
!
!****************************************************
!
!   filename: rootbendingmomentanalysis.f90
!   author: c.a.(sandy) mader
!   date started: july 10, 2011
!   date modified: july 10,2011
!
!****************************************************
subroutine computerootbendingmoment_b(cf, cfd, cm, cmd, liftindex, &
& bendingmoment, bendingmomentd)
!*******************************************************
!                                                      *
! compute a normalized bending moment coefficient from *
! the force and moment coefficient. at the moment this *
! routine only works for a half body. additional logic *
! would be needed for a full body.                     *
!                                                      *
!*******************************************************
  use inputphysics
  use costfunctions
  use communication
  use inputiteration
  implicit none
!input/output variables
  real(kind=realtype), dimension(3), intent(in) :: cf, cm
  real(kind=realtype), dimension(3) :: cfd, cmd
  integer(kind=inttype), intent(in) :: liftindex
  real(kind=realtype) :: bendingmoment
  real(kind=realtype) :: bendingmomentd
!subroutine variables
  real(kind=realtype) :: elasticmomentx, elasticmomenty, elasticmomentz
  real(kind=realtype) :: elasticmomentxd, elasticmomentyd, &
& elasticmomentzd
  intrinsic sqrt
  real(kind=realtype) :: temp3
  real(kind=realtype) :: temp2
  real(kind=realtype) :: temp1
  real(kind=realtype) :: temp0
  real(kind=realtype) :: tempd
  real(kind=realtype) :: tempd8
  real(kind=realtype) :: tempd7
  real(kind=realtype) :: tempd6
  real(kind=realtype) :: tempd5
  real(kind=realtype) :: tempd4
  real(kind=realtype) :: tempd3
  real(kind=realtype) :: tempd2
  real(kind=realtype) :: tempd1
  real(kind=realtype) :: tempd0
  real(kind=realtype) :: temp
  real(kind=realtype) :: temp6
  real(kind=realtype) :: temp5
  real(kind=realtype) :: temp4
  if (liftindex .eq. 2) then
!z out wing sum momentx,momentz
    elasticmomentx = cm(1) + cf(2)*(pointrefec(3)-pointref(3))/lengthref&
&     - cf(3)*(pointrefec(2)-pointref(2))/lengthref
    elasticmomentz = cm(3) - cf(2)*(pointrefec(1)-pointref(1))/lengthref&
&     + cf(1)*(pointrefec(2)-pointref(2))/lengthref
    temp0 = cf(3)/lengthref
    if (elasticmomentx**2 + elasticmomentz**2 .eq. 0.0_8) then
      tempd = 0.0
    else
      tempd = bendingmomentd/(2.0*sqrt(elasticmomentx**2+elasticmomentz&
&       **2))
    end if
    elasticmomentxd = 2*elasticmomentx*tempd
    elasticmomentzd = 2*elasticmomentz*tempd
    cfd = 0.0_8
    cmd = 0.0_8
    tempd0 = -((pointrefec(1)-pointref(1))*elasticmomentzd/lengthref)
    temp1 = cf(2)/lengthref
    tempd1 = (pointrefec(2)-pointref(2))*elasticmomentzd/lengthref
    temp2 = cf(1)/lengthref
    cmd(3) = cmd(3) + elasticmomentzd
    cfd(2) = cfd(2) + tempd0
    pointrefd(1) = pointrefd(1) + temp1*elasticmomentzd
    cfd(1) = cfd(1) + tempd1
    pointrefd(2) = pointrefd(2) - temp2*elasticmomentzd
    tempd2 = (pointrefec(3)-pointref(3))*elasticmomentxd/lengthref
    temp = cf(2)/lengthref
    tempd3 = -((pointrefec(2)-pointref(2))*elasticmomentxd/lengthref)
    lengthrefd = lengthrefd - temp*tempd2 - temp0*tempd3 - temp2*tempd1 &
&     - temp1*tempd0
    cmd(1) = cmd(1) + elasticmomentxd
    cfd(2) = cfd(2) + tempd2
    pointrefd(3) = pointrefd(3) - temp*elasticmomentxd
    cfd(3) = cfd(3) + tempd3
    pointrefd(2) = pointrefd(2) + temp0*elasticmomentxd
  else if (liftindex .eq. 3) then
!y out wing sum momentx,momenty
    elasticmomentx = cm(1) + cf(3)*(pointrefec(2)-pointref(2))/lengthref&
&     + cf(3)*(pointrefec(3)-pointref(3))/lengthref
    elasticmomenty = cm(2) + cf(3)*(pointrefec(1)-pointref(1))/lengthref&
&     + cf(1)*(pointrefec(3)-pointref(3))/lengthref
    temp4 = cf(3)/lengthref
    if (elasticmomentx**2 + elasticmomenty**2 .eq. 0.0_8) then
      tempd4 = 0.0
    else
      tempd4 = bendingmomentd/(2.0*sqrt(elasticmomentx**2+elasticmomenty&
&       **2))
    end if
    elasticmomentxd = 2*elasticmomentx*tempd4
    elasticmomentyd = 2*elasticmomenty*tempd4
    cfd = 0.0_8
    cmd = 0.0_8
    tempd5 = (pointrefec(1)-pointref(1))*elasticmomentyd/lengthref
    temp5 = cf(3)/lengthref
    tempd6 = (pointrefec(3)-pointref(3))*elasticmomentyd/lengthref
    temp6 = cf(1)/lengthref
    cmd(2) = cmd(2) + elasticmomentyd
    cfd(3) = cfd(3) + tempd5
    pointrefd(1) = pointrefd(1) - temp5*elasticmomentyd
    cfd(1) = cfd(1) + tempd6
    pointrefd(3) = pointrefd(3) - temp6*elasticmomentyd
    tempd7 = (pointrefec(2)-pointref(2))*elasticmomentxd/lengthref
    temp3 = cf(3)/lengthref
    tempd8 = (pointrefec(3)-pointref(3))*elasticmomentxd/lengthref
    lengthrefd = lengthrefd - temp3*tempd7 - temp4*tempd8 - temp6*tempd6&
&     - temp5*tempd5
    cmd(1) = cmd(1) + elasticmomentxd
    cfd(3) = cfd(3) + tempd8 + tempd7
    pointrefd(2) = pointrefd(2) - temp3*elasticmomentxd
    pointrefd(3) = pointrefd(3) - temp4*elasticmomentxd
  else
    cfd = 0.0_8
    cmd = 0.0_8
  end if
end subroutine computerootbendingmoment_b
