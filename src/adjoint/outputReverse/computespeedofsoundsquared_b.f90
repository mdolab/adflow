!        generated by tapenade     (inria, tropics team)
!  tapenade 3.10 (r5363) -  9 sep 2014 09:53
!
!  differentiation of computespeedofsoundsquared in reverse (adjoint) mode (with options i4 dr8 r8 noisize):
!   gradient     of useful results: *aa *p *w
!   with respect to varying inputs: *p *w
!   plus diff mem management of: aa:in p:in w:in
!
!      ******************************************************************
!      *                                                                *
!      * file:          computespeedofsoundsquared.f90                  *
!      * author:        gaetan k.w. kenway                              *
!      * starting date: 01-20-2014                                      *
!      * last modified: 01-20-2014                                      *
!      *                                                                *
!      ******************************************************************
!
subroutine computespeedofsoundsquared_b()
!
!      ******************************************************************
!      *                                                                *
!      * computespeedofsoundsquared does what it says.                  *
!      *                                                                *
!      ******************************************************************
!
  use constants
  use blockpointers, only : ie, je, ke, w, wd, p, pd, aa, aad, gamma
  implicit none
!
!      local variables.
!
  real(kind=realtype), parameter :: twothird=two*third
  integer(kind=inttype) :: i, j, k, ii
  real(kind=realtype) :: pp
  real(kind=realtype) :: ppd
  logical :: correctfork, getcorrectfork
  intrinsic mod
  real(kind=realtype) :: temp0
  real(kind=realtype) :: tempd
  real(kind=realtype) :: tempd0
  real(kind=realtype) :: temp
! determine if we need to correct for k
  correctfork = getcorrectfork()
  if (correctfork) then
    do ii=0,ie*je*ke-1
      i = mod(ii, ie) + 1
      j = mod(ii/ie, je) + 1
      k = ii/(ie*je) + 1
      pp = p(i, j, k) - twothird*w(i, j, k, irho)*w(i, j, k, itu1)
      temp = w(i, j, k, irho)
      tempd = gamma(i, j, k)*aad(i, j, k)/temp
      ppd = tempd
      wd(i, j, k, irho) = wd(i, j, k, irho) - pp*tempd/temp
      aad(i, j, k) = 0.0_8
      pd(i, j, k) = pd(i, j, k) + ppd
      wd(i, j, k, irho) = wd(i, j, k, irho) - twothird*w(i, j, k, itu1)*&
&       ppd
      wd(i, j, k, itu1) = wd(i, j, k, itu1) - twothird*w(i, j, k, irho)*&
&       ppd
    end do
  else
    do ii=0,ie*je*ke-1
      i = mod(ii, ie) + 1
      j = mod(ii/ie, je) + 1
      k = ii/(ie*je) + 1
      temp0 = w(i, j, k, irho)
      tempd0 = gamma(i, j, k)*aad(i, j, k)/temp0
      pd(i, j, k) = pd(i, j, k) + tempd0
      wd(i, j, k, irho) = wd(i, j, k, irho) - p(i, j, k)*tempd0/temp0
      aad(i, j, k) = 0.0_8
    end do
  end if
end subroutine computespeedofsoundsquared_b
