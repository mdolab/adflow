!        generated by tapenade     (inria, ecuador team)
!  tapenade 3.16 (develop) - 22 aug 2023 15:51
!
module actuatorregion_b
  use constants
  use communication, only : commtype, internalcommtype
  use actuatorregiondata
  implicit none

contains
  subroutine computecellspatialmetrics(i, j, k, centerpoint, &
&   thrustvector, distance2plane, distance2axis)
    use constants
    use blockpointers, only : x
    implicit none
! inputs
    real(kind=realtype), dimension(3), intent(in) :: centerpoint, &
&   thrustvector
    integer(kind=inttype), intent(in) :: i, j, k
! outputs
    real(kind=realtype), intent(out) :: distance2axis, distance2plane
! working
    real(kind=realtype) :: thrustvectornorm, dotproduct, norm
    real(kind=realtype), dimension(3) :: xcen, distance2center, &
&   crossproduct
    intrinsic sqrt
! compute the cell center
    xcen = eighth*(x(i-1, j-1, k-1, :)+x(i, j-1, k-1, :)+x(i-1, j, k-1, &
&     :)+x(i, j, k-1, :)+x(i-1, j-1, k, :)+x(i, j-1, k, :)+x(i-1, j, k, &
&     :)+x(i, j, k, :))
    thrustvectornorm = sqrt(thrustvector(1)**2 + thrustvector(2)**2 + &
&     thrustvector(3)**2)
    distance2center = xcen - centerpoint
! compute distance to plane
    dotproduct = thrustvector(1)*distance2center(1) + thrustvector(2)*&
&     distance2center(2) + thrustvector(3)*distance2center(3)
    distance2plane = dotproduct/thrustvectornorm
! compute distance to axis
    crossproduct(1) = distance2center(2)*thrustvector(3) - &
&     distance2center(3)*thrustvector(2)
    crossproduct(2) = distance2center(3)*thrustvector(1) - &
&     distance2center(1)*thrustvector(3)
    crossproduct(3) = distance2center(1)*thrustvector(2) - &
&     distance2center(2)*thrustvector(1)
    norm = sqrt(crossproduct(1)**2 + crossproduct(2)**2 + crossproduct(3&
&     )**2)
    distance2axis = norm/thrustvectornorm
  end subroutine computecellspatialmetrics
! ----------------------------------------------------------------------
!                                                                      |
!                    no tapenade routine below this line               |
!                                                                      |
! ----------------------------------------------------------------------

end module actuatorregion_b

