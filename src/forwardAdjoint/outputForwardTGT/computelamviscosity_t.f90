   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.7 (r4786) - 21 Feb 2013 15:53
   !
   !  Differentiation of computelamviscosity in forward (tangent) mode (with options debugTangent i4 dr8 r8):
   !   variations   of useful results: *p *rlv
   !   with respect to varying inputs: *p *w muref rgas
   !   Plus diff mem management of: p:in w:in rlv:in
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          computeLamViscosity.f90                         *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 03-10-2003                                      *
   !      * Last modified: 06-12-2005                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE COMPUTELAMVISCOSITY_T()
   USE CONSTANTS
   USE ITERATION
   USE FLOWVARREFSTATE
   USE BLOCKPOINTERS_D
   USE INPUTPHYSICS
   USE DIFFSIZES
   !  Hint: ISIZE4OFDrfw should be the size of dimension 4 of array *w
   !  Hint: ISIZE3OFDrfw should be the size of dimension 3 of array *w
   !  Hint: ISIZE2OFDrfw should be the size of dimension 2 of array *w
   !  Hint: ISIZE1OFDrfw should be the size of dimension 1 of array *w
   !  Hint: ISIZE3OFDrfp should be the size of dimension 3 of array *p
   !  Hint: ISIZE2OFDrfp should be the size of dimension 2 of array *p
   !  Hint: ISIZE1OFDrfp should be the size of dimension 1 of array *p
   !  Hint: ISIZE3OFDrfrlv should be the size of dimension 3 of array *rlv
   !  Hint: ISIZE2OFDrfrlv should be the size of dimension 2 of array *rlv
   !  Hint: ISIZE1OFDrfrlv should be the size of dimension 1 of array *rlv
   IMPLICIT NONE
   !
   !      ******************************************************************
   !      *                                                                *
   !      * computeLamViscosity computes the laminar viscosity ratio in    *
   !      * the owned cell centers of the given block. Sutherland's law is *
   !      * used. It is assumed that the pointes already point to the      *
   !      * correct block before entering this subroutine.                 *
   !      *                                                                *
   !      ******************************************************************
   !
   !
   !      Local parameter.
   !
   REAL(kind=realtype), PARAMETER :: twothird=two*third
   !
   !      Local variables.
   !
   INTEGER(kind=inttype) :: i, j, k
   REAL(kind=realtype) :: musuth, tsuth, ssuth, t
   REAL(kind=realtype) :: musuthd, td
   LOGICAL :: correctfork
   EXTERNAL DEBUG_TGT_HERE
   LOGICAL :: DEBUG_TGT_HERE
   IF (.TRUE. .AND. DEBUG_TGT_HERE('entry', .FALSE.)) THEN
   CALL DEBUG_TGT_REAL8ARRAY('p', p, pd, ISIZE1OFDrfp*ISIZE2OFDrfp*&
   &                        ISIZE3OFDrfp)
   CALL DEBUG_TGT_REAL8ARRAY('w', w, wd, ISIZE1OFDrfw*ISIZE2OFDrfw*&
   &                        ISIZE3OFDrfw*ISIZE4OFDrfw)
   CALL DEBUG_TGT_REAL8('muref', muref, murefd)
   CALL DEBUG_TGT_REAL8('rgas', rgas, rgasd)
   CALL DEBUG_TGT_DISPLAY('entry')
   END IF
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Return immediately if no laminar viscosity needs to be computed.
   IF (.NOT.viscous) THEN
   rlvd = 0.0_8
   IF (.TRUE. .AND. DEBUG_TGT_HERE('exit', .FALSE.)) THEN
   CALL DEBUG_TGT_REAL8ARRAY('p', p, pd, ISIZE1OFDrfp*ISIZE2OFDrfp*&
   &                          ISIZE3OFDrfp)
   CALL DEBUG_TGT_REAL8ARRAY('rlv', rlv, rlvd, ISIZE1OFDrfrlv*&
   &                          ISIZE2OFDrfrlv*ISIZE3OFDrfrlv)
   CALL DEBUG_TGT_DISPLAY('exit')
   END IF
   RETURN
   ELSE
   ! Determine whether or not the pressure must be corrected
   ! for the presence of the turbulent kinetic energy.
   IF (kpresent) THEN
   IF (currentlevel .LE. groundlevel .OR. turbcoupled) THEN
   correctfork = .true.
   ELSE
   correctfork = .false.
   END IF
   ELSE
   correctfork = .false.
   END IF
   ! Compute the nonDimensional constants in sutherland's law.
   musuthd = -(musuthdim*murefd/muref**2)
   musuth = musuthdim/muref
   tsuth = tsuthdim/tref
   ssuth = ssuthdim/tref
   ! Substract 2/3 rho k, which is a part of the normal turbulent
   ! stresses, in case the pressure must be corrected.
   IF (correctfork) THEN
   DO k=2,kl
   DO j=2,jl
   DO i=2,il
   IF (.TRUE. .AND. DEBUG_TGT_HERE('middle', .FALSE.)) THEN
   CALL DEBUG_TGT_REAL8ARRAY('p', p, pd, ISIZE1OFDrfp*&
   &                                  ISIZE2OFDrfp*ISIZE3OFDrfp)
   CALL DEBUG_TGT_REAL8ARRAY('w', w, wd, ISIZE1OFDrfw*&
   &                                  ISIZE2OFDrfw*ISIZE3OFDrfw*ISIZE4OFDrfw&
   &                                 )
   CALL DEBUG_TGT_REAL8('rgas', rgas, rgasd)
   CALL DEBUG_TGT_REAL8('musuth', musuth, musuthd)
   CALL DEBUG_TGT_DISPLAY('middle')
   END IF
   pd(i, j, k) = pd(i, j, k) - twothird*(wd(i, j, k, irho)*w(i&
   &              , j, k, itu1)+w(i, j, k, irho)*wd(i, j, k, itu1))
   p(i, j, k) = p(i, j, k) - twothird*w(i, j, k, irho)*w(i, j, &
   &              k, itu1)
   END DO
   END DO
   END DO
   rlvd = 0.0_8
   ELSE
   rlvd = 0.0_8
   END IF
   ! Loop over the owned cells of this block and compute the
   ! laminar viscosity ratio.
   DO k=2,kl
   DO j=2,jl
   DO i=2,il
   ! Compute the nonDimensional temperature and the
   ! nonDimensional laminar viscosity.
   td = (pd(i, j, k)*rgas*w(i, j, k, irho)-p(i, j, k)*(rgasd*w(i&
   &            , j, k, irho)+rgas*wd(i, j, k, irho)))/(rgas*w(i, j, k, irho&
   &            ))**2
   t = p(i, j, k)/(rgas*w(i, j, k, irho))
   rlvd(i, j, k) = (musuthd*(tsuth+ssuth)/(t+ssuth)-musuth*(tsuth&
   &            +ssuth)*td/(t+ssuth)**2)*(t/tsuth)**1.5_realType + musuth*(&
   &            tsuth+ssuth)*1.5_realType*(t/tsuth)**0.5*td/((t+ssuth)*tsuth&
   &            )
   rlv(i, j, k) = musuth*((tsuth+ssuth)/(t+ssuth))*(t/tsuth)**&
   &            1.5_realType
   END DO
   END DO
   END DO
   ! Add the 2/3 rho k again to the pressure if the pressure was
   ! corrected earlier.
   IF (correctfork) THEN
   DO k=2,kl
   DO j=2,jl
   DO i=2,il
   pd(i, j, k) = pd(i, j, k) + twothird*(wd(i, j, k, irho)*w(i&
   &              , j, k, itu1)+w(i, j, k, irho)*wd(i, j, k, itu1))
   p(i, j, k) = p(i, j, k) + twothird*w(i, j, k, irho)*w(i, j, &
   &              k, itu1)
   END DO
   END DO
   END DO
   END IF
   END IF
   IF (.TRUE. .AND. DEBUG_TGT_HERE('exit', .FALSE.)) THEN
   CALL DEBUG_TGT_REAL8ARRAY('p', p, pd, ISIZE1OFDrfp*ISIZE2OFDrfp*&
   &                        ISIZE3OFDrfp)
   CALL DEBUG_TGT_REAL8ARRAY('rlv', rlv, rlvd, ISIZE1OFDrfrlv*&
   &                        ISIZE2OFDrfrlv*ISIZE3OFDrfrlv)
   CALL DEBUG_TGT_DISPLAY('exit')
   END IF
   END SUBROUTINE COMPUTELAMVISCOSITY_T
