   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.7 (r4786) - 21 Feb 2013 15:53
   !
   !  Differentiation of vectorrotation in forward (tangent) mode (with options debugTangent i4 dr8 r8):
   !   variations   of useful results: xp yp zp
   !   with respect to varying inputs: x y z angle
   !
   !     ******************************************************************
   !     *                                                                *
   !     * File:          vectorRotation.f90                              *
   !     * Author:        Andre C. Marta                                  *
   !     * Starting date: 06-23-2006                                      *
   !     * Last modified: 07-28-2006                                      *
   !     *                                                                *
   !     ******************************************************************
   !
   SUBROUTINE VECTORROTATION_T(xp, xpd, yp, ypd, zp, zpd, iaxis, angle, &
   &  angled, x, xd, y, yd, z, zd)
   USE PRECISION
   IMPLICIT NONE
   !
   !     ****************************************************************
   !     *                                                              *
   !     * vectorRotation rotates a given vector with respect to a      *
   !     * specified axis by a given angle.                             *
   !     *                                                              *
   !     *    input arguments:                                          *
   !     *       iaxis      = rotation axis (1-x, 2-y, 3-z)             *
   !     *       angle      = rotation angle (measured ccw in radians)  *
   !     *       x, y, z    = coordinates in original system            *
   !     *    output arguments:                                         *
   !     *       xp, yp, zp = coordinates in rotated system             *
   !     *                                                              *
   !     ****************************************************************
   !
   !
   !     Subroutine arguments.
   !
   INTEGER(kind=inttype), INTENT(IN) :: iaxis
   REAL(kind=realtype), INTENT(IN) :: angle, x, y, z
   REAL(kind=realtype), INTENT(IN) :: angled, xd, yd, zd
   REAL(kind=realtype), INTENT(OUT) :: xp, yp, zp
   REAL(kind=realtype), INTENT(OUT) :: xpd, ypd, zpd
   INTRINSIC COS
   INTRINSIC SIN
   EXTERNAL DEBUG_TGT_HERE
   LOGICAL :: DEBUG_TGT_HERE
   IF (.TRUE. .AND. DEBUG_TGT_HERE('entry', .FALSE.)) THEN
   CALL DEBUG_TGT_REAL8('x', x, xd)
   CALL DEBUG_TGT_REAL8('y', y, yd)
   CALL DEBUG_TGT_REAL8('z', z, zd)
   CALL DEBUG_TGT_REAL8('angle', angle, angled)
   CALL DEBUG_TGT_DISPLAY('entry')
   END IF
   !
   !     ******************************************************************
   !     *                                                                *
   !     * Begin execution                                                *
   !     *                                                                *
   !     ******************************************************************
   !
   ! rotation about specified axis by specified angle
   SELECT CASE  (iaxis) 
   CASE (1) 
   ! rotation about the x-axis
   xpd = xd
   xp = 1.*x + 0.*y + 0.*z
   ypd = COS(angle)*yd - angled*SIN(angle)*y + angled*COS(angle)*z + &
   &      SIN(angle)*zd
   yp = 0.*x + COS(angle)*y + SIN(angle)*z
   zpd = COS(angle)*zd - SIN(angle)*yd - angled*COS(angle)*y - angled*&
   &      SIN(angle)*z
   zp = 0.*x - SIN(angle)*y + COS(angle)*z
   CASE (2) 
   IF (.TRUE. .AND. DEBUG_TGT_HERE('middle', .FALSE.)) THEN
   CALL DEBUG_TGT_REAL8('x', x, xd)
   CALL DEBUG_TGT_REAL8('y', y, yd)
   CALL DEBUG_TGT_REAL8('z', z, zd)
   CALL DEBUG_TGT_REAL8('angle', angle, angled)
   CALL DEBUG_TGT_DISPLAY('middle')
   END IF
   ! rotation about the y-axis
   xpd = COS(angle)*xd - angled*SIN(angle)*x - angled*COS(angle)*z - &
   &      SIN(angle)*zd
   xp = COS(angle)*x + 0.*y - SIN(angle)*z
   ypd = yd
   yp = 0.*x + 1.*y + 0.*z
   zpd = angled*COS(angle)*x + SIN(angle)*xd + COS(angle)*zd - angled*&
   &      SIN(angle)*z
   zp = SIN(angle)*x + 0.*y + COS(angle)*z
   CASE (3) 
   ! rotation about the z-axis
   xpd = COS(angle)*xd - angled*SIN(angle)*x + angled*COS(angle)*y + &
   &      SIN(angle)*yd
   xp = COS(angle)*x + SIN(angle)*y + 0.*z
   ypd = COS(angle)*yd - SIN(angle)*xd - angled*COS(angle)*x - angled*&
   &      SIN(angle)*y
   yp = -(SIN(angle)*x) + COS(angle)*y + 0.*z
   zpd = zd
   zp = 0.*x + 0.*y + 1.*z
   CASE DEFAULT
   WRITE(*, *) 'vectorRotation called with invalid arguments'
   STOP
   END SELECT
   IF (.TRUE. .AND. DEBUG_TGT_HERE('exit', .FALSE.)) THEN
   CALL DEBUG_TGT_REAL8('xp', xp, xpd)
   CALL DEBUG_TGT_REAL8('yp', yp, ypd)
   CALL DEBUG_TGT_REAL8('zp', zp, zpd)
   CALL DEBUG_TGT_DISPLAY('exit')
   END IF
   END SUBROUTINE VECTORROTATION_T
