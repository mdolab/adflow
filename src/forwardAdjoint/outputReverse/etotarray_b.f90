   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.10 (r5363) -  9 Sep 2014 09:53
   !
   !  Differentiation of etotarray in reverse (adjoint) mode (with options i4 dr8 r8 noISIZE):
   !   gradient     of useful results: p etot rho (global)tref (global)rgas
   !   with respect to varying inputs: k p u v w etot rho (global)tref
   !                (global)rgas
   !      ==================================================================
   SUBROUTINE ETOTARRAY_B(rho, rhod, u, ud, v, vd, w, wd, p, pd, k, kd, &
   & etot, etotd, correctfork, kk)
   !
   !      ******************************************************************
   !      *                                                                *
   !      * EtotArray computes the total energy from the given density,    *
   !      * velocity and presssure for the given kk elements of the arrays.*
   !      * First the internal energy per unit mass is computed and after  *
   !      * that the kinetic energy is added as well the conversion to     *
   !      * energy per unit volume.                                        *
   !      *                                                                *
   !      ******************************************************************
   !
   USE CONSTANTS
   IMPLICIT NONE
   INTEGER(kind=inttype), INTENT(IN) :: kk
   !
   !      Subroutine arguments.
   !
   REAL(kind=realtype), DIMENSION(kk), INTENT(IN) :: rho, p, k
   REAL(kind=realtype), DIMENSION(kk) :: rhod, pd, kd
   REAL(kind=realtype), DIMENSION(kk), INTENT(IN) :: u, v, w
   REAL(kind=realtype), DIMENSION(kk) :: ud, vd, wd
   REAL(kind=realtype), DIMENSION(kk) :: etot
   REAL(kind=realtype), DIMENSION(kk) :: etotd
   LOGICAL, INTENT(IN) :: correctfork
   !
   !      Local variables.
   !
   INTEGER(kind=inttype) :: i
   REAL(kind=realtype) :: tempd
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Compute the internal energy for unit mass.
   CALL PUSHREAL8ARRAY(etot, kk)
   CALL EINTARRAY(rho, p, k, etot, correctfork, kk)
   ud = 0.0_8
   vd = 0.0_8
   wd = 0.0_8
   DO i=kk,1,-1
   tempd = rho(i)*half*etotd(i)
   rhod(i) = rhod(i) + (etot(i)+half*(u(i)**2+v(i)**2+w(i)**2))*etotd(i&
   &     )
   ud(i) = ud(i) + 2*u(i)*tempd
   vd(i) = vd(i) + 2*v(i)*tempd
   wd(i) = wd(i) + 2*w(i)*tempd
   etotd(i) = rho(i)*etotd(i)
   END DO
   CALL POPREAL8ARRAY(etot, kk)
   CALL EINTARRAY_B(rho, rhod, p, pd, k, kd, etot, etotd, correctfork, kk&
   &           )
   END SUBROUTINE ETOTARRAY_B
