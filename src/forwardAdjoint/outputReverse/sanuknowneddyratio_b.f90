   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.10 (r5363) -  9 Sep 2014 09:53
   !
   !  Differentiation of sanuknowneddyratio in reverse (adjoint) mode (with options i4 dr8 r8 noISIZE):
   !   gradient     of useful results: sanuknowneddyratio
   !   with respect to varying inputs: nulam
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          saNuFromEddyRatio.f90                           *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 06-22-2003                                      *
   !      * Last modified: 04-12-2005                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE SANUKNOWNEDDYRATIO_B(eddyratio, nulam, nulamd, &
   & sanuknowneddyratiod)
   !
   !      ******************************************************************
   !      *                                                                *
   !      * saNuKnownEddyRatio computes the Spalart-Allmaras transport     *
   !      * variable nu for the given eddy viscosity ratio.                *
   !      *                                                                *
   !      ******************************************************************
   !
   USE CONSTANTS
   USE PARAMTURB
   IMPLICIT NONE
   !
   !      Function type.
   !
   REAL(kind=realtype) :: sanuknowneddyratio
   REAL(kind=realtype) :: sanuknowneddyratiod
   !
   !      Function arguments.
   !
   REAL(kind=realtype), INTENT(IN) :: eddyratio, nulam
   REAL(kind=realtype) :: nulamd
   !
   !      Local variables.
   !
   REAL(kind=realtype) :: cv13, chi, chi2, chi3, chi4, f, df, dchi
   INTRINSIC ABS
   REAL(kind=realtype) :: abs0
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Take care of the exceptional cases.
   IF (eddyratio .LE. zero) THEN
   nulamd = 0.0_8
   ELSE
   ! Set the value of cv1^3, which is the constant appearing in the
   ! sa function fv1 to compute the eddy viscosity
   cv13 = rsacv1**3
   ! Determine the value of chi, which is given by the quartic
   ! polynomial chi^4 - ratio*(chi^3 + cv1^3) = 0.
   ! First determine the start value, depending on the eddyRatio.
   IF (eddyratio .LT. 1.e-4_realType) THEN
   chi = 0.5_realType
   ELSE IF (eddyratio .LT. 1.0_realType) THEN
   chi = 5.0_realType
   ELSE IF (eddyratio .LT. 10.0_realType) THEN
   chi = 10.0_realType
   ELSE
   chi = eddyratio
   END IF
   ! Compute the function value and the derivative.
   100 chi2 = chi*chi
   chi3 = chi*chi2
   chi4 = chi*chi3
   f = chi4 - eddyratio*(chi3+cv13)
   df = four*chi3 - three*eddyratio*chi2
   ! Compute the negative update and the new value of chi.
   dchi = f/df
   chi = chi - dchi
   IF (dchi/chi .GE. 0.) THEN
   abs0 = dchi/chi
   ELSE
   abs0 = -(dchi/chi)
   END IF
   ! Condition to exit the loop.
   IF (abs0 .GT. thresholdreal) GOTO 100
   nulamd = chi*sanuknowneddyratiod
   END IF
   END SUBROUTINE SANUKNOWNEDDYRATIO_B
