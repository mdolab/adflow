   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.10 (r5363) -  9 Sep 2014 09:53
   !
   !  Differentiation of computerootbendingmoment in reverse (adjoint) mode (with options i4 dr8 r8 noISIZE):
   !   gradient     of useful results: lengthref pointref bendingmoment
   !   with respect to varying inputs: lengthref pointref cf cm
   !
   !****************************************************
   !
   !   Filename: rootBendingMomentAnalysis.f90
   !   Author: C.A.(Sandy) Mader
   !   Date Started: July 10, 2011
   !   Date Modified: July 10,2011
   !
   !****************************************************
   SUBROUTINE COMPUTEROOTBENDINGMOMENT_B(cf, cfb, cm, cmb, liftindex, &
   & bendingmoment, bendingmomentb)
   !*******************************************************
   !                                                      *
   ! Compute a normalized bending moment coefficient from *
   ! the force and moment coefficient. At the moment this *
   ! Routine only works for a half body. Additional logic *
   ! would be needed for a full body.                     *
   !                                                      *
   !*******************************************************
   USE INPUTPHYSICS
   USE COSTFUNCTIONS
   USE COMMUNICATION
   USE INPUTITERATION
   IMPLICIT NONE
   !input/output variables
   REAL(kind=realtype), DIMENSION(3), INTENT(IN) :: cf, cm
   REAL(kind=realtype), DIMENSION(3) :: cfb, cmb
   INTEGER(kind=inttype), INTENT(IN) :: liftindex
   REAL(kind=realtype) :: bendingmoment
   REAL(kind=realtype) :: bendingmomentb
   !Subroutine Variables
   REAL(kind=realtype) :: elasticmomentx, elasticmomenty, elasticmomentz
   REAL(kind=realtype) :: elasticmomentxb, elasticmomentyb, &
   & elasticmomentzb
   INTRINSIC SQRT
   REAL(kind=realtype) :: temp3
   REAL(kind=realtype) :: temp2
   REAL(kind=realtype) :: temp1
   REAL(kind=realtype) :: temp0
   REAL(kind=realtype) :: tempb8
   REAL(kind=realtype) :: tempb7
   REAL(kind=realtype) :: tempb6
   REAL(kind=realtype) :: tempb5
   REAL(kind=realtype) :: tempb4
   REAL(kind=realtype) :: tempb3
   REAL(kind=realtype) :: tempb2
   REAL(kind=realtype) :: tempb1
   REAL(kind=realtype) :: tempb0
   REAL(kind=realtype) :: tempb
   REAL(kind=realtype) :: temp
   REAL(kind=realtype) :: temp6
   REAL(kind=realtype) :: temp5
   REAL(kind=realtype) :: temp4
   IF (liftindex .EQ. 2) THEN
   !z out wing sum momentx,momentz
   elasticmomentx = cm(1) + cf(2)*(pointrefec(3)-pointref(3))/lengthref&
   &     - cf(3)*(pointrefec(2)-pointref(2))/lengthref
   elasticmomentz = cm(3) - cf(2)*(pointrefec(1)-pointref(1))/lengthref&
   &     + cf(1)*(pointrefec(2)-pointref(2))/lengthref
   temp0 = cf(3)/lengthref
   IF (elasticmomentx**2 + elasticmomentz**2 .EQ. 0.0_8) THEN
   tempb = 0.0
   ELSE
   tempb = bendingmomentb/(2.0*SQRT(elasticmomentx**2+elasticmomentz&
   &       **2))
   END IF
   elasticmomentxb = 2*elasticmomentx*tempb
   elasticmomentzb = 2*elasticmomentz*tempb
   cfb = 0.0_8
   cmb = 0.0_8
   tempb0 = -((pointrefec(1)-pointref(1))*elasticmomentzb/lengthref)
   temp1 = cf(2)/lengthref
   tempb1 = (pointrefec(2)-pointref(2))*elasticmomentzb/lengthref
   temp2 = cf(1)/lengthref
   cmb(3) = cmb(3) + elasticmomentzb
   cfb(2) = cfb(2) + tempb0
   pointrefb(1) = pointrefb(1) + temp1*elasticmomentzb
   cfb(1) = cfb(1) + tempb1
   pointrefb(2) = pointrefb(2) - temp2*elasticmomentzb
   tempb2 = (pointrefec(3)-pointref(3))*elasticmomentxb/lengthref
   temp = cf(2)/lengthref
   tempb3 = -((pointrefec(2)-pointref(2))*elasticmomentxb/lengthref)
   lengthrefb = lengthrefb - temp*tempb2 - temp0*tempb3 - temp2*tempb1 &
   &     - temp1*tempb0
   cmb(1) = cmb(1) + elasticmomentxb
   cfb(2) = cfb(2) + tempb2
   pointrefb(3) = pointrefb(3) - temp*elasticmomentxb
   cfb(3) = cfb(3) + tempb3
   pointrefb(2) = pointrefb(2) + temp0*elasticmomentxb
   ELSE IF (liftindex .EQ. 3) THEN
   !y out wing sum momentx,momenty
   elasticmomentx = cm(1) + cf(3)*(pointrefec(2)-pointref(2))/lengthref&
   &     + cf(3)*(pointrefec(3)-pointref(3))/lengthref
   elasticmomenty = cm(2) + cf(3)*(pointrefec(1)-pointref(1))/lengthref&
   &     + cf(1)*(pointrefec(3)-pointref(3))/lengthref
   temp4 = cf(3)/lengthref
   IF (elasticmomentx**2 + elasticmomenty**2 .EQ. 0.0_8) THEN
   tempb4 = 0.0
   ELSE
   tempb4 = bendingmomentb/(2.0*SQRT(elasticmomentx**2+elasticmomenty&
   &       **2))
   END IF
   elasticmomentxb = 2*elasticmomentx*tempb4
   elasticmomentyb = 2*elasticmomenty*tempb4
   cfb = 0.0_8
   cmb = 0.0_8
   tempb5 = (pointrefec(1)-pointref(1))*elasticmomentyb/lengthref
   temp5 = cf(3)/lengthref
   tempb6 = (pointrefec(3)-pointref(3))*elasticmomentyb/lengthref
   temp6 = cf(1)/lengthref
   cmb(2) = cmb(2) + elasticmomentyb
   cfb(3) = cfb(3) + tempb5
   pointrefb(1) = pointrefb(1) - temp5*elasticmomentyb
   cfb(1) = cfb(1) + tempb6
   pointrefb(3) = pointrefb(3) - temp6*elasticmomentyb
   tempb7 = (pointrefec(2)-pointref(2))*elasticmomentxb/lengthref
   temp3 = cf(3)/lengthref
   tempb8 = (pointrefec(3)-pointref(3))*elasticmomentxb/lengthref
   lengthrefb = lengthrefb - temp3*tempb7 - temp4*tempb8 - temp6*tempb6&
   &     - temp5*tempb5
   cmb(1) = cmb(1) + elasticmomentxb
   cfb(3) = cfb(3) + tempb8 + tempb7
   pointrefb(2) = pointrefb(2) - temp3*elasticmomentxb
   pointrefb(3) = pointrefb(3) - temp4*elasticmomentxb
   ELSE
   cfb = 0.0_8
   cmb = 0.0_8
   END IF
   END SUBROUTINE COMPUTEROOTBENDINGMOMENT_B
