   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.6 (r4159) - 21 Sep 2011 10:11
   !
   !  Differentiation of invisciddissfluxscalarcoarse in reverse (adjoint) mode:
   !   gradient     of useful results: *p *w *fw
   !   with respect to varying inputs: *p *w *radi *radj *radk
   !   Plus diff mem management of: p:in w:in fw:in radi:in radj:in
   !                radk:in
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          inviscidDissFluxScalarCoarse.f90                *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 03-25-2003                                      *
   !      * Last modified: 08-25-2005                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE INVISCIDDISSFLUXSCALARCOARSE_B()
   USE BLOCKPOINTERS_B
   USE INPUTDISCRETIZATION
   USE CONSTANTS
   USE ITERATION
   IMPLICIT NONE
   !
   !      ******************************************************************
   !      *                                                                *
   !      * inviscidDissFluxScalarCoarse computes the coarse grid, i.e.    *
   !      * 1st order, artificial dissipation flux for the scalar          *
   !      * dissipation scheme for a given block. Therefore it is assumed  *
   !      * that the pointers in blockPointers already point to the        *
   !      * correct block.                                                 *
   !      *                                                                *
   !      ******************************************************************
   !
   !
   !      Local variables.
   !
   INTEGER(kind=inttype) :: i, j, k
   REAL(kind=realtype) :: sfil, fis0, dis0, ppor, fs, rhoi
   REAL(kind=realtype) :: dis0b, fsb, rhoib
   REAL(kind=realtype) :: tmp
   REAL(kind=realtype) :: tmp0
   REAL(kind=realtype) :: tmp1
   REAL(kind=realtype) :: tempb1
   REAL(kind=realtype) :: tempb0
   REAL(kind=realtype) :: tmpb
   REAL(kind=realtype) :: tmp0b
   INTRINSIC ABS
   REAL(kind=realtype) :: tempb
   REAL(kind=realtype) :: abs0
   REAL(kind=realtype) :: temp
   REAL(kind=realtype) :: tmp1b
   IF (rfil .GE. 0.) THEN
   abs0 = rfil
   ELSE
   abs0 = -rfil
   END IF
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Check if rFil == 0. If so, the dissipative flux needs not to
   ! be computed.
   IF (abs0 .LT. thresholdreal) THEN
   radib = 0.0_8
   radjb = 0.0_8
   radkb = 0.0_8
   ELSE
   ! Set a couple of constants for the scheme.
   fis0 = rfil*vis2coarse
   ! Replace the total energy by rho times the total enthalpy.
   ! In this way the numerical solution is total enthalpy preserving
   ! for the steady Euler equations. Also replace the velocities by
   ! the momentum. As only first order halo's are needed, only include
   ! the first order halo's.
   DO k=1,ke
   DO j=1,je
   DO i=1,ie
   tmp = w(i, j, k, irho)*w(i, j, k, ivx)
   CALL PUSHREAL8(w(i, j, k, ivx))
   w(i, j, k, ivx) = tmp
   tmp0 = w(i, j, k, irho)*w(i, j, k, ivy)
   CALL PUSHREAL8(w(i, j, k, ivy))
   w(i, j, k, ivy) = tmp0
   tmp1 = w(i, j, k, irho)*w(i, j, k, ivz)
   CALL PUSHREAL8(w(i, j, k, ivz))
   w(i, j, k, ivz) = tmp1
   CALL PUSHREAL8(w(i, j, k, irhoe))
   w(i, j, k, irhoe) = w(i, j, k, irhoe) + p(i, j, k)
   END DO
   END DO
   END DO
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Dissipative fluxes in the i-direction.                         *
   !      *                                                                *
   !      ******************************************************************
   !
   DO k=2,kl
   DO j=2,jl
   DO i=1,il
   CALL PUSHREAL8(ppor)
   ! Compute the dissipation coefficients for this face.
   ppor = zero
   IF (pori(i, j, k) .EQ. normalflux) ppor = half
   END DO
   END DO
   END DO
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Dissipative fluxes in the j-direction.                         *
   !      *                                                                *
   !      ******************************************************************
   !
   DO k=2,kl
   DO j=1,jl
   DO i=2,il
   CALL PUSHREAL8(ppor)
   ! Compute the dissipation coefficients for this face.
   ppor = zero
   IF (porj(i, j, k) .EQ. normalflux) ppor = half
   END DO
   END DO
   END DO
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Dissipative fluxes in the k-direction.                         *
   !      *                                                                *
   !      ******************************************************************
   !
   DO k=1,kl
   DO j=2,jl
   DO i=2,il
   CALL PUSHREAL8(ppor)
   ! Compute the dissipation coefficients for this face.
   ppor = zero
   IF (pork(i, j, k) .EQ. normalflux) ppor = half
   END DO
   END DO
   END DO
   ! Replace rho times the total enthalpy by the total energy and
   ! store the velocities again instead of the momentum. As only
   ! the first halo cells are included, this must be done here again.
   DO k=1,ke
   DO j=1,je
   DO i=1,ie
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(i, j, k, irho)
   CALL PUSHREAL8(w(i, j, k, ivx))
   w(i, j, k, ivx) = w(i, j, k, ivx)*rhoi
   CALL PUSHREAL8(w(i, j, k, ivy))
   w(i, j, k, ivy) = w(i, j, k, ivy)*rhoi
   CALL PUSHREAL8(w(i, j, k, ivz))
   w(i, j, k, ivz) = w(i, j, k, ivz)*rhoi
   CALL PUSHREAL8(w(i, j, k, irhoe))
   w(i, j, k, irhoe) = w(i, j, k, irhoe) - p(i, j, k)
   END DO
   END DO
   END DO
   DO k=ke,1,-1
   DO j=je,1,-1
   DO i=ie,1,-1
   CALL POPREAL8(w(i, j, k, irhoe))
   pb(i, j, k) = pb(i, j, k) - wb(i, j, k, irhoe)
   CALL POPREAL8(w(i, j, k, ivz))
   rhoib = w(i, j, k, ivz)*wb(i, j, k, ivz)
   wb(i, j, k, ivz) = rhoi*wb(i, j, k, ivz)
   CALL POPREAL8(w(i, j, k, ivy))
   rhoib = rhoib + w(i, j, k, ivy)*wb(i, j, k, ivy)
   wb(i, j, k, ivy) = rhoi*wb(i, j, k, ivy)
   CALL POPREAL8(w(i, j, k, ivx))
   rhoib = rhoib + w(i, j, k, ivx)*wb(i, j, k, ivx)
   wb(i, j, k, ivx) = rhoi*wb(i, j, k, ivx)
   CALL POPREAL8(rhoi)
   temp = w(i, j, k, irho)
   wb(i, j, k, irho) = wb(i, j, k, irho) - one*rhoib/temp**2
   END DO
   END DO
   END DO
   radkb = 0.0_8
   DO k=kl,1,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   fsb = fwb(i, j, k+1, irhoe) - fwb(i, j, k, irhoe)
   dis0 = fis0*ppor*(radk(i, j, k)+radk(i, j, k+1))
   dis0b = (w(i, j, k+1, irhoe)-w(i, j, k, irhoe))*fsb
   wb(i, j, k+1, irhoe) = wb(i, j, k+1, irhoe) + dis0*fsb
   wb(i, j, k, irhoe) = wb(i, j, k, irhoe) - dis0*fsb
   fsb = fwb(i, j, k+1, imz) - fwb(i, j, k, imz)
   dis0b = dis0b + (w(i, j, k+1, ivz)-w(i, j, k, ivz))*fsb
   wb(i, j, k+1, ivz) = wb(i, j, k+1, ivz) + dis0*fsb
   wb(i, j, k, ivz) = wb(i, j, k, ivz) - dis0*fsb
   fsb = fwb(i, j, k+1, imy) - fwb(i, j, k, imy)
   dis0b = dis0b + (w(i, j, k+1, ivy)-w(i, j, k, ivy))*fsb
   wb(i, j, k+1, ivy) = wb(i, j, k+1, ivy) + dis0*fsb
   wb(i, j, k, ivy) = wb(i, j, k, ivy) - dis0*fsb
   fsb = fwb(i, j, k+1, imx) - fwb(i, j, k, imx)
   dis0b = dis0b + (w(i, j, k+1, ivx)-w(i, j, k, ivx))*fsb
   wb(i, j, k+1, ivx) = wb(i, j, k+1, ivx) + dis0*fsb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) - dis0*fsb
   fsb = fwb(i, j, k+1, irho) - fwb(i, j, k, irho)
   dis0b = dis0b + (w(i, j, k+1, irho)-w(i, j, k, irho))*fsb
   wb(i, j, k+1, irho) = wb(i, j, k+1, irho) + dis0*fsb
   wb(i, j, k, irho) = wb(i, j, k, irho) - dis0*fsb
   tempb1 = fis0*ppor*dis0b
   radkb(i, j, k) = radkb(i, j, k) + tempb1
   radkb(i, j, k+1) = radkb(i, j, k+1) + tempb1
   CALL POPREAL8(ppor)
   END DO
   END DO
   END DO
   radjb = 0.0_8
   DO k=kl,2,-1
   DO j=jl,1,-1
   DO i=il,2,-1
   fsb = fwb(i, j+1, k, irhoe) - fwb(i, j, k, irhoe)
   dis0 = fis0*ppor*(radj(i, j, k)+radj(i, j+1, k))
   dis0b = (w(i, j+1, k, irhoe)-w(i, j, k, irhoe))*fsb
   wb(i, j+1, k, irhoe) = wb(i, j+1, k, irhoe) + dis0*fsb
   wb(i, j, k, irhoe) = wb(i, j, k, irhoe) - dis0*fsb
   fsb = fwb(i, j+1, k, imz) - fwb(i, j, k, imz)
   dis0b = dis0b + (w(i, j+1, k, ivz)-w(i, j, k, ivz))*fsb
   wb(i, j+1, k, ivz) = wb(i, j+1, k, ivz) + dis0*fsb
   wb(i, j, k, ivz) = wb(i, j, k, ivz) - dis0*fsb
   fsb = fwb(i, j+1, k, imy) - fwb(i, j, k, imy)
   dis0b = dis0b + (w(i, j+1, k, ivy)-w(i, j, k, ivy))*fsb
   wb(i, j+1, k, ivy) = wb(i, j+1, k, ivy) + dis0*fsb
   wb(i, j, k, ivy) = wb(i, j, k, ivy) - dis0*fsb
   fsb = fwb(i, j+1, k, imx) - fwb(i, j, k, imx)
   dis0b = dis0b + (w(i, j+1, k, ivx)-w(i, j, k, ivx))*fsb
   wb(i, j+1, k, ivx) = wb(i, j+1, k, ivx) + dis0*fsb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) - dis0*fsb
   fsb = fwb(i, j+1, k, irho) - fwb(i, j, k, irho)
   dis0b = dis0b + (w(i, j+1, k, irho)-w(i, j, k, irho))*fsb
   wb(i, j+1, k, irho) = wb(i, j+1, k, irho) + dis0*fsb
   wb(i, j, k, irho) = wb(i, j, k, irho) - dis0*fsb
   tempb0 = fis0*ppor*dis0b
   radjb(i, j, k) = radjb(i, j, k) + tempb0
   radjb(i, j+1, k) = radjb(i, j+1, k) + tempb0
   CALL POPREAL8(ppor)
   END DO
   END DO
   END DO
   radib = 0.0_8
   DO k=kl,2,-1
   DO j=jl,2,-1
   DO i=il,1,-1
   fsb = fwb(i+1, j, k, irhoe) - fwb(i, j, k, irhoe)
   dis0 = fis0*ppor*(radi(i, j, k)+radi(i+1, j, k))
   dis0b = (w(i+1, j, k, irhoe)-w(i, j, k, irhoe))*fsb
   wb(i+1, j, k, irhoe) = wb(i+1, j, k, irhoe) + dis0*fsb
   wb(i, j, k, irhoe) = wb(i, j, k, irhoe) - dis0*fsb
   fsb = fwb(i+1, j, k, imz) - fwb(i, j, k, imz)
   dis0b = dis0b + (w(i+1, j, k, ivz)-w(i, j, k, ivz))*fsb
   wb(i+1, j, k, ivz) = wb(i+1, j, k, ivz) + dis0*fsb
   wb(i, j, k, ivz) = wb(i, j, k, ivz) - dis0*fsb
   fsb = fwb(i+1, j, k, imy) - fwb(i, j, k, imy)
   dis0b = dis0b + (w(i+1, j, k, ivy)-w(i, j, k, ivy))*fsb
   wb(i+1, j, k, ivy) = wb(i+1, j, k, ivy) + dis0*fsb
   wb(i, j, k, ivy) = wb(i, j, k, ivy) - dis0*fsb
   fsb = fwb(i+1, j, k, imx) - fwb(i, j, k, imx)
   dis0b = dis0b + (w(i+1, j, k, ivx)-w(i, j, k, ivx))*fsb
   wb(i+1, j, k, ivx) = wb(i+1, j, k, ivx) + dis0*fsb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) - dis0*fsb
   fsb = fwb(i+1, j, k, irho) - fwb(i, j, k, irho)
   dis0b = dis0b + (w(i+1, j, k, irho)-w(i, j, k, irho))*fsb
   wb(i+1, j, k, irho) = wb(i+1, j, k, irho) + dis0*fsb
   wb(i, j, k, irho) = wb(i, j, k, irho) - dis0*fsb
   tempb = fis0*ppor*dis0b
   radib(i, j, k) = radib(i, j, k) + tempb
   radib(i+1, j, k) = radib(i+1, j, k) + tempb
   CALL POPREAL8(ppor)
   END DO
   END DO
   END DO
   DO k=ke,1,-1
   DO j=je,1,-1
   DO i=ie,1,-1
   CALL POPREAL8(w(i, j, k, irhoe))
   pb(i, j, k) = pb(i, j, k) + wb(i, j, k, irhoe)
   CALL POPREAL8(w(i, j, k, ivz))
   tmp1b = wb(i, j, k, ivz)
   wb(i, j, k, ivz) = 0.0_8
   wb(i, j, k, irho) = wb(i, j, k, irho) + w(i, j, k, ivz)*tmp1b
   wb(i, j, k, ivz) = wb(i, j, k, ivz) + w(i, j, k, irho)*tmp1b
   CALL POPREAL8(w(i, j, k, ivy))
   tmp0b = wb(i, j, k, ivy)
   wb(i, j, k, ivy) = 0.0_8
   wb(i, j, k, irho) = wb(i, j, k, irho) + w(i, j, k, ivy)*tmp0b
   wb(i, j, k, ivy) = wb(i, j, k, ivy) + w(i, j, k, irho)*tmp0b
   CALL POPREAL8(w(i, j, k, ivx))
   tmpb = wb(i, j, k, ivx)
   wb(i, j, k, ivx) = 0.0_8
   wb(i, j, k, irho) = wb(i, j, k, irho) + w(i, j, k, ivx)*tmpb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) + w(i, j, k, irho)*tmpb
   END DO
   END DO
   END DO
   END IF
   END SUBROUTINE INVISCIDDISSFLUXSCALARCOARSE_B
