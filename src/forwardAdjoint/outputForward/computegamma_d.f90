   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.7 (r4786) - 21 Feb 2013 15:53
   !
   !  Differentiation of computegamma in forward (tangent) mode (with options i4 dr8 r8):
   !   variations   of useful results: gamma
   !   with respect to varying inputs: t
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          computeGamma.f90                                *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 09-16-2003                                      *
   !      * Last modified: 03-23-2005                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE COMPUTEGAMMA_D(t, td, gamma, gammad, mm)
   USE CPCURVEFITS
   USE INPUTPHYSICS
   USE CONSTANTS
   IMPLICIT NONE
   INTEGER(kind=inttype), INTENT(IN) :: mm
   !
   !      ******************************************************************
   !      *                                                                *
   !      * computeGamma computes the corresponding values of gamma for    *
   !      * the given dimensional temperatures.                            *
   !      *                                                                *
   !      ******************************************************************
   !
   !
   !      Subroutine arguments.
   !
   REAL(kind=realtype), DIMENSION(mm), INTENT(IN) :: t
   REAL(kind=realtype), DIMENSION(mm), INTENT(IN) :: td
   REAL(kind=realtype), DIMENSION(mm), INTENT(OUT) :: gamma
   REAL(kind=realtype), DIMENSION(mm), INTENT(OUT) :: gammad
   !
   !      Local variables.
   !
   INTEGER(kind=inttype) :: i, ii, nn, start
   REAL(kind=realtype) :: cp, t2
   REAL(kind=realtype) :: cpd, t2d
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Determine the cp model used in the computation.
   SELECT CASE  (cpmodel) 
   CASE (cpconstant) 
   ! Constant cp and thus constant gamma. Set the values.
   DO i=1,mm
   gammad(i) = 0.0_8
   gamma(i) = gammaconstant
   END DO
   gammad = 0.0_8
   CASE (cptempcurvefits) 
   gammad = 0.0_8
   !        ================================================================
   ! Cp as function of the temperature is given via curve fits.
   DO i=1,mm
   ! Determine the case we are having here.
   IF (t(i) .LE. cptrange(0)) THEN
   ! Temperature is less than the smallest temperature
   ! in the curve fits. Use cv0 to compute gamma.
   gammad(i) = 0.0_8
   gamma(i) = (cv0+one)/cv0
   ELSE IF (t(i) .GE. cptrange(cpnparts)) THEN
   ! Temperature is larger than the largest temperature
   ! in the curve fits. Use cvn to compute gamma.
   gammad(i) = 0.0_8
   gamma(i) = (cvn+one)/cvn
   ELSE
   ! Temperature is in the curve fit range.
   ! First find the valid range.
   ii = cpnparts
   start = 1
   interval:DO 
   ! Next guess for the interval.
   nn = start + ii/2
   ! Determine the situation we are having here.
   IF (t(i) .GT. cptrange(nn)) THEN
   ! Temperature is larger than the upper boundary of
   ! the current interval. Update the lower boundary.
   start = nn + 1
   ii = ii - 1
   ELSE IF (t(i) .GE. cptrange(nn-1)) THEN
   GOTO 100
   END IF
   ! This is the correct range. Exit the do-loop.
   ! Modify ii for the next branch to search.
   ii = ii/2
   END DO interval
   ! Nn contains the correct curve fit interval.
   ! Compute the value of cp.
   100    cp = zero
   cpd = 0.0_8
   DO ii=1,cptempfit(nn)%nterm
   IF (t(i) .GT. 0.0_8 .OR. (t(i) .LT. 0.0_8 .AND. cptempfit(nn)%&
   &              exponents(ii) .EQ. INT(cptempfit(nn)%exponents(ii)))) THEN
   t2d = cptempfit(nn)%exponents(ii)*t(i)**(cptempfit(nn)%&
   &              exponents(ii)-1)*td(i)
   ELSE IF (t(i) .EQ. 0.0_8 .AND. cptempfit(nn)%exponents(ii) &
   &              .EQ. 1.0) THEN
   t2d = td(i)
   ELSE
   t2d = 0.0_8
   END IF
   t2 = t(i)**cptempfit(nn)%exponents(ii)
   cpd = cpd + cptempfit(nn)%constants(ii)*t2d
   cp = cp + cptempfit(nn)%constants(ii)*t2
   END DO
   ! Compute the corresponding value of gamma.
   gammad(i) = (cpd*(cp-one)-cp*cpd)/(cp-one)**2
   gamma(i) = cp/(cp-one)
   END IF
   END DO
   CASE DEFAULT
   gammad = 0.0_8
   END SELECT
   END SUBROUTINE COMPUTEGAMMA_D
