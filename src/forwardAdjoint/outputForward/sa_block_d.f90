!        generated by tapenade     (inria, tropics team)
!  tapenade 3.10 (r5363) -  9 sep 2014 09:53
!
!  differentiation of sa_block in forward (tangent) mode (with options i4 dr8 r8):
!   variations   of useful results: *rev *dw *w
!   with respect to varying inputs: *rev *sfacei *sfacej *sfacek
!                *w *rlv *vol *si *sj *sk (global)timeref (global)winf[1:10]
!   plus diff mem management of: rev:in bvtj1:in bvtj2:in sfacei:in
!                sfacej:in sfacek:in dw:in w:in rlv:in bvtk1:in
!                bvtk2:in vol:in si:in sj:in sk:in bvti1:in bvti2:in
!                bcdata:in
!
!      ******************************************************************
!      *                                                                *
!      * file:          sa.f90                                          *
!      * author:        georgi kalitzin, edwin van der weide            *
!      * starting date: 06-11-2003                                      *
!      * last modified: 04-12-2005                                      *
!      *                                                                *
!      ******************************************************************
!
subroutine sa_block_d(resonly)
!
!      ******************************************************************
!      *                                                                *
!      * sa solves the transport equation for the spalart-allmaras      *
!      * turbulence model in a segregated manner using a diagonal       *
!      * dominant adi-scheme.                                           *
!      *                                                                *
!      ******************************************************************
!
  use blockpointers
  use inputtimespectral
  use iteration
  implicit none
!
!      subroutine argument.
!
  logical, intent(in) :: resonly
!
!      local variables.
!
  integer(kind=inttype) :: nn, sps
!
!      ******************************************************************
!      *                                                                *
!      * begin execution                                                *
!      *                                                                *
!      ******************************************************************
! set the arrays for the boundary condition treatment.
  call bcturbtreatment_d()
! solve the transport equation for nutilde.
  call sasolve_d(resonly)
! the eddy viscosity and the boundary conditions are only
! applied if an actual update has been computed in sasolve.
  if (.not.resonly) then
! compute the corresponding eddy viscosity.
    call saeddyviscosity_d()
! set the halo values for the turbulent variables.
! we are on the finest mesh, so the second layer of halo
! cells must be computed as well.
    call applyallturbbcthisblock_d(.true.)
! write the loglaw for a flat plate boundary layer.
! call writeloglaw
  end if
end subroutine sa_block_d
