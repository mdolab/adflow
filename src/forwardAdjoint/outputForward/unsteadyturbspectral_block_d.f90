   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.10 (r5363) -  9 Sep 2014 09:53
   !
   !  Differentiation of unsteadyturbspectral_block in forward (tangent) mode (with options i4 dr8 r8):
   !   variations   of useful results: *dw
   !   with respect to varying inputs: *(flowdoms.w)
   !   Plus diff mem management of: flowdoms.w:in dw:in
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          unsteadyTurbSpectral.f90                        *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 08-22-2004                                      *
   !      * Last modified: 06-28-2005                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE UNSTEADYTURBSPECTRAL_BLOCK_D(ntu1, ntu2, nn, sps)
   !
   !      ******************************************************************
   !      *                                                                *
   !      * unsteadyTurbSpectral determines the spectral time derivative   *
   !      * for all owned cells. This routine is called before the actual  *
   !      * solve routines, such that the treatment is identical for all   *
   !      * spectral solutions. The results is stored in the corresponding *
   !      * entry in dw.                                                   *
   !      *                                                                *
   !      ******************************************************************
   !
   USE BLOCKPOINTERS_D
   USE INPUTPHYSICS
   USE INPUTTIMESPECTRAL
   USE ITERATION
   IMPLICIT NONE
   !
   !      Subroutine arguments.
   !
   INTEGER(kind=inttype), INTENT(IN) :: ntu1, ntu2, nn, sps
   !
   !      Local variables.
   !
   INTEGER(kind=inttype) :: ii, mm, i, j, k
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   ! Return immediately if not the time spectral equations are to
   ! be solved.
   IF (equationmode .NE. timespectral) THEN
   dwd = 0.0_8
   RETURN
   ELSE
   dwd = 0.0_8
   ! Loop over the number of turbulent transport equations.
   nadvloop:DO ii=ntu1,ntu2
   ! Initialize the time derivative to zero for the owned
   ! cell centers.
   DO k=2,kl
   DO j=2,jl
   DO i=2,il
   dwd(i, j, k, ii) = 0.0_8
   dw(i, j, k, ii) = zero
   END DO
   END DO
   END DO
   ! Loop over the number of terms which contribute to the
   ! time derivative.
   DO mm=1,ntimeintervalsspectral
   ! Add the contribution to the time derivative for
   ! all owned cells.
   DO k=2,kl
   DO j=2,jl
   DO i=2,il
   dwd(i, j, k, ii) = dwd(i, j, k, ii) + dscalar(sectionid, &
   &               sps, mm)*flowdomsd(nn, currentlevel, mm)%w(i, j, k, ii)
   dw(i, j, k, ii) = dw(i, j, k, ii) + dscalar(sectionid, sps&
   &               , mm)*flowdoms(nn, currentlevel, mm)%w(i, j, k, ii)
   END DO
   END DO
   END DO
   END DO
   END DO nadvloop
   END IF
   END SUBROUTINE UNSTEADYTURBSPECTRAL_BLOCK_D
