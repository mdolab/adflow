   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.10 (r5363) -  9 Sep 2014 09:53
   !
   !  Differentiation of computespeedofsoundsquared in forward (tangent) mode (with options i4 dr8 r8):
   !   variations   of useful results: *aa
   !   with respect to varying inputs: *p *gamma *w
   !   Plus diff mem management of: aa:in p:in gamma:in w:in
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          computeSpeedOfSoundSquared.F90                  *
   !      * Author:        Gaetan K.W. Kenway                              *
   !      * Starting date: 01-20-2014                                      *
   !      * Last modified: 01-20-2014                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE COMPUTESPEEDOFSOUNDSQUARED_D()
   !
   !      ******************************************************************
   !      *                                                                *
   !      * computeSpeedOfSoundSquared does what it says.                  *
   !      *                                                                *
   !      ******************************************************************
   !
   USE BLOCKPOINTERS
   USE CONSTANTS
   USE FLOWVARREFSTATE
   USE INPUTPHYSICS
   USE ITERATION
   IMPLICIT NONE
   !
   !      Local variables.
   !
   LOGICAL :: correctfork
   REAL(kind=realtype), PARAMETER :: twothird=two*third
   INTEGER(kind=inttype) :: i, j, k, ii
   REAL(kind=realtype) :: pp
   REAL(kind=realtype) :: ppd
   ! Determine if we need to correct for K
   IF (kpresent) THEN
   IF (currentlevel .LE. groundlevel .OR. turbcoupled) THEN
   correctfork = .true.
   ELSE
   correctfork = .false.
   END IF
   ELSE
   correctfork = .false.
   END IF
   IF (correctfork) THEN
   aad = 0.0_8
   DO k=1,ke
   DO j=1,je
   DO i=1,ie
   ppd = pd(i, j, k) - twothird*(wd(i, j, k, irho)*w(i, j, k, &
   &           itu1)+w(i, j, k, irho)*wd(i, j, k, itu1))
   pp = p(i, j, k) - twothird*w(i, j, k, irho)*w(i, j, k, itu1)
   aad(i, j, k) = ((gammad(i, j, k)*pp+gamma(i, j, k)*ppd)*w(i, j&
   &           , k, irho)-gamma(i, j, k)*pp*wd(i, j, k, irho))/w(i, j, k, &
   &           irho)**2
   aa(i, j, k) = gamma(i, j, k)*pp/w(i, j, k, irho)
   END DO
   END DO
   END DO
   ELSE
   aad = 0.0_8
   DO k=1,ke
   DO j=1,je
   DO i=1,ie
   aad(i, j, k) = ((gammad(i, j, k)*p(i, j, k)+gamma(i, j, k)*pd(&
   &           i, j, k))*w(i, j, k, irho)-gamma(i, j, k)*p(i, j, k)*wd(i, j&
   &           , k, irho))/w(i, j, k, irho)**2
   aa(i, j, k) = gamma(i, j, k)*p(i, j, k)/w(i, j, k, irho)
   END DO
   END DO
   END DO
   END IF
   END SUBROUTINE COMPUTESPEEDOFSOUNDSQUARED_D
