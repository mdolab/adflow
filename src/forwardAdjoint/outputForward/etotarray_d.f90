!        generated by tapenade     (inria, tropics team)
!  tapenade 3.10 (r5363) -  9 sep 2014 09:53
!
!  differentiation of etotarray in forward (tangent) mode (with options i4 dr8 r8):
!   variations   of useful results: etot
!   with respect to varying inputs: k p u v w etot rho (global)tref
!                (global)rgas
!      ==================================================================
subroutine etotarray_d(rho, rhod, u, ud, v, vd, w, wd, p, pd, k, kd, &
& etot, etotd, correctfork, kk)
!
!      ******************************************************************
!      *                                                                *
!      * etotarray computes the total energy from the given density,    *
!      * velocity and presssure for the given kk elements of the arrays.*
!      * first the internal energy per unit mass is computed and after  *
!      * that the kinetic energy is added as well the conversion to     *
!      * energy per unit volume.                                        *
!      *                                                                *
!      ******************************************************************
!
  use constants
  implicit none
  integer(kind=inttype), intent(in) :: kk
!
!      subroutine arguments.
!
  real(kind=realtype), dimension(kk), intent(in) :: rho, p, k
  real(kind=realtype), dimension(kk), intent(in) :: rhod, pd, kd
  real(kind=realtype), dimension(kk), intent(in) :: u, v, w
  real(kind=realtype), dimension(kk), intent(in) :: ud, vd, wd
  real(kind=realtype), dimension(kk), intent(out) :: etot
  real(kind=realtype), dimension(kk), intent(out) :: etotd
  logical, intent(in) :: correctfork
!
!      local variables.
!
  integer(kind=inttype) :: i
!
!      ******************************************************************
!      *                                                                *
!      * begin execution                                                *
!      *                                                                *
!      ******************************************************************
!
! compute the internal energy for unit mass.
  call eintarray_d(rho, rhod, p, pd, k, kd, etot, etotd, correctfork, kk&
&           )
! add the kinetic energy.
  do i=1,kk
    etotd(i) = rhod(i)*(etot(i)+half*(u(i)*u(i)+v(i)*v(i)+w(i)*w(i))) + &
&     rho(i)*(etotd(i)+half*(ud(i)*u(i)+u(i)*ud(i)+vd(i)*v(i)+v(i)*vd(i)&
&     +wd(i)*w(i)+w(i)*wd(i)))
    etot(i) = rho(i)*(etot(i)+half*(u(i)*u(i)+v(i)*v(i)+w(i)*w(i)))
  end do
end subroutine etotarray_d
