   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.7 (r4786) - 21 Feb 2013 15:53
   !
   !  Differentiation of computerootbendingmoment in reverse (adjoint) mode (with options i4 dr8 r8):
   !   gradient     of useful results: lengthref pointref bendingmoment
   !   with respect to varying inputs: lengthref pointref cf cm
   !
   !****************************************************
   !
   !   Filename: rootBendingMomentAnalysis.f90
   !   Author: C.A.(Sandy) Mader
   !   Date Started: July 10, 2011
   !   Date Modified: July 10,2011
   !
   !****************************************************
   SUBROUTINE COMPUTEROOTBENDINGMOMENT_B(cf, cfb, cm, cmb, liftindex, &
   &  bendingmoment, bendingmomentb)
   USE INPUTITERATION
   USE COSTFUNCTIONS
   USE INPUTPHYSICS
   USE COMMUNICATION
   IMPLICIT NONE
   !*******************************************************
   !                                                      *
   ! Compute a normalized bending moment coefficient from *
   ! the force and moment coefficient. At the moment this *
   ! Routine only works for a half body. Additional logic *
   ! would be needed for a full body.                     *
   !                                                      *
   !*******************************************************
   !input/output variables
   REAL(kind=realtype), DIMENSION(3), INTENT(IN) :: cf, cm
   REAL(kind=realtype), DIMENSION(3) :: cfb, cmb
   INTEGER(kind=inttype), INTENT(IN) :: liftindex
   REAL(kind=realtype) :: bendingmoment
   REAL(kind=realtype) :: bendingmomentb
   !Subroutine Variables
   REAL(kind=realtype) :: elasticmomentx, elasticmomenty, elasticmomentz
   REAL(kind=realtype) :: elasticmomentxb, elasticmomentyb, &
   &  elasticmomentzb
   REAL(kind=realtype) :: temp3
   REAL(kind=realtype) :: temp2
   REAL(kind=realtype) :: temp1
   REAL(kind=realtype) :: temp0
   REAL(kind=realtype) :: temp7b
   REAL(kind=realtype) :: temp0b
   REAL(kind=realtype) :: temp3b
   REAL(kind=realtype) :: temp6b
   REAL(kind=realtype) :: tempb
   REAL(kind=realtype) :: temp2b
   REAL(kind=realtype) :: temp5b
   REAL(kind=realtype) :: temp3b0
   REAL(kind=realtype) :: temp1b
   INTRINSIC SQRT
   REAL(kind=realtype) :: temp
   REAL(kind=realtype) :: temp6
   REAL(kind=realtype) :: temp4b
   REAL(kind=realtype) :: temp5
   REAL(kind=realtype) :: temp4
   IF (liftindex .EQ. 2) THEN
   !z out wing sum momentx,momentz
   elasticmomentx = cm(1) + cf(2)*(pointrefec(3)-pointref(3))/lengthref&
   &      - cf(3)*(pointrefec(2)-pointref(2))/lengthref
   elasticmomentz = cm(3) - cf(2)*(pointrefec(1)-pointref(1))/lengthref&
   &      + cf(1)*(pointrefec(2)-pointref(2))/lengthref
   temp0 = cf(3)/lengthref
   IF (elasticmomentx**2 + elasticmomentz**2 .EQ. 0.0_8) THEN
   temp3b = 0.0
   ELSE
   temp3b = bendingmomentb/(2.0*SQRT(elasticmomentx**2+elasticmomentz&
   &        **2))
   END IF
   elasticmomentxb = 2*elasticmomentx*temp3b
   elasticmomentzb = 2*elasticmomentz*temp3b
   cfb = 0.0_8
   cmb = 0.0_8
   temp1b = -((pointrefec(1)-pointref(1))*elasticmomentzb/lengthref)
   temp1 = cf(2)/lengthref
   temp2b = (pointrefec(2)-pointref(2))*elasticmomentzb/lengthref
   temp2 = cf(1)/lengthref
   cmb(3) = cmb(3) + elasticmomentzb
   cfb(2) = cfb(2) + temp1b
   pointrefb(1) = pointrefb(1) + temp1*elasticmomentzb
   cfb(1) = cfb(1) + temp2b
   pointrefb(2) = pointrefb(2) - temp2*elasticmomentzb
   tempb = (pointrefec(3)-pointref(3))*elasticmomentxb/lengthref
   temp = cf(2)/lengthref
   temp0b = -((pointrefec(2)-pointref(2))*elasticmomentxb/lengthref)
   lengthrefb = lengthrefb - temp*tempb - temp0*temp0b - temp2*temp2b -&
   &      temp1*temp1b
   cmb(1) = cmb(1) + elasticmomentxb
   cfb(2) = cfb(2) + tempb
   pointrefb(3) = pointrefb(3) - temp*elasticmomentxb
   cfb(3) = cfb(3) + temp0b
   pointrefb(2) = pointrefb(2) + temp0*elasticmomentxb
   ELSE IF (liftindex .EQ. 3) THEN
   !y out wing sum momentx,momenty
   elasticmomentx = cm(1) + cf(3)*(pointrefec(2)-pointref(2))/lengthref&
   &      + cf(3)*(pointrefec(3)-pointref(3))/lengthref
   elasticmomenty = cm(2) + cf(3)*(pointrefec(1)-pointref(1))/lengthref&
   &      + cf(1)*(pointrefec(3)-pointref(3))/lengthref
   temp4 = cf(3)/lengthref
   IF (elasticmomentx**2 + elasticmomenty**2 .EQ. 0.0_8) THEN
   temp7b = 0.0
   ELSE
   temp7b = bendingmomentb/(2.0*SQRT(elasticmomentx**2+elasticmomenty&
   &        **2))
   END IF
   elasticmomentxb = 2*elasticmomentx*temp7b
   elasticmomentyb = 2*elasticmomenty*temp7b
   cfb = 0.0_8
   cmb = 0.0_8
   temp5b = (pointrefec(1)-pointref(1))*elasticmomentyb/lengthref
   temp5 = cf(3)/lengthref
   temp6b = (pointrefec(3)-pointref(3))*elasticmomentyb/lengthref
   temp6 = cf(1)/lengthref
   cmb(2) = cmb(2) + elasticmomentyb
   cfb(3) = cfb(3) + temp5b
   pointrefb(1) = pointrefb(1) - temp5*elasticmomentyb
   cfb(1) = cfb(1) + temp6b
   pointrefb(3) = pointrefb(3) - temp6*elasticmomentyb
   temp3b0 = (pointrefec(2)-pointref(2))*elasticmomentxb/lengthref
   temp3 = cf(3)/lengthref
   temp4b = (pointrefec(3)-pointref(3))*elasticmomentxb/lengthref
   lengthrefb = lengthrefb - temp3*temp3b0 - temp4*temp4b - temp6*&
   &      temp6b - temp5*temp5b
   cmb(1) = cmb(1) + elasticmomentxb
   cfb(3) = cfb(3) + temp4b + temp3b0
   pointrefb(2) = pointrefb(2) - temp3*elasticmomentxb
   pointrefb(3) = pointrefb(3) - temp4*elasticmomentxb
   ELSE
   cfb = 0.0_8
   cmb = 0.0_8
   END IF
   END SUBROUTINE COMPUTEROOTBENDINGMOMENT_B
