   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.10 (r5363) -  9 Sep 2014 09:53
   !
   !  Differentiation of getcostfunction in reverse (adjoint) mode (with options i4 dr8 r8):
   !   gradient     of useful results: objvalue
   !   with respect to varying inputs: tempfreestream reynolds machgrid
   !                lengthref machcoef pointref pref moment objvalue
   !                alpha force beta cavitation sepsensor
   !   RW status of diff variables: tempfreestream:out reynolds:out
   !                veldirfreestream:(loc) machgrid:out lengthref:out
   !                machcoef:out dragdirection:(loc) liftdirection:(loc)
   !                pointref:out mudim:(loc) gammainf:(loc) pinf:(loc)
   !                rhoinfdim:(loc) pinfdim:(loc) pref:out moment:out
   !                objvalue:in-zero alpha:out force:out beta:out
   !                cavitation:out sepsensor:out
   SUBROUTINE GETCOSTFUNCTION_B(costfunction, force, forceb, moment, &
   & momentb, sepsensor, sepsensorb, cavitation, cavitationb, alpha, alphab&
   & , beta, betab, liftindex, objvalue, objvalueb)
   ! Compute the value of the actual objective function based on the
   ! (summed) forces and moments and any other "extra" design
   ! variables. The index of the objective is determined by 'iDV'. This
   ! function is intended to be AD'ed in reverse mode. 
   USE INPUTTIMESPECTRAL
   USE COSTFUNCTIONS
   USE INPUTPHYSICS
   USE FLOWVARREFSTATE
   IMPLICIT NONE
   ! Input 
   INTEGER(kind=inttype), INTENT(IN) :: costfunction
   INTEGER(kind=inttype), INTENT(IN) :: liftindex
   REAL(kind=realtype), DIMENSION(3, ntimeintervalsspectral), INTENT(IN) &
   & :: force, moment
   REAL(kind=realtype), DIMENSION(3, ntimeintervalsspectral) :: forceb, &
   & momentb
   REAL(kind=realtype), DIMENSION(ntimeintervalsspectral), INTENT(IN) :: &
   & sepsensor, cavitation
   REAL(kind=realtype), DIMENSION(ntimeintervalsspectral) :: sepsensorb, &
   & cavitationb
   REAL(kind=realtype), INTENT(IN) :: alpha, beta
   REAL(kind=realtype) :: alphab, betab
   ! Output
   REAL(kind=realtype) :: objvalue
   REAL(kind=realtype) :: objvalueb
   ! Working
   REAL(kind=realtype) :: fact, factmoment, scaledim, ovrnts
   REAL(kind=realtype) :: factb, factmomentb, scaledimb
   REAL(kind=realtype), DIMENSION(3) :: cf, cm
   REAL(kind=realtype), DIMENSION(3) :: cfb, cmb
   REAL(kind=realtype) :: elasticmomentx, elasticmomenty, elasticmomentz
   REAL(kind=realtype), DIMENSION(ntimeintervalsspectral, 8) :: basecoef
   REAL(kind=realtype), DIMENSION(8) :: coef0, dcdalpha, dcdalphadot, &
   & dcdq, dcdqdot
   REAL(kind=realtype), DIMENSION(8) :: coef0b, dcdalphab, dcdalphadotb
   REAL(kind=realtype) :: bendingmoment
   REAL(kind=realtype) :: bendingmomentb
   INTEGER(kind=inttype) :: sps
   INTEGER :: branch
   REAL(kind=realtype) :: temp1
   REAL(kind=realtype) :: temp0
   REAL(kind=realtype) :: tempb5
   REAL(kind=realtype) :: tempb4
   REAL(kind=realtype) :: tempb3
   REAL(kind=realtype) :: tempb2
   REAL(kind=realtype) :: tempb1
   REAL(kind=realtype) :: tempb0
   REAL(kind=realtype) :: tempb
   REAL(kind=realtype) :: temp
   ! Compute the factor since we may need it below
   CALL ADJUSTINFLOWANGLE(alpha, beta, liftindex)
   CALL PUSHREAL8(pref)
   CALL PUSHREAL8(gammainf)
   CALL REFERENCESTATE()
   scaledim = pref/pinf
   fact = two/(gammainf*pinf*machcoef**2*surfaceref*lref**2*scaledim)
   factmoment = fact/(lengthref*lref)
   ovrnts = one/ntimeintervalsspectral
   ! Pre-compute TS stability info if required:
   SELECT CASE  (costfunction) 
   CASE (costfunccl0, costfunccd0, costfunccm0, costfuncclalpha, &
   & costfunccdalpha, costfunccmzalpha, costfuncclalphadot, &
   & costfunccdalphadot, costfunccmzalphadot, costfuncclq, costfunccdq, &
   & costfunccmzq, costfuncclqdot, costfunccdqdot, costfunccmzqdot) 
   CALL PUSHINTEGER4(liftindex)
   CALL COMPUTETSDERIVATIVES(force, moment, liftindex, coef0, &
   &                          dcdalpha, dcdalphadot, dcdq, dcdqdot)
   CALL PUSHCONTROL1B(1)
   CASE DEFAULT
   CALL PUSHCONTROL1B(0)
   END SELECT
   ! Main cost function selection
   SELECT CASE  (costfunction) 
   CASE (costfuncforcex) 
   forceb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   forceb(1, sps) = forceb(1, sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncforcey) 
   forceb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   forceb(2, sps) = forceb(2, sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncforcez) 
   forceb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   forceb(3, sps) = forceb(3, sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncmomx) 
   momentb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   momentb(1, sps) = momentb(1, sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncmomy) 
   momentb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   momentb(2, sps) = momentb(2, sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncmomz) 
   momentb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   momentb(3, sps) = momentb(3, sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncforcexcoef) 
   forceb = 0.0_8
   factb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   forceb(1, sps) = forceb(1, sps) + ovrnts*fact*objvalueb
   factb = factb + ovrnts*force(1, sps)*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncforceycoef) 
   forceb = 0.0_8
   factb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   forceb(2, sps) = forceb(2, sps) + ovrnts*fact*objvalueb
   factb = factb + ovrnts*force(2, sps)*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncforcezcoef) 
   forceb = 0.0_8
   factb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   forceb(3, sps) = forceb(3, sps) + ovrnts*fact*objvalueb
   factb = factb + ovrnts*force(3, sps)*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncmomxcoef) 
   momentb = 0.0_8
   factmomentb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   momentb(1, sps) = momentb(1, sps) + ovrnts*factmoment*objvalueb
   factmomentb = factmomentb + ovrnts*moment(1, sps)*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncmomycoef) 
   momentb = 0.0_8
   factmomentb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   momentb(2, sps) = momentb(2, sps) + ovrnts*factmoment*objvalueb
   factmomentb = factmomentb + ovrnts*moment(2, sps)*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncmomzcoef) 
   momentb = 0.0_8
   factmomentb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   momentb(3, sps) = momentb(3, sps) + ovrnts*factmoment*objvalueb
   factmomentb = factmomentb + ovrnts*moment(3, sps)*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunclift) 
   liftdirectionb = 0.0_8
   forceb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   tempb2 = ovrnts*objvalueb
   forceb(1, sps) = forceb(1, sps) + liftdirection(1)*tempb2
   liftdirectionb(1) = liftdirectionb(1) + force(1, sps)*tempb2
   forceb(2, sps) = forceb(2, sps) + liftdirection(2)*tempb2
   liftdirectionb(2) = liftdirectionb(2) + force(2, sps)*tempb2
   forceb(3, sps) = forceb(3, sps) + liftdirection(3)*tempb2
   liftdirectionb(3) = liftdirectionb(3) + force(3, sps)*tempb2
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncdrag) 
   dragdirectionb = 0.0_8
   forceb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   tempb3 = ovrnts*objvalueb
   forceb(1, sps) = forceb(1, sps) + dragdirection(1)*tempb3
   dragdirectionb(1) = dragdirectionb(1) + force(1, sps)*tempb3
   forceb(2, sps) = forceb(2, sps) + dragdirection(2)*tempb3
   dragdirectionb(2) = dragdirectionb(2) + force(2, sps)*tempb3
   forceb(3, sps) = forceb(3, sps) + dragdirection(3)*tempb3
   dragdirectionb(3) = dragdirectionb(3) + force(3, sps)*tempb3
   END DO
   lengthrefb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncliftcoef) 
   liftdirectionb = 0.0_8
   forceb = 0.0_8
   factb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   tempb4 = ovrnts*fact*objvalueb
   factb = factb + ovrnts*(force(1, sps)*liftdirection(1)+force(2, &
   &       sps)*liftdirection(2)+force(3, sps)*liftdirection(3))*objvalueb
   forceb(1, sps) = forceb(1, sps) + liftdirection(1)*tempb4
   liftdirectionb(1) = liftdirectionb(1) + force(1, sps)*tempb4
   forceb(2, sps) = forceb(2, sps) + liftdirection(2)*tempb4
   liftdirectionb(2) = liftdirectionb(2) + force(2, sps)*tempb4
   forceb(3, sps) = forceb(3, sps) + liftdirection(3)*tempb4
   liftdirectionb(3) = liftdirectionb(3) + force(3, sps)*tempb4
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncdragcoef) 
   dragdirectionb = 0.0_8
   forceb = 0.0_8
   factb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   tempb5 = ovrnts*fact*objvalueb
   factb = factb + ovrnts*(force(1, sps)*dragdirection(1)+force(2, &
   &       sps)*dragdirection(2)+force(3, sps)*dragdirection(3))*objvalueb
   forceb(1, sps) = forceb(1, sps) + dragdirection(1)*tempb5
   dragdirectionb(1) = dragdirectionb(1) + force(1, sps)*tempb5
   forceb(2, sps) = forceb(2, sps) + dragdirection(2)*tempb5
   dragdirectionb(2) = dragdirectionb(2) + force(2, sps)*tempb5
   forceb(3, sps) = forceb(3, sps) + dragdirection(3)*tempb5
   dragdirectionb(3) = dragdirectionb(3) + force(3, sps)*tempb5
   END DO
   lengthrefb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccl0) 
   coef0b = 0.0_8
   coef0b(1) = coef0b(1) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccd0) 
   coef0b = 0.0_8
   coef0b(2) = coef0b(2) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccm0) 
   coef0b = 0.0_8
   coef0b(8) = coef0b(8) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncclalpha) 
   dcdalphab = 0.0_8
   dcdalphab(1) = dcdalphab(1) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   CASE (costfunccdalpha) 
   dcdalphab = 0.0_8
   dcdalphab(2) = dcdalphab(2) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   CASE (costfunccmzalpha) 
   dcdalphab = 0.0_8
   dcdalphab(8) = dcdalphab(8) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   CASE (costfuncclalphadot) 
   dcdalphadotb = 0.0_8
   dcdalphadotb(1) = dcdalphadotb(1) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccdalphadot) 
   dcdalphadotb = 0.0_8
   dcdalphadotb(2) = dcdalphadotb(2) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccmzalphadot) 
   dcdalphadotb = 0.0_8
   dcdalphadotb(8) = dcdalphadotb(8) + objvalueb
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncclq) 
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccdq) 
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccmzq) 
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncclqdot) 
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccdqdot) 
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccmzqdot) 
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncbendingcoef) 
   lengthrefb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   factmomentb = 0.0_8
   factb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   bendingmomentb = ovrnts*objvalueb
   cf = fact*force(:, sps)
   cm = factmoment*moment(:, sps)
   CALL COMPUTEROOTBENDINGMOMENT_B(cf, cfb, cm, cmb, liftindex, &
   &                               bendingmoment, bendingmomentb)
   factb = factb + SUM(force(:, sps)*cfb)
   forceb(:, sps) = forceb(:, sps) + fact*cfb
   factmomentb = factmomentb + SUM(moment(:, sps)*cmb)
   momentb(:, sps) = momentb(:, sps) + factmoment*cmb
   END DO
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfuncsepsensor) 
   sepsensorb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   sepsensorb(sps) = sepsensorb(sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE (costfunccavitation) 
   cavitationb = 0.0_8
   DO sps=ntimeintervalsspectral,1,-1
   cavitationb(sps) = cavitationb(sps) + ovrnts*objvalueb
   END DO
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   CASE DEFAULT
   lengthrefb = 0.0_8
   dragdirectionb = 0.0_8
   liftdirectionb = 0.0_8
   pointrefb = 0.0_8
   momentb = 0.0_8
   forceb = 0.0_8
   cavitationb = 0.0_8
   sepsensorb = 0.0_8
   factmomentb = 0.0_8
   dcdalphadotb = 0.0_8
   coef0b = 0.0_8
   factb = 0.0_8
   dcdalphab = 0.0_8
   END SELECT
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   machgridb = 0.0_8
   machcoefb = 0.0_8
   gammainfb = 0.0_8
   pinfb = 0.0_8
   rhoinfdimb = 0.0_8
   pinfdimb = 0.0_8
   prefb = 0.0_8
   ELSE
   CALL POPINTEGER4(liftindex)
   CALL COMPUTETSDERIVATIVES_B(force, forceb, moment, momentb, &
   &                         liftindex, coef0, coef0b, dcdalpha, dcdalphab&
   &                         , dcdalphadot, dcdalphadotb, dcdq, dcdqdot)
   END IF
   tempb = factmomentb/(lref*lengthref)
   factb = factb + tempb
   lengthrefb = lengthrefb - fact*tempb/lengthref
   temp1 = machcoef**2*scaledim
   temp0 = surfaceref*lref**2
   temp = temp0*gammainf*pinf
   tempb0 = -(two*factb/(temp**2*temp1**2))
   tempb1 = temp1*temp0*tempb0
   gammainfb = gammainfb + pinf*tempb1
   machcoefb = machcoefb + scaledim*temp*2*machcoef*tempb0
   scaledimb = temp*machcoef**2*tempb0
   pinfb = pinfb + gammainf*tempb1 - pref*scaledimb/pinf**2
   prefb = prefb + scaledimb/pinf
   CALL POPREAL8(gammainf)
   CALL POPREAL8(pref)
   CALL REFERENCESTATE_B()
   CALL ADJUSTINFLOWANGLE_B(alpha, alphab, beta, betab, liftindex)
   objvalueb = 0.0_8
   END SUBROUTINE GETCOSTFUNCTION_B
