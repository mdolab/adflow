   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.6 (r4159) - 21 Sep 2011 10:11
   !
   !  Differentiation of computelamviscosity in reverse (adjoint) mode:
   !   gradient     of useful results: *p *w *rlv
   !   with respect to varying inputs: *p *w
   !   Plus diff mem management of: p:in w:in rlv:in
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          computeLamViscosity.f90                         *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 03-10-2003                                      *
   !      * Last modified: 06-12-2005                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE COMPUTELAMVISCOSITY_B()
   USE BLOCKPOINTERS_B
   USE INPUTPHYSICS
   USE CONSTANTS
   USE ITERATION
   USE FLOWVARREFSTATE
   IMPLICIT NONE
   !
   !      ******************************************************************
   !      *                                                                *
   !      * computeLamViscosity computes the laminar viscosity ratio in    *
   !      * the owned cell centers of the given block. Sutherland's law is *
   !      * used. It is assumed that the pointes already point to the      *
   !      * correct block before entering this subroutine.                 *
   !      *                                                                *
   !      ******************************************************************
   !
   !
   !      Local parameter.
   !
   REAL(kind=realtype), PARAMETER :: twothird=two*third
   !
   !      Local variables.
   !
   INTEGER(kind=inttype) :: i, j, k
   REAL(kind=realtype) :: musuth, tsuth, ssuth, t
   REAL(kind=realtype) :: tb
   LOGICAL :: correctfork
   INTEGER :: branch
   REAL(kind=realtype) :: temp0b
   REAL(kind=realtype) :: temp
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Return immediately if no laminar viscosity needs to be computed.
   IF (viscous) THEN
   ! Determine whether or not the pressure must be corrected
   ! for the presence of the turbulent kinetic energy.
   IF (kpresent) THEN
   IF (currentlevel .LE. groundlevel .OR. turbcoupled) THEN
   correctfork = .true.
   ELSE
   correctfork = .false.
   END IF
   ELSE
   correctfork = .false.
   END IF
   ! Compute the nonDimensional constants in sutherland's law.
   musuth = musuthdim/muref
   tsuth = tsuthdim/tref
   ssuth = ssuthdim/tref
   ! Substract 2/3 rho k, which is a part of the normal turbulent
   ! stresses, in case the pressure must be corrected.
   IF (correctfork) THEN
   DO k=2,kl
   DO j=2,jl
   DO i=2,il
   p(i, j, k) = p(i, j, k) - twothird*w(i, j, k, irho)*w(i, j, &
   &              k, itu1)
   END DO
   END DO
   END DO
   CALL PUSHCONTROL1B(1)
   ELSE
   CALL PUSHCONTROL1B(0)
   END IF
   ! Add the 2/3 rho k again to the pressure if the pressure was
   ! corrected earlier.
   IF (correctfork) THEN
   DO k=kl,2,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   wb(i, j, k, irho) = wb(i, j, k, irho) + twothird*w(i, j, k, &
   &              itu1)*pb(i, j, k)
   wb(i, j, k, itu1) = wb(i, j, k, itu1) + twothird*w(i, j, k, &
   &              irho)*pb(i, j, k)
   END DO
   END DO
   END DO
   END IF
   DO k=kl,2,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   t = p(i, j, k)/(rgas*w(i, j, k, irho))
   temp0b = musuth*(tsuth+ssuth)*rlvb(i, j, k)/(ssuth+t)
   tb = (1.5_realType*(t/tsuth)**0.5/tsuth-(t/tsuth)**&
   &            1.5_realType/(ssuth+t))*temp0b
   rlvb(i, j, k) = 0.0_8
   temp = rgas*w(i, j, k, irho)
   pb(i, j, k) = pb(i, j, k) + tb/temp
   wb(i, j, k, irho) = wb(i, j, k, irho) - p(i, j, k)*rgas*tb/&
   &            temp**2
   END DO
   END DO
   END DO
   CALL POPCONTROL1B(branch)
   IF (branch .NE. 0) THEN
   DO k=kl,2,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   wb(i, j, k, irho) = wb(i, j, k, irho) - twothird*w(i, j, k, &
   &              itu1)*pb(i, j, k)
   wb(i, j, k, itu1) = wb(i, j, k, itu1) - twothird*w(i, j, k, &
   &              irho)*pb(i, j, k)
   END DO
   END DO
   END DO
   END IF
   END IF
   END SUBROUTINE COMPUTELAMVISCOSITY_B
