   !        Generated by TAPENADE     (INRIA, Tropics team)
   !  Tapenade 3.6 (r4159) - 21 Sep 2011 10:11
   !
   !  Differentiation of invisciddissfluxscalar in reverse (adjoint) mode:
   !   gradient     of useful results: *p *w *fw
   !   with respect to varying inputs: *p *w *radi *radj *radk
   !   Plus diff mem management of: p:in gamma:in w:in fw:in radi:in
   !                radj:in radk:in
   !
   !      ******************************************************************
   !      *                                                                *
   !      * File:          inviscidDissFluxScalar.f90                      *
   !      * Author:        Edwin van der Weide                             *
   !      * Starting date: 03-24-2003                                      *
   !      * Last modified: 10-29-2007                                      *
   !      *                                                                *
   !      ******************************************************************
   !
   SUBROUTINE INVISCIDDISSFLUXSCALAR_B()
   USE CGNSGRID
   USE BLOCKPOINTERS_B
   USE INPUTPHYSICS
   USE INPUTDISCRETIZATION
   USE CONSTANTS
   USE ITERATION
   USE FLOWVARREFSTATE
   IMPLICIT NONE
   !
   !      ******************************************************************
   !      *                                                                *
   !      * inviscidDissFluxScalar computes the scalar artificial          *
   !      * dissipation, see AIAA paper 81-1259, for a given block.        *
   !      * Therefore it is assumed that the pointers in  blockPointers    *
   !      * already point to the correct block.                            *
   !      *                                                                *
   !      ******************************************************************
   !
   !
   !      Local parameter.
   !
   REAL(kind=realtype), PARAMETER :: dssmax=0.25_realType
   !
   !      Local variables.
   !
   INTEGER(kind=inttype) :: i, j, k, ind
   REAL(kind=realtype) :: sslim, rhoi
   REAL(kind=realtype) :: rhoib
   REAL(kind=realtype) :: sfil, fis2, fis4
   REAL(kind=realtype) :: ppor, rrad, dis2, dis4
   REAL(kind=realtype) :: rradb, dis2b, dis4b
   REAL(kind=realtype) :: dss1, dss2, ddw, fs
   REAL(kind=realtype) :: dss1b, dss2b, ddwb, fsb
   REAL(kind=realtype), DIMENSION(0:ib, 0:jb, 0:kb) :: ss
   REAL(kind=realtype), DIMENSION(0:ib, 0:jb, 0:kb) :: ssb
   REAL(kind=realtype) :: DIM
   REAL(kind=realtype) :: arg1
   REAL(kind=realtype) :: arg1b
   REAL(kind=realtype) :: tmp
   REAL(kind=realtype) :: tmp0
   REAL(kind=realtype) :: tmp1
   REAL(kind=realtype) :: tmp2
   REAL(kind=realtype) :: tmp3
   REAL(kind=realtype) :: tmp4
   REAL(kind=realtype) :: tmp5
   REAL(kind=realtype) :: tmp6
   REAL(kind=realtype) :: tmp7
   REAL(kind=realtype) :: tmp8
   REAL(kind=realtype) :: tmp9
   REAL(kind=realtype) :: tmp10
   REAL(kind=realtype) :: tmp11
   REAL(kind=realtype) :: tmp12
   REAL(kind=realtype) :: tmp13
   REAL(kind=realtype) :: tmp14
   REAL(kind=realtype) :: tmp15
   REAL(kind=realtype) :: tmp16
   REAL(kind=realtype) :: tmp17
   REAL(kind=realtype) :: tmp18
   REAL(kind=realtype) :: tmp19
   REAL(kind=realtype) :: tmp20
   REAL(kind=realtype) :: tmp21
   REAL(kind=realtype) :: tmp22
   REAL(kind=realtype) :: tmp23
   REAL(kind=realtype) :: tmp24
   REAL(kind=realtype) :: tmp25
   INTEGER :: branch
   REAL(kind=realtype) :: temp3
   REAL(kind=realtype) :: tmp22b
   REAL(kind=realtype) :: x3b
   REAL(kind=realtype) :: temp29
   REAL(kind=realtype) :: temp2
   REAL(kind=realtype) :: y1b
   REAL(kind=realtype) :: temp28
   REAL(kind=realtype) :: temp1
   REAL(kind=realtype) :: tmp4b
   REAL(kind=realtype) :: temp27
   REAL(kind=realtype) :: temp0
   REAL(kind=realtype) :: temp26
   REAL(kind=realtype) :: temp25
   REAL(kind=realtype) :: min5b
   REAL(kind=realtype) :: temp24
   REAL(kind=realtype) :: temp23
   REAL(kind=realtype) :: tmp17b
   REAL(kind=realtype) :: temp22
   REAL(kind=realtype) :: tmp25b
   REAL(kind=realtype) :: x6b
   REAL(kind=realtype) :: temp21
   REAL(kind=realtype) :: y4b
   REAL(kind=realtype) :: temp20
   REAL(kind=realtype) :: tmp7b
   REAL(kind=realtype) :: min6
   REAL(kind=realtype) :: temp30b5
   REAL(kind=realtype) :: min5
   REAL(kind=realtype) :: temp30b4
   REAL(kind=realtype) :: temp32b
   REAL(kind=realtype) :: min4
   REAL(kind=realtype) :: temp30b3
   REAL(kind=realtype) :: min3
   REAL(kind=realtype) :: temp28b5
   REAL(kind=realtype) :: temp30b2
   REAL(kind=realtype) :: min2
   REAL(kind=realtype) :: temp28b4
   REAL(kind=realtype) :: temp30b1
   REAL(kind=realtype) :: min1
   REAL(kind=realtype) :: temp28b3
   REAL(kind=realtype) :: temp30b0
   REAL(kind=realtype) :: temp28b2
   REAL(kind=realtype) :: temp27b
   REAL(kind=realtype) :: temp28b1
   REAL(kind=realtype) :: temp28b0
   INTRINSIC MAX
   REAL(kind=realtype) :: tmp10b
   REAL(kind=realtype) :: tmpb
   REAL(kind=realtype) :: x6
   REAL(kind=realtype) :: x5
   REAL(kind=realtype) :: tmp0b
   REAL(kind=realtype) :: x4
   REAL(kind=realtype) :: x3
   REAL(kind=realtype) :: min1b
   INTRINSIC ABS
   REAL(kind=realtype) :: x2
   REAL(kind=realtype) :: x1
   REAL(kind=realtype) :: tmp13b
   REAL(kind=realtype) :: temp19
   REAL(kind=realtype) :: tmp21b
   REAL(kind=realtype) :: x2b
   REAL(kind=realtype) :: temp18
   REAL(kind=realtype) :: temp17
   REAL(kind=realtype) :: tmp3b
   REAL(kind=realtype) :: temp16
   REAL(kind=realtype) :: temp15
   REAL(kind=realtype) :: min4b
   REAL(kind=realtype) :: temp14
   REAL(kind=realtype) :: temp13
   REAL(kind=realtype) :: tmp16b
   REAL(kind=realtype) :: temp12
   REAL(kind=realtype) :: tmp24b
   REAL(kind=realtype) :: x5b
   REAL(kind=realtype) :: temp11
   REAL(kind=realtype) :: y3b
   REAL(kind=realtype) :: temp10
   REAL(kind=realtype) :: tmp6b
   REAL(kind=realtype) :: temp26b0
   REAL(kind=realtype) :: temp31b
   REAL(kind=realtype) :: tmp19b
   REAL(kind=realtype) :: y6b
   REAL(kind=realtype) :: tmp9b
   REAL(kind=realtype) :: temp40
   REAL(kind=realtype) :: temp26b
   REAL(kind=realtype) :: temp31b0
   REAL(kind=realtype) :: temp29b
   REAL(kind=realtype) :: temp29b0
   REAL(kind=realtype) :: tmp12b
   REAL(kind=realtype) :: tmp20b
   REAL(kind=realtype) :: x1b
   REAL(kind=realtype) :: tmp2b
   REAL(kind=realtype) :: min3b
   REAL(kind=realtype) :: tmp15b
   REAL(kind=realtype) :: tmp23b
   REAL(kind=realtype) :: x4b
   REAL(kind=realtype) :: temp39
   REAL(kind=realtype) :: y2b
   REAL(kind=realtype) :: temp38
   REAL(kind=realtype) :: tmp5b
   REAL(kind=realtype) :: temp37
   REAL(kind=realtype) :: temp36
   REAL(kind=realtype) :: min6b
   REAL(kind=realtype) :: temp35
   REAL(kind=realtype) :: temp30b
   REAL(kind=realtype) :: temp34
   REAL(kind=realtype) :: tmp18b
   REAL(kind=realtype) :: temp33
   REAL(kind=realtype) :: temp32
   REAL(kind=realtype) :: temp31
   REAL(kind=realtype) :: y5b
   REAL(kind=realtype) :: tmp8b
   REAL(kind=realtype) :: temp30
   REAL(kind=realtype) :: temp27b0
   REAL(kind=realtype) :: abs0
   INTRINSIC MIN
   REAL(kind=realtype) :: temp28b
   REAL(kind=realtype) :: temp
   REAL(kind=realtype) :: temp32b3
   REAL(kind=realtype) :: tmp11b
   REAL(kind=realtype) :: temp32b2
   REAL(kind=realtype) :: temp32b1
   REAL(kind=realtype) :: y6
   REAL(kind=realtype) :: temp9
   REAL(kind=realtype) :: temp32b0
   REAL(kind=realtype) :: y5
   REAL(kind=realtype) :: temp8
   REAL(kind=realtype) :: tmp1b
   REAL(kind=realtype) :: y4
   REAL(kind=realtype) :: temp7
   REAL(kind=realtype) :: y3
   REAL(kind=realtype) :: temp6
   REAL(kind=realtype) :: min2b
   REAL(kind=realtype) :: y2
   REAL(kind=realtype) :: temp5
   REAL(kind=realtype) :: y1
   REAL(kind=realtype) :: temp4
   REAL(kind=realtype) :: tmp14b
   IF (rfil .GE. 0.) THEN
   abs0 = rfil
   ELSE
   abs0 = -rfil
   END IF
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Begin execution                                                *
   !      *                                                                *
   !      ******************************************************************
   !
   ! Check if rFil == 0. If so, the dissipative flux needs not to
   ! be computed.
   IF (abs0 .LT. thresholdreal) THEN
   radib = 0.0_8
   radjb = 0.0_8
   radkb = 0.0_8
   ELSE
   ! Determine the variables used to compute the switch.
   ! For the inviscid case this is the pressure; for the viscous
   ! case it is the entropy.
   SELECT CASE  (equations) 
   CASE (eulerequations) 
   ! Inviscid case. Pressure switch is based on the pressure.
   ! Also set the value of sslim. To be fully consistent this
   ! must have the dimension of pressure and it is therefore
   ! set to a fraction of the free stream value.
   sslim = 0.001_realType*pinfcorr
   ! Copy the pressure in ss. Only fill the entries used in
   ! the discretization, i.e. ignore the corner halo's.
   DO k=0,kb
   DO j=2,jl
   DO i=2,il
   ss(i, j, k) = p(i, j, k)
   END DO
   END DO
   END DO
   DO k=2,kl
   DO j=2,jl
   ss(0, j, k) = p(0, j, k)
   ss(1, j, k) = p(1, j, k)
   ss(ie, j, k) = p(ie, j, k)
   ss(ib, j, k) = p(ib, j, k)
   END DO
   END DO
   DO k=2,kl
   DO i=2,il
   ss(i, 0, k) = p(i, 0, k)
   ss(i, 1, k) = p(i, 1, k)
   ss(i, je, k) = p(i, je, k)
   ss(i, jb, k) = p(i, jb, k)
   END DO
   END DO
   CALL PUSHCONTROL2B(1)
   CASE (nsequations, ransequations) 
   !===============================================================
   ! Viscous case. Pressure switch is based on the entropy.
   ! Also set the value of sslim. To be fully consistent this
   ! must have the dimension of entropy and it is therefore
   ! set to a fraction of the free stream value.
   sslim = 0.001_realType*pinfcorr/rhoinf**gammainf
   ! Store the entropy in ss. Only fill the entries used in
   ! the discretization, i.e. ignore the corner halo's.
   DO k=0,kb
   DO j=2,jl
   DO i=2,il
   ss(i, j, k) = p(i, j, k)/w(i, j, k, irho)**gamma(i, j, k)
   END DO
   END DO
   END DO
   DO k=2,kl
   DO j=2,jl
   ss(0, j, k) = p(0, j, k)/w(0, j, k, irho)**gamma(0, j, k)
   ss(1, j, k) = p(1, j, k)/w(1, j, k, irho)**gamma(1, j, k)
   ss(ie, j, k) = p(ie, j, k)/w(ie, j, k, irho)**gamma(ie, j, k)
   ss(ib, j, k) = p(ib, j, k)/w(ib, j, k, irho)**gamma(ib, j, k)
   END DO
   END DO
   DO k=2,kl
   DO i=2,il
   ss(i, 0, k) = p(i, 0, k)/w(i, 0, k, irho)**gamma(i, 0, k)
   ss(i, 1, k) = p(i, 1, k)/w(i, 1, k, irho)**gamma(i, 1, k)
   ss(i, je, k) = p(i, je, k)/w(i, je, k, irho)**gamma(i, je, k)
   ss(i, jb, k) = p(i, jb, k)/w(i, jb, k, irho)**gamma(i, jb, k)
   END DO
   END DO
   CALL PUSHCONTROL2B(2)
   CASE DEFAULT
   CALL PUSHCONTROL2B(0)
   END SELECT
   ! Set a couple of constants for the scheme.
   fis2 = rfil*vis2
   fis4 = rfil*vis4
   ! Replace the total energy by rho times the total enthalpy.
   ! In this way the numerical solution is total enthalpy preserving
   ! for the steady Euler equations. Also replace the velocities by
   ! the momentum. Only done for the entries used in the
   ! discretization, i.e. ignore the corner halo's.
   DO k=0,kb
   DO j=2,jl
   DO i=2,il
   tmp = w(i, j, k, irho)*w(i, j, k, ivx)
   CALL PUSHREAL8(w(i, j, k, ivx))
   w(i, j, k, ivx) = tmp
   tmp0 = w(i, j, k, irho)*w(i, j, k, ivy)
   CALL PUSHREAL8(w(i, j, k, ivy))
   w(i, j, k, ivy) = tmp0
   tmp1 = w(i, j, k, irho)*w(i, j, k, ivz)
   CALL PUSHREAL8(w(i, j, k, ivz))
   w(i, j, k, ivz) = tmp1
   CALL PUSHREAL8(w(i, j, k, irhoe))
   w(i, j, k, irhoe) = w(i, j, k, irhoe) + p(i, j, k)
   END DO
   END DO
   END DO
   DO k=2,kl
   DO j=2,jl
   tmp2 = w(0, j, k, irho)*w(0, j, k, ivx)
   CALL PUSHREAL8(w(0, j, k, ivx))
   w(0, j, k, ivx) = tmp2
   tmp3 = w(0, j, k, irho)*w(0, j, k, ivy)
   CALL PUSHREAL8(w(0, j, k, ivy))
   w(0, j, k, ivy) = tmp3
   tmp4 = w(0, j, k, irho)*w(0, j, k, ivz)
   CALL PUSHREAL8(w(0, j, k, ivz))
   w(0, j, k, ivz) = tmp4
   CALL PUSHREAL8(w(0, j, k, irhoe))
   w(0, j, k, irhoe) = w(0, j, k, irhoe) + p(0, j, k)
   tmp5 = w(1, j, k, irho)*w(1, j, k, ivx)
   CALL PUSHREAL8(w(1, j, k, ivx))
   w(1, j, k, ivx) = tmp5
   tmp6 = w(1, j, k, irho)*w(1, j, k, ivy)
   CALL PUSHREAL8(w(1, j, k, ivy))
   w(1, j, k, ivy) = tmp6
   tmp7 = w(1, j, k, irho)*w(1, j, k, ivz)
   CALL PUSHREAL8(w(1, j, k, ivz))
   w(1, j, k, ivz) = tmp7
   CALL PUSHREAL8(w(1, j, k, irhoe))
   w(1, j, k, irhoe) = w(1, j, k, irhoe) + p(1, j, k)
   tmp8 = w(ie, j, k, irho)*w(ie, j, k, ivx)
   CALL PUSHREAL8(w(ie, j, k, ivx))
   w(ie, j, k, ivx) = tmp8
   tmp9 = w(ie, j, k, irho)*w(ie, j, k, ivy)
   CALL PUSHREAL8(w(ie, j, k, ivy))
   w(ie, j, k, ivy) = tmp9
   tmp10 = w(ie, j, k, irho)*w(ie, j, k, ivz)
   CALL PUSHREAL8(w(ie, j, k, ivz))
   w(ie, j, k, ivz) = tmp10
   CALL PUSHREAL8(w(ie, j, k, irhoe))
   w(ie, j, k, irhoe) = w(ie, j, k, irhoe) + p(ie, j, k)
   tmp11 = w(ib, j, k, irho)*w(ib, j, k, ivx)
   CALL PUSHREAL8(w(ib, j, k, ivx))
   w(ib, j, k, ivx) = tmp11
   tmp12 = w(ib, j, k, irho)*w(ib, j, k, ivy)
   CALL PUSHREAL8(w(ib, j, k, ivy))
   w(ib, j, k, ivy) = tmp12
   tmp13 = w(ib, j, k, irho)*w(ib, j, k, ivz)
   CALL PUSHREAL8(w(ib, j, k, ivz))
   w(ib, j, k, ivz) = tmp13
   CALL PUSHREAL8(w(ib, j, k, irhoe))
   w(ib, j, k, irhoe) = w(ib, j, k, irhoe) + p(ib, j, k)
   END DO
   END DO
   DO k=2,kl
   DO i=2,il
   tmp14 = w(i, 0, k, irho)*w(i, 0, k, ivx)
   CALL PUSHREAL8(w(i, 0, k, ivx))
   w(i, 0, k, ivx) = tmp14
   tmp15 = w(i, 0, k, irho)*w(i, 0, k, ivy)
   CALL PUSHREAL8(w(i, 0, k, ivy))
   w(i, 0, k, ivy) = tmp15
   tmp16 = w(i, 0, k, irho)*w(i, 0, k, ivz)
   CALL PUSHREAL8(w(i, 0, k, ivz))
   w(i, 0, k, ivz) = tmp16
   CALL PUSHREAL8(w(i, 0, k, irhoe))
   w(i, 0, k, irhoe) = w(i, 0, k, irhoe) + p(i, 0, k)
   tmp17 = w(i, 1, k, irho)*w(i, 1, k, ivx)
   CALL PUSHREAL8(w(i, 1, k, ivx))
   w(i, 1, k, ivx) = tmp17
   tmp18 = w(i, 1, k, irho)*w(i, 1, k, ivy)
   CALL PUSHREAL8(w(i, 1, k, ivy))
   w(i, 1, k, ivy) = tmp18
   tmp19 = w(i, 1, k, irho)*w(i, 1, k, ivz)
   CALL PUSHREAL8(w(i, 1, k, ivz))
   w(i, 1, k, ivz) = tmp19
   CALL PUSHREAL8(w(i, 1, k, irhoe))
   w(i, 1, k, irhoe) = w(i, 1, k, irhoe) + p(i, 1, k)
   tmp20 = w(i, je, k, irho)*w(i, je, k, ivx)
   CALL PUSHREAL8(w(i, je, k, ivx))
   w(i, je, k, ivx) = tmp20
   tmp21 = w(i, je, k, irho)*w(i, je, k, ivy)
   CALL PUSHREAL8(w(i, je, k, ivy))
   w(i, je, k, ivy) = tmp21
   tmp22 = w(i, je, k, irho)*w(i, je, k, ivz)
   CALL PUSHREAL8(w(i, je, k, ivz))
   w(i, je, k, ivz) = tmp22
   CALL PUSHREAL8(w(i, je, k, irhoe))
   w(i, je, k, irhoe) = w(i, je, k, irhoe) + p(i, je, k)
   tmp23 = w(i, jb, k, irho)*w(i, jb, k, ivx)
   CALL PUSHREAL8(w(i, jb, k, ivx))
   w(i, jb, k, ivx) = tmp23
   tmp24 = w(i, jb, k, irho)*w(i, jb, k, ivy)
   CALL PUSHREAL8(w(i, jb, k, ivy))
   w(i, jb, k, ivy) = tmp24
   tmp25 = w(i, jb, k, irho)*w(i, jb, k, ivz)
   CALL PUSHREAL8(w(i, jb, k, ivz))
   w(i, jb, k, ivz) = tmp25
   CALL PUSHREAL8(w(i, jb, k, irhoe))
   w(i, jb, k, irhoe) = w(i, jb, k, irhoe) + p(i, jb, k)
   END DO
   END DO
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Dissipative fluxes in the i-direction.                         *
   !      *                                                                *
   !      ******************************************************************
   !
   DO k=2,kl
   DO j=2,jl
   x1 = (ss(2, j, k)-two*ss(1, j, k)+ss(0, j, k))/(ss(2, j, k)+two*&
   &          ss(1, j, k)+ss(0, j, k)+sslim)
   IF (x1 .GE. 0.) THEN
   dss1 = x1
   CALL PUSHCONTROL1B(0)
   ELSE
   dss1 = -x1
   CALL PUSHCONTROL1B(1)
   END IF
   ! Loop in i-direction.
   DO i=1,il
   x2 = (ss(i+2, j, k)-two*ss(i+1, j, k)+ss(i, j, k))/(ss(i+2, j&
   &            , k)+two*ss(i+1, j, k)+ss(i, j, k)+sslim)
   IF (x2 .GE. 0.) THEN
   dss2 = x2
   CALL PUSHCONTROL1B(0)
   ELSE
   dss2 = -x2
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(ppor)
   ! Compute the dissipation coefficients for this face.
   ppor = zero
   IF (pori(i, j, k) .EQ. normalflux) ppor = half
   rrad = ppor*(radi(i, j, k)+radi(i+1, j, k))
   ! Modification for FD Preconditioner Note: This lumping
   ! actually still results in a greater than 3 cell stencil
   ! in any direction. Since this seems to work slightly
   ! better than the dis2=sigma*fis4*rrad, we will just use
   ! a 5-cell stencil for doing the PC
   IF (lumpeddiss) THEN
   IF (dss1 .LT. dss2) THEN
   y1 = dss2
   CALL PUSHCONTROL1B(0)
   ELSE
   y1 = dss1
   CALL PUSHCONTROL1B(1)
   END IF
   IF (dssmax .GT. y1) THEN
   CALL PUSHREAL8(min1)
   min1 = y1
   CALL PUSHCONTROL1B(0)
   ELSE
   CALL PUSHREAL8(min1)
   min1 = dssmax
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(dis2)
   dis2 = fis2*rrad*min1 + sigma*fis4*rrad
   CALL PUSHREAL8(dis4)
   !dis2 = sigma*fis4*rrad 
   dis4 = 0.0
   CALL PUSHCONTROL1B(0)
   ELSE
   IF (dss1 .LT. dss2) THEN
   y2 = dss2
   CALL PUSHCONTROL1B(0)
   ELSE
   y2 = dss1
   CALL PUSHCONTROL1B(1)
   END IF
   IF (dssmax .GT. y2) THEN
   CALL PUSHREAL8(min2)
   min2 = y2
   CALL PUSHCONTROL1B(0)
   ELSE
   CALL PUSHREAL8(min2)
   min2 = dssmax
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(dis2)
   dis2 = fis2*rrad*min2
   arg1 = fis4*rrad
   CALL PUSHREAL8(dis4)
   dis4 = DIM(arg1, dis2)
   CALL PUSHCONTROL1B(1)
   END IF
   ! Compute and scatter the dissipative flux.
   ! Density. Store it in the mass flow of the
   ! appropriate sliding mesh interface.
   ! X-momentum.
   ! Y-momentum.
   ! Z-momentum.
   ! Energy.
   ! Set dss1 to dss2 for the next face.
   dss1 = dss2
   END DO
   END DO
   END DO
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Dissipative fluxes in the j-direction.                         *
   !      *                                                                *
   !      ******************************************************************
   !
   DO k=2,kl
   DO i=2,il
   x3 = (ss(i, 2, k)-two*ss(i, 1, k)+ss(i, 0, k))/(ss(i, 2, k)+two*&
   &          ss(i, 1, k)+ss(i, 0, k)+sslim)
   IF (x3 .GE. 0.) THEN
   dss1 = x3
   CALL PUSHCONTROL1B(0)
   ELSE
   dss1 = -x3
   CALL PUSHCONTROL1B(1)
   END IF
   ! Loop in j-direction.
   DO j=1,jl
   x4 = (ss(i, j+2, k)-two*ss(i, j+1, k)+ss(i, j, k))/(ss(i, j+2&
   &            , k)+two*ss(i, j+1, k)+ss(i, j, k)+sslim)
   IF (x4 .GE. 0.) THEN
   dss2 = x4
   CALL PUSHCONTROL1B(0)
   ELSE
   dss2 = -x4
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(ppor)
   ! Compute the dissipation coefficients for this face.
   ppor = zero
   IF (porj(i, j, k) .EQ. normalflux) ppor = half
   rrad = ppor*(radj(i, j, k)+radj(i, j+1, k))
   ! Modification for FD Preconditioner
   IF (lumpeddiss) THEN
   IF (dss1 .LT. dss2) THEN
   y3 = dss2
   CALL PUSHCONTROL1B(0)
   ELSE
   y3 = dss1
   CALL PUSHCONTROL1B(1)
   END IF
   IF (dssmax .GT. y3) THEN
   CALL PUSHREAL8(min3)
   min3 = y3
   CALL PUSHCONTROL1B(0)
   ELSE
   CALL PUSHREAL8(min3)
   min3 = dssmax
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(dis2)
   dis2 = fis2*rrad*min3 + sigma*fis4*rrad
   CALL PUSHREAL8(dis4)
   !dis2 = sigma*fis4*rrad 
   dis4 = 0.0
   CALL PUSHCONTROL1B(0)
   ELSE
   IF (dss1 .LT. dss2) THEN
   y4 = dss2
   CALL PUSHCONTROL1B(0)
   ELSE
   y4 = dss1
   CALL PUSHCONTROL1B(1)
   END IF
   IF (dssmax .GT. y4) THEN
   CALL PUSHREAL8(min4)
   min4 = y4
   CALL PUSHCONTROL1B(0)
   ELSE
   CALL PUSHREAL8(min4)
   min4 = dssmax
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(dis2)
   dis2 = fis2*rrad*min4
   arg1 = fis4*rrad
   CALL PUSHREAL8(dis4)
   dis4 = DIM(arg1, dis2)
   CALL PUSHCONTROL1B(1)
   END IF
   ! Compute and scatter the dissipative flux.
   ! Density. Store it in the mass flow of the
   ! appropriate sliding mesh interface.
   ! X-momentum.
   ! Y-momentum.
   ! Z-momentum.
   ! Energy.
   ! Set dss1 to dss2 for the next face.
   dss1 = dss2
   END DO
   END DO
   END DO
   !
   !      ******************************************************************
   !      *                                                                *
   !      * Dissipative fluxes in the k-direction.                         *
   !      *                                                                *
   !      ******************************************************************
   !
   DO j=2,jl
   DO i=2,il
   x5 = (ss(i, j, 2)-two*ss(i, j, 1)+ss(i, j, 0))/(ss(i, j, 2)+two*&
   &          ss(i, j, 1)+ss(i, j, 0)+sslim)
   IF (x5 .GE. 0.) THEN
   dss1 = x5
   CALL PUSHCONTROL1B(0)
   ELSE
   dss1 = -x5
   CALL PUSHCONTROL1B(1)
   END IF
   ! Loop in k-direction.
   DO k=1,kl
   x6 = (ss(i, j, k+2)-two*ss(i, j, k+1)+ss(i, j, k))/(ss(i, j, k&
   &            +2)+two*ss(i, j, k+1)+ss(i, j, k)+sslim)
   IF (x6 .GE. 0.) THEN
   dss2 = x6
   CALL PUSHCONTROL1B(0)
   ELSE
   dss2 = -x6
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(ppor)
   ! Compute the dissipation coefficients for this face.
   ppor = zero
   IF (pork(i, j, k) .EQ. normalflux) ppor = half
   rrad = ppor*(radk(i, j, k)+radk(i, j, k+1))
   ! Modification for FD Preconditioner
   IF (lumpeddiss) THEN
   IF (dss1 .LT. dss2) THEN
   y5 = dss2
   CALL PUSHCONTROL1B(0)
   ELSE
   y5 = dss1
   CALL PUSHCONTROL1B(1)
   END IF
   IF (dssmax .GT. y5) THEN
   CALL PUSHREAL8(min5)
   min5 = y5
   CALL PUSHCONTROL1B(0)
   ELSE
   CALL PUSHREAL8(min5)
   min5 = dssmax
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(dis2)
   dis2 = fis2*rrad*min5 + sigma*fis4*rrad
   CALL PUSHREAL8(dis4)
   !dis2 = sigma*fis4*rrad 
   dis4 = 0.0
   CALL PUSHCONTROL1B(0)
   ELSE
   IF (dss1 .LT. dss2) THEN
   y6 = dss2
   CALL PUSHCONTROL1B(0)
   ELSE
   y6 = dss1
   CALL PUSHCONTROL1B(1)
   END IF
   IF (dssmax .GT. y6) THEN
   CALL PUSHREAL8(min6)
   min6 = y6
   CALL PUSHCONTROL1B(0)
   ELSE
   CALL PUSHREAL8(min6)
   min6 = dssmax
   CALL PUSHCONTROL1B(1)
   END IF
   CALL PUSHREAL8(dis2)
   dis2 = fis2*rrad*min6
   arg1 = fis4*rrad
   CALL PUSHREAL8(dis4)
   dis4 = DIM(arg1, dis2)
   CALL PUSHCONTROL1B(1)
   END IF
   ! Compute and scatter the dissipative flux.
   ! Density. Store it in the mass flow of the
   ! appropriate sliding mesh interface.
   ! X-momentum.
   ! Y-momentum.
   ! Z-momentum.
   ! Energy.
   ! Set dss1 to dss2 for the next face.
   dss1 = dss2
   END DO
   END DO
   END DO
   ! Replace rho times the total enthalpy by the total energy and
   ! store the velocities again instead of the momentum. Only for
   ! those entries that have been altered, i.e. ignore the
   ! corner halo's.
   DO k=0,kb
   DO j=2,jl
   DO i=2,il
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(i, j, k, irho)
   CALL PUSHREAL8(w(i, j, k, ivx))
   w(i, j, k, ivx) = w(i, j, k, ivx)*rhoi
   CALL PUSHREAL8(w(i, j, k, ivy))
   w(i, j, k, ivy) = w(i, j, k, ivy)*rhoi
   CALL PUSHREAL8(w(i, j, k, ivz))
   w(i, j, k, ivz) = w(i, j, k, ivz)*rhoi
   CALL PUSHREAL8(w(i, j, k, irhoe))
   w(i, j, k, irhoe) = w(i, j, k, irhoe) - p(i, j, k)
   END DO
   END DO
   END DO
   DO k=2,kl
   DO j=2,jl
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(0, j, k, irho)
   CALL PUSHREAL8(w(0, j, k, ivx))
   w(0, j, k, ivx) = w(0, j, k, ivx)*rhoi
   CALL PUSHREAL8(w(0, j, k, ivy))
   w(0, j, k, ivy) = w(0, j, k, ivy)*rhoi
   CALL PUSHREAL8(w(0, j, k, ivz))
   w(0, j, k, ivz) = w(0, j, k, ivz)*rhoi
   CALL PUSHREAL8(w(0, j, k, irhoe))
   w(0, j, k, irhoe) = w(0, j, k, irhoe) - p(0, j, k)
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(1, j, k, irho)
   CALL PUSHREAL8(w(1, j, k, ivx))
   w(1, j, k, ivx) = w(1, j, k, ivx)*rhoi
   CALL PUSHREAL8(w(1, j, k, ivy))
   w(1, j, k, ivy) = w(1, j, k, ivy)*rhoi
   CALL PUSHREAL8(w(1, j, k, ivz))
   w(1, j, k, ivz) = w(1, j, k, ivz)*rhoi
   CALL PUSHREAL8(w(1, j, k, irhoe))
   w(1, j, k, irhoe) = w(1, j, k, irhoe) - p(1, j, k)
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(ie, j, k, irho)
   CALL PUSHREAL8(w(ie, j, k, ivx))
   w(ie, j, k, ivx) = w(ie, j, k, ivx)*rhoi
   CALL PUSHREAL8(w(ie, j, k, ivy))
   w(ie, j, k, ivy) = w(ie, j, k, ivy)*rhoi
   CALL PUSHREAL8(w(ie, j, k, ivz))
   w(ie, j, k, ivz) = w(ie, j, k, ivz)*rhoi
   CALL PUSHREAL8(w(ie, j, k, irhoe))
   w(ie, j, k, irhoe) = w(ie, j, k, irhoe) - p(ie, j, k)
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(ib, j, k, irho)
   CALL PUSHREAL8(w(ib, j, k, ivx))
   w(ib, j, k, ivx) = w(ib, j, k, ivx)*rhoi
   CALL PUSHREAL8(w(ib, j, k, ivy))
   w(ib, j, k, ivy) = w(ib, j, k, ivy)*rhoi
   CALL PUSHREAL8(w(ib, j, k, ivz))
   w(ib, j, k, ivz) = w(ib, j, k, ivz)*rhoi
   CALL PUSHREAL8(w(ib, j, k, irhoe))
   w(ib, j, k, irhoe) = w(ib, j, k, irhoe) - p(ib, j, k)
   END DO
   END DO
   DO k=2,kl
   DO i=2,il
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(i, 0, k, irho)
   CALL PUSHREAL8(w(i, 0, k, ivx))
   w(i, 0, k, ivx) = w(i, 0, k, ivx)*rhoi
   CALL PUSHREAL8(w(i, 0, k, ivy))
   w(i, 0, k, ivy) = w(i, 0, k, ivy)*rhoi
   CALL PUSHREAL8(w(i, 0, k, ivz))
   w(i, 0, k, ivz) = w(i, 0, k, ivz)*rhoi
   CALL PUSHREAL8(w(i, 0, k, irhoe))
   w(i, 0, k, irhoe) = w(i, 0, k, irhoe) - p(i, 0, k)
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(i, 1, k, irho)
   CALL PUSHREAL8(w(i, 1, k, ivx))
   w(i, 1, k, ivx) = w(i, 1, k, ivx)*rhoi
   CALL PUSHREAL8(w(i, 1, k, ivy))
   w(i, 1, k, ivy) = w(i, 1, k, ivy)*rhoi
   CALL PUSHREAL8(w(i, 1, k, ivz))
   w(i, 1, k, ivz) = w(i, 1, k, ivz)*rhoi
   CALL PUSHREAL8(w(i, 1, k, irhoe))
   w(i, 1, k, irhoe) = w(i, 1, k, irhoe) - p(i, 1, k)
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(i, je, k, irho)
   CALL PUSHREAL8(w(i, je, k, ivx))
   w(i, je, k, ivx) = w(i, je, k, ivx)*rhoi
   CALL PUSHREAL8(w(i, je, k, ivy))
   w(i, je, k, ivy) = w(i, je, k, ivy)*rhoi
   CALL PUSHREAL8(w(i, je, k, ivz))
   w(i, je, k, ivz) = w(i, je, k, ivz)*rhoi
   CALL PUSHREAL8(w(i, je, k, irhoe))
   w(i, je, k, irhoe) = w(i, je, k, irhoe) - p(i, je, k)
   CALL PUSHREAL8(rhoi)
   rhoi = one/w(i, jb, k, irho)
   CALL PUSHREAL8(w(i, jb, k, ivx))
   w(i, jb, k, ivx) = w(i, jb, k, ivx)*rhoi
   CALL PUSHREAL8(w(i, jb, k, ivy))
   w(i, jb, k, ivy) = w(i, jb, k, ivy)*rhoi
   CALL PUSHREAL8(w(i, jb, k, ivz))
   w(i, jb, k, ivz) = w(i, jb, k, ivz)*rhoi
   CALL PUSHREAL8(w(i, jb, k, irhoe))
   w(i, jb, k, irhoe) = w(i, jb, k, irhoe) - p(i, jb, k)
   END DO
   END DO
   DO k=kl,2,-1
   DO i=il,2,-1
   CALL POPREAL8(w(i, jb, k, irhoe))
   pb(i, jb, k) = pb(i, jb, k) - wb(i, jb, k, irhoe)
   CALL POPREAL8(w(i, jb, k, ivz))
   rhoib = w(i, jb, k, ivz)*wb(i, jb, k, ivz)
   wb(i, jb, k, ivz) = rhoi*wb(i, jb, k, ivz)
   CALL POPREAL8(w(i, jb, k, ivy))
   rhoib = rhoib + w(i, jb, k, ivy)*wb(i, jb, k, ivy)
   wb(i, jb, k, ivy) = rhoi*wb(i, jb, k, ivy)
   CALL POPREAL8(w(i, jb, k, ivx))
   rhoib = rhoib + w(i, jb, k, ivx)*wb(i, jb, k, ivx)
   wb(i, jb, k, ivx) = rhoi*wb(i, jb, k, ivx)
   CALL POPREAL8(rhoi)
   temp40 = w(i, jb, k, irho)
   wb(i, jb, k, irho) = wb(i, jb, k, irho) - one*rhoib/temp40**2
   CALL POPREAL8(w(i, je, k, irhoe))
   pb(i, je, k) = pb(i, je, k) - wb(i, je, k, irhoe)
   CALL POPREAL8(w(i, je, k, ivz))
   rhoib = w(i, je, k, ivz)*wb(i, je, k, ivz)
   wb(i, je, k, ivz) = rhoi*wb(i, je, k, ivz)
   CALL POPREAL8(w(i, je, k, ivy))
   rhoib = rhoib + w(i, je, k, ivy)*wb(i, je, k, ivy)
   wb(i, je, k, ivy) = rhoi*wb(i, je, k, ivy)
   CALL POPREAL8(w(i, je, k, ivx))
   rhoib = rhoib + w(i, je, k, ivx)*wb(i, je, k, ivx)
   wb(i, je, k, ivx) = rhoi*wb(i, je, k, ivx)
   CALL POPREAL8(rhoi)
   temp39 = w(i, je, k, irho)
   wb(i, je, k, irho) = wb(i, je, k, irho) - one*rhoib/temp39**2
   CALL POPREAL8(w(i, 1, k, irhoe))
   pb(i, 1, k) = pb(i, 1, k) - wb(i, 1, k, irhoe)
   CALL POPREAL8(w(i, 1, k, ivz))
   rhoib = w(i, 1, k, ivz)*wb(i, 1, k, ivz)
   wb(i, 1, k, ivz) = rhoi*wb(i, 1, k, ivz)
   CALL POPREAL8(w(i, 1, k, ivy))
   rhoib = rhoib + w(i, 1, k, ivy)*wb(i, 1, k, ivy)
   wb(i, 1, k, ivy) = rhoi*wb(i, 1, k, ivy)
   CALL POPREAL8(w(i, 1, k, ivx))
   rhoib = rhoib + w(i, 1, k, ivx)*wb(i, 1, k, ivx)
   wb(i, 1, k, ivx) = rhoi*wb(i, 1, k, ivx)
   CALL POPREAL8(rhoi)
   temp38 = w(i, 1, k, irho)
   wb(i, 1, k, irho) = wb(i, 1, k, irho) - one*rhoib/temp38**2
   CALL POPREAL8(w(i, 0, k, irhoe))
   pb(i, 0, k) = pb(i, 0, k) - wb(i, 0, k, irhoe)
   CALL POPREAL8(w(i, 0, k, ivz))
   rhoib = w(i, 0, k, ivz)*wb(i, 0, k, ivz)
   wb(i, 0, k, ivz) = rhoi*wb(i, 0, k, ivz)
   CALL POPREAL8(w(i, 0, k, ivy))
   rhoib = rhoib + w(i, 0, k, ivy)*wb(i, 0, k, ivy)
   wb(i, 0, k, ivy) = rhoi*wb(i, 0, k, ivy)
   CALL POPREAL8(w(i, 0, k, ivx))
   rhoib = rhoib + w(i, 0, k, ivx)*wb(i, 0, k, ivx)
   wb(i, 0, k, ivx) = rhoi*wb(i, 0, k, ivx)
   CALL POPREAL8(rhoi)
   temp37 = w(i, 0, k, irho)
   wb(i, 0, k, irho) = wb(i, 0, k, irho) - one*rhoib/temp37**2
   END DO
   END DO
   DO k=kl,2,-1
   DO j=jl,2,-1
   CALL POPREAL8(w(ib, j, k, irhoe))
   pb(ib, j, k) = pb(ib, j, k) - wb(ib, j, k, irhoe)
   CALL POPREAL8(w(ib, j, k, ivz))
   rhoib = w(ib, j, k, ivz)*wb(ib, j, k, ivz)
   wb(ib, j, k, ivz) = rhoi*wb(ib, j, k, ivz)
   CALL POPREAL8(w(ib, j, k, ivy))
   rhoib = rhoib + w(ib, j, k, ivy)*wb(ib, j, k, ivy)
   wb(ib, j, k, ivy) = rhoi*wb(ib, j, k, ivy)
   CALL POPREAL8(w(ib, j, k, ivx))
   rhoib = rhoib + w(ib, j, k, ivx)*wb(ib, j, k, ivx)
   wb(ib, j, k, ivx) = rhoi*wb(ib, j, k, ivx)
   CALL POPREAL8(rhoi)
   temp36 = w(ib, j, k, irho)
   wb(ib, j, k, irho) = wb(ib, j, k, irho) - one*rhoib/temp36**2
   CALL POPREAL8(w(ie, j, k, irhoe))
   pb(ie, j, k) = pb(ie, j, k) - wb(ie, j, k, irhoe)
   CALL POPREAL8(w(ie, j, k, ivz))
   rhoib = w(ie, j, k, ivz)*wb(ie, j, k, ivz)
   wb(ie, j, k, ivz) = rhoi*wb(ie, j, k, ivz)
   CALL POPREAL8(w(ie, j, k, ivy))
   rhoib = rhoib + w(ie, j, k, ivy)*wb(ie, j, k, ivy)
   wb(ie, j, k, ivy) = rhoi*wb(ie, j, k, ivy)
   CALL POPREAL8(w(ie, j, k, ivx))
   rhoib = rhoib + w(ie, j, k, ivx)*wb(ie, j, k, ivx)
   wb(ie, j, k, ivx) = rhoi*wb(ie, j, k, ivx)
   CALL POPREAL8(rhoi)
   temp35 = w(ie, j, k, irho)
   wb(ie, j, k, irho) = wb(ie, j, k, irho) - one*rhoib/temp35**2
   CALL POPREAL8(w(1, j, k, irhoe))
   pb(1, j, k) = pb(1, j, k) - wb(1, j, k, irhoe)
   CALL POPREAL8(w(1, j, k, ivz))
   rhoib = w(1, j, k, ivz)*wb(1, j, k, ivz)
   wb(1, j, k, ivz) = rhoi*wb(1, j, k, ivz)
   CALL POPREAL8(w(1, j, k, ivy))
   rhoib = rhoib + w(1, j, k, ivy)*wb(1, j, k, ivy)
   wb(1, j, k, ivy) = rhoi*wb(1, j, k, ivy)
   CALL POPREAL8(w(1, j, k, ivx))
   rhoib = rhoib + w(1, j, k, ivx)*wb(1, j, k, ivx)
   wb(1, j, k, ivx) = rhoi*wb(1, j, k, ivx)
   CALL POPREAL8(rhoi)
   temp34 = w(1, j, k, irho)
   wb(1, j, k, irho) = wb(1, j, k, irho) - one*rhoib/temp34**2
   CALL POPREAL8(w(0, j, k, irhoe))
   pb(0, j, k) = pb(0, j, k) - wb(0, j, k, irhoe)
   CALL POPREAL8(w(0, j, k, ivz))
   rhoib = w(0, j, k, ivz)*wb(0, j, k, ivz)
   wb(0, j, k, ivz) = rhoi*wb(0, j, k, ivz)
   CALL POPREAL8(w(0, j, k, ivy))
   rhoib = rhoib + w(0, j, k, ivy)*wb(0, j, k, ivy)
   wb(0, j, k, ivy) = rhoi*wb(0, j, k, ivy)
   CALL POPREAL8(w(0, j, k, ivx))
   rhoib = rhoib + w(0, j, k, ivx)*wb(0, j, k, ivx)
   wb(0, j, k, ivx) = rhoi*wb(0, j, k, ivx)
   CALL POPREAL8(rhoi)
   temp33 = w(0, j, k, irho)
   wb(0, j, k, irho) = wb(0, j, k, irho) - one*rhoib/temp33**2
   END DO
   END DO
   DO k=kb,0,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   CALL POPREAL8(w(i, j, k, irhoe))
   pb(i, j, k) = pb(i, j, k) - wb(i, j, k, irhoe)
   CALL POPREAL8(w(i, j, k, ivz))
   rhoib = w(i, j, k, ivz)*wb(i, j, k, ivz)
   wb(i, j, k, ivz) = rhoi*wb(i, j, k, ivz)
   CALL POPREAL8(w(i, j, k, ivy))
   rhoib = rhoib + w(i, j, k, ivy)*wb(i, j, k, ivy)
   wb(i, j, k, ivy) = rhoi*wb(i, j, k, ivy)
   CALL POPREAL8(w(i, j, k, ivx))
   rhoib = rhoib + w(i, j, k, ivx)*wb(i, j, k, ivx)
   wb(i, j, k, ivx) = rhoi*wb(i, j, k, ivx)
   CALL POPREAL8(rhoi)
   temp32 = w(i, j, k, irho)
   wb(i, j, k, irho) = wb(i, j, k, irho) - one*rhoib/temp32**2
   END DO
   END DO
   END DO
   radkb = 0.0_8
   ssb = 0.0_8
   DO j=jl,2,-1
   DO i=il,2,-1
   dss1b = 0.0_8
   DO k=kl,1,-1
   dss2b = dss1b
   fsb = fwb(i, j, k+1, irhoe) - fwb(i, j, k, irhoe)
   ddw = w(i, j, k+1, irhoe) - w(i, j, k, irhoe)
   temp32b = -(dis4*fsb)
   dis2b = ddw*fsb
   ddwb = dis2*fsb - three*temp32b
   dis4b = -((w(i, j, k+2, irhoe)-w(i, j, k-1, irhoe)-three*ddw)*&
   &            fsb)
   wb(i, j, k+2, irhoe) = wb(i, j, k+2, irhoe) + temp32b
   wb(i, j, k-1, irhoe) = wb(i, j, k-1, irhoe) - temp32b
   wb(i, j, k+1, irhoe) = wb(i, j, k+1, irhoe) + ddwb
   wb(i, j, k, irhoe) = wb(i, j, k, irhoe) - ddwb
   fsb = fwb(i, j, k+1, imz) - fwb(i, j, k, imz)
   ddw = w(i, j, k+1, ivz) - w(i, j, k, ivz)
   temp32b0 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp32b0
   dis4b = dis4b - (w(i, j, k+2, ivz)-w(i, j, k-1, ivz)-three*ddw&
   &            )*fsb
   wb(i, j, k+2, ivz) = wb(i, j, k+2, ivz) + temp32b0
   wb(i, j, k-1, ivz) = wb(i, j, k-1, ivz) - temp32b0
   wb(i, j, k+1, ivz) = wb(i, j, k+1, ivz) + ddwb
   wb(i, j, k, ivz) = wb(i, j, k, ivz) - ddwb
   fsb = fwb(i, j, k+1, imy) - fwb(i, j, k, imy)
   ddw = w(i, j, k+1, ivy) - w(i, j, k, ivy)
   temp32b1 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp32b1
   dis4b = dis4b - (w(i, j, k+2, ivy)-w(i, j, k-1, ivy)-three*ddw&
   &            )*fsb
   wb(i, j, k+2, ivy) = wb(i, j, k+2, ivy) + temp32b1
   wb(i, j, k-1, ivy) = wb(i, j, k-1, ivy) - temp32b1
   wb(i, j, k+1, ivy) = wb(i, j, k+1, ivy) + ddwb
   wb(i, j, k, ivy) = wb(i, j, k, ivy) - ddwb
   fsb = fwb(i, j, k+1, imx) - fwb(i, j, k, imx)
   ddw = w(i, j, k+1, ivx) - w(i, j, k, ivx)
   temp32b2 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp32b2
   dis4b = dis4b - (w(i, j, k+2, ivx)-w(i, j, k-1, ivx)-three*ddw&
   &            )*fsb
   wb(i, j, k+2, ivx) = wb(i, j, k+2, ivx) + temp32b2
   wb(i, j, k-1, ivx) = wb(i, j, k-1, ivx) - temp32b2
   wb(i, j, k+1, ivx) = wb(i, j, k+1, ivx) + ddwb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) - ddwb
   fsb = fwb(i, j, k+1, irho) - fwb(i, j, k, irho)
   ddw = w(i, j, k+1, irho) - w(i, j, k, irho)
   temp32b3 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp32b3
   dis4b = dis4b - (w(i, j, k+2, irho)-w(i, j, k-1, irho)-three*&
   &            ddw)*fsb
   wb(i, j, k+2, irho) = wb(i, j, k+2, irho) + temp32b3
   wb(i, j, k-1, irho) = wb(i, j, k-1, irho) - temp32b3
   wb(i, j, k+1, irho) = wb(i, j, k+1, irho) + ddwb
   wb(i, j, k, irho) = wb(i, j, k, irho) - ddwb
   rrad = ppor*(radk(i, j, k)+radk(i, j, k+1))
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(dis4)
   CALL POPREAL8(dis2)
   rradb = (sigma*fis4+fis2*min5)*dis2b
   min5b = fis2*rrad*dis2b
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(min5)
   y5b = min5b
   ELSE
   CALL POPREAL8(min5)
   y5b = 0.0_8
   END IF
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   dss2b = dss2b + y5b
   dss1b = 0.0_8
   ELSE
   dss1b = y5b
   END IF
   ELSE
   arg1 = fis4*rrad
   CALL POPREAL8(dis4)
   CALL DIM_B(arg1, arg1b, dis2, dis2b, dis4b)
   rradb = fis2*min6*dis2b + fis4*arg1b
   CALL POPREAL8(dis2)
   min6b = fis2*rrad*dis2b
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(min6)
   y6b = min6b
   ELSE
   CALL POPREAL8(min6)
   y6b = 0.0_8
   END IF
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   dss2b = dss2b + y6b
   dss1b = 0.0_8
   ELSE
   dss1b = y6b
   END IF
   END IF
   radkb(i, j, k) = radkb(i, j, k) + ppor*rradb
   radkb(i, j, k+1) = radkb(i, j, k+1) + ppor*rradb
   CALL POPREAL8(ppor)
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   x6b = dss2b
   ELSE
   x6b = -dss2b
   END IF
   temp31 = sslim + ss(i, j, k+2) + two*ss(i, j, k+1) + ss(i, j, &
   &            k)
   temp31b = x6b/temp31
   temp31b0 = -((ss(i, j, k+2)-two*ss(i, j, k+1)+ss(i, j, k))*&
   &            temp31b/temp31)
   ssb(i, j, k+2) = ssb(i, j, k+2) + temp31b0 + temp31b
   ssb(i, j, k+1) = ssb(i, j, k+1) + two*temp31b0 - two*temp31b
   ssb(i, j, k) = ssb(i, j, k) + temp31b0 + temp31b
   END DO
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   x5b = dss1b
   ELSE
   x5b = -dss1b
   END IF
   temp30 = sslim + ss(i, j, 2) + two*ss(i, j, 1) + ss(i, j, 0)
   temp30b4 = x5b/temp30
   temp30b5 = -((ss(i, j, 2)-two*ss(i, j, 1)+ss(i, j, 0))*temp30b4/&
   &          temp30)
   ssb(i, j, 2) = ssb(i, j, 2) + temp30b5 + temp30b4
   ssb(i, j, 1) = ssb(i, j, 1) + two*temp30b5 - two*temp30b4
   ssb(i, j, 0) = ssb(i, j, 0) + temp30b5 + temp30b4
   END DO
   END DO
   radjb = 0.0_8
   DO k=kl,2,-1
   DO i=il,2,-1
   dss1b = 0.0_8
   DO j=jl,1,-1
   dss2b = dss1b
   fsb = fwb(i, j+1, k, irhoe) - fwb(i, j, k, irhoe)
   ddw = w(i, j+1, k, irhoe) - w(i, j, k, irhoe)
   temp30b = -(dis4*fsb)
   dis2b = ddw*fsb
   ddwb = dis2*fsb - three*temp30b
   dis4b = -((w(i, j+2, k, irhoe)-w(i, j-1, k, irhoe)-three*ddw)*&
   &            fsb)
   wb(i, j+2, k, irhoe) = wb(i, j+2, k, irhoe) + temp30b
   wb(i, j-1, k, irhoe) = wb(i, j-1, k, irhoe) - temp30b
   wb(i, j+1, k, irhoe) = wb(i, j+1, k, irhoe) + ddwb
   wb(i, j, k, irhoe) = wb(i, j, k, irhoe) - ddwb
   fsb = fwb(i, j+1, k, imz) - fwb(i, j, k, imz)
   ddw = w(i, j+1, k, ivz) - w(i, j, k, ivz)
   temp30b0 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp30b0
   dis4b = dis4b - (w(i, j+2, k, ivz)-w(i, j-1, k, ivz)-three*ddw&
   &            )*fsb
   wb(i, j+2, k, ivz) = wb(i, j+2, k, ivz) + temp30b0
   wb(i, j-1, k, ivz) = wb(i, j-1, k, ivz) - temp30b0
   wb(i, j+1, k, ivz) = wb(i, j+1, k, ivz) + ddwb
   wb(i, j, k, ivz) = wb(i, j, k, ivz) - ddwb
   fsb = fwb(i, j+1, k, imy) - fwb(i, j, k, imy)
   ddw = w(i, j+1, k, ivy) - w(i, j, k, ivy)
   temp30b1 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp30b1
   dis4b = dis4b - (w(i, j+2, k, ivy)-w(i, j-1, k, ivy)-three*ddw&
   &            )*fsb
   wb(i, j+2, k, ivy) = wb(i, j+2, k, ivy) + temp30b1
   wb(i, j-1, k, ivy) = wb(i, j-1, k, ivy) - temp30b1
   wb(i, j+1, k, ivy) = wb(i, j+1, k, ivy) + ddwb
   wb(i, j, k, ivy) = wb(i, j, k, ivy) - ddwb
   fsb = fwb(i, j+1, k, imx) - fwb(i, j, k, imx)
   ddw = w(i, j+1, k, ivx) - w(i, j, k, ivx)
   temp30b2 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp30b2
   dis4b = dis4b - (w(i, j+2, k, ivx)-w(i, j-1, k, ivx)-three*ddw&
   &            )*fsb
   wb(i, j+2, k, ivx) = wb(i, j+2, k, ivx) + temp30b2
   wb(i, j-1, k, ivx) = wb(i, j-1, k, ivx) - temp30b2
   wb(i, j+1, k, ivx) = wb(i, j+1, k, ivx) + ddwb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) - ddwb
   fsb = fwb(i, j+1, k, irho) - fwb(i, j, k, irho)
   ddw = w(i, j+1, k, irho) - w(i, j, k, irho)
   temp30b3 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp30b3
   dis4b = dis4b - (w(i, j+2, k, irho)-w(i, j-1, k, irho)-three*&
   &            ddw)*fsb
   wb(i, j+2, k, irho) = wb(i, j+2, k, irho) + temp30b3
   wb(i, j-1, k, irho) = wb(i, j-1, k, irho) - temp30b3
   wb(i, j+1, k, irho) = wb(i, j+1, k, irho) + ddwb
   wb(i, j, k, irho) = wb(i, j, k, irho) - ddwb
   rrad = ppor*(radj(i, j, k)+radj(i, j+1, k))
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(dis4)
   CALL POPREAL8(dis2)
   rradb = (sigma*fis4+fis2*min3)*dis2b
   min3b = fis2*rrad*dis2b
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(min3)
   y3b = min3b
   ELSE
   CALL POPREAL8(min3)
   y3b = 0.0_8
   END IF
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   dss2b = dss2b + y3b
   dss1b = 0.0_8
   ELSE
   dss1b = y3b
   END IF
   ELSE
   arg1 = fis4*rrad
   CALL POPREAL8(dis4)
   CALL DIM_B(arg1, arg1b, dis2, dis2b, dis4b)
   rradb = fis2*min4*dis2b + fis4*arg1b
   CALL POPREAL8(dis2)
   min4b = fis2*rrad*dis2b
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(min4)
   y4b = min4b
   ELSE
   CALL POPREAL8(min4)
   y4b = 0.0_8
   END IF
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   dss2b = dss2b + y4b
   dss1b = 0.0_8
   ELSE
   dss1b = y4b
   END IF
   END IF
   radjb(i, j, k) = radjb(i, j, k) + ppor*rradb
   radjb(i, j+1, k) = radjb(i, j+1, k) + ppor*rradb
   CALL POPREAL8(ppor)
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   x4b = dss2b
   ELSE
   x4b = -dss2b
   END IF
   temp29 = sslim + ss(i, j+2, k) + two*ss(i, j+1, k) + ss(i, j, &
   &            k)
   temp29b = x4b/temp29
   temp29b0 = -((ss(i, j+2, k)-two*ss(i, j+1, k)+ss(i, j, k))*&
   &            temp29b/temp29)
   ssb(i, j+2, k) = ssb(i, j+2, k) + temp29b0 + temp29b
   ssb(i, j+1, k) = ssb(i, j+1, k) + two*temp29b0 - two*temp29b
   ssb(i, j, k) = ssb(i, j, k) + temp29b0 + temp29b
   END DO
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   x3b = dss1b
   ELSE
   x3b = -dss1b
   END IF
   temp28 = sslim + ss(i, 2, k) + two*ss(i, 1, k) + ss(i, 0, k)
   temp28b4 = x3b/temp28
   temp28b5 = -((ss(i, 2, k)-two*ss(i, 1, k)+ss(i, 0, k))*temp28b4/&
   &          temp28)
   ssb(i, 2, k) = ssb(i, 2, k) + temp28b5 + temp28b4
   ssb(i, 1, k) = ssb(i, 1, k) + two*temp28b5 - two*temp28b4
   ssb(i, 0, k) = ssb(i, 0, k) + temp28b5 + temp28b4
   END DO
   END DO
   radib = 0.0_8
   DO k=kl,2,-1
   DO j=jl,2,-1
   dss1b = 0.0_8
   DO i=il,1,-1
   dss2b = dss1b
   fsb = fwb(i+1, j, k, irhoe) - fwb(i, j, k, irhoe)
   ddw = w(i+1, j, k, irhoe) - w(i, j, k, irhoe)
   temp28b = -(dis4*fsb)
   dis2b = ddw*fsb
   ddwb = dis2*fsb - three*temp28b
   dis4b = -((w(i+2, j, k, irhoe)-w(i-1, j, k, irhoe)-three*ddw)*&
   &            fsb)
   wb(i+2, j, k, irhoe) = wb(i+2, j, k, irhoe) + temp28b
   wb(i-1, j, k, irhoe) = wb(i-1, j, k, irhoe) - temp28b
   wb(i+1, j, k, irhoe) = wb(i+1, j, k, irhoe) + ddwb
   wb(i, j, k, irhoe) = wb(i, j, k, irhoe) - ddwb
   fsb = fwb(i+1, j, k, imz) - fwb(i, j, k, imz)
   ddw = w(i+1, j, k, ivz) - w(i, j, k, ivz)
   temp28b0 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp28b0
   dis4b = dis4b - (w(i+2, j, k, ivz)-w(i-1, j, k, ivz)-three*ddw&
   &            )*fsb
   wb(i+2, j, k, ivz) = wb(i+2, j, k, ivz) + temp28b0
   wb(i-1, j, k, ivz) = wb(i-1, j, k, ivz) - temp28b0
   wb(i+1, j, k, ivz) = wb(i+1, j, k, ivz) + ddwb
   wb(i, j, k, ivz) = wb(i, j, k, ivz) - ddwb
   fsb = fwb(i+1, j, k, imy) - fwb(i, j, k, imy)
   ddw = w(i+1, j, k, ivy) - w(i, j, k, ivy)
   temp28b1 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp28b1
   dis4b = dis4b - (w(i+2, j, k, ivy)-w(i-1, j, k, ivy)-three*ddw&
   &            )*fsb
   wb(i+2, j, k, ivy) = wb(i+2, j, k, ivy) + temp28b1
   wb(i-1, j, k, ivy) = wb(i-1, j, k, ivy) - temp28b1
   wb(i+1, j, k, ivy) = wb(i+1, j, k, ivy) + ddwb
   wb(i, j, k, ivy) = wb(i, j, k, ivy) - ddwb
   fsb = fwb(i+1, j, k, imx) - fwb(i, j, k, imx)
   ddw = w(i+1, j, k, ivx) - w(i, j, k, ivx)
   temp28b2 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp28b2
   dis4b = dis4b - (w(i+2, j, k, ivx)-w(i-1, j, k, ivx)-three*ddw&
   &            )*fsb
   wb(i+2, j, k, ivx) = wb(i+2, j, k, ivx) + temp28b2
   wb(i-1, j, k, ivx) = wb(i-1, j, k, ivx) - temp28b2
   wb(i+1, j, k, ivx) = wb(i+1, j, k, ivx) + ddwb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) - ddwb
   fsb = fwb(i+1, j, k, irho) - fwb(i, j, k, irho)
   ddw = w(i+1, j, k, irho) - w(i, j, k, irho)
   temp28b3 = -(dis4*fsb)
   dis2b = dis2b + ddw*fsb
   ddwb = dis2*fsb - three*temp28b3
   dis4b = dis4b - (w(i+2, j, k, irho)-w(i-1, j, k, irho)-three*&
   &            ddw)*fsb
   wb(i+2, j, k, irho) = wb(i+2, j, k, irho) + temp28b3
   wb(i-1, j, k, irho) = wb(i-1, j, k, irho) - temp28b3
   wb(i+1, j, k, irho) = wb(i+1, j, k, irho) + ddwb
   wb(i, j, k, irho) = wb(i, j, k, irho) - ddwb
   rrad = ppor*(radi(i, j, k)+radi(i+1, j, k))
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(dis4)
   CALL POPREAL8(dis2)
   rradb = (sigma*fis4+fis2*min1)*dis2b
   min1b = fis2*rrad*dis2b
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(min1)
   y1b = min1b
   ELSE
   CALL POPREAL8(min1)
   y1b = 0.0_8
   END IF
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   dss2b = dss2b + y1b
   dss1b = 0.0_8
   ELSE
   dss1b = y1b
   END IF
   ELSE
   arg1 = fis4*rrad
   CALL POPREAL8(dis4)
   CALL DIM_B(arg1, arg1b, dis2, dis2b, dis4b)
   rradb = fis2*min2*dis2b + fis4*arg1b
   CALL POPREAL8(dis2)
   min2b = fis2*rrad*dis2b
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   CALL POPREAL8(min2)
   y2b = min2b
   ELSE
   CALL POPREAL8(min2)
   y2b = 0.0_8
   END IF
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   dss2b = dss2b + y2b
   dss1b = 0.0_8
   ELSE
   dss1b = y2b
   END IF
   END IF
   radib(i, j, k) = radib(i, j, k) + ppor*rradb
   radib(i+1, j, k) = radib(i+1, j, k) + ppor*rradb
   CALL POPREAL8(ppor)
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   x2b = dss2b
   ELSE
   x2b = -dss2b
   END IF
   temp27 = sslim + ss(i+2, j, k) + two*ss(i+1, j, k) + ss(i, j, &
   &            k)
   temp27b = x2b/temp27
   temp27b0 = -((ss(i+2, j, k)-two*ss(i+1, j, k)+ss(i, j, k))*&
   &            temp27b/temp27)
   ssb(i+2, j, k) = ssb(i+2, j, k) + temp27b0 + temp27b
   ssb(i+1, j, k) = ssb(i+1, j, k) + two*temp27b0 - two*temp27b
   ssb(i, j, k) = ssb(i, j, k) + temp27b0 + temp27b
   END DO
   CALL POPCONTROL1B(branch)
   IF (branch .EQ. 0) THEN
   x1b = dss1b
   ELSE
   x1b = -dss1b
   END IF
   temp26 = sslim + ss(2, j, k) + two*ss(1, j, k) + ss(0, j, k)
   temp26b = x1b/temp26
   temp26b0 = -((ss(2, j, k)-two*ss(1, j, k)+ss(0, j, k))*temp26b/&
   &          temp26)
   ssb(2, j, k) = ssb(2, j, k) + temp26b0 + temp26b
   ssb(1, j, k) = ssb(1, j, k) + two*temp26b0 - two*temp26b
   ssb(0, j, k) = ssb(0, j, k) + temp26b0 + temp26b
   END DO
   END DO
   DO k=kl,2,-1
   DO i=il,2,-1
   CALL POPREAL8(w(i, jb, k, irhoe))
   pb(i, jb, k) = pb(i, jb, k) + wb(i, jb, k, irhoe)
   CALL POPREAL8(w(i, jb, k, ivz))
   tmp25b = wb(i, jb, k, ivz)
   wb(i, jb, k, ivz) = 0.0_8
   wb(i, jb, k, irho) = wb(i, jb, k, irho) + w(i, jb, k, ivz)*&
   &          tmp25b
   wb(i, jb, k, ivz) = wb(i, jb, k, ivz) + w(i, jb, k, irho)*tmp25b
   CALL POPREAL8(w(i, jb, k, ivy))
   tmp24b = wb(i, jb, k, ivy)
   wb(i, jb, k, ivy) = 0.0_8
   wb(i, jb, k, irho) = wb(i, jb, k, irho) + w(i, jb, k, ivy)*&
   &          tmp24b
   wb(i, jb, k, ivy) = wb(i, jb, k, ivy) + w(i, jb, k, irho)*tmp24b
   CALL POPREAL8(w(i, jb, k, ivx))
   tmp23b = wb(i, jb, k, ivx)
   wb(i, jb, k, ivx) = 0.0_8
   wb(i, jb, k, irho) = wb(i, jb, k, irho) + w(i, jb, k, ivx)*&
   &          tmp23b
   wb(i, jb, k, ivx) = wb(i, jb, k, ivx) + w(i, jb, k, irho)*tmp23b
   CALL POPREAL8(w(i, je, k, irhoe))
   pb(i, je, k) = pb(i, je, k) + wb(i, je, k, irhoe)
   CALL POPREAL8(w(i, je, k, ivz))
   tmp22b = wb(i, je, k, ivz)
   wb(i, je, k, ivz) = 0.0_8
   wb(i, je, k, irho) = wb(i, je, k, irho) + w(i, je, k, ivz)*&
   &          tmp22b
   wb(i, je, k, ivz) = wb(i, je, k, ivz) + w(i, je, k, irho)*tmp22b
   CALL POPREAL8(w(i, je, k, ivy))
   tmp21b = wb(i, je, k, ivy)
   wb(i, je, k, ivy) = 0.0_8
   wb(i, je, k, irho) = wb(i, je, k, irho) + w(i, je, k, ivy)*&
   &          tmp21b
   wb(i, je, k, ivy) = wb(i, je, k, ivy) + w(i, je, k, irho)*tmp21b
   CALL POPREAL8(w(i, je, k, ivx))
   tmp20b = wb(i, je, k, ivx)
   wb(i, je, k, ivx) = 0.0_8
   wb(i, je, k, irho) = wb(i, je, k, irho) + w(i, je, k, ivx)*&
   &          tmp20b
   wb(i, je, k, ivx) = wb(i, je, k, ivx) + w(i, je, k, irho)*tmp20b
   CALL POPREAL8(w(i, 1, k, irhoe))
   pb(i, 1, k) = pb(i, 1, k) + wb(i, 1, k, irhoe)
   CALL POPREAL8(w(i, 1, k, ivz))
   tmp19b = wb(i, 1, k, ivz)
   wb(i, 1, k, ivz) = 0.0_8
   wb(i, 1, k, irho) = wb(i, 1, k, irho) + w(i, 1, k, ivz)*tmp19b
   wb(i, 1, k, ivz) = wb(i, 1, k, ivz) + w(i, 1, k, irho)*tmp19b
   CALL POPREAL8(w(i, 1, k, ivy))
   tmp18b = wb(i, 1, k, ivy)
   wb(i, 1, k, ivy) = 0.0_8
   wb(i, 1, k, irho) = wb(i, 1, k, irho) + w(i, 1, k, ivy)*tmp18b
   wb(i, 1, k, ivy) = wb(i, 1, k, ivy) + w(i, 1, k, irho)*tmp18b
   CALL POPREAL8(w(i, 1, k, ivx))
   tmp17b = wb(i, 1, k, ivx)
   wb(i, 1, k, ivx) = 0.0_8
   wb(i, 1, k, irho) = wb(i, 1, k, irho) + w(i, 1, k, ivx)*tmp17b
   wb(i, 1, k, ivx) = wb(i, 1, k, ivx) + w(i, 1, k, irho)*tmp17b
   CALL POPREAL8(w(i, 0, k, irhoe))
   pb(i, 0, k) = pb(i, 0, k) + wb(i, 0, k, irhoe)
   CALL POPREAL8(w(i, 0, k, ivz))
   tmp16b = wb(i, 0, k, ivz)
   wb(i, 0, k, ivz) = 0.0_8
   wb(i, 0, k, irho) = wb(i, 0, k, irho) + w(i, 0, k, ivz)*tmp16b
   wb(i, 0, k, ivz) = wb(i, 0, k, ivz) + w(i, 0, k, irho)*tmp16b
   CALL POPREAL8(w(i, 0, k, ivy))
   tmp15b = wb(i, 0, k, ivy)
   wb(i, 0, k, ivy) = 0.0_8
   wb(i, 0, k, irho) = wb(i, 0, k, irho) + w(i, 0, k, ivy)*tmp15b
   wb(i, 0, k, ivy) = wb(i, 0, k, ivy) + w(i, 0, k, irho)*tmp15b
   CALL POPREAL8(w(i, 0, k, ivx))
   tmp14b = wb(i, 0, k, ivx)
   wb(i, 0, k, ivx) = 0.0_8
   wb(i, 0, k, irho) = wb(i, 0, k, irho) + w(i, 0, k, ivx)*tmp14b
   wb(i, 0, k, ivx) = wb(i, 0, k, ivx) + w(i, 0, k, irho)*tmp14b
   END DO
   END DO
   DO k=kl,2,-1
   DO j=jl,2,-1
   CALL POPREAL8(w(ib, j, k, irhoe))
   pb(ib, j, k) = pb(ib, j, k) + wb(ib, j, k, irhoe)
   CALL POPREAL8(w(ib, j, k, ivz))
   tmp13b = wb(ib, j, k, ivz)
   wb(ib, j, k, ivz) = 0.0_8
   wb(ib, j, k, irho) = wb(ib, j, k, irho) + w(ib, j, k, ivz)*&
   &          tmp13b
   wb(ib, j, k, ivz) = wb(ib, j, k, ivz) + w(ib, j, k, irho)*tmp13b
   CALL POPREAL8(w(ib, j, k, ivy))
   tmp12b = wb(ib, j, k, ivy)
   wb(ib, j, k, ivy) = 0.0_8
   wb(ib, j, k, irho) = wb(ib, j, k, irho) + w(ib, j, k, ivy)*&
   &          tmp12b
   wb(ib, j, k, ivy) = wb(ib, j, k, ivy) + w(ib, j, k, irho)*tmp12b
   CALL POPREAL8(w(ib, j, k, ivx))
   tmp11b = wb(ib, j, k, ivx)
   wb(ib, j, k, ivx) = 0.0_8
   wb(ib, j, k, irho) = wb(ib, j, k, irho) + w(ib, j, k, ivx)*&
   &          tmp11b
   wb(ib, j, k, ivx) = wb(ib, j, k, ivx) + w(ib, j, k, irho)*tmp11b
   CALL POPREAL8(w(ie, j, k, irhoe))
   pb(ie, j, k) = pb(ie, j, k) + wb(ie, j, k, irhoe)
   CALL POPREAL8(w(ie, j, k, ivz))
   tmp10b = wb(ie, j, k, ivz)
   wb(ie, j, k, ivz) = 0.0_8
   wb(ie, j, k, irho) = wb(ie, j, k, irho) + w(ie, j, k, ivz)*&
   &          tmp10b
   wb(ie, j, k, ivz) = wb(ie, j, k, ivz) + w(ie, j, k, irho)*tmp10b
   CALL POPREAL8(w(ie, j, k, ivy))
   tmp9b = wb(ie, j, k, ivy)
   wb(ie, j, k, ivy) = 0.0_8
   wb(ie, j, k, irho) = wb(ie, j, k, irho) + w(ie, j, k, ivy)*tmp9b
   wb(ie, j, k, ivy) = wb(ie, j, k, ivy) + w(ie, j, k, irho)*tmp9b
   CALL POPREAL8(w(ie, j, k, ivx))
   tmp8b = wb(ie, j, k, ivx)
   wb(ie, j, k, ivx) = 0.0_8
   wb(ie, j, k, irho) = wb(ie, j, k, irho) + w(ie, j, k, ivx)*tmp8b
   wb(ie, j, k, ivx) = wb(ie, j, k, ivx) + w(ie, j, k, irho)*tmp8b
   CALL POPREAL8(w(1, j, k, irhoe))
   pb(1, j, k) = pb(1, j, k) + wb(1, j, k, irhoe)
   CALL POPREAL8(w(1, j, k, ivz))
   tmp7b = wb(1, j, k, ivz)
   wb(1, j, k, ivz) = 0.0_8
   wb(1, j, k, irho) = wb(1, j, k, irho) + w(1, j, k, ivz)*tmp7b
   wb(1, j, k, ivz) = wb(1, j, k, ivz) + w(1, j, k, irho)*tmp7b
   CALL POPREAL8(w(1, j, k, ivy))
   tmp6b = wb(1, j, k, ivy)
   wb(1, j, k, ivy) = 0.0_8
   wb(1, j, k, irho) = wb(1, j, k, irho) + w(1, j, k, ivy)*tmp6b
   wb(1, j, k, ivy) = wb(1, j, k, ivy) + w(1, j, k, irho)*tmp6b
   CALL POPREAL8(w(1, j, k, ivx))
   tmp5b = wb(1, j, k, ivx)
   wb(1, j, k, ivx) = 0.0_8
   wb(1, j, k, irho) = wb(1, j, k, irho) + w(1, j, k, ivx)*tmp5b
   wb(1, j, k, ivx) = wb(1, j, k, ivx) + w(1, j, k, irho)*tmp5b
   CALL POPREAL8(w(0, j, k, irhoe))
   pb(0, j, k) = pb(0, j, k) + wb(0, j, k, irhoe)
   CALL POPREAL8(w(0, j, k, ivz))
   tmp4b = wb(0, j, k, ivz)
   wb(0, j, k, ivz) = 0.0_8
   wb(0, j, k, irho) = wb(0, j, k, irho) + w(0, j, k, ivz)*tmp4b
   wb(0, j, k, ivz) = wb(0, j, k, ivz) + w(0, j, k, irho)*tmp4b
   CALL POPREAL8(w(0, j, k, ivy))
   tmp3b = wb(0, j, k, ivy)
   wb(0, j, k, ivy) = 0.0_8
   wb(0, j, k, irho) = wb(0, j, k, irho) + w(0, j, k, ivy)*tmp3b
   wb(0, j, k, ivy) = wb(0, j, k, ivy) + w(0, j, k, irho)*tmp3b
   CALL POPREAL8(w(0, j, k, ivx))
   tmp2b = wb(0, j, k, ivx)
   wb(0, j, k, ivx) = 0.0_8
   wb(0, j, k, irho) = wb(0, j, k, irho) + w(0, j, k, ivx)*tmp2b
   wb(0, j, k, ivx) = wb(0, j, k, ivx) + w(0, j, k, irho)*tmp2b
   END DO
   END DO
   DO k=kb,0,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   CALL POPREAL8(w(i, j, k, irhoe))
   pb(i, j, k) = pb(i, j, k) + wb(i, j, k, irhoe)
   CALL POPREAL8(w(i, j, k, ivz))
   tmp1b = wb(i, j, k, ivz)
   wb(i, j, k, ivz) = 0.0_8
   wb(i, j, k, irho) = wb(i, j, k, irho) + w(i, j, k, ivz)*tmp1b
   wb(i, j, k, ivz) = wb(i, j, k, ivz) + w(i, j, k, irho)*tmp1b
   CALL POPREAL8(w(i, j, k, ivy))
   tmp0b = wb(i, j, k, ivy)
   wb(i, j, k, ivy) = 0.0_8
   wb(i, j, k, irho) = wb(i, j, k, irho) + w(i, j, k, ivy)*tmp0b
   wb(i, j, k, ivy) = wb(i, j, k, ivy) + w(i, j, k, irho)*tmp0b
   CALL POPREAL8(w(i, j, k, ivx))
   tmpb = wb(i, j, k, ivx)
   wb(i, j, k, ivx) = 0.0_8
   wb(i, j, k, irho) = wb(i, j, k, irho) + w(i, j, k, ivx)*tmpb
   wb(i, j, k, ivx) = wb(i, j, k, ivx) + w(i, j, k, irho)*tmpb
   END DO
   END DO
   END DO
   CALL POPCONTROL2B(branch)
   IF (branch .NE. 0) THEN
   IF (branch .EQ. 1) THEN
   DO k=kl,2,-1
   DO i=il,2,-1
   pb(i, jb, k) = pb(i, jb, k) + ssb(i, jb, k)
   ssb(i, jb, k) = 0.0_8
   pb(i, je, k) = pb(i, je, k) + ssb(i, je, k)
   ssb(i, je, k) = 0.0_8
   pb(i, 1, k) = pb(i, 1, k) + ssb(i, 1, k)
   ssb(i, 1, k) = 0.0_8
   pb(i, 0, k) = pb(i, 0, k) + ssb(i, 0, k)
   ssb(i, 0, k) = 0.0_8
   END DO
   END DO
   DO k=kl,2,-1
   DO j=jl,2,-1
   pb(ib, j, k) = pb(ib, j, k) + ssb(ib, j, k)
   ssb(ib, j, k) = 0.0_8
   pb(ie, j, k) = pb(ie, j, k) + ssb(ie, j, k)
   ssb(ie, j, k) = 0.0_8
   pb(1, j, k) = pb(1, j, k) + ssb(1, j, k)
   ssb(1, j, k) = 0.0_8
   pb(0, j, k) = pb(0, j, k) + ssb(0, j, k)
   ssb(0, j, k) = 0.0_8
   END DO
   END DO
   DO k=kb,0,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   pb(i, j, k) = pb(i, j, k) + ssb(i, j, k)
   ssb(i, j, k) = 0.0_8
   END DO
   END DO
   END DO
   ELSE
   DO k=kl,2,-1
   DO i=il,2,-1
   temp25 = gamma(i, jb, k)
   temp24 = w(i, jb, k, irho)
   temp23 = temp24**temp25
   pb(i, jb, k) = pb(i, jb, k) + ssb(i, jb, k)/temp23
   IF (.NOT.(temp24 .LE. 0.0 .AND. (temp25 .EQ. 0.0 .OR. temp25&
   &                .NE. INT(temp25)))) wb(i, jb, k, irho) = wb(i, jb, k, &
   &                irho) - p(i, jb, k)*temp25*temp24**(temp25-1)*ssb(i, jb&
   &                , k)/temp23**2
   ssb(i, jb, k) = 0.0_8
   temp22 = gamma(i, je, k)
   temp21 = w(i, je, k, irho)
   temp20 = temp21**temp22
   pb(i, je, k) = pb(i, je, k) + ssb(i, je, k)/temp20
   IF (.NOT.(temp21 .LE. 0.0 .AND. (temp22 .EQ. 0.0 .OR. temp22&
   &                .NE. INT(temp22)))) wb(i, je, k, irho) = wb(i, je, k, &
   &                irho) - p(i, je, k)*temp22*temp21**(temp22-1)*ssb(i, je&
   &                , k)/temp20**2
   ssb(i, je, k) = 0.0_8
   temp19 = gamma(i, 1, k)
   temp18 = w(i, 1, k, irho)
   temp17 = temp18**temp19
   pb(i, 1, k) = pb(i, 1, k) + ssb(i, 1, k)/temp17
   IF (.NOT.(temp18 .LE. 0.0 .AND. (temp19 .EQ. 0.0 .OR. temp19&
   &                .NE. INT(temp19)))) wb(i, 1, k, irho) = wb(i, 1, k, irho&
   &                ) - p(i, 1, k)*temp19*temp18**(temp19-1)*ssb(i, 1, k)/&
   &                temp17**2
   ssb(i, 1, k) = 0.0_8
   temp16 = gamma(i, 0, k)
   temp15 = w(i, 0, k, irho)
   temp14 = temp15**temp16
   pb(i, 0, k) = pb(i, 0, k) + ssb(i, 0, k)/temp14
   IF (.NOT.(temp15 .LE. 0.0 .AND. (temp16 .EQ. 0.0 .OR. temp16&
   &                .NE. INT(temp16)))) wb(i, 0, k, irho) = wb(i, 0, k, irho&
   &                ) - p(i, 0, k)*temp16*temp15**(temp16-1)*ssb(i, 0, k)/&
   &                temp14**2
   ssb(i, 0, k) = 0.0_8
   END DO
   END DO
   DO k=kl,2,-1
   DO j=jl,2,-1
   temp13 = gamma(ib, j, k)
   temp12 = w(ib, j, k, irho)
   temp11 = temp12**temp13
   pb(ib, j, k) = pb(ib, j, k) + ssb(ib, j, k)/temp11
   IF (.NOT.(temp12 .LE. 0.0 .AND. (temp13 .EQ. 0.0 .OR. temp13&
   &                .NE. INT(temp13)))) wb(ib, j, k, irho) = wb(ib, j, k, &
   &                irho) - p(ib, j, k)*temp13*temp12**(temp13-1)*ssb(ib, j&
   &                , k)/temp11**2
   ssb(ib, j, k) = 0.0_8
   temp10 = gamma(ie, j, k)
   temp9 = w(ie, j, k, irho)
   temp8 = temp9**temp10
   pb(ie, j, k) = pb(ie, j, k) + ssb(ie, j, k)/temp8
   IF (.NOT.(temp9 .LE. 0.0 .AND. (temp10 .EQ. 0.0 .OR. temp10 &
   &                .NE. INT(temp10)))) wb(ie, j, k, irho) = wb(ie, j, k, &
   &                irho) - p(ie, j, k)*temp10*temp9**(temp10-1)*ssb(ie, j, &
   &                k)/temp8**2
   ssb(ie, j, k) = 0.0_8
   temp7 = gamma(1, j, k)
   temp6 = w(1, j, k, irho)
   temp5 = temp6**temp7
   pb(1, j, k) = pb(1, j, k) + ssb(1, j, k)/temp5
   IF (.NOT.(temp6 .LE. 0.0 .AND. (temp7 .EQ. 0.0 .OR. temp7 &
   &                .NE. INT(temp7)))) wb(1, j, k, irho) = wb(1, j, k, irho)&
   &                - p(1, j, k)*temp7*temp6**(temp7-1)*ssb(1, j, k)/temp5**&
   &                2
   ssb(1, j, k) = 0.0_8
   temp4 = gamma(0, j, k)
   temp3 = w(0, j, k, irho)
   temp2 = temp3**temp4
   pb(0, j, k) = pb(0, j, k) + ssb(0, j, k)/temp2
   IF (.NOT.(temp3 .LE. 0.0 .AND. (temp4 .EQ. 0.0 .OR. temp4 &
   &                .NE. INT(temp4)))) wb(0, j, k, irho) = wb(0, j, k, irho)&
   &                - p(0, j, k)*temp4*temp3**(temp4-1)*ssb(0, j, k)/temp2**&
   &                2
   ssb(0, j, k) = 0.0_8
   END DO
   END DO
   DO k=kb,0,-1
   DO j=jl,2,-1
   DO i=il,2,-1
   temp1 = gamma(i, j, k)
   temp0 = w(i, j, k, irho)
   temp = temp0**temp1
   pb(i, j, k) = pb(i, j, k) + ssb(i, j, k)/temp
   IF (.NOT.(temp0 .LE. 0.0 .AND. (temp1 .EQ. 0.0 .OR. temp1 &
   &                  .NE. INT(temp1)))) wb(i, j, k, irho) = wb(i, j, k, &
   &                  irho) - p(i, j, k)*temp1*temp0**(temp1-1)*ssb(i, j, k)&
   &                  /temp**2
   ssb(i, j, k) = 0.0_8
   END DO
   END DO
   END DO
   END IF
   END IF
   END IF
   END SUBROUTINE INVISCIDDISSFLUXSCALAR_B
