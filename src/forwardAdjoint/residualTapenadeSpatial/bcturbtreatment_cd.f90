!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08
!
!
!      ******************************************************************
!      *                                                                *
!      * File:          bcTurbTreatment.f90                             *
!      * Author:        Georgi Kalitzin, Edwin van der Weide            *
!      *                Seonghyeon Hahn                                 *
!      * Starting date: 06-13-2003                                      *
!      * Last modified: 08-12-2005                                      *
!      *                                                                *
!      ******************************************************************
!
SUBROUTINE BCTURBTREATMENT_CD()
  USE BCTYPES_SPATIAL_D
  USE BLOCKPOINTERS_SPATIAL_D
  USE FLOWVARREFSTATE_SPATIAL_D
  IMPLICIT NONE
!
!      ******************************************************************
!      *                                                                *
!      * bcTurbTreatment sets the arrays bmti1, bvti1, etc, such that   *
!      * the physical boundary conditions are treated correctly.        *
!      * It is assumed that the variables in blockPointers already      *
!      * point to the correct block.                                    *
!      *                                                                *
!      * The turbulent variable in the halo is computed as follows:     *
!      * wHalo = -bmt*wInternal + bvt for every block facer. As it is   *
!      * possible to have a coupling in the boundary conditions bmt     *
!      * actually are matrices. If there is no coupling between the     *
!      * boundary conditions of the turbulence equations bmt is a       *
!      * diagonal matrix.                                               *
!      *                                                                *
!      ******************************************************************
!
!
!      Local variable.
!
  INTEGER(kind=inttype) :: nn, i, j, k, l, m
  EXTERNAL BCTURBINTERFACE
!
!      ******************************************************************
!      *                                                                *
!      * Begin execution                                                *
!      *                                                                *
!      ******************************************************************
!
! Initialize the arrays for the boundary condition treatment
! to zero, such that internal block boundaries are solved
! correctly (i.e. explicitly).
  DO k=1,ke
    DO j=1,je
      DO l=nt1,nt2
        DO m=nt1,nt2
          bmti1(j, k, l, m) = zero
          bmti2(j, k, l, m) = zero
        END DO
        bvti1(j, k, l) = zero
        bvti2(j, k, l) = zero
      END DO
    END DO
  END DO
  DO k=1,ke
    DO i=1,ie
      DO l=nt1,nt2
        DO m=nt1,nt2
          bmtj1(i, k, l, m) = zero
          bmtj2(i, k, l, m) = zero
        END DO
        bvtj1(i, k, l) = zero
        bvtj2(i, k, l) = zero
      END DO
    END DO
  END DO
  DO j=1,je
    DO i=1,ie
      DO l=nt1,nt2
        DO m=nt1,nt2
          bmtk1(i, j, l, m) = zero
          bmtk2(i, j, l, m) = zero
        END DO
        bvtk1(i, j, l) = zero
        bvtk2(i, j, l) = zero
      END DO
    END DO
  END DO
! Loop over the boundary condition subfaces of this block.
bocos:DO nn=1,nbocos
! Determine the kind of boundary condition for this subface.
    SELECT CASE  (bctype(nn)) 
    CASE (nswalladiabatic, nswallisothermal) 
! Viscous wall. There is no difference between an adiabatic
! and an isothermal wall for the turbulent equations.
! Set the implicit treatment of the wall boundary conditions.
      CALL BCTURBWALL_CD(nn)
    CASE (subsonicinflow, supersonicinflow, massbleedinflow) 
!=============================================================
! Inflow. Subsonic, supersonic or mass bleed inflow is
! identical for the turbulent transport equations.
      CALL BCTURBINFLOW_CD(nn)
    CASE (subsonicoutflow, supersonicoutflow, massbleedoutflow, extrap) 
!=============================================================
! Outflow. Subsonic, supersonic or mass bleed outflow is
! identical for the turbulent transport equations. The
! extrapolation boundary is also an outflow.
      CALL BCTURBOUTFLOW_CD(nn)
    CASE (symm, symmpolar, eulerwall) 
!=============================================================
! Symmetry, polar symmetry or inviscid wall. Treatment of
! the turbulent equations is identical.
      CALL BCTURBSYMM_CD(nn)
    CASE (farfield) 
!=============================================================
! Farfield. The kind of boundary condition to be applied,
! inflow or outflow, depends on the local conditions.
      CALL BCTURBFARFIELD_CD(nn)
    CASE (slidinginterface, oversetouterbound, domaininterfaceall, &
&    domaininterfacerhouvw, domaininterfacep, domaininterfacerho, &
&    domaininterfacetotal) 
!=============================================================
! Sliding mesh interface, overset outer boudaries, and 
! domain interface with another code are not really boundary
! condition and therefore the values are kept.
      CALL BCTURBINTERFACE(nn)
    CASE DEFAULT
!=============================================================
      CALL TERMINATE_CD('bcTurbTreatment', 'Unknown boundary condition')
    END SELECT
  END DO bocos
END SUBROUTINE BCTURBTREATMENT_CD
