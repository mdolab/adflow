<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="residual_block_cd"></a><a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      * File:          residual.f90                                    *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      * Author:        Edwin van der Weide, Steve Repsher (blanking)   *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      * Starting date: 03-15-2003                                      *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      * Last modified: 10-29-2007                                      *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">RESIDUAL_BLOCK_CD</code>()</a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTITERATION_SPATIAL_D</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">USE </code><code class="funcname">ITERATION_SPATIAL_D</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">USE </code><code class="funcname">CGNSGRID_SPATIAL_D</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTDISCRETIZATION_SPATIAL_D</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL_SPATIAL_D</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE_SPATIAL_D</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!write(14,40),i,j,k,dw(i,j,k,l),fw(i,j,k,l)</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      * residual computes the residual of the mean flow equations on   *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      * the current MG level.                                          *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      Local variables.</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">sps</code>, <code class="vardecl">nn</code>, <code class="vardecl">discr</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">l</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">finegrid</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="typename">REAL </code>:: <code class="vardecl">result1</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (smoother .EQ. rungekutta) <code class="keyword">THEN</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile">rfil = cdisrk(rkstage+<code class="constant">1</code>)</a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">ELSE</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile">rfil = one</a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END IF</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Initialize the local arrays to monitor the massflows to zero.</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile">massflowfamilyinv = zero</a>
  <a href="residual_block_p.html#residual_block" target="origFile">massflowfamilydiss = zero</a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Set the value of the discretization, depending on the grid level,</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! and the logical fineGrid, which indicates whether or not this</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! is the finest grid level of the current mg cycle.</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile">discr = spacediscrcoarse</a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (currentlevel .EQ. <code class="constant">1</code>) discr = spacediscr</a>
  <a href="residual_block_p.html#residual_block" target="origFile">finegrid = <code class="constant">.false.</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (currentlevel .EQ. groundlevel) finegrid = <code class="constant">.true.</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (finegrid .EQV. <code class="constant">.false.</code>) <code class="keyword">THEN</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">PRINT*</code>, <code class="string">'Fine Grid should not be false here'</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">STOP</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">ELSE</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDCENTRALFLUX_CD</code>()</a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Compute the artificial dissipation fluxes.</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! This depends on the parameter discr.</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">SELECT CASE </code> (discr) </a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CASE </code>(dissscalar) </a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Standard scalar dissipation scheme.</code></a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (finegrid) <code class="keyword">THEN</code></a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXSCALAR_CD</code>()</a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXSCALARCOARSE_CD</code>()</a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END IF</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CASE </code>(dissmatrix) </a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!===========================================================</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Matrix dissipation scheme.</code></a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (finegrid) <code class="keyword">THEN</code></a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXMATRIX_CD</code>()</a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXMATRIXCOARSE_CD</code>()</a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END IF</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CASE </code>(disscusp) </a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!===========================================================</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Cusp dissipation scheme.</code></a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (finegrid) <code class="keyword">THEN</code></a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXCUSP_CD</code>()</a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXCUSPCOARSE_CD</code>()</a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END IF</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CASE </code>(upwind) </a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!===========================================================</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Dissipation via an upwind scheme.</code></a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDUPWINDFLUX_CD</code>(finegrid)</a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END SELECT</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Compute the viscous flux in case of a viscous computation.</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">IF</code> (viscous) <code class="keyword">CALL </code><code class="funcname">VISCOUSFLUX_CD</code>()</a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! add the dissipative and possibly viscous fluxes to the</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Euler fluxes. Loop over the owned cells and add fw to dw.</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Also multiply by iblank so that no updates occur in holes</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! or on the overset boundary.</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">DO </code>l=<code class="constant">1</code>,nwf</a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
          <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
            <a href="residual_block_p.html#residual_block" target="origFile">result1 = <code class="funcname">REAL</code>(iblank(i, j, k), realtype)</a>
            <a href="residual_block_p.html#residual_block" target="origFile">dw(i, j, k, l) = (dw(i, j, k, l)+fw(i, j, k, l))*result1</a>
          <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END DO</code></a>
        <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END DO</code></a>
      <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END DO</code></a>
    <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END DO</code></a>
  <a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END IF</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Add the source terms from the level 0 cooling model.</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">!call level0CoolingModel</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Set the value of rFil, which controls the fraction of the old</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! dissipation residual to be used. This is only for the runge-kutta</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! schemes; for other smoothers rFil is simply set to 1.0.</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! Note the index rkStage+1 for cdisRK. The reason is that the</code></a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="comment">! residual computation is performed before rkStage is incremented.</code></a>
 <a href="residual_block_p.html#residual_block" target="origFile"><code class="label">40 </code><code class="keyword">FORMAT</code>(<code class="constant">1x,i4,i4,i4,e20.6,e20.6</code>)</a>
<a href="residual_block_p.html#residual_block" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">RESIDUAL_BLOCK_CD</code></a>
</pre>
</body>
