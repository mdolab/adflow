<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="xhalo_block_spatial_d"></a><a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!  Differentiation of xhalo_block in forward (tangent) mode:</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   variations   of useful results: *x</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   with respect to varying inputs: *x</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * File:          xhalo.f90                                       *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * Author:        Edwin van der Weide,C.A.(Sandy) Mader            *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * Starting date: 02-23-2003                                      *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * Last modified: 08-12-2009                                      *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">XHALO_BLOCK_SPATIAL_D</code>(<code class="vardecl">level</code>)</a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">BCTYPES_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">COMMUNICATION_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      else if (BCType(mm) == EulerWall .or. BCType(nn) == FarField) then</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         ! Do a generic extrapolation</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         select case (BCFaceID(mm))</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (iMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(0,:,:,:); x1 => x(1,:,:,:); x2 => x(2,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (iMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(ie,:,:,:); x1 => x(il,:,:,:); x2 => x(nx,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (jMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,0,:,:); x1 => x(:,1,:,:); x2 => x(:,2,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (jMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,je,:,:); x1 => x(:,jl,:,:); x2 => x(:,ny,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (kMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,:,0,:); x1 => x(:,:,1,:); x2 => x(:,:,2,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (kMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,:,ke,:); x1 => x(:,:,kl,:); x2 => x(:,:,nz,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end select</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(iBeg == 1)     iBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(iEnd == iiMax) iEnd = iiMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(jBeg == 1)     jBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(jEnd == jjMax) jEnd = jjMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         do j=jBeg,jEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            do i=iBeg,iEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               x0(i+1,j+1,1) = two*x1(i+1,j+1,1) - x2(i+1,j+1,1)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               x0(i+1,j+1,2) = two*x1(i+1,j+1,2) - x2(i+1,j+1,2)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               x0(i+1,j+1,3) = two*x1(i+1,j+1,3) - x2(i+1,j+1,3)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   do l=1,3</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      do k=0,ke</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         do j=0,je</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            do i=0,ie</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               if (x_peturb(i,j,k,l)) then</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!                  x(i,j,k,l) = x_temp(i,j,k,l)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               end if</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!  loop1to1: do mm=1,n1to1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      select case (BCFaceID(mm))</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (iMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(0,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(0,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (iMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(ie,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(ie,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (jMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,0,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,0,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (jMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,je,:,:);</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,je,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (kMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,:,0,:);</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,:,0,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (kMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,:,ke,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,:,ke,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      end select</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! Basically we want to copy the RIGHT X back into X. This is</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! basically the same as the exchange coordinates execpt we</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! already had the right halos on input</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(iBeg == 1)     iBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(iEnd == iiMax) iEnd = iiMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(jBeg == 1)     jBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(jEnd == jjMax) jEnd = jjMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! Loop over the nodes of the subface and set the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! corresponding halo coordinates.</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      print *,ibeg,iend,jbeg,jend</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      do j=jBeg,jEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         do i=iBeg,iEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0(i+1,j+1,:) = x1(i+1,j+1,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end do</code></a>
<a name="xhalo_block_spatial_di0"></a><a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   end do loop1to1</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!,x_peturb)</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      * xhalo determines the coordinates of the nodal halo's.          *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      * First it sets all halo coordinates by simple extrapolation,    *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      * then the symmetry planes are treated (also the unit normal of  *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      * symmetry planes are determined) and finally an exchange is     *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      * made for the internal halo's.                                  *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!      Subroutine arguments.</code></a>
<a name="xhalo_block_spatial_di1"></a><a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="comment">!</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki0" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">level</code></a>
<a href="xhalo_block_p.html#xhalo_blocki1" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki1" target="origFile"><code class="comment">!      Local variables.</code></a>
<a name="xhalo_block_spatial_di2"></a><a href="xhalo_block_p.html#xhalo_blocki1" target="origFile"><code class="comment">!</code></a>
<a name="xhalo_block_spatial_di3"></a>  <a href="xhalo_block_p.html#xhalo_blocki1" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">nn</code>, <code class="vardecl">mm</code>, <code class="vardecl">sps</code>, <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">ii</code>, <code class="vardecl">jj</code>, <code class="vardecl">l</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki2" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">ibeg</code>, <code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>, <code class="vardecl">jend</code>, <code class="vardecl">iimax</code>, <code class="vardecl">jjmax</code></a>
<a href="xhalo_block_p.html#xhalo_blocki3" target="origFile"><code class="comment">!integer(kind=intType) :: iBeg2, iEnd2, jBeg2, jEnd2</code></a>
<a name="xhalo_block_spatial_di4"></a>  <a href="xhalo_block_p.html#xhalo_blocki3" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">x0</code>, <code class="vardecl">x1</code>, <code class="vardecl">x2</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(:, :, :), <code class="modifier">POINTER </code>:: <code class="vardecl">x0d</code>, <code class="vardecl">x1d</code>, <code class="vardecl">x2d</code></a>
<a name="xhalo_block_spatial_di5"></a>  <a href="xhalo_block_p.html#xhalo_blocki4" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">length</code>, <code class="vardecl">dot</code></a>
<a name="xhalo_block_spatial_di6"></a>  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">lengthd</code>, <code class="vardecl">dotd</code></a>
<a name="xhalo_block_spatial_di7"></a>  <a href="xhalo_block_p.html#xhalo_blocki5" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">imininternal</code>, <code class="vardecl">jmininternal</code>, <code class="vardecl">kmininternal</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki6" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">imaxinternal</code>, <code class="vardecl">jmaxinternal</code>, <code class="vardecl">kmaxinternal</code></a>
<a name="xhalo_block_spatial_di8"></a>  <a href="xhalo_block_p.html#xhalo_blocki7" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code><code class="constant">3</code><code class="typename">) </code>:: <code class="vardecl">v1</code>, <code class="vardecl">v2</code>, <code class="vardecl">norm</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(<code class="constant">3</code>) :: <code class="vardecl">v1d</code>, <code class="vardecl">v2d</code>, <code class="vardecl">normd</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki8" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
<a name="xhalo_block_spatial_di9"></a>  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1d</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!real(kind=realType) :: x_temp(0:ie,0:je,0:ke,3)</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!logical :: x_peturb(0:ie,0:je,0:ke,3)</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          * Extrapolation of the coordinates. First extrapolation in   *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          * i-direction, without halo's, followed by extrapolation in  *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          * j-direction, with i-halo's and finally extrapolation in    *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          * k-direction, with both i- and j-halo's. In this way also   *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          * the indirect halo's get a value, albeit a bit arbitrary.   *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">! Make a copy of X</code></a>
<a name="xhalo_block_spatial_di10"></a><a href="xhalo_block_p.html#xhalo_blocki9" target="origFile"><code class="comment">!x_temp = x</code></a>
<a name="xhalo_block_spatial_di11"></a>  <a href="xhalo_block_p.html#xhalo_blocki9" target="origFile">imininternal = <code class="constant">.false.</code></a>
<a name="xhalo_block_spatial_di12"></a>  <a href="xhalo_block_p.html#xhalo_blocki10" target="origFile">jmininternal = <code class="constant">.false.</code></a>
<a name="xhalo_block_spatial_di13"></a>  <a href="xhalo_block_p.html#xhalo_blocki11" target="origFile">kmininternal = <code class="constant">.false.</code></a>
<a name="xhalo_block_spatial_di14"></a>  <a href="xhalo_block_p.html#xhalo_blocki12" target="origFile">imaxinternal = <code class="constant">.false.</code></a>
<a name="xhalo_block_spatial_di15"></a>  <a href="xhalo_block_p.html#xhalo_blocki13" target="origFile">jmaxinternal = <code class="constant">.false.</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki14" target="origFile">kmaxinternal = <code class="constant">.false.</code></a>
<a name="xhalo_block_spatial_di16"></a><a href="xhalo_block_p.html#xhalo_blocki15" target="origFile"><code class="comment">!Bocos</code></a>
<a name="xhalo_block_spatial_di17"></a><a href="xhalo_block_p.html#xhalo_blocki15" target="origFile"><code class="label">loopsubface:</code><code class="keyword">DO </code>mm=<code class="constant">1</code>,nsubface</a>
    <a href="xhalo_block_p.html#xhalo_blocki16" target="origFile"><code class="keyword">IF</code> (bctype(mm) .EQ. b2bmatch) <code class="keyword">THEN</code></a>
<a name="xhalo_block_spatial_di18"></a>      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(mm)) </a>
      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">CASE </code>(imin) </a>
<a name="xhalo_block_spatial_di19"></a>        <a href="xhalo_block_p.html#xhalo_blocki18" target="origFile">imininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">CASE </code>(imax) </a>
<a name="xhalo_block_spatial_di20"></a>        <a href="xhalo_block_p.html#xhalo_blocki19" target="origFile">imaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
<a name="xhalo_block_spatial_di21"></a>        <a href="xhalo_block_p.html#xhalo_blocki20" target="origFile">jmininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
<a name="xhalo_block_spatial_di22"></a>        <a href="xhalo_block_p.html#xhalo_blocki21" target="origFile">jmaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
<a name="xhalo_block_spatial_di23"></a>        <a href="xhalo_block_p.html#xhalo_blocki22" target="origFile">kmininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
        <a href="xhalo_block_p.html#xhalo_blocki23" target="origFile">kmaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki17" target="origFile"><code class="keyword">END SELECT</code></a>
<a name="xhalo_block_spatial_di24"></a>    <a href="xhalo_block_p.html#xhalo_blocki16" target="origFile"><code class="keyword">END IF</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki15" target="origFile"><code class="keyword">END DO </code><code class="label">loopsubface</code></a>
<a name="xhalo_block_spatial_di25"></a><a href="xhalo_block_p.html#xhalo_blocki24" target="origFile"><code class="comment">! Extrapolation in i-direction.</code></a>
<a name="xhalo_block_spatial_di26"></a>  <a href="xhalo_block_p.html#xhalo_blocki24" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kl</a>
<a name="xhalo_block_spatial_di27"></a>    <a href="xhalo_block_p.html#xhalo_blocki25" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="xhalo_block_p.html#xhalo_blocki26" target="origFile"><code class="keyword">IF</code> (.NOT.imininternal) <code class="keyword">THEN</code></a>
<a name="xhalo_block_spatial_di28"></a>        <a href="xhalo_block_p.html#xhalo_blocki27" target="origFile">xd(<code class="constant">0</code>, j, k, <code class="constant">1</code>) = two*xd(<code class="constant">1</code>, j, k, <code class="constant">1</code>) - xd(<code class="constant">2</code>, j, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki27" target="origFile">x(<code class="constant">0</code>, j, k, <code class="constant">1</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">1</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di29"></a>        <a href="xhalo_block_p.html#xhalo_blocki28" target="origFile">xd(<code class="constant">0</code>, j, k, <code class="constant">2</code>) = two*xd(<code class="constant">1</code>, j, k, <code class="constant">2</code>) - xd(<code class="constant">2</code>, j, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki28" target="origFile">x(<code class="constant">0</code>, j, k, <code class="constant">2</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">2</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki29" target="origFile">xd(<code class="constant">0</code>, j, k, <code class="constant">3</code>) = two*xd(<code class="constant">1</code>, j, k, <code class="constant">3</code>) - xd(<code class="constant">2</code>, j, k, <code class="constant">3</code>)</a>
<a name="xhalo_block_spatial_di30"></a>        <a href="xhalo_block_p.html#xhalo_blocki29" target="origFile">x(<code class="constant">0</code>, j, k, <code class="constant">3</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">3</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">3</code>)</a>
<a name="xhalo_block_spatial_di31"></a>      <a href="xhalo_block_p.html#xhalo_blocki26" target="origFile"><code class="keyword">END IF</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki30" target="origFile"><code class="keyword">IF</code> (.NOT.imaxinternal) <code class="keyword">THEN</code></a>
<a name="xhalo_block_spatial_di32"></a>        <a href="xhalo_block_p.html#xhalo_blocki31" target="origFile">xd(ie, j, k, <code class="constant">1</code>) = two*xd(il, j, k, <code class="constant">1</code>) - xd(nx, j, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki31" target="origFile">x(ie, j, k, <code class="constant">1</code>) = two*x(il, j, k, <code class="constant">1</code>) - x(nx, j, k, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di33"></a>        <a href="xhalo_block_p.html#xhalo_blocki32" target="origFile">xd(ie, j, k, <code class="constant">2</code>) = two*xd(il, j, k, <code class="constant">2</code>) - xd(nx, j, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki32" target="origFile">x(ie, j, k, <code class="constant">2</code>) = two*x(il, j, k, <code class="constant">2</code>) - x(nx, j, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki33" target="origFile">xd(ie, j, k, <code class="constant">3</code>) = two*xd(il, j, k, <code class="constant">3</code>) - xd(nx, j, k, <code class="constant">3</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki33" target="origFile">x(ie, j, k, <code class="constant">3</code>) = two*x(il, j, k, <code class="constant">3</code>) - x(nx, j, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki30" target="origFile"><code class="keyword">END IF</code></a>
<a name="xhalo_block_spatial_di34"></a>    <a href="xhalo_block_p.html#xhalo_blocki25" target="origFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki24" target="origFile"><code class="keyword">END DO</code></a>
<a name="xhalo_block_spatial_di35"></a><a href="xhalo_block_p.html#xhalo_blocki34" target="origFile"><code class="comment">! Extrapolation in j-direction.</code></a>
<a name="xhalo_block_spatial_di36"></a>  <a href="xhalo_block_p.html#xhalo_blocki34" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kl</a>
<a name="xhalo_block_spatial_di37"></a>    <a href="xhalo_block_p.html#xhalo_blocki35" target="origFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ie</a>
      <a href="xhalo_block_p.html#xhalo_blocki36" target="origFile"><code class="keyword">IF</code> (.NOT.jmininternal) <code class="keyword">THEN</code></a>
<a name="xhalo_block_spatial_di38"></a>        <a href="xhalo_block_p.html#xhalo_blocki37" target="origFile">xd(i, <code class="constant">0</code>, k, <code class="constant">1</code>) = two*xd(i, <code class="constant">1</code>, k, <code class="constant">1</code>) - xd(i, <code class="constant">2</code>, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki37" target="origFile">x(i, <code class="constant">0</code>, k, <code class="constant">1</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">1</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di39"></a>        <a href="xhalo_block_p.html#xhalo_blocki38" target="origFile">xd(i, <code class="constant">0</code>, k, <code class="constant">2</code>) = two*xd(i, <code class="constant">1</code>, k, <code class="constant">2</code>) - xd(i, <code class="constant">2</code>, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki38" target="origFile">x(i, <code class="constant">0</code>, k, <code class="constant">2</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">2</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki39" target="origFile">xd(i, <code class="constant">0</code>, k, <code class="constant">3</code>) = two*xd(i, <code class="constant">1</code>, k, <code class="constant">3</code>) - xd(i, <code class="constant">2</code>, k, <code class="constant">3</code>)</a>
<a name="xhalo_block_spatial_di40"></a>        <a href="xhalo_block_p.html#xhalo_blocki39" target="origFile">x(i, <code class="constant">0</code>, k, <code class="constant">3</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">3</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">3</code>)</a>
<a name="xhalo_block_spatial_di41"></a>      <a href="xhalo_block_p.html#xhalo_blocki36" target="origFile"><code class="keyword">END IF</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki40" target="origFile"><code class="keyword">IF</code> (.NOT.jmaxinternal) <code class="keyword">THEN</code></a>
<a name="xhalo_block_spatial_di42"></a>        <a href="xhalo_block_p.html#xhalo_blocki41" target="origFile">xd(i, je, k, <code class="constant">1</code>) = two*xd(i, jl, k, <code class="constant">1</code>) - xd(i, ny, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki41" target="origFile">x(i, je, k, <code class="constant">1</code>) = two*x(i, jl, k, <code class="constant">1</code>) - x(i, ny, k, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di43"></a>        <a href="xhalo_block_p.html#xhalo_blocki42" target="origFile">xd(i, je, k, <code class="constant">2</code>) = two*xd(i, jl, k, <code class="constant">2</code>) - xd(i, ny, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki42" target="origFile">x(i, je, k, <code class="constant">2</code>) = two*x(i, jl, k, <code class="constant">2</code>) - x(i, ny, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki43" target="origFile">xd(i, je, k, <code class="constant">3</code>) = two*xd(i, jl, k, <code class="constant">3</code>) - xd(i, ny, k, <code class="constant">3</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki43" target="origFile">x(i, je, k, <code class="constant">3</code>) = two*x(i, jl, k, <code class="constant">3</code>) - x(i, ny, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki40" target="origFile"><code class="keyword">END IF</code></a>
<a name="xhalo_block_spatial_di44"></a>    <a href="xhalo_block_p.html#xhalo_blocki35" target="origFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki34" target="origFile"><code class="keyword">END DO</code></a>
<a name="xhalo_block_spatial_di45"></a><a href="xhalo_block_p.html#xhalo_blocki44" target="origFile"><code class="comment">! Extrapolation in k-direction.</code></a>
<a name="xhalo_block_spatial_di46"></a>  <a href="xhalo_block_p.html#xhalo_blocki44" target="origFile"><code class="keyword">DO </code>j=<code class="constant">0</code>,je</a>
<a name="xhalo_block_spatial_di47"></a>    <a href="xhalo_block_p.html#xhalo_blocki45" target="origFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ie</a>
      <a href="xhalo_block_p.html#xhalo_blocki46" target="origFile"><code class="keyword">IF</code> (.NOT.kmininternal) <code class="keyword">THEN</code></a>
<a name="xhalo_block_spatial_di48"></a>        <a href="xhalo_block_p.html#xhalo_blocki47" target="origFile">xd(i, j, <code class="constant">0</code>, <code class="constant">1</code>) = two*xd(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - xd(i, j, <code class="constant">2</code>, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki47" target="origFile">x(i, j, <code class="constant">0</code>, <code class="constant">1</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di49"></a>        <a href="xhalo_block_p.html#xhalo_blocki48" target="origFile">xd(i, j, <code class="constant">0</code>, <code class="constant">2</code>) = two*xd(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - xd(i, j, <code class="constant">2</code>, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki48" target="origFile">x(i, j, <code class="constant">0</code>, <code class="constant">2</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki49" target="origFile">xd(i, j, <code class="constant">0</code>, <code class="constant">3</code>) = two*xd(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - xd(i, j, <code class="constant">2</code>, <code class="constant">3</code>)</a>
<a name="xhalo_block_spatial_di50"></a>        <a href="xhalo_block_p.html#xhalo_blocki49" target="origFile">x(i, j, <code class="constant">0</code>, <code class="constant">3</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">3</code>)</a>
<a name="xhalo_block_spatial_di51"></a>      <a href="xhalo_block_p.html#xhalo_blocki46" target="origFile"><code class="keyword">END IF</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki50" target="origFile"><code class="keyword">IF</code> (.NOT.kmaxinternal) <code class="keyword">THEN</code></a>
<a name="xhalo_block_spatial_di52"></a>        <a href="xhalo_block_p.html#xhalo_blocki51" target="origFile">xd(i, j, ke, <code class="constant">1</code>) = two*xd(i, j, kl, <code class="constant">1</code>) - xd(i, j, nz, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki51" target="origFile">x(i, j, ke, <code class="constant">1</code>) = two*x(i, j, kl, <code class="constant">1</code>) - x(i, j, nz, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di53"></a>        <a href="xhalo_block_p.html#xhalo_blocki52" target="origFile">xd(i, j, ke, <code class="constant">2</code>) = two*xd(i, j, kl, <code class="constant">2</code>) - xd(i, j, nz, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki52" target="origFile">x(i, j, ke, <code class="constant">2</code>) = two*x(i, j, kl, <code class="constant">2</code>) - x(i, j, nz, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki53" target="origFile">xd(i, j, ke, <code class="constant">3</code>) = two*xd(i, j, kl, <code class="constant">3</code>) - xd(i, j, nz, <code class="constant">3</code>)</a>
        <a href="xhalo_block_p.html#xhalo_blocki53" target="origFile">x(i, j, ke, <code class="constant">3</code>) = two*x(i, j, kl, <code class="constant">3</code>) - x(i, j, nz, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki50" target="origFile"><code class="keyword">END IF</code></a>
    <a href="xhalo_block_p.html#xhalo_blocki45" target="origFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki44" target="origFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">v1d = <code class="constant">0.0</code></a>
<a name="xhalo_block_spatial_di54"></a>  <a href="xhalo_block_p.html#xhalo_block" target="origFile">v2d = <code class="constant">0.0</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">normd = <code class="constant">0.0</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!          * Mirror the halo coordinates adjacent to the symmetry       *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!          * planes                                                     *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">!</code></a>
<a name="xhalo_block_spatial_di55"></a><a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="comment">! Loop over boundary subfaces.</code></a>
<a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="label">loopbocos:</code><code class="keyword">DO </code>mm=<code class="constant">1</code>,nbocos</a>
<a href="xhalo_block_p.html#xhalo_blocki55" target="origFile"><code class="comment">! The actual correction of the coordinates only takes</code></a>
<a name="xhalo_block_spatial_di56"></a><a href="xhalo_block_p.html#xhalo_blocki55" target="origFile"><code class="comment">! place for symmetry planes.</code></a>
    <a href="xhalo_block_p.html#xhalo_blocki55" target="origFile"><code class="keyword">IF</code> (bctype(mm) .EQ. symm) <code class="keyword">THEN</code></a>
<a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="comment">! Set some variables, depending on the block face on</code></a>
<a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="comment">! which the subface is located.</code></a>
<a name="xhalo_block_spatial_di57"></a>      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(mm)) </a>
<a name="xhalo_block_spatial_di58"></a>      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">CASE </code>(imin) </a>
<a name="xhalo_block_spatial_di59"></a>        <a href="xhalo_block_p.html#xhalo_blocki57" target="origFile">ibeg = jnbeg(mm)</a>
<a name="xhalo_block_spatial_di60"></a>        <a href="xhalo_block_p.html#xhalo_blocki58" target="origFile">iend = jnend(mm)</a>
<a name="xhalo_block_spatial_di61"></a>        <a href="xhalo_block_p.html#xhalo_blocki59" target="origFile">iimax = jl</a>
<a name="xhalo_block_spatial_di62"></a>        <a href="xhalo_block_p.html#xhalo_blocki60" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki61" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki62" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0d => xd(<code class="constant">0</code>, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0 => x(<code class="constant">0</code>, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1d => xd(<code class="constant">1</code>, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1 => x(<code class="constant">1</code>, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2d => xd(<code class="constant">2</code>, :, :, :)</a>
<a name="xhalo_block_spatial_di66"></a>        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2 => x(<code class="constant">2</code>, :, :, :)</a>
<a name="xhalo_block_spatial_di67"></a>      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">CASE </code>(imax) </a>
<a name="xhalo_block_spatial_di68"></a>        <a href="xhalo_block_p.html#xhalo_blocki66" target="origFile">ibeg = jnbeg(mm)</a>
<a name="xhalo_block_spatial_di69"></a>        <a href="xhalo_block_p.html#xhalo_blocki67" target="origFile">iend = jnend(mm)</a>
<a name="xhalo_block_spatial_di70"></a>        <a href="xhalo_block_p.html#xhalo_blocki68" target="origFile">iimax = jl</a>
<a name="xhalo_block_spatial_di71"></a>        <a href="xhalo_block_p.html#xhalo_blocki69" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki70" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki71" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0d => xd(ie, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0 => x(ie, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1d => xd(il, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1 => x(il, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2d => xd(nx, :, :, :)</a>
<a name="xhalo_block_spatial_di75"></a>        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2 => x(nx, :, :, :)</a>
<a name="xhalo_block_spatial_di76"></a>      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
<a name="xhalo_block_spatial_di77"></a>        <a href="xhalo_block_p.html#xhalo_blocki75" target="origFile">ibeg = inbeg(mm)</a>
<a name="xhalo_block_spatial_di78"></a>        <a href="xhalo_block_p.html#xhalo_blocki76" target="origFile">iend = inend(mm)</a>
<a name="xhalo_block_spatial_di79"></a>        <a href="xhalo_block_p.html#xhalo_blocki77" target="origFile">iimax = il</a>
<a name="xhalo_block_spatial_di80"></a>        <a href="xhalo_block_p.html#xhalo_blocki78" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki79" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki80" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0d => xd(:, <code class="constant">0</code>, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0 => x(:, <code class="constant">0</code>, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1d => xd(:, <code class="constant">1</code>, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1 => x(:, <code class="constant">1</code>, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2d => xd(:, <code class="constant">2</code>, :, :)</a>
<a name="xhalo_block_spatial_di84"></a>        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2 => x(:, <code class="constant">2</code>, :, :)</a>
<a name="xhalo_block_spatial_di85"></a>      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
<a name="xhalo_block_spatial_di86"></a>        <a href="xhalo_block_p.html#xhalo_blocki84" target="origFile">ibeg = inbeg(mm)</a>
<a name="xhalo_block_spatial_di87"></a>        <a href="xhalo_block_p.html#xhalo_blocki85" target="origFile">iend = inend(mm)</a>
<a name="xhalo_block_spatial_di88"></a>        <a href="xhalo_block_p.html#xhalo_blocki86" target="origFile">iimax = il</a>
<a name="xhalo_block_spatial_di89"></a>        <a href="xhalo_block_p.html#xhalo_blocki87" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki88" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki89" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0d => xd(:, je, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0 => x(:, je, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1d => xd(:, jl, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1 => x(:, jl, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2d => xd(:, ny, :, :)</a>
<a name="xhalo_block_spatial_di93"></a>        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2 => x(:, ny, :, :)</a>
<a name="xhalo_block_spatial_di94"></a>      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
<a name="xhalo_block_spatial_di95"></a>        <a href="xhalo_block_p.html#xhalo_blocki93" target="origFile">ibeg = inbeg(mm)</a>
<a name="xhalo_block_spatial_di96"></a>        <a href="xhalo_block_p.html#xhalo_blocki94" target="origFile">iend = inend(mm)</a>
<a name="xhalo_block_spatial_di97"></a>        <a href="xhalo_block_p.html#xhalo_blocki95" target="origFile">iimax = il</a>
<a name="xhalo_block_spatial_di98"></a>        <a href="xhalo_block_p.html#xhalo_blocki96" target="origFile">jbeg = jnbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki97" target="origFile">jend = jnend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki98" target="origFile">jjmax = jl</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0d => xd(:, :, <code class="constant">0</code>, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0 => x(:, :, <code class="constant">0</code>, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1d => xd(:, :, <code class="constant">1</code>, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1 => x(:, :, <code class="constant">1</code>, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2d => xd(:, :, <code class="constant">2</code>, :)</a>
<a name="xhalo_block_spatial_di102"></a>        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2 => x(:, :, <code class="constant">2</code>, :)</a>
<a name="xhalo_block_spatial_di103"></a>      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
<a name="xhalo_block_spatial_di104"></a>        <a href="xhalo_block_p.html#xhalo_blocki102" target="origFile">ibeg = inbeg(mm)</a>
<a name="xhalo_block_spatial_di105"></a>        <a href="xhalo_block_p.html#xhalo_blocki103" target="origFile">iend = inend(mm)</a>
<a name="xhalo_block_spatial_di106"></a>        <a href="xhalo_block_p.html#xhalo_blocki104" target="origFile">iimax = il</a>
<a name="xhalo_block_spatial_di107"></a>        <a href="xhalo_block_p.html#xhalo_blocki105" target="origFile">jbeg = jnbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki106" target="origFile">jend = jnend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_blocki107" target="origFile">jjmax = jl</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0d => xd(:, :, ke, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x0 => x(:, :, ke, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1d => xd(:, :, kl, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x1 => x(:, :, kl, :)</a>
        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2d => xd(:, :, nz, :)</a>
<a name="xhalo_block_spatial_di111"></a>        <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile">x2 => x(:, :, nz, :)</a>
      <a href="xhalo_block_p.html#xhalo_blocki56" target="origFile"><code class="keyword">END SELECT</code></a>
<a href="xhalo_block_p.html#xhalo_blocki111" target="origFile"><code class="comment">! Determine the vector from the lower left corner to</code></a>
<a href="xhalo_block_p.html#xhalo_blocki111" target="origFile"><code class="comment">! the upper right corner. Due to the usage of pointers</code></a>
<a href="xhalo_block_p.html#xhalo_blocki111" target="origFile"><code class="comment">! an offset of +1 must be used, because the original</code></a>
<a href="xhalo_block_p.html#xhalo_blocki111" target="origFile"><code class="comment">! array x start at 0.</code></a>
<a name="xhalo_block_spatial_di112"></a>      <a href="xhalo_block_p.html#xhalo_blocki111" target="origFile">v1d(<code class="constant">1</code>) = x1d(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>) - x1d(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki111" target="origFile">v1(<code class="constant">1</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di113"></a>      <a href="xhalo_block_p.html#xhalo_blocki112" target="origFile">v1d(<code class="constant">2</code>) = x1d(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>) - x1d(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki112" target="origFile">v1(<code class="constant">2</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>)</a>
<a name="xhalo_block_spatial_di114"></a>      <a href="xhalo_block_p.html#xhalo_blocki113" target="origFile">v1d(<code class="constant">3</code>) = x1d(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>) - x1d(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki113" target="origFile">v1(<code class="constant">3</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block_p.html#xhalo_blocki114" target="origFile"><code class="comment">! And the vector from the upper left corner to the</code></a>
<a href="xhalo_block_p.html#xhalo_blocki114" target="origFile"><code class="comment">! lower right corner.</code></a>
<a name="xhalo_block_spatial_di115"></a>      <a href="xhalo_block_p.html#xhalo_blocki114" target="origFile">v2d(<code class="constant">1</code>) = x1d(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>) - x1d(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki114" target="origFile">v2(<code class="constant">1</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di116"></a>      <a href="xhalo_block_p.html#xhalo_blocki115" target="origFile">v2d(<code class="constant">2</code>) = x1d(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>) - x1d(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki115" target="origFile">v2(<code class="constant">2</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>)</a>
<a name="xhalo_block_spatial_di117"></a>      <a href="xhalo_block_p.html#xhalo_blocki116" target="origFile">v2d(<code class="constant">3</code>) = x1d(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>) - x1d(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki116" target="origFile">v2(<code class="constant">3</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block_p.html#xhalo_blocki117" target="origFile"><code class="comment">! Determine the normal of the face by taking the cross</code></a>
<a href="xhalo_block_p.html#xhalo_blocki117" target="origFile"><code class="comment">! product of v1 and v2 and add it to norm.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki117" target="origFile">normd(<code class="constant">1</code>) = v1d(<code class="constant">2</code>)*v2(<code class="constant">3</code>) + v1(<code class="constant">2</code>)*v2d(<code class="constant">3</code>) - v1d(<code class="constant">3</code>)*v2(<code class="constant">2</code>) - v1(<code class="constant">3</code>)*v2d(<code class="label">&</code></a>
<a name="xhalo_block_spatial_di118"></a><a href="xhalo_block_p.html#xhalo_blocki117" target="origFile"><code class="label">&        </code><code class="constant">2</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki117" target="origFile">norm(<code class="constant">1</code>) = v1(<code class="constant">2</code>)*v2(<code class="constant">3</code>) - v1(<code class="constant">3</code>)*v2(<code class="constant">2</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki118" target="origFile">normd(<code class="constant">2</code>) = v1d(<code class="constant">3</code>)*v2(<code class="constant">1</code>) + v1(<code class="constant">3</code>)*v2d(<code class="constant">1</code>) - v1d(<code class="constant">1</code>)*v2(<code class="constant">3</code>) - v1(<code class="constant">1</code>)*v2d(<code class="label">&</code></a>
<a name="xhalo_block_spatial_di119"></a><a href="xhalo_block_p.html#xhalo_blocki118" target="origFile"><code class="label">&        </code><code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki118" target="origFile">norm(<code class="constant">2</code>) = v1(<code class="constant">3</code>)*v2(<code class="constant">1</code>) - v1(<code class="constant">1</code>)*v2(<code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki119" target="origFile">normd(<code class="constant">3</code>) = v1d(<code class="constant">1</code>)*v2(<code class="constant">2</code>) + v1(<code class="constant">1</code>)*v2d(<code class="constant">2</code>) - v1d(<code class="constant">2</code>)*v2(<code class="constant">1</code>) - v1(<code class="constant">2</code>)*v2d(<code class="label">&</code></a>
<a name="xhalo_block_spatial_di120"></a><a href="xhalo_block_p.html#xhalo_blocki119" target="origFile"><code class="label">&        </code><code class="constant">1</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki119" target="origFile">norm(<code class="constant">3</code>) = v1(<code class="constant">1</code>)*v2(<code class="constant">2</code>) - v1(<code class="constant">2</code>)*v2(<code class="constant">1</code>)</a>
<a href="xhalo_block_p.html#xhalo_blocki120" target="origFile"><code class="comment">! Compute the length of the normal and test if this is</code></a>
<a href="xhalo_block_p.html#xhalo_blocki120" target="origFile"><code class="comment">! larger than eps. If this is the case this means that</code></a>
<a href="xhalo_block_p.html#xhalo_blocki120" target="origFile"><code class="comment">! it is a nonsingular subface and the coordinates are</code></a>
<a href="xhalo_block_p.html#xhalo_blocki120" target="origFile"><code class="comment">! corrected.</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki120" target="origFile">arg1d = <code class="constant">2</code>*norm(<code class="constant">1</code>)*normd(<code class="constant">1</code>) + <code class="constant">2</code>*norm(<code class="constant">2</code>)*normd(<code class="constant">2</code>) + <code class="constant">2</code>*norm(<code class="constant">3</code>)*normd(<code class="label">&</code></a>
<a name="xhalo_block_spatial_di121"></a><a href="xhalo_block_p.html#xhalo_blocki120" target="origFile"><code class="label">&        </code><code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_blocki120" target="origFile">arg1 = norm(<code class="constant">1</code>)**<code class="constant">2 </code>+ norm(<code class="constant">2</code>)**<code class="constant">2 </code>+ norm(<code class="constant">3</code>)**<code class="constant">2</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki121" target="origFile"><code class="keyword">IF</code> (arg1 .EQ. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
        <a href="xhalo_block_p.html#xhalo_blocki121" target="origFile">lengthd = <code class="constant">0.0</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki121" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="xhalo_block_p.html#xhalo_blocki121" target="origFile">lengthd = arg1d/(<code class="constant">2.0</code>*<code class="funcname">SQRT</code>(arg1))</a>
<a name="xhalo_block_spatial_di122"></a>      <a href="xhalo_block_p.html#xhalo_blocki121" target="origFile"><code class="keyword">END IF</code></a>
<a name="xhalo_block_spatial_di123"></a>      <a href="xhalo_block_p.html#xhalo_blocki121" target="origFile">length = <code class="funcname">SQRT</code>(arg1)</a>
      <a href="xhalo_block_p.html#xhalo_blocki122" target="origFile"><code class="keyword">IF</code> (length .GT. eps) <code class="keyword">THEN</code></a>
<a href="xhalo_block_p.html#xhalo_blocki123" target="origFile"><code class="comment">! Compute the unit normal of the subface.</code></a>
<a name="xhalo_block_spatial_di124"></a>        <a href="xhalo_block_p.html#xhalo_blocki123" target="origFile">normd(<code class="constant">1</code>) = (normd(<code class="constant">1</code>)*length-norm(<code class="constant">1</code>)*lengthd)/length**<code class="constant">2</code></a>
        <a href="xhalo_block_p.html#xhalo_blocki123" target="origFile">norm(<code class="constant">1</code>) = norm(<code class="constant">1</code>)/length</a>
<a name="xhalo_block_spatial_di125"></a>        <a href="xhalo_block_p.html#xhalo_blocki124" target="origFile">normd(<code class="constant">2</code>) = (normd(<code class="constant">2</code>)*length-norm(<code class="constant">2</code>)*lengthd)/length**<code class="constant">2</code></a>
        <a href="xhalo_block_p.html#xhalo_blocki124" target="origFile">norm(<code class="constant">2</code>) = norm(<code class="constant">2</code>)/length</a>
<a name="xhalo_block_spatial_di126"></a>        <a href="xhalo_block_p.html#xhalo_blocki125" target="origFile">normd(<code class="constant">3</code>) = (normd(<code class="constant">3</code>)*length-norm(<code class="constant">3</code>)*lengthd)/length**<code class="constant">2</code></a>
        <a href="xhalo_block_p.html#xhalo_blocki125" target="origFile">norm(<code class="constant">3</code>) = norm(<code class="constant">3</code>)/length</a>
<a href="xhalo_block_p.html#xhalo_blocki126" target="origFile"><code class="comment">! Add an overlap to the symmetry subface if the</code></a>
<a name="xhalo_block_spatial_di127"></a><a href="xhalo_block_p.html#xhalo_blocki126" target="origFile"><code class="comment">! boundaries coincide with the block boundaries.</code></a>
<a name="xhalo_block_spatial_di129"></a><a name="xhalo_block_spatial_di128"></a><a href="xhalo_block_p.html#xhalo_blocki126" target="origFile"><code class="comment">! This way the indirect halo's are treated properly.</code></a>
<a name="xhalo_block_spatial_di131"></a><a name="xhalo_block_spatial_di130"></a>        <a href="xhalo_block_p.html#xhalo_blocki126" target="origFile"><code class="keyword">IF</code> (ibeg .EQ. <code class="constant">1</code>) </a><a href="xhalo_block_p.html#xhalo_blocki127" target="origFile">ibeg = <code class="constant">0</code></a>
<a name="xhalo_block_spatial_di133"></a><a name="xhalo_block_spatial_di132"></a>        <a href="xhalo_block_p.html#xhalo_blocki128" target="origFile"><code class="keyword">IF</code> (iend .EQ. iimax) </a><a href="xhalo_block_p.html#xhalo_blocki129" target="origFile">iend = iimax + <code class="constant">1</code></a>
<a name="xhalo_block_spatial_di134"></a>        <a href="xhalo_block_p.html#xhalo_blocki130" target="origFile"><code class="keyword">IF</code> (jbeg .EQ. <code class="constant">1</code>) </a><a href="xhalo_block_p.html#xhalo_blocki131" target="origFile">jbeg = <code class="constant">0</code></a>
        <a href="xhalo_block_p.html#xhalo_blocki132" target="origFile"><code class="keyword">IF</code> (jend .EQ. jjmax) </a><a href="xhalo_block_p.html#xhalo_blocki133" target="origFile">jend = jjmax + <code class="constant">1</code></a>
<a href="xhalo_block_p.html#xhalo_blocki134" target="origFile"><code class="comment">! Loop over the nodes of the subface and set the</code></a>
<a name="xhalo_block_spatial_di135"></a><a href="xhalo_block_p.html#xhalo_blocki134" target="origFile"><code class="comment">! corresponding halo coordinates.</code></a>
<a name="xhalo_block_spatial_di136"></a>        <a href="xhalo_block_p.html#xhalo_blocki134" target="origFile"><code class="keyword">DO </code>j=jbeg,jend</a>
          <a href="xhalo_block_p.html#xhalo_blocki135" target="origFile"><code class="keyword">DO </code>i=ibeg,iend</a>
<a href="xhalo_block_p.html#xhalo_blocki136" target="origFile"><code class="comment">! Determine the vector from the internal node to the</code></a>
<a href="xhalo_block_p.html#xhalo_blocki136" target="origFile"><code class="comment">! node on the face. Again an offset of +1 must be</code></a>
<a href="xhalo_block_p.html#xhalo_blocki136" target="origFile"><code class="comment">! used, due to the usage of pointers.</code></a>
<a name="xhalo_block_spatial_di137"></a>            <a href="xhalo_block_p.html#xhalo_blocki136" target="origFile">v1d(<code class="constant">1</code>) = x1d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) - x2d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki136" target="origFile">v1(<code class="constant">1</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="xhalo_block_spatial_di138"></a>            <a href="xhalo_block_p.html#xhalo_blocki137" target="origFile">v1d(<code class="constant">2</code>) = x1d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) - x2d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki137" target="origFile">v1(<code class="constant">2</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>)</a>
<a name="xhalo_block_spatial_di139"></a>            <a href="xhalo_block_p.html#xhalo_blocki138" target="origFile">v1d(<code class="constant">3</code>) = x1d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) - x2d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki138" target="origFile">v1(<code class="constant">3</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block_p.html#xhalo_blocki139" target="origFile"><code class="comment">! Determine two times the normal component of this</code></a>
<a href="xhalo_block_p.html#xhalo_blocki139" target="origFile"><code class="comment">! vector; this vector must be added to the</code></a>
<a href="xhalo_block_p.html#xhalo_blocki139" target="origFile"><code class="comment">! coordinates of the internal node to obtain the</code></a>
<a href="xhalo_block_p.html#xhalo_blocki139" target="origFile"><code class="comment">! halo coordinates. Again the offset of +1.</code></a>
            <a href="xhalo_block_p.html#xhalo_blocki139" target="origFile">dotd = two*(v1d(<code class="constant">1</code>)*norm(<code class="constant">1</code>)+v1(<code class="constant">1</code>)*normd(<code class="constant">1</code>)+v1d(<code class="constant">2</code>)*norm(<code class="constant">2</code>)+v1(<code class="label">&</code></a>
<a name="xhalo_block_spatial_di140"></a><a href="xhalo_block_p.html#xhalo_blocki139" target="origFile"><code class="label">&              </code><code class="constant">2</code>)*normd(<code class="constant">2</code>)+v1d(<code class="constant">3</code>)*norm(<code class="constant">3</code>)+v1(<code class="constant">3</code>)*normd(<code class="constant">3</code>))</a>
            <a href="xhalo_block_p.html#xhalo_blocki139" target="origFile">dot = two*(v1(<code class="constant">1</code>)*norm(<code class="constant">1</code>)+v1(<code class="constant">2</code>)*norm(<code class="constant">2</code>)+v1(<code class="constant">3</code>)*norm(<code class="constant">3</code>))</a>
            <a href="xhalo_block_p.html#xhalo_blocki140" target="origFile">x0d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) = x2d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) + dotd*norm(<code class="constant">1</code>) + dot*<code class="label">&</code></a>
<a name="xhalo_block_spatial_di141"></a><a href="xhalo_block_p.html#xhalo_blocki140" target="origFile"><code class="label">&              </code>normd(<code class="constant">1</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki140" target="origFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) + dot*norm(<code class="constant">1</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki141" target="origFile">x0d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) = x2d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) + dotd*norm(<code class="constant">2</code>) + dot*<code class="label">&</code></a>
<a name="xhalo_block_spatial_di142"></a><a href="xhalo_block_p.html#xhalo_blocki141" target="origFile"><code class="label">&              </code>normd(<code class="constant">2</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki141" target="origFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) + dot*norm(<code class="constant">2</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki142" target="origFile">x0d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) = x2d(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) + dotd*norm(<code class="constant">3</code>) + dot*<code class="label">&</code></a>
<a href="xhalo_block_p.html#xhalo_blocki142" target="origFile"><code class="label">&              </code>normd(<code class="constant">3</code>)</a>
            <a href="xhalo_block_p.html#xhalo_blocki142" target="origFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) + dot*norm(<code class="constant">3</code>)</a>
          <a href="xhalo_block_p.html#xhalo_blocki135" target="origFile"><code class="keyword">END DO</code></a>
        <a href="xhalo_block_p.html#xhalo_blocki134" target="origFile"><code class="keyword">END DO</code></a>
      <a href="xhalo_block_p.html#xhalo_blocki122" target="origFile"><code class="keyword">END IF</code></a>
    <a href="xhalo_block_p.html#xhalo_blocki55" target="origFile"><code class="keyword">END IF</code></a>
  <a href="xhalo_block_p.html#xhalo_blocki54" target="origFile"><code class="keyword">END DO </code><code class="label">loopbocos</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">XHALO_BLOCK_SPATIAL_D</code></a>
</pre>
</body>
