<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="block_res_spatial_cd"></a><a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! This is a super-combined function that combines the original</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! functionality of: </code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Pressure Computation</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! timeStep</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! applyAllBCs</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! initRes</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! residual </code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! The real difference between this and the original modules is that it</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! it only operates on a single block at a time and as such the</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! block/sps loop is outside the calculation. This routine is suitable</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! for forward mode AD with Tapenade</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">BLOCK_RES_SPATIAL_CD</code>(<code class="vardecl">nn</code>, <code class="vardecl">sps</code>)</a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS_SPATIAL_D</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">USE </code><code class="funcname">ITERATION_SPATIAL_D</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL_SPATIAL_D</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE_SPATIAL_D</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!,x_peturb)</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! i/j/kl/b/e, i/j/k/Min/MaxBoundaryStencil</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! nw</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">gm1</code>, <code class="vardecl">v2</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">nn</code>, <code class="vardecl">sps</code>, <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">sps2</code>, <code class="vardecl">mm</code>, <code class="vardecl">l</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">correctfork</code></a>
<a name="p44"></a>  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!  logical :: x_peturb(0:ie,0:je,0:ke,3)</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE_CD</code>(nn, sps, </a><a href="msg.html#p44" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial_p.html#block_res_spatial" target="origFile">sps)</a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Do the spatial things first:</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">XHALO_BLOCK_CD</code>(<code class="constant">1</code>)</a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!,x_peturb)</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">METRIC_BLOCK_CD</code>(nn, <code class="constant">1</code>, sps)</a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! call gridVelocities(useOldCoor, t, sps) ! Required for TS</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! call normalVelocitiesAllLevels(sps) ! Required for TS</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Compute the pressures</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">gm1 = gammaconstant - one</a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">correctfork = <code class="constant">.false.</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Compute P </code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>k=<code class="constant">0</code>,kb</a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>j=<code class="constant">0</code>,jb</a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ib</a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">v2 = w(i, j, k, ivx)**<code class="constant">2 </code>+ w(i, j, k, ivy)**<code class="constant">2 </code>+ w(i, j, k, ivz)**<code class="label">&</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="label">&          </code><code class="constant">2</code></a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">p(i, j, k) = gm1*(w(i, j, k, irhoe)-half*w(i, j, k, irho)*v2)</a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">IF</code> (p(i, j, k) .LT. <code class="constant">1.e-4_realType</code>*pinfcorr) <code class="keyword">THEN</code></a>
          <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">p(i, j, k) = <code class="constant">1.e-4_realType</code>*pinfcorr</a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">p(i, j, k) = p(i, j, k)</a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END IF</code></a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!call computeEtot(0,ib,0,jb,0,kb,correctForK)</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!  Apply all BC's</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">APPLYALLBC_BLOCK_CD</code>(<code class="constant">.true.</code>)</a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Compute skin_friction Velocity</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">COMPUTEUTAU_BLOCK_CD</code>()</a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Compute time step and spectral radius</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">TIMESTEP_BLOCK_CD</code>(<code class="constant">.false.</code>)</a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!   if( equations == RANSEquations ) then</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!      call initres_block(nt1MG, nMGVar,nn,sps) ! Initialize only the Turblent Variables</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!      call turbResidual_block</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">!   endif</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">SELECT CASE </code> (equationmode) </a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CASE </code>(steady) </a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">dw = <code class="constant">0.0</code></a>
<a name="p45"></a>  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CASE </code>(timespectral) </a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>sps2=<code class="constant">1</code>,ntimeintervalsspectral</a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE_CD</code>(nn, sps2, </a><a href="msg.html#p45" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial_p.html#block_res_spatial" target="origFile">sps2)</a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">dw = <code class="constant">0.0</code></a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>mm=<code class="constant">1</code>,ntimeintervalsspectral</a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE_CD</code>(nn, sps2, mm)</a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">INITRES_BLOCK_TS_CD</code>(<code class="constant">1</code>, nwf, nn, sps2, mm)</a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
<a name="p46"></a>  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END SELECT</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Rest the pointers the the "on time instance"</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE_CD</code>(nn, sps, </a><a href="msg.html#p46" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial_p.html#block_res_spatial" target="origFile">sps)</a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Actual residual calc</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">RESIDUAL_BLOCK_CD</code>()</a>
<a name="p47"></a><a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="comment">! Divide through by the volume</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>sps2=<code class="constant">1</code>,ntimeintervalsspectral</a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE_CD</code>(nn, sps2, </a><a href="msg.html#p47" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial_p.html#block_res_spatial" target="origFile">sps2)</a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>l=<code class="constant">1</code>,nw</a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
          <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
            <a href="block_res_spatial_p.html#block_res_spatial" target="origFile">dw(i, j, k, l) = dw(i, j, k, l)/vol(i, j, k)</a>
          <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
        <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
      <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
    <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
  <a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END DO</code></a>
<a href="block_res_spatial_p.html#block_res_spatial" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">BLOCK_RES_SPATIAL_CD</code></a>
</pre>
</body>
