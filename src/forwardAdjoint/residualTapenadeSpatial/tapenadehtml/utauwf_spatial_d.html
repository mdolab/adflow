<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="utauwf_spatial_d"></a><a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!  Differentiation of utauwf in forward (tangent) mode:</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!   variations   of useful results: *fw</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!   with respect to varying inputs: *w *si *sj *sk *fw *(*viscsubface.tau)</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * File:          utauWF.f90                                      *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * Author:        Georgi Kalitzin, Edwin van der Weide            *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * Starting date: 10-01-2003                                      *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * Last modified: 06-12-2005                                      *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">UTAUWF_SPATIAL_D</code>(<code class="vardecl">rfilv</code>)</a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">BCTYPES_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
<a name="utauwf_spatial_di0"></a>  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!      * utauWF substitutes the wall shear stress with values from a    *</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!      * look-up table, if desired.                                     *</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!      Subroutine argument.</code></a>
<a name="utauwf_spatial_di1"></a><a href="utauwf_p.html#utauwfi0" target="origFile"><code class="comment">!</code></a>
  <a href="utauwf_p.html#utauwfi0" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">rfilv</code></a>
<a href="utauwf_p.html#utauwfi1" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwfi1" target="origFile"><code class="comment">!      Local variables.</code></a>
<a name="utauwf_spatial_di2"></a><a href="utauwf_p.html#utauwfi1" target="origFile"><code class="comment">!</code></a>
<a name="utauwf_spatial_di3"></a>  <a href="utauwf_p.html#utauwfi1" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">nn</code></a>
  <a href="utauwf_p.html#utauwfi2" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fact</code></a>
<a name="utauwf_spatial_di4"></a>  <a href="utauwf_p.html#utauwfi3" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxx</code>, <code class="vardecl">tauyy</code>, <code class="vardecl">tauzz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxxd</code>, <code class="vardecl">tauyyd</code>, <code class="vardecl">tauzzd</code></a>
<a name="utauwf_spatial_di5"></a>  <a href="utauwf_p.html#utauwfi4" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxy</code>, <code class="vardecl">tauxz</code>, <code class="vardecl">tauyz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxyd</code>, <code class="vardecl">tauxzd</code>, <code class="vardecl">tauyzd</code></a>
<a name="utauwf_spatial_di6"></a>  <a href="utauwf_p.html#utauwfi5" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rbar</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rbard</code>, <code class="vardecl">ubard</code>, <code class="vardecl">vbard</code>, <code class="vardecl">wbard</code>, <code class="vardecl">vxd</code>, <code class="vardecl">vyd</code>, <code class="vardecl">vzd</code></a>
<a name="utauwf_spatial_di7"></a>  <a href="utauwf_p.html#utauwfi6" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmx</code>, <code class="vardecl">fmy</code>, <code class="vardecl">fmz</code>, <code class="vardecl">frhoe</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmxd</code>, <code class="vardecl">fmyd</code>, <code class="vardecl">fmzd</code>, <code class="vardecl">frhoed</code></a>
<a name="utauwf_spatial_di8"></a>  <a href="utauwf_p.html#utauwfi7" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">veln</code>, <code class="vardecl">velnx</code>, <code class="vardecl">velny</code>, <code class="vardecl">velnz</code>, <code class="vardecl">tx</code>, <code class="vardecl">ty</code>, <code class="vardecl">tz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">velnd</code>, <code class="vardecl">velnxd</code>, <code class="vardecl">velnyd</code>, <code class="vardecl">velnzd</code>, <code class="vardecl">txd</code>, <code class="vardecl">tyd</code>, <code class="vardecl">tzd</code></a>
<a name="utauwf_spatial_di9"></a>  <a href="utauwf_p.html#utauwfi8" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">veltx</code>, <code class="vardecl">velty</code>, <code class="vardecl">veltz</code>, <code class="vardecl">veltmag</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">veltxd</code>, <code class="vardecl">veltyd</code>, <code class="vardecl">veltzd</code>, <code class="vardecl">veltmagd</code></a>
<a name="utauwf_spatial_di10"></a>  <a href="utauwf_p.html#utauwfi9" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">txnx</code>, <code class="vardecl">txny</code>, <code class="vardecl">txnz</code>, <code class="vardecl">tynx</code>, <code class="vardecl">tyny</code>, <code class="vardecl">tynz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">txnxd</code>, <code class="vardecl">txnyd</code>, <code class="vardecl">txnzd</code>, <code class="vardecl">tynxd</code>, <code class="vardecl">tynyd</code>, <code class="vardecl">tynzd</code></a>
<a name="utauwf_spatial_di11"></a>  <a href="utauwf_p.html#utauwfi10" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tznx</code>, <code class="vardecl">tzny</code>, <code class="vardecl">tznz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tznxd</code>, <code class="vardecl">tznyd</code>, <code class="vardecl">tznzd</code></a>
<a name="utauwf_spatial_di12"></a>  <a href="utauwf_p.html#utauwfi11" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tautn</code>, <code class="vardecl">tauwall</code>, <code class="vardecl">utau</code>, <code class="vardecl">re</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tautnd</code>, <code class="vardecl">tauwalld</code>, <code class="vardecl">utaud</code>, <code class="vardecl">red</code></a>
<a name="utauwf_spatial_di13"></a>  <a href="utauwf_p.html#utauwfi12" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ww1</code>, <code class="vardecl">ww2</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(:, :, :), <code class="modifier">POINTER </code>:: <code class="vardecl">ww1d</code>, <code class="vardecl">ww2d</code></a>
<a name="utauwf_spatial_di14"></a>  <a href="utauwf_p.html#utauwfi13" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ss</code>, <code class="vardecl">rres</code></a>
<a name="utauwf_spatial_di15"></a>  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(:, :, :), <code class="modifier">POINTER </code>:: <code class="vardecl">ssd</code>, <code class="vardecl">rresd</code></a>
<a name="utauwf_spatial_di16"></a>  <a href="utauwf_p.html#utauwfi14" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">norm</code></a>
  <a href="utauwf_p.html#utauwfi15" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rrlv2</code>, <code class="vardecl">dd2wall2</code></a>
<a href="utauwf_p.html#utauwfi16" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwfi16" target="origFile"><code class="comment">!      Function definition.</code></a>
<a href="utauwf_p.html#utauwfi16" target="origFile"><code class="comment">!</code></a>
<a name="utauwf_spatial_di17"></a>  <a href="utauwf_p.html#utauwfi16" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="funcname">CURVEUPRE_CD</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="funcname">CURVEUPRE_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwfi17" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1d</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">x1</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max1d</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">x1d</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max1</code></a>
<a name="utauwf_spatial_di18"></a>  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">y1</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">y1d</code></a>
<a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">!</code></a>
<a name="utauwf_spatial_di19"></a><a href="utauwf_p.html#utauwfi18" target="origFile"><code class="comment">! Return immediately if no wall functions must be used.</code></a>
  <a href="utauwf_p.html#utauwfi18" target="origFile"><code class="keyword">IF</code> (.NOT.wallfunctions) <code class="keyword">THEN</code></a>
<a name="utauwf_spatial_di20"></a>    <a href="utauwf_p.html#utauwfi19" target="origFile"><code class="keyword">RETURN</code></a>
  <a href="utauwf_p.html#utauwfi18" target="origFile"><code class="keyword">ELSE</code></a>
<a name="utauwf_spatial_di21"></a><a href="utauwf_p.html#utauwfi20" target="origFile"><code class="comment">! Loop over the viscous subfaces of this block.</code></a>
<a href="utauwf_p.html#utauwfi20" target="origFile"><code class="label">viscsubfaces:</code><code class="keyword">DO </code>nn=<code class="constant">1</code>,nviscbocos</a>
<a href="utauwf_p.html#utauwfi21" target="origFile"><code class="comment">! Set a bunch of variables depending on the face id to make</code></a>
<a href="utauwf_p.html#utauwfi21" target="origFile"><code class="comment">! a generic treatment possible.</code></a>
<a name="utauwf_spatial_di22"></a>      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="utauwf_p.html#utauwfi22" target="origFile">fact = -one</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ssd => sid(<code class="constant">1</code>, :, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ss => si(<code class="constant">1</code>, :, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rresd => fwd(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rres => fw(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2d => wd(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2 => w(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1d => wd(<code class="constant">1</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1 => w(<code class="constant">1</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">dd2wall2 => d2wall(<code class="constant">2</code>, :, :)</a>
<a name="utauwf_spatial_di29"></a>        <a href="utauwf_p.html#utauwfi21" target="origFile">rrlv2 => rlv(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">CASE </code>(imax) </a>
<a href="utauwf_p.html#utauwfi29" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwfi29" target="origFile">fact = one</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ssd => sid(il, :, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ss => si(il, :, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rresd => fwd(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rres => fw(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2d => wd(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2 => w(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1d => wd(ie, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1 => w(ie, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">dd2wall2 => d2wall(il, :, :)</a>
<a name="utauwf_spatial_di36"></a>        <a href="utauwf_p.html#utauwfi21" target="origFile">rrlv2 => rlv(il, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
<a href="utauwf_p.html#utauwfi36" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwfi36" target="origFile">fact = -one</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ssd => sjd(:, <code class="constant">1</code>, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ss => sj(:, <code class="constant">1</code>, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rresd => fwd(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rres => fw(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2d => wd(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1d => wd(<code class="constant">1</code>:, <code class="constant">1</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">dd2wall2 => d2wall(:, <code class="constant">2</code>, :)</a>
<a name="utauwf_spatial_di43"></a>        <a href="utauwf_p.html#utauwfi21" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
<a href="utauwf_p.html#utauwfi43" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwfi43" target="origFile">fact = one</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ssd => sjd(:, jl, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ss => sj(:, jl, :, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rresd => fwd(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rres => fw(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2d => wd(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2 => w(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1d => wd(<code class="constant">1</code>:, je, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1 => w(<code class="constant">1</code>:, je, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">dd2wall2 => d2wall(:, jl, :)</a>
<a name="utauwf_spatial_di50"></a>        <a href="utauwf_p.html#utauwfi21" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, jl, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
<a href="utauwf_p.html#utauwfi50" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwfi50" target="origFile">fact = -one</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ssd => skd(:, :, <code class="constant">1</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ss => sk(:, :, <code class="constant">1</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rresd => fwd(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rres => fw(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2d => wd(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1d => wd(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">dd2wall2 => d2wall(:, :, <code class="constant">2</code>)</a>
<a name="utauwf_spatial_di57"></a>        <a href="utauwf_p.html#utauwfi21" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>)</a>
      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
<a href="utauwf_p.html#utauwfi57" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwfi57" target="origFile">fact = one</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ssd => skd(:, :, kl, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ss => sk(:, :, kl, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rresd => fwd(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rres => fw(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2d => wd(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1d => wd(<code class="constant">1</code>:, <code class="constant">1</code>:, ke, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, ke, :)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">dd2wall2 => d2wall(:, :, kl)</a>
        <a href="utauwf_p.html#utauwfi21" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, kl)</a>
      <a href="utauwf_p.html#utauwfi21" target="origFile"><code class="keyword">END SELECT</code></a>
<a name="utauwf_spatial_di65"></a><a href="utauwf_p.html#utauwfi20" target="origFile"><code class="comment">! Set the pointer for the unit outward normals.</code></a>
      <a href="utauwf_p.html#utauwfi20" target="origFile">norm => bcdata(nn)%norm</a>
<a href="utauwf_p.html#utauwfi65" target="origFile"><code class="comment">! Loop over the quadrilateral faces of the subface. Note</code></a>
<a href="utauwf_p.html#utauwfi65" target="origFile"><code class="comment">! that the nodal range of BCData must be used and not the</code></a>
<a href="utauwf_p.html#utauwfi65" target="origFile"><code class="comment">! cell range, because the latter may include the halo's in i</code></a>
<a href="utauwf_p.html#utauwfi65" target="origFile"><code class="comment">! and j-direction. The offset +1 is there, because inBeg and</code></a>
<a name="utauwf_spatial_di66"></a><a href="utauwf_p.html#utauwfi65" target="origFile"><code class="comment">! jnBeg refer to nodal ranges and not to cell ranges.</code></a>
<a name="utauwf_spatial_di67"></a>      <a href="utauwf_p.html#utauwfi65" target="origFile"><code class="keyword">DO </code>j=bcdata(nn)%jnbeg+<code class="constant">1</code>,bcdata(nn)%jnend</a>
        <a href="utauwf_p.html#utauwfi66" target="origFile"><code class="keyword">DO </code>i=bcdata(nn)%inbeg+<code class="constant">1</code>,bcdata(nn)%inend</a>
<a href="utauwf_p.html#utauwfi67" target="origFile"><code class="comment">! Store the viscous stress tensor a bit easier.</code></a>
<a name="utauwf_spatial_di68"></a>          <a href="utauwf_p.html#utauwfi67" target="origFile">tauxxd = viscsubfaced(nn)%tau(i, j, <code class="constant">1</code>)</a>
          <a href="utauwf_p.html#utauwfi67" target="origFile">tauxx = viscsubface(nn)%tau(i, j, <code class="constant">1</code>)</a>
<a name="utauwf_spatial_di69"></a>          <a href="utauwf_p.html#utauwfi68" target="origFile">tauyyd = viscsubfaced(nn)%tau(i, j, <code class="constant">2</code>)</a>
          <a href="utauwf_p.html#utauwfi68" target="origFile">tauyy = viscsubface(nn)%tau(i, j, <code class="constant">2</code>)</a>
<a name="utauwf_spatial_di70"></a>          <a href="utauwf_p.html#utauwfi69" target="origFile">tauzzd = viscsubfaced(nn)%tau(i, j, <code class="constant">3</code>)</a>
          <a href="utauwf_p.html#utauwfi69" target="origFile">tauzz = viscsubface(nn)%tau(i, j, <code class="constant">3</code>)</a>
<a name="utauwf_spatial_di71"></a>          <a href="utauwf_p.html#utauwfi70" target="origFile">tauxyd = viscsubfaced(nn)%tau(i, j, <code class="constant">4</code>)</a>
          <a href="utauwf_p.html#utauwfi70" target="origFile">tauxy = viscsubface(nn)%tau(i, j, <code class="constant">4</code>)</a>
<a name="utauwf_spatial_di72"></a>          <a href="utauwf_p.html#utauwfi71" target="origFile">tauxzd = viscsubfaced(nn)%tau(i, j, <code class="constant">5</code>)</a>
          <a href="utauwf_p.html#utauwfi71" target="origFile">tauxz = viscsubface(nn)%tau(i, j, <code class="constant">5</code>)</a>
<a name="utauwf_spatial_di73"></a>          <a href="utauwf_p.html#utauwfi72" target="origFile">tauyzd = viscsubfaced(nn)%tau(i, j, <code class="constant">6</code>)</a>
          <a href="utauwf_p.html#utauwfi72" target="origFile">tauyz = viscsubface(nn)%tau(i, j, <code class="constant">6</code>)</a>
<a href="utauwf_p.html#utauwfi73" target="origFile"><code class="comment">! Compute the velocities at the wall face; these are only</code></a>
<a href="utauwf_p.html#utauwfi73" target="origFile"><code class="comment">! non-zero for moving a block. Also compute the density,</code></a>
<a href="utauwf_p.html#utauwfi73" target="origFile"><code class="comment">! which is needed to compute the wall shear stress via</code></a>
<a href="utauwf_p.html#utauwfi73" target="origFile"><code class="comment">! wall functions.</code></a>
<a name="utauwf_spatial_di74"></a>          <a href="utauwf_p.html#utauwfi73" target="origFile">rbard = half*(ww2d(i, j, irho)+ww1d(i, j, irho))</a>
          <a href="utauwf_p.html#utauwfi73" target="origFile">rbar = half*(ww2(i, j, irho)+ww1(i, j, irho))</a>
<a name="utauwf_spatial_di75"></a>          <a href="utauwf_p.html#utauwfi74" target="origFile">ubard = half*(ww2d(i, j, ivx)+ww1d(i, j, ivx))</a>
          <a href="utauwf_p.html#utauwfi74" target="origFile">ubar = half*(ww2(i, j, ivx)+ww1(i, j, ivx))</a>
<a name="utauwf_spatial_di76"></a>          <a href="utauwf_p.html#utauwfi75" target="origFile">vbard = half*(ww2d(i, j, ivy)+ww1d(i, j, ivy))</a>
          <a href="utauwf_p.html#utauwfi75" target="origFile">vbar = half*(ww2(i, j, ivy)+ww1(i, j, ivy))</a>
<a name="utauwf_spatial_di77"></a>          <a href="utauwf_p.html#utauwfi76" target="origFile">wbard = half*(ww2d(i, j, ivz)+ww1d(i, j, ivz))</a>
          <a href="utauwf_p.html#utauwfi76" target="origFile">wbar = half*(ww2(i, j, ivz)+ww1(i, j, ivz))</a>
<a href="utauwf_p.html#utauwfi77" target="origFile"><code class="comment">! Compute the velocity difference between the internal cell</code></a>
<a href="utauwf_p.html#utauwfi77" target="origFile"><code class="comment">! and the wall.</code></a>
<a name="utauwf_spatial_di78"></a>          <a href="utauwf_p.html#utauwfi77" target="origFile">vxd = ww2d(i, j, ivx) - ubard</a>
          <a href="utauwf_p.html#utauwfi77" target="origFile">vx = ww2(i, j, ivx) - ubar</a>
<a name="utauwf_spatial_di79"></a>          <a href="utauwf_p.html#utauwfi78" target="origFile">vyd = ww2d(i, j, ivy) - vbard</a>
          <a href="utauwf_p.html#utauwfi78" target="origFile">vy = ww2(i, j, ivy) - vbar</a>
<a name="utauwf_spatial_di80"></a>          <a href="utauwf_p.html#utauwfi79" target="origFile">vzd = ww2d(i, j, ivz) - wbard</a>
          <a href="utauwf_p.html#utauwfi79" target="origFile">vz = ww2(i, j, ivz) - wbar</a>
<a href="utauwf_p.html#utauwfi80" target="origFile"><code class="comment">! Compute the normal velocity of the internal cell.</code></a>
          <a href="utauwf_p.html#utauwfi80" target="origFile">velnd = norm(i, j, <code class="constant">1</code>)*vxd + norm(i, j, <code class="constant">2</code>)*vyd + norm(i, j, <code class="constant">3</code>)*<code class="label">&</code></a>
<a name="utauwf_spatial_di81"></a><a href="utauwf_p.html#utauwfi80" target="origFile"><code class="label">&            </code>vzd</a>
          <a href="utauwf_p.html#utauwfi80" target="origFile">veln = vx*norm(i, j, <code class="constant">1</code>) + vy*norm(i, j, <code class="constant">2</code>) + vz*norm(i, j, <code class="constant">3</code>)</a>
<a name="utauwf_spatial_di82"></a>          <a href="utauwf_p.html#utauwfi81" target="origFile">velnxd = norm(i, j, <code class="constant">1</code>)*velnd</a>
          <a href="utauwf_p.html#utauwfi81" target="origFile">velnx = veln*norm(i, j, <code class="constant">1</code>)</a>
<a name="utauwf_spatial_di83"></a>          <a href="utauwf_p.html#utauwfi82" target="origFile">velnyd = norm(i, j, <code class="constant">2</code>)*velnd</a>
          <a href="utauwf_p.html#utauwfi82" target="origFile">velny = veln*norm(i, j, <code class="constant">2</code>)</a>
<a name="utauwf_spatial_di84"></a>          <a href="utauwf_p.html#utauwfi83" target="origFile">velnzd = norm(i, j, <code class="constant">3</code>)*velnd</a>
          <a href="utauwf_p.html#utauwfi83" target="origFile">velnz = veln*norm(i, j, <code class="constant">3</code>)</a>
<a href="utauwf_p.html#utauwfi84" target="origFile"><code class="comment">! Compute the tangential velocity, its magnitude and its</code></a>
<a href="utauwf_p.html#utauwfi84" target="origFile"><code class="comment">! unit vector of the internal cell.</code></a>
<a name="utauwf_spatial_di85"></a>          <a href="utauwf_p.html#utauwfi84" target="origFile">veltxd = vxd - velnxd</a>
          <a href="utauwf_p.html#utauwfi84" target="origFile">veltx = vx - velnx</a>
<a name="utauwf_spatial_di86"></a>          <a href="utauwf_p.html#utauwfi85" target="origFile">veltyd = vyd - velnyd</a>
          <a href="utauwf_p.html#utauwfi85" target="origFile">velty = vy - velny</a>
<a name="utauwf_spatial_di87"></a>          <a href="utauwf_p.html#utauwfi86" target="origFile">veltzd = vzd - velnzd</a>
          <a href="utauwf_p.html#utauwfi86" target="origFile">veltz = vz - velnz</a>
<a name="utauwf_spatial_di88"></a>          <a href="utauwf_p.html#utauwfi87" target="origFile">arg1d = <code class="constant">2</code>*veltx*veltxd + <code class="constant">2</code>*velty*veltyd + <code class="constant">2</code>*veltz*veltzd</a>
          <a href="utauwf_p.html#utauwfi87" target="origFile">arg1 = veltx**<code class="constant">2 </code>+ velty**<code class="constant">2 </code>+ veltz**<code class="constant">2</code></a>
          <a href="utauwf_p.html#utauwfi88" target="origFile"><code class="keyword">IF</code> (arg1 .EQ. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
            <a href="utauwf_p.html#utauwfi88" target="origFile">y1d = <code class="constant">0.0</code></a>
          <a href="utauwf_p.html#utauwfi88" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="utauwf_p.html#utauwfi88" target="origFile">y1d = arg1d/(<code class="constant">2.0</code>*<code class="funcname">SQRT</code>(arg1))</a>
<a name="utauwf_spatial_di89"></a>          <a href="utauwf_p.html#utauwfi88" target="origFile"><code class="keyword">END IF</code></a>
<a name="utauwf_spatial_di91"></a>          <a href="utauwf_p.html#utauwfi88" target="origFile">y1 = <code class="funcname">SQRT</code>(arg1)</a>
          <a href="utauwf_p.html#utauwfi89" target="origFile"><code class="keyword">IF</code> (eps .LT. y1) <code class="keyword">THEN</code></a>
            <a href="utauwf_p.html#utauwfi91" target="origFile">veltmagd = y1d</a>
<a name="utauwf_spatial_di90"></a>            <a href="utauwf_p.html#utauwfi91" target="origFile">veltmag = y1</a>
          <a href="utauwf_p.html#utauwfi89" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="utauwf_p.html#utauwfi90" target="origFile">veltmag = eps</a>
<a name="utauwf_spatial_di92"></a>            <a href="utauwf_p.html#utauwfi89" target="origFile">veltmagd = <code class="constant">0.0</code></a>
          <a href="utauwf_p.html#utauwfi89" target="origFile"><code class="keyword">END IF</code></a>
<a name="utauwf_spatial_di93"></a>          <a href="utauwf_p.html#utauwfi92" target="origFile">txd = (veltxd*veltmag-veltx*veltmagd)/veltmag**<code class="constant">2</code></a>
          <a href="utauwf_p.html#utauwfi92" target="origFile">tx = veltx/veltmag</a>
<a name="utauwf_spatial_di94"></a>          <a href="utauwf_p.html#utauwfi93" target="origFile">tyd = (veltyd*veltmag-velty*veltmagd)/veltmag**<code class="constant">2</code></a>
          <a href="utauwf_p.html#utauwfi93" target="origFile">ty = velty/veltmag</a>
<a name="utauwf_spatial_di95"></a>          <a href="utauwf_p.html#utauwfi94" target="origFile">tzd = (veltzd*veltmag-veltz*veltmagd)/veltmag**<code class="constant">2</code></a>
          <a href="utauwf_p.html#utauwfi94" target="origFile">tz = veltz/veltmag</a>
<a href="utauwf_p.html#utauwfi95" target="origFile"><code class="comment">! Compute some coefficients needed for the transformation</code></a>
<a href="utauwf_p.html#utauwfi95" target="origFile"><code class="comment">! between the cartesian frame and the frame defined by the</code></a>
<a href="utauwf_p.html#utauwfi95" target="origFile"><code class="comment">! tangential direction (tx,ty,tz) and the normal direction.</code></a>
<a href="utauwf_p.html#utauwfi95" target="origFile"><code class="comment">! The minus sign is present, because for this transformation</code></a>
<a href="utauwf_p.html#utauwfi95" target="origFile"><code class="comment">! the normal direction should be inward pointing and norm</code></a>
<a href="utauwf_p.html#utauwfi95" target="origFile"><code class="comment">! is outward pointing.</code></a>
<a name="utauwf_spatial_di96"></a>          <a href="utauwf_p.html#utauwfi95" target="origFile">txnxd = -(norm(i, j, <code class="constant">1</code>)*txd)</a>
          <a href="utauwf_p.html#utauwfi95" target="origFile">txnx = -(tx*norm(i, j, <code class="constant">1</code>))</a>
<a name="utauwf_spatial_di97"></a>          <a href="utauwf_p.html#utauwfi96" target="origFile">txnyd = -(norm(i, j, <code class="constant">2</code>)*txd)</a>
          <a href="utauwf_p.html#utauwfi96" target="origFile">txny = -(tx*norm(i, j, <code class="constant">2</code>))</a>
<a name="utauwf_spatial_di98"></a>          <a href="utauwf_p.html#utauwfi97" target="origFile">txnzd = -(norm(i, j, <code class="constant">3</code>)*txd)</a>
          <a href="utauwf_p.html#utauwfi97" target="origFile">txnz = -(tx*norm(i, j, <code class="constant">3</code>))</a>
<a name="utauwf_spatial_di99"></a>          <a href="utauwf_p.html#utauwfi98" target="origFile">tynxd = -(norm(i, j, <code class="constant">1</code>)*tyd)</a>
          <a href="utauwf_p.html#utauwfi98" target="origFile">tynx = -(ty*norm(i, j, <code class="constant">1</code>))</a>
<a name="utauwf_spatial_di100"></a>          <a href="utauwf_p.html#utauwfi99" target="origFile">tynyd = -(norm(i, j, <code class="constant">2</code>)*tyd)</a>
          <a href="utauwf_p.html#utauwfi99" target="origFile">tyny = -(ty*norm(i, j, <code class="constant">2</code>))</a>
<a name="utauwf_spatial_di101"></a>          <a href="utauwf_p.html#utauwfi100" target="origFile">tynzd = -(norm(i, j, <code class="constant">3</code>)*tyd)</a>
          <a href="utauwf_p.html#utauwfi100" target="origFile">tynz = -(ty*norm(i, j, <code class="constant">3</code>))</a>
<a name="utauwf_spatial_di102"></a>          <a href="utauwf_p.html#utauwfi101" target="origFile">tznxd = -(norm(i, j, <code class="constant">1</code>)*tzd)</a>
          <a href="utauwf_p.html#utauwfi101" target="origFile">tznx = -(tz*norm(i, j, <code class="constant">1</code>))</a>
<a name="utauwf_spatial_di103"></a>          <a href="utauwf_p.html#utauwfi102" target="origFile">tznyd = -(norm(i, j, <code class="constant">2</code>)*tzd)</a>
          <a href="utauwf_p.html#utauwfi102" target="origFile">tzny = -(tz*norm(i, j, <code class="constant">2</code>))</a>
<a name="utauwf_spatial_di104"></a>          <a href="utauwf_p.html#utauwfi103" target="origFile">tznzd = -(norm(i, j, <code class="constant">3</code>)*tzd)</a>
          <a href="utauwf_p.html#utauwfi103" target="origFile">tznz = -(tz*norm(i, j, <code class="constant">3</code>))</a>
<a href="utauwf_p.html#utauwfi104" target="origFile"><code class="comment">! Compute the tn component of the wall shear stress</code></a>
<a href="utauwf_p.html#utauwfi104" target="origFile"><code class="comment">! tensor. Normally this is the only nonzero shear</code></a>
<a href="utauwf_p.html#utauwfi104" target="origFile"><code class="comment">! stress component in the t-n frame.</code></a>
          <a href="utauwf_p.html#utauwfi104" target="origFile">tautnd = tauxxd*txnx + tauxx*txnxd + tauyyd*tyny + tauyy*tynyd<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi104" target="origFile"><code class="label">&            </code>+ tauzzd*tznz + tauzz*tznzd + tauxyd*(txny+tynx) + tauxy*(<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi104" target="origFile"><code class="label">&            </code>txnyd+tynxd) + tauxzd*(txnz+tznx) + tauxz*(txnzd+tznxd) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi104" target="origFile"><code class="label">&            </code>tauyzd*(tynz+tzny) + tauyz*(tynzd+tznyd)</a>
<a name="utauwf_spatial_di105"></a>          <a href="utauwf_p.html#utauwfi104" target="origFile">tautn = tauxx*txnx + tauyy*tyny + tauzz*tznz + tauxy*(txny+<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi104" target="origFile"><code class="label">&            </code>tynx) + tauxz*(txnz+tznx) + tauyz*(tynz+tzny)</a>
<a href="utauwf_p.html#utauwfi105" target="origFile"><code class="comment">! Compute the Reynolds number using the velocity, density,</code></a>
<a href="utauwf_p.html#utauwfi105" target="origFile"><code class="comment">! laminar viscosity and wall distance. Note that an offset</code></a>
<a href="utauwf_p.html#utauwfi105" target="origFile"><code class="comment">! of -1 must be used in dd2Wall2, because the original array</code></a>
<a href="utauwf_p.html#utauwfi105" target="origFile"><code class="comment">! d2Wall starts at 2.</code></a>
          <a href="utauwf_p.html#utauwfi105" target="origFile">red = dd2wall2(i-<code class="constant">1</code>, j-<code class="constant">1</code>)*(ww2d(i, j, irho)*veltmag+ww2(i, j, <code class="label">&</code></a>
<a name="utauwf_spatial_di106"></a><a href="utauwf_p.html#utauwfi105" target="origFile"><code class="label">&            </code>irho)*veltmagd)/rrlv2(i, j)</a>
<a name="utauwf_spatial_di107"></a>          <a href="utauwf_p.html#utauwfi105" target="origFile">re = ww2(i, j, irho)*veltmag*dd2wall2(i-<code class="constant">1</code>, j-<code class="constant">1</code>)/rrlv2(i, j)</a>
<a name="utauwf_spatial_di109"></a>          <a href="utauwf_p.html#utauwfi106" target="origFile">x1d = <code class="funcname">CURVEUPRE_SPATIAL_D</code>(re, red, x1)</a>
          <a href="utauwf_p.html#utauwfi107" target="origFile"><code class="keyword">IF</code> (x1 .LT. eps) <code class="keyword">THEN</code></a>
            <a href="utauwf_p.html#utauwfi109" target="origFile">max1 = eps</a>
<a name="utauwf_spatial_di108"></a>            <a href="utauwf_p.html#utauwfi107" target="origFile">max1d = <code class="constant">0.0</code></a>
          <a href="utauwf_p.html#utauwfi107" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="utauwf_p.html#utauwfi108" target="origFile">max1d = x1d</a>
<a name="utauwf_spatial_di110"></a>            <a href="utauwf_p.html#utauwfi108" target="origFile">max1 = x1</a>
          <a href="utauwf_p.html#utauwfi107" target="origFile"><code class="keyword">END IF</code></a>
<a href="utauwf_p.html#utauwfi110" target="origFile"><code class="comment">! Determine the friction velocity from the table and</code></a>
<a href="utauwf_p.html#utauwfi110" target="origFile"><code class="comment">! compute the wall shear stress from it.</code></a>
<a name="utauwf_spatial_di111"></a>          <a href="utauwf_p.html#utauwfi110" target="origFile">utaud = (veltmagd*max1-veltmag*max1d)/max1**<code class="constant">2</code></a>
          <a href="utauwf_p.html#utauwfi110" target="origFile">utau = veltmag/max1</a>
<a name="utauwf_spatial_di112"></a>          <a href="utauwf_p.html#utauwfi111" target="origFile">tauwalld = (rbard*utau+rbar*utaud)*utau + rbar*utau*utaud</a>
          <a href="utauwf_p.html#utauwfi111" target="origFile">tauwall = rbar*utau*utau</a>
<a href="utauwf_p.html#utauwfi112" target="origFile"><code class="comment">! Compute the correction to the wall shear stress tautn and</code></a>
<a href="utauwf_p.html#utauwfi112" target="origFile"><code class="comment">! transform this correction back to the cartesian frame.</code></a>
<a href="utauwf_p.html#utauwfi112" target="origFile"><code class="comment">! Take rFilv into account, such that the correction to the</code></a>
<a href="utauwf_p.html#utauwfi112" target="origFile"><code class="comment">! stress tensor is computed correctly.</code></a>
<a name="utauwf_spatial_di113"></a>          <a href="utauwf_p.html#utauwfi112" target="origFile">tautnd = rfilv*tauwalld - tautnd</a>
          <a href="utauwf_p.html#utauwfi112" target="origFile">tautn = rfilv*tauwall - tautn</a>
<a name="utauwf_spatial_di114"></a>          <a href="utauwf_p.html#utauwfi113" target="origFile">tauxxd = two*(tautnd*txnx+tautn*txnxd)</a>
          <a href="utauwf_p.html#utauwfi113" target="origFile">tauxx = two*tautn*txnx</a>
<a name="utauwf_spatial_di115"></a>          <a href="utauwf_p.html#utauwfi114" target="origFile">tauyyd = two*(tautnd*tyny+tautn*tynyd)</a>
          <a href="utauwf_p.html#utauwfi114" target="origFile">tauyy = two*tautn*tyny</a>
<a name="utauwf_spatial_di116"></a>          <a href="utauwf_p.html#utauwfi115" target="origFile">tauzzd = two*(tautnd*tznz+tautn*tznzd)</a>
          <a href="utauwf_p.html#utauwfi115" target="origFile">tauzz = two*tautn*tznz</a>
<a name="utauwf_spatial_di117"></a>          <a href="utauwf_p.html#utauwfi116" target="origFile">tauxyd = tautnd*(txny+tynx) + tautn*(txnyd+tynxd)</a>
          <a href="utauwf_p.html#utauwfi116" target="origFile">tauxy = tautn*(txny+tynx)</a>
<a name="utauwf_spatial_di118"></a>          <a href="utauwf_p.html#utauwfi117" target="origFile">tauxzd = tautnd*(txnz+tznx) + tautn*(txnzd+tznxd)</a>
          <a href="utauwf_p.html#utauwfi117" target="origFile">tauxz = tautn*(txnz+tznx)</a>
<a name="utauwf_spatial_di119"></a>          <a href="utauwf_p.html#utauwfi118" target="origFile">tauyzd = tautnd*(tynz+tzny) + tautn*(tynzd+tznyd)</a>
          <a href="utauwf_p.html#utauwfi118" target="origFile">tauyz = tautn*(tynz+tzny)</a>
<a href="utauwf_p.html#utauwfi119" target="origFile"><code class="comment">! Compute the correction to the viscous flux at the wall.</code></a>
          <a href="utauwf_p.html#utauwfi119" target="origFile">fmxd = tauxxd*ss(i, j, <code class="constant">1</code>) + tauxx*ssd(i, j, <code class="constant">1</code>) + tauxyd*ss(i, <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi119" target="origFile"><code class="label">&            </code>j, <code class="constant">2</code>) + tauxy*ssd(i, j, <code class="constant">2</code>) + tauxzd*ss(i, j, <code class="constant">3</code>) + tauxz*ssd(<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi119" target="origFile"><code class="label">&            </code>i, j, <code class="constant">3</code>)</a>
<a name="utauwf_spatial_di120"></a>          <a href="utauwf_p.html#utauwfi119" target="origFile">fmx = tauxx*ss(i, j, <code class="constant">1</code>) + tauxy*ss(i, j, <code class="constant">2</code>) + tauxz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi119" target="origFile"><code class="label">&            </code>)</a>
          <a href="utauwf_p.html#utauwfi120" target="origFile">fmyd = tauxyd*ss(i, j, <code class="constant">1</code>) + tauxy*ssd(i, j, <code class="constant">1</code>) + tauyyd*ss(i, <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi120" target="origFile"><code class="label">&            </code>j, <code class="constant">2</code>) + tauyy*ssd(i, j, <code class="constant">2</code>) + tauyzd*ss(i, j, <code class="constant">3</code>) + tauyz*ssd(<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi120" target="origFile"><code class="label">&            </code>i, j, <code class="constant">3</code>)</a>
<a name="utauwf_spatial_di121"></a>          <a href="utauwf_p.html#utauwfi120" target="origFile">fmy = tauxy*ss(i, j, <code class="constant">1</code>) + tauyy*ss(i, j, <code class="constant">2</code>) + tauyz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi120" target="origFile"><code class="label">&            </code>)</a>
          <a href="utauwf_p.html#utauwfi121" target="origFile">fmzd = tauxzd*ss(i, j, <code class="constant">1</code>) + tauxz*ssd(i, j, <code class="constant">1</code>) + tauyzd*ss(i, <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi121" target="origFile"><code class="label">&            </code>j, <code class="constant">2</code>) + tauyz*ssd(i, j, <code class="constant">2</code>) + tauzzd*ss(i, j, <code class="constant">3</code>) + tauzz*ssd(<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi121" target="origFile"><code class="label">&            </code>i, j, <code class="constant">3</code>)</a>
<a name="utauwf_spatial_di122"></a>          <a href="utauwf_p.html#utauwfi121" target="origFile">fmz = tauxz*ss(i, j, <code class="constant">1</code>) + tauyz*ss(i, j, <code class="constant">2</code>) + tauzz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi121" target="origFile"><code class="label">&            </code>)</a>
          <a href="utauwf_p.html#utauwfi122" target="origFile">frhoed = (ubard*tauxx+ubar*tauxxd+vbard*tauxy+vbar*tauxyd+<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>wbard*tauxz+wbar*tauxzd)*ss(i, j, <code class="constant">1</code>) + (ubar*tauxx+vbar*<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>tauxy+wbar*tauxz)*ssd(i, j, <code class="constant">1</code>) + (ubard*tauxy+ubar*tauxyd+<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>vbard*tauyy+vbar*tauyyd+wbard*tauyz+wbar*tauyzd)*ss(i, j, <code class="constant">2</code>)<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>+ (ubar*tauxy+vbar*tauyy+wbar*tauyz)*ssd(i, j, <code class="constant">2</code>) + (ubard*<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>tauxz+ubar*tauxzd+vbard*tauyz+vbar*tauyzd+wbard*tauzz+wbar*<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>tauzzd)*ss(i, j, <code class="constant">3</code>) + (ubar*tauxz+vbar*tauyz+wbar*tauzz)*ssd<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>(i, j, <code class="constant">3</code>)</a>
          <a href="utauwf_p.html#utauwfi122" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*ss(i, j, <code class="constant">1</code>) + (ubar<code class="label">&</code></a>
<a name="utauwf_spatial_di123"></a><a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>*tauxy+vbar*tauyy+wbar*tauyz)*ss(i, j, <code class="constant">2</code>) + (ubar*tauxz+vbar<code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi122" target="origFile"><code class="label">&            </code>*tauyz+wbar*tauzz)*ss(i, j, <code class="constant">3</code>)</a>
<a href="utauwf_p.html#utauwfi123" target="origFile"><code class="comment">! Add them to the residual. Note that now the factor rFilv</code></a>
<a href="utauwf_p.html#utauwfi123" target="origFile"><code class="comment">! is already taken into account via tau. Fact is present to</code></a>
<a href="utauwf_p.html#utauwfi123" target="origFile"><code class="comment">! take inward/outward pointing normals into account</code></a>
<a name="utauwf_spatial_di124"></a>          <a href="utauwf_p.html#utauwfi123" target="origFile">rresd(i, j, imx) = rresd(i, j, imx) - fact*fmxd</a>
          <a href="utauwf_p.html#utauwfi123" target="origFile">rres(i, j, imx) = rres(i, j, imx) - fact*fmx</a>
<a name="utauwf_spatial_di125"></a>          <a href="utauwf_p.html#utauwfi124" target="origFile">rresd(i, j, imy) = rresd(i, j, imy) - fact*fmyd</a>
          <a href="utauwf_p.html#utauwfi124" target="origFile">rres(i, j, imy) = rres(i, j, imy) - fact*fmy</a>
<a name="utauwf_spatial_di126"></a>          <a href="utauwf_p.html#utauwfi125" target="origFile">rresd(i, j, imz) = rresd(i, j, imz) - fact*fmzd</a>
          <a href="utauwf_p.html#utauwfi125" target="origFile">rres(i, j, imz) = rres(i, j, imz) - fact*fmz</a>
<a name="utauwf_spatial_di127"></a>          <a href="utauwf_p.html#utauwfi126" target="origFile">rresd(i, j, irhoe) = rresd(i, j, irhoe) - fact*frhoed</a>
          <a href="utauwf_p.html#utauwfi126" target="origFile">rres(i, j, irhoe) = rres(i, j, irhoe) - fact*frhoe</a>
<a name="utauwf_spatial_di128"></a><a href="utauwf_p.html#utauwfi127" target="origFile"><code class="comment">! Store the friction velocity for later use.</code></a>
          <a href="utauwf_p.html#utauwfi127" target="origFile">viscsubface(nn)%utau(i, j) = utau</a>
<a href="utauwf_p.html#utauwfi128" target="origFile"><code class="comment">! Also add the correction to the wall stress tensor.</code></a>
          <a href="utauwf_p.html#utauwfi128" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">1</code>) = viscsubfaced(nn)%tau(i, j, <code class="constant">1</code>) <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi128" target="origFile"><code class="label">&            </code>+ tauxxd</a>
<a name="utauwf_spatial_di129"></a>          <a href="utauwf_p.html#utauwfi128" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = viscsubface(nn)%tau(i, j, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi128" target="origFile"><code class="label">&            </code>tauxx</a>
          <a href="utauwf_p.html#utauwfi129" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">2</code>) = viscsubfaced(nn)%tau(i, j, <code class="constant">2</code>) <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi129" target="origFile"><code class="label">&            </code>+ tauyyd</a>
<a name="utauwf_spatial_di130"></a>          <a href="utauwf_p.html#utauwfi129" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = viscsubface(nn)%tau(i, j, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi129" target="origFile"><code class="label">&            </code>tauyy</a>
          <a href="utauwf_p.html#utauwfi130" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">3</code>) = viscsubfaced(nn)%tau(i, j, <code class="constant">3</code>) <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi130" target="origFile"><code class="label">&            </code>+ tauzzd</a>
<a name="utauwf_spatial_di131"></a>          <a href="utauwf_p.html#utauwfi130" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = viscsubface(nn)%tau(i, j, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi130" target="origFile"><code class="label">&            </code>tauzz</a>
          <a href="utauwf_p.html#utauwfi131" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">4</code>) = viscsubfaced(nn)%tau(i, j, <code class="constant">4</code>) <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi131" target="origFile"><code class="label">&            </code>+ tauxyd</a>
<a name="utauwf_spatial_di132"></a>          <a href="utauwf_p.html#utauwfi131" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = viscsubface(nn)%tau(i, j, <code class="constant">4</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi131" target="origFile"><code class="label">&            </code>tauxy</a>
          <a href="utauwf_p.html#utauwfi132" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">5</code>) = viscsubfaced(nn)%tau(i, j, <code class="constant">5</code>) <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi132" target="origFile"><code class="label">&            </code>+ tauxzd</a>
<a name="utauwf_spatial_di133"></a>          <a href="utauwf_p.html#utauwfi132" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = viscsubface(nn)%tau(i, j, <code class="constant">5</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi132" target="origFile"><code class="label">&            </code>tauxz</a>
          <a href="utauwf_p.html#utauwfi133" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">6</code>) = viscsubfaced(nn)%tau(i, j, <code class="constant">6</code>) <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi133" target="origFile"><code class="label">&            </code>+ tauyzd</a>
          <a href="utauwf_p.html#utauwfi133" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = viscsubface(nn)%tau(i, j, <code class="constant">6</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwfi133" target="origFile"><code class="label">&            </code>tauyz</a>
        <a href="utauwf_p.html#utauwfi66" target="origFile"><code class="keyword">END DO</code></a>
      <a href="utauwf_p.html#utauwfi65" target="origFile"><code class="keyword">END DO</code></a>
    <a href="utauwf_p.html#utauwfi20" target="origFile"><code class="keyword">END DO </code><code class="label">viscsubfaces</code></a>
  <a href="utauwf_p.html#utauwfi18" target="origFile"><code class="keyword">END IF</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">UTAUWF_SPATIAL_D</code></a>
</pre>
</body>
