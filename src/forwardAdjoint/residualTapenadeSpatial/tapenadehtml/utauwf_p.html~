<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="utauwf"></a><a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      * File:          utauWF.f90                                      *</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      * Author:        Georgi Kalitzin, Edwin van der Weide            *</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      * Starting date: 10-01-2003                                      *</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      * Last modified: 06-12-2005                                      *</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">UTAUWF</code>(<code class="vardecl">rfilv</code>)</a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS</code></a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE</code></a>
<a name="utauwfi0"></a>  <a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">USE </code><code class="funcname">BCTYPES</code></a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!      * utauWF substitutes the wall shear stress with values from a    *</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!      * look-up table, if desired.                                     *</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!      Subroutine argument.</code></a>
<a name="utauwfi1"></a><a href="utauwf.html#utauwfi0" target="diffFile"><code class="comment">!</code></a>
  <a href="utauwf.html#utauwfi0" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">rfilv</code></a>
<a href="utauwf.html#utauwfi1" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwfi1" target="diffFile"><code class="comment">!      Local variables.</code></a>
<a name="utauwfi2"></a><a href="utauwf.html#utauwfi1" target="diffFile"><code class="comment">!</code></a>
<a name="utauwfi3"></a>  <a href="utauwf.html#utauwfi1" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">nn</code></a>
<a name="utauwfi4"></a>  <a href="utauwf.html#utauwfi2" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fact</code></a>
<a name="utauwfi5"></a>  <a href="utauwf.html#utauwfi3" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxx</code>, <code class="vardecl">tauyy</code>, <code class="vardecl">tauzz</code></a>
<a name="utauwfi6"></a>  <a href="utauwf.html#utauwfi4" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxy</code>, <code class="vardecl">tauxz</code>, <code class="vardecl">tauyz</code></a>
<a name="utauwfi7"></a>  <a href="utauwf.html#utauwfi5" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rbar</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code></a>
<a name="utauwfi8"></a>  <a href="utauwf.html#utauwfi6" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmx</code>, <code class="vardecl">fmy</code>, <code class="vardecl">fmz</code>, <code class="vardecl">frhoe</code></a>
<a name="utauwfi9"></a>  <a href="utauwf.html#utauwfi7" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">veln</code>, <code class="vardecl">velnx</code>, <code class="vardecl">velny</code>, <code class="vardecl">velnz</code>, <code class="vardecl">tx</code>, <code class="vardecl">ty</code>, <code class="vardecl">tz</code></a>
<a name="utauwfi10"></a>  <a href="utauwf.html#utauwfi8" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">veltx</code>, <code class="vardecl">velty</code>, <code class="vardecl">veltz</code>, <code class="vardecl">veltmag</code></a>
<a name="utauwfi11"></a>  <a href="utauwf.html#utauwfi9" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">txnx</code>, <code class="vardecl">txny</code>, <code class="vardecl">txnz</code>, <code class="vardecl">tynx</code>, <code class="vardecl">tyny</code>, <code class="vardecl">tynz</code></a>
<a name="utauwfi12"></a>  <a href="utauwf.html#utauwfi10" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tznx</code>, <code class="vardecl">tzny</code>, <code class="vardecl">tznz</code></a>
<a name="utauwfi13"></a>  <a href="utauwf.html#utauwfi11" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tautn</code>, <code class="vardecl">tauwall</code>, <code class="vardecl">utau</code>, <code class="vardecl">re</code></a>
<a name="utauwfi14"></a>  <a href="utauwf.html#utauwfi12" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ww1</code>, <code class="vardecl">ww2</code></a>
<a name="utauwfi15"></a>  <a href="utauwf.html#utauwfi13" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ss</code>, <code class="vardecl">rres</code></a>
<a name="utauwfi16"></a>  <a href="utauwf.html#utauwfi14" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">norm</code></a>
  <a href="utauwf.html#utauwfi15" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rrlv2</code>, <code class="vardecl">dd2wall2</code></a>
<a href="utauwf.html#utauwfi16" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwfi16" target="diffFile"><code class="comment">!      Function definition.</code></a>
<a name="utauwfi17"></a><a href="utauwf.html#utauwfi16" target="diffFile"><code class="comment">!</code></a>
  <a href="utauwf.html#utauwfi16" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="funcname">CURVEUPRE</code></a>
  <a href="utauwf.html#utauwfi17" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">x1</code></a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a name="utauwfi18"></a>  <a href="utauwf.html#utauwf" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max1</code></a>
  <a href="utauwf.html#utauwf" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">y1</code></a>
<a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">!</code></a>
<a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">!</code></a>
<a name="utauwfi19"></a><a href="utauwf.html#utauwfi18" target="diffFile"><code class="comment">! Return immediately if no wall functions must be used.</code></a>
  <a href="utauwf.html#utauwfi18" target="diffFile"><code class="keyword">IF</code> (.NOT.wallfunctions) <code class="keyword">THEN</code></a>
<a name="utauwfi20"></a>    <a href="utauwf.html#utauwfi19" target="diffFile"><code class="keyword">RETURN</code></a>
  <a href="utauwf.html#utauwfi18" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="utauwfi21"></a><a href="utauwf.html#utauwfi20" target="diffFile"><code class="comment">! Loop over the viscous subfaces of this block.</code></a>
<a href="utauwf.html#utauwfi20" target="diffFile"><code class="label">viscsubfaces:</code><code class="keyword">DO </code>nn=<code class="constant">1</code>,nviscbocos</a>
<a href="utauwf.html#utauwfi21" target="diffFile"><code class="comment">! Set a bunch of variables depending on the face id to make</code></a>
<a href="utauwf.html#utauwfi21" target="diffFile"><code class="comment">! a generic treatment possible.</code></a>
<a name="utauwfi22"></a>      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="utauwf.html#utauwfi22" target="diffFile">fact = -one</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ss => si(<code class="constant">1</code>, :, :, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">rres => fw(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww2 => w(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww1 => w(<code class="constant">1</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">dd2wall2 => d2wall(<code class="constant">2</code>, :, :)</a>
<a name="utauwfi29"></a>        <a href="utauwf.html#utauwfi21" target="diffFile">rrlv2 => rlv(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">CASE </code>(imax) </a>
<a href="utauwf.html#utauwfi29" target="diffFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf.html#utauwfi29" target="diffFile">fact = one</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ss => si(il, :, :, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">rres => fw(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww2 => w(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww1 => w(ie, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">dd2wall2 => d2wall(il, :, :)</a>
<a name="utauwfi36"></a>        <a href="utauwf.html#utauwfi21" target="diffFile">rrlv2 => rlv(il, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">CASE </code>(jmin) </a>
<a href="utauwf.html#utauwfi36" target="diffFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf.html#utauwfi36" target="diffFile">fact = -one</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ss => sj(:, <code class="constant">1</code>, :, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">rres => fw(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">dd2wall2 => d2wall(:, <code class="constant">2</code>, :)</a>
<a name="utauwfi43"></a>        <a href="utauwf.html#utauwfi21" target="diffFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">CASE </code>(jmax) </a>
<a href="utauwf.html#utauwfi43" target="diffFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf.html#utauwfi43" target="diffFile">fact = one</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ss => sj(:, jl, :, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">rres => fw(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww2 => w(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww1 => w(<code class="constant">1</code>:, je, <code class="constant">1</code>:, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">dd2wall2 => d2wall(:, jl, :)</a>
<a name="utauwfi50"></a>        <a href="utauwf.html#utauwfi21" target="diffFile">rrlv2 => rlv(<code class="constant">1</code>:, jl, <code class="constant">1</code>:)</a>
      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">CASE </code>(kmin) </a>
<a href="utauwf.html#utauwfi50" target="diffFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf.html#utauwfi50" target="diffFile">fact = -one</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ss => sk(:, :, <code class="constant">1</code>, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">rres => fw(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">dd2wall2 => d2wall(:, :, <code class="constant">2</code>)</a>
<a name="utauwfi57"></a>        <a href="utauwf.html#utauwfi21" target="diffFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>)</a>
      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">CASE </code>(kmax) </a>
<a href="utauwf.html#utauwfi57" target="diffFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf.html#utauwfi57" target="diffFile">fact = one</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ss => sk(:, :, kl, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">rres => fw(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, ke, :)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">dd2wall2 => d2wall(:, :, kl)</a>
        <a href="utauwf.html#utauwfi21" target="diffFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, kl)</a>
      <a href="utauwf.html#utauwfi21" target="diffFile"><code class="keyword">END SELECT</code></a>
<a name="utauwfi65"></a><a href="utauwf.html#utauwfi20" target="diffFile"><code class="comment">! Set the pointer for the unit outward normals.</code></a>
      <a href="utauwf.html#utauwfi20" target="diffFile">norm => bcdata(nn)%norm</a>
<a href="utauwf.html#utauwfi65" target="diffFile"><code class="comment">! Loop over the quadrilateral faces of the subface. Note</code></a>
<a href="utauwf.html#utauwfi65" target="diffFile"><code class="comment">! that the nodal range of BCData must be used and not the</code></a>
<a href="utauwf.html#utauwfi65" target="diffFile"><code class="comment">! cell range, because the latter may include the halo's in i</code></a>
<a href="utauwf.html#utauwfi65" target="diffFile"><code class="comment">! and j-direction. The offset +1 is there, because inBeg and</code></a>
<a name="utauwfi66"></a><a href="utauwf.html#utauwfi65" target="diffFile"><code class="comment">! jnBeg refer to nodal ranges and not to cell ranges.</code></a>
<a name="utauwfi67"></a>      <a href="utauwf.html#utauwfi65" target="diffFile"><code class="keyword">DO </code>j=bcdata(nn)%jnbeg+<code class="constant">1</code>,bcdata(nn)%jnend</a>
        <a href="utauwf.html#utauwfi66" target="diffFile"><code class="keyword">DO </code>i=bcdata(nn)%inbeg+<code class="constant">1</code>,bcdata(nn)%inend</a>
<a name="utauwfi68"></a><a href="utauwf.html#utauwfi67" target="diffFile"><code class="comment">! Store the viscous stress tensor a bit easier.</code></a>
<a name="utauwfi69"></a>          <a href="utauwf.html#utauwfi67" target="diffFile">tauxx = viscsubface(nn)%tau(i, j, <code class="constant">1</code>)</a>
<a name="utauwfi70"></a>          <a href="utauwf.html#utauwfi68" target="diffFile">tauyy = viscsubface(nn)%tau(i, j, <code class="constant">2</code>)</a>
<a name="utauwfi71"></a>          <a href="utauwf.html#utauwfi69" target="diffFile">tauzz = viscsubface(nn)%tau(i, j, <code class="constant">3</code>)</a>
<a name="utauwfi72"></a>          <a href="utauwf.html#utauwfi70" target="diffFile">tauxy = viscsubface(nn)%tau(i, j, <code class="constant">4</code>)</a>
<a name="utauwfi73"></a>          <a href="utauwf.html#utauwfi71" target="diffFile">tauxz = viscsubface(nn)%tau(i, j, <code class="constant">5</code>)</a>
          <a href="utauwf.html#utauwfi72" target="diffFile">tauyz = viscsubface(nn)%tau(i, j, <code class="constant">6</code>)</a>
<a href="utauwf.html#utauwfi73" target="diffFile"><code class="comment">! Compute the velocities at the wall face; these are only</code></a>
<a href="utauwf.html#utauwfi73" target="diffFile"><code class="comment">! non-zero for moving a block. Also compute the density,</code></a>
<a href="utauwf.html#utauwfi73" target="diffFile"><code class="comment">! which is needed to compute the wall shear stress via</code></a>
<a name="utauwfi74"></a><a href="utauwf.html#utauwfi73" target="diffFile"><code class="comment">! wall functions.</code></a>
<a name="utauwfi75"></a>          <a href="utauwf.html#utauwfi73" target="diffFile">rbar = half*(ww2(i, j, irho)+ww1(i, j, irho))</a>
<a name="utauwfi76"></a>          <a href="utauwf.html#utauwfi74" target="diffFile">ubar = half*(ww2(i, j, ivx)+ww1(i, j, ivx))</a>
<a name="utauwfi77"></a>          <a href="utauwf.html#utauwfi75" target="diffFile">vbar = half*(ww2(i, j, ivy)+ww1(i, j, ivy))</a>
          <a href="utauwf.html#utauwfi76" target="diffFile">wbar = half*(ww2(i, j, ivz)+ww1(i, j, ivz))</a>
<a href="utauwf.html#utauwfi77" target="diffFile"><code class="comment">! Compute the velocity difference between the internal cell</code></a>
<a name="utauwfi78"></a><a href="utauwf.html#utauwfi77" target="diffFile"><code class="comment">! and the wall.</code></a>
<a name="utauwfi79"></a>          <a href="utauwf.html#utauwfi77" target="diffFile">vx = ww2(i, j, ivx) - ubar</a>
<a name="utauwfi80"></a>          <a href="utauwf.html#utauwfi78" target="diffFile">vy = ww2(i, j, ivy) - vbar</a>
          <a href="utauwf.html#utauwfi79" target="diffFile">vz = ww2(i, j, ivz) - wbar</a>
<a name="utauwfi81"></a><a href="utauwf.html#utauwfi80" target="diffFile"><code class="comment">! Compute the normal velocity of the internal cell.</code></a>
<a name="utauwfi82"></a>          <a href="utauwf.html#utauwfi80" target="diffFile">veln = vx*norm(i, j, <code class="constant">1</code>) + vy*norm(i, j, <code class="constant">2</code>) + vz*norm(i, j, <code class="constant">3</code>)</a>
<a name="utauwfi83"></a>          <a href="utauwf.html#utauwfi81" target="diffFile">velnx = veln*norm(i, j, <code class="constant">1</code>)</a>
<a name="utauwfi84"></a>          <a href="utauwf.html#utauwfi82" target="diffFile">velny = veln*norm(i, j, <code class="constant">2</code>)</a>
          <a href="utauwf.html#utauwfi83" target="diffFile">velnz = veln*norm(i, j, <code class="constant">3</code>)</a>
<a href="utauwf.html#utauwfi84" target="diffFile"><code class="comment">! Compute the tangential velocity, its magnitude and its</code></a>
<a name="utauwfi85"></a><a href="utauwf.html#utauwfi84" target="diffFile"><code class="comment">! unit vector of the internal cell.</code></a>
<a name="utauwfi86"></a>          <a href="utauwf.html#utauwfi84" target="diffFile">veltx = vx - velnx</a>
<a name="utauwfi87"></a>          <a href="utauwf.html#utauwfi85" target="diffFile">velty = vy - velny</a>
<a name="utauwfi88"></a>          <a href="utauwf.html#utauwfi86" target="diffFile">veltz = vz - velnz</a>
<a name="utauwfi89"></a>          <a href="utauwf.html#utauwfi87" target="diffFile">arg1 = veltx**<code class="constant">2 </code>+ velty**<code class="constant">2 </code>+ veltz**<code class="constant">2</code></a>
<a name="utauwfi91"></a>          <a href="utauwf.html#utauwfi88" target="diffFile">y1 = <code class="funcname">SQRT</code>(arg1)</a>
          <a href="utauwf.html#utauwfi89" target="diffFile"><code class="keyword">IF</code> (eps .LT. y1) <code class="keyword">THEN</code></a>
<a name="utauwfi90"></a>            <a href="utauwf.html#utauwfi91" target="diffFile">veltmag = y1</a>
          <a href="utauwf.html#utauwfi89" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="utauwfi92"></a>            <a href="utauwf.html#utauwfi90" target="diffFile">veltmag = eps</a>
<a name="utauwfi93"></a>          <a href="utauwf.html#utauwfi89" target="diffFile"><code class="keyword">END IF</code></a>
<a name="utauwfi94"></a>          <a href="utauwf.html#utauwfi92" target="diffFile">tx = veltx/veltmag</a>
<a name="utauwfi95"></a>          <a href="utauwf.html#utauwfi93" target="diffFile">ty = velty/veltmag</a>
          <a href="utauwf.html#utauwfi94" target="diffFile">tz = veltz/veltmag</a>
<a href="utauwf.html#utauwfi95" target="diffFile"><code class="comment">! Compute some coefficients needed for the transformation</code></a>
<a href="utauwf.html#utauwfi95" target="diffFile"><code class="comment">! between the cartesian frame and the frame defined by the</code></a>
<a href="utauwf.html#utauwfi95" target="diffFile"><code class="comment">! tangential direction (tx,ty,tz) and the normal direction.</code></a>
<a href="utauwf.html#utauwfi95" target="diffFile"><code class="comment">! The minus sign is present, because for this transformation</code></a>
<a href="utauwf.html#utauwfi95" target="diffFile"><code class="comment">! the normal direction should be inward pointing and norm</code></a>
<a name="utauwfi96"></a><a href="utauwf.html#utauwfi95" target="diffFile"><code class="comment">! is outward pointing.</code></a>
<a name="utauwfi97"></a>          <a href="utauwf.html#utauwfi95" target="diffFile">txnx = -(tx*norm(i, j, <code class="constant">1</code>))</a>
<a name="utauwfi98"></a>          <a href="utauwf.html#utauwfi96" target="diffFile">txny = -(tx*norm(i, j, <code class="constant">2</code>))</a>
<a name="utauwfi99"></a>          <a href="utauwf.html#utauwfi97" target="diffFile">txnz = -(tx*norm(i, j, <code class="constant">3</code>))</a>
<a name="utauwfi100"></a>          <a href="utauwf.html#utauwfi98" target="diffFile">tynx = -(ty*norm(i, j, <code class="constant">1</code>))</a>
<a name="utauwfi101"></a>          <a href="utauwf.html#utauwfi99" target="diffFile">tyny = -(ty*norm(i, j, <code class="constant">2</code>))</a>
<a name="utauwfi102"></a>          <a href="utauwf.html#utauwfi100" target="diffFile">tynz = -(ty*norm(i, j, <code class="constant">3</code>))</a>
<a name="utauwfi103"></a>          <a href="utauwf.html#utauwfi101" target="diffFile">tznx = -(tz*norm(i, j, <code class="constant">1</code>))</a>
<a name="utauwfi104"></a>          <a href="utauwf.html#utauwfi102" target="diffFile">tzny = -(tz*norm(i, j, <code class="constant">2</code>))</a>
          <a href="utauwf.html#utauwfi103" target="diffFile">tznz = -(tz*norm(i, j, <code class="constant">3</code>))</a>
<a href="utauwf.html#utauwfi104" target="diffFile"><code class="comment">! Compute the tn component of the wall shear stress</code></a>
<a href="utauwf.html#utauwfi104" target="diffFile"><code class="comment">! tensor. Normally this is the only nonzero shear</code></a>
<a href="utauwf.html#utauwfi104" target="diffFile"><code class="comment">! stress component in the t-n frame.</code></a>
<a name="utauwfi105"></a>          <a href="utauwf.html#utauwfi104" target="diffFile">tautn = tauxx*txnx + tauyy*tyny + tauzz*tznz + tauxy*(txny+<code class="label">&</code></a>
<a href="utauwf.html#utauwfi104" target="diffFile"><code class="label">&            </code>tynx) + tauxz*(txnz+tznx) + tauyz*(tynz+tzny)</a>
<a href="utauwf.html#utauwfi105" target="diffFile"><code class="comment">! Compute the Reynolds number using the velocity, density,</code></a>
<a href="utauwf.html#utauwfi105" target="diffFile"><code class="comment">! laminar viscosity and wall distance. Note that an offset</code></a>
<a href="utauwf.html#utauwfi105" target="diffFile"><code class="comment">! of -1 must be used in dd2Wall2, because the original array</code></a>
<a name="utauwfi106"></a><a href="utauwf.html#utauwfi105" target="diffFile"><code class="comment">! d2Wall starts at 2.</code></a>
<a name="utauwfi107"></a>          <a href="utauwf.html#utauwfi105" target="diffFile">re = ww2(i, j, irho)*veltmag*dd2wall2(i-<code class="constant">1</code>, j-<code class="constant">1</code>)/rrlv2(i, j)</a>
<a name="utauwfi109"></a>          <a href="utauwf.html#utauwfi106" target="diffFile">x1 = <code class="funcname">CURVEUPRE</code>(re)</a>
          <a href="utauwf.html#utauwfi107" target="diffFile"><code class="keyword">IF</code> (x1 .LT. eps) <code class="keyword">THEN</code></a>
<a name="utauwfi108"></a>            <a href="utauwf.html#utauwfi109" target="diffFile">max1 = eps</a>
          <a href="utauwf.html#utauwfi107" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="utauwfi110"></a>            <a href="utauwf.html#utauwfi108" target="diffFile">max1 = x1</a>
          <a href="utauwf.html#utauwfi107" target="diffFile"><code class="keyword">END IF</code></a>
<a href="utauwf.html#utauwfi110" target="diffFile"><code class="comment">! Determine the friction velocity from the table and</code></a>
<a name="utauwfi111"></a><a href="utauwf.html#utauwfi110" target="diffFile"><code class="comment">! compute the wall shear stress from it.</code></a>
<a name="utauwfi112"></a>          <a href="utauwf.html#utauwfi110" target="diffFile">utau = veltmag/max1</a>
          <a href="utauwf.html#utauwfi111" target="diffFile">tauwall = rbar*utau*utau</a>
<a href="utauwf.html#utauwfi112" target="diffFile"><code class="comment">! Compute the correction to the wall shear stress tautn and</code></a>
<a href="utauwf.html#utauwfi112" target="diffFile"><code class="comment">! transform this correction back to the cartesian frame.</code></a>
<a href="utauwf.html#utauwfi112" target="diffFile"><code class="comment">! Take rFilv into account, such that the correction to the</code></a>
<a name="utauwfi113"></a><a href="utauwf.html#utauwfi112" target="diffFile"><code class="comment">! stress tensor is computed correctly.</code></a>
<a name="utauwfi114"></a>          <a href="utauwf.html#utauwfi112" target="diffFile">tautn = rfilv*tauwall - tautn</a>
<a name="utauwfi115"></a>          <a href="utauwf.html#utauwfi113" target="diffFile">tauxx = two*tautn*txnx</a>
<a name="utauwfi116"></a>          <a href="utauwf.html#utauwfi114" target="diffFile">tauyy = two*tautn*tyny</a>
<a name="utauwfi117"></a>          <a href="utauwf.html#utauwfi115" target="diffFile">tauzz = two*tautn*tznz</a>
<a name="utauwfi118"></a>          <a href="utauwf.html#utauwfi116" target="diffFile">tauxy = tautn*(txny+tynx)</a>
<a name="utauwfi119"></a>          <a href="utauwf.html#utauwfi117" target="diffFile">tauxz = tautn*(txnz+tznx)</a>
          <a href="utauwf.html#utauwfi118" target="diffFile">tauyz = tautn*(tynz+tzny)</a>
<a href="utauwf.html#utauwfi119" target="diffFile"><code class="comment">! Compute the correction to the viscous flux at the wall.</code></a>
<a name="utauwfi120"></a>          <a href="utauwf.html#utauwfi119" target="diffFile">fmx = tauxx*ss(i, j, <code class="constant">1</code>) + tauxy*ss(i, j, <code class="constant">2</code>) + tauxz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf.html#utauwfi119" target="diffFile"><code class="label">&            </code>)</a>
<a name="utauwfi121"></a>          <a href="utauwf.html#utauwfi120" target="diffFile">fmy = tauxy*ss(i, j, <code class="constant">1</code>) + tauyy*ss(i, j, <code class="constant">2</code>) + tauyz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf.html#utauwfi120" target="diffFile"><code class="label">&            </code>)</a>
<a name="utauwfi122"></a>          <a href="utauwf.html#utauwfi121" target="diffFile">fmz = tauxz*ss(i, j, <code class="constant">1</code>) + tauyz*ss(i, j, <code class="constant">2</code>) + tauzz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf.html#utauwfi121" target="diffFile"><code class="label">&            </code>)</a>
          <a href="utauwf.html#utauwfi122" target="diffFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*ss(i, j, <code class="constant">1</code>) + (ubar<code class="label">&</code></a>
<a name="utauwfi123"></a><a href="utauwf.html#utauwfi122" target="diffFile"><code class="label">&            </code>*tauxy+vbar*tauyy+wbar*tauyz)*ss(i, j, <code class="constant">2</code>) + (ubar*tauxz+vbar<code class="label">&</code></a>
<a href="utauwf.html#utauwfi122" target="diffFile"><code class="label">&            </code>*tauyz+wbar*tauzz)*ss(i, j, <code class="constant">3</code>)</a>
<a href="utauwf.html#utauwfi123" target="diffFile"><code class="comment">! Add them to the residual. Note that now the factor rFilv</code></a>
<a href="utauwf.html#utauwfi123" target="diffFile"><code class="comment">! is already taken into account via tau. Fact is present to</code></a>
<a name="utauwfi124"></a><a href="utauwf.html#utauwfi123" target="diffFile"><code class="comment">! take inward/outward pointing normals into account</code></a>
<a name="utauwfi125"></a>          <a href="utauwf.html#utauwfi123" target="diffFile">rres(i, j, imx) = rres(i, j, imx) - fact*fmx</a>
<a name="utauwfi126"></a>          <a href="utauwf.html#utauwfi124" target="diffFile">rres(i, j, imy) = rres(i, j, imy) - fact*fmy</a>
<a name="utauwfi127"></a>          <a href="utauwf.html#utauwfi125" target="diffFile">rres(i, j, imz) = rres(i, j, imz) - fact*fmz</a>
          <a href="utauwf.html#utauwfi126" target="diffFile">rres(i, j, irhoe) = rres(i, j, irhoe) - fact*frhoe</a>
<a name="utauwfi128"></a><a href="utauwf.html#utauwfi127" target="diffFile"><code class="comment">! Store the friction velocity for later use.</code></a>
          <a href="utauwf.html#utauwfi127" target="diffFile">viscsubface(nn)%utau(i, j) = utau</a>
<a href="utauwf.html#utauwfi128" target="diffFile"><code class="comment">! Also add the correction to the wall stress tensor.</code></a>
<a name="utauwfi129"></a>          <a href="utauwf.html#utauwfi128" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = viscsubface(nn)%tau(i, j, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="utauwf.html#utauwfi128" target="diffFile"><code class="label">&            </code>tauxx</a>
<a name="utauwfi130"></a>          <a href="utauwf.html#utauwfi129" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = viscsubface(nn)%tau(i, j, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="utauwf.html#utauwfi129" target="diffFile"><code class="label">&            </code>tauyy</a>
<a name="utauwfi131"></a>          <a href="utauwf.html#utauwfi130" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = viscsubface(nn)%tau(i, j, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="utauwf.html#utauwfi130" target="diffFile"><code class="label">&            </code>tauzz</a>
<a name="utauwfi132"></a>          <a href="utauwf.html#utauwfi131" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = viscsubface(nn)%tau(i, j, <code class="constant">4</code>) + <code class="label">&</code></a>
<a href="utauwf.html#utauwfi131" target="diffFile"><code class="label">&            </code>tauxy</a>
<a name="utauwfi133"></a>          <a href="utauwf.html#utauwfi132" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = viscsubface(nn)%tau(i, j, <code class="constant">5</code>) + <code class="label">&</code></a>
<a href="utauwf.html#utauwfi132" target="diffFile"><code class="label">&            </code>tauxz</a>
          <a href="utauwf.html#utauwfi133" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = viscsubface(nn)%tau(i, j, <code class="constant">6</code>) + <code class="label">&</code></a>
<a href="utauwf.html#utauwfi133" target="diffFile"><code class="label">&            </code>tauyz</a>
        <a href="utauwf.html#utauwfi66" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="utauwf.html#utauwfi65" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="utauwf.html#utauwfi20" target="diffFile"><code class="keyword">END DO </code><code class="label">viscsubfaces</code></a>
  <a href="utauwf.html#utauwfi18" target="diffFile"><code class="keyword">END IF</code></a>
<a href="utauwf.html#utauwf" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">UTAUWF</code></a>
</pre>
</body>
