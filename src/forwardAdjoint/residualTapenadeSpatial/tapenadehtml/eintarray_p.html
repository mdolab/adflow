<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="eintarray"></a><a href="eintarray.html#eintarray" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="eintarray.html#eintarray" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="eintarray.html#eintarray" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarray" target="diffFile"><code class="comment">!      ==================================================================</code></a>
<a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">EINTARRAY</code>(<code class="vardecl">rho</code>, <code class="vardecl">p</code>, <code class="vardecl">k</code>, <code class="vardecl">eint</code>, <code class="vardecl">correctfork</code>, <code class="vardecl">kk</code>)</a>
  <a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS</code></a>
  <a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">USE </code><code class="funcname">CONSTANTS</code></a>
  <a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">USE </code><code class="funcname">CPCURVEFITS</code></a>
<a name="eintarrayi0"></a>  <a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE</code></a>
  <a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      * EintArray computes the internal energy per unit mass from the  *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      * given density and pressure (and possibly turbulent energy) for *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      * the given kk elements of the arrays.                           *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      * For a calorically and thermally perfect gas the well-known     *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      * expression is used; for only a thermally perfect gas, cp is a  *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      * function of temperature, curve fits are used and a more        *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      * complex expression is obtained.                                *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!      Subroutine arguments.</code></a>
<a name="eintarrayi1"></a><a href="eintarray.html#eintarrayi0" target="diffFile"><code class="comment">!</code></a>
<a name="eintarrayi2"></a>  <a href="eintarray.html#eintarrayi0" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code><code class="keyword">*</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">rho</code>, <code class="vardecl">p</code>, <code class="vardecl">k</code></a>
<a name="eintarrayi3"></a>  <a href="eintarray.html#eintarrayi1" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code><code class="keyword">*</code><code class="typename">)</code>, <code class="typename">INTENT(OUT) </code>:: <code class="vardecl">eint</code></a>
<a name="eintarrayi4"></a>  <a href="eintarray.html#eintarrayi2" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">correctfork</code></a>
  <a href="eintarray.html#eintarrayi3" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">kk</code></a>
<a href="eintarray.html#eintarrayi4" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarrayi4" target="diffFile"><code class="comment">!      Local parameter.</code></a>
<a name="eintarrayi5"></a><a href="eintarray.html#eintarrayi4" target="diffFile"><code class="comment">!</code></a>
  <a href="eintarray.html#eintarrayi4" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">twothird</code>=<code class="vardecl">two</code>*<code class="vardecl">third</code></a>
<a href="eintarray.html#eintarrayi5" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarrayi5" target="diffFile"><code class="comment">!      Local variables.</code></a>
<a name="eintarrayi6"></a><a href="eintarray.html#eintarrayi5" target="diffFile"><code class="comment">!</code></a>
  <a href="eintarray.html#eintarrayi5" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">nn</code>, <code class="vardecl">mm</code>, <code class="vardecl">ii</code>, <code class="vardecl">start</code></a>
<a name="eintarrayi7"></a>  <a href="eintarray.html#eintarrayi6" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">ovgm1</code>, <code class="vardecl">factk</code>, <code class="vardecl">pp</code>, <code class="vardecl">t</code>, <code class="vardecl">t2</code>, <code class="vardecl">scale</code></a>
  <a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">LOG</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">!</code></a>
<a href="eintarray.html#eintarrayi7" target="diffFile"><code class="comment">! Determine the cp model used in the computation.</code></a>
<a name="eintarrayi8"></a>  <a href="eintarray.html#eintarrayi7" target="diffFile"><code class="keyword">SELECT CASE </code> (cpmodel) </a>
  <a href="eintarray.html#eintarrayi7" target="diffFile"><code class="keyword">CASE </code>(cpconstant) </a>
<a name="eintarrayi9"></a><a href="eintarray.html#eintarrayi8" target="diffFile"><code class="comment">! Abbreviate 1/(gamma -1) a bit easier.</code></a>
    <a href="eintarray.html#eintarrayi8" target="diffFile">ovgm1 = one/(gammaconstant-one)</a>
<a href="eintarray.html#eintarrayi9" target="diffFile"><code class="comment">! Loop over the number of elements of the array and compute</code></a>
<a name="eintarrayi10"></a><a href="eintarray.html#eintarrayi9" target="diffFile"><code class="comment">! the total energy.</code></a>
    <a href="eintarray.html#eintarrayi9" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,kk</a>
<a name="eintarrayi11"></a>      <a href="eintarray.html#eintarrayi10" target="diffFile">eint(i) = ovgm1*p(i)/rho(i)</a>
    <a href="eintarray.html#eintarrayi9" target="diffFile"><code class="keyword">END DO</code></a>
<a href="eintarray.html#eintarrayi11" target="diffFile"><code class="comment">! Second step. Correct the energy in case a turbulent kinetic</code></a>
<a name="eintarrayi12"></a><a href="eintarray.html#eintarrayi11" target="diffFile"><code class="comment">! energy is present.</code></a>
<a name="eintarrayi13"></a>    <a href="eintarray.html#eintarrayi11" target="diffFile"><code class="keyword">IF</code> (correctfork) <code class="keyword">THEN</code></a>
<a name="eintarrayi14"></a>      <a href="eintarray.html#eintarrayi12" target="diffFile">factk = ovgm1*(five*third-gammaconstant)</a>
      <a href="eintarray.html#eintarrayi13" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,kk</a>
        <a href="eintarray.html#eintarrayi14" target="diffFile">eint(i) = eint(i) - factk*k(i)</a>
      <a href="eintarray.html#eintarrayi13" target="diffFile"><code class="keyword">END DO</code></a>
<a name="eintarrayi15"></a>    <a href="eintarray.html#eintarrayi11" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="eintarray.html#eintarrayi7" target="diffFile"><code class="keyword">CASE </code>(cptempcurvefits) </a>
<a href="eintarray.html#eintarrayi15" target="diffFile"><code class="comment">!        ================================================================</code></a>
<a href="eintarray.html#eintarrayi15" target="diffFile"><code class="comment">! Cp as function of the temperature is given via curve fits.</code></a>
<a href="eintarray.html#eintarrayi15" target="diffFile"><code class="comment">! Store a scale factor to compute the nonDimensional</code></a>
<a name="eintarrayi16"></a><a href="eintarray.html#eintarrayi15" target="diffFile"><code class="comment">! internal energy.</code></a>
    <a href="eintarray.html#eintarrayi15" target="diffFile">scale = rgas/tref</a>
<a name="eintarrayi17"></a><a href="eintarray.html#eintarrayi16" target="diffFile"><code class="comment">! Loop over the number of elements of the array</code></a>
    <a href="eintarray.html#eintarrayi16" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,kk</a>
<a name="eintarrayi19"></a><a name="eintarrayi18"></a><a href="eintarray.html#eintarrayi17" target="diffFile"><code class="comment">! Compute the dimensional temperature.</code></a>
<a name="eintarrayi20"></a>      <a href="eintarray.html#eintarrayi17" target="diffFile">pp = p(i)</a>
<a name="eintarrayi21"></a>      <a href="eintarray.html#eintarrayi18" target="diffFile"><code class="keyword">IF</code> (correctfork) </a><a href="eintarray.html#eintarrayi19" target="diffFile">pp = pp - twothird*rho(i)*k(i)</a>
      <a href="eintarray.html#eintarrayi20" target="diffFile">t = tref*pp/(rgas*rho(i))</a>
<a name="eintarrayi22"></a><a href="eintarray.html#eintarrayi21" target="diffFile"><code class="comment">! Determine the case we are having here.</code></a>
      <a href="eintarray.html#eintarrayi21" target="diffFile"><code class="keyword">IF</code> (t .LE. cptrange(<code class="constant">0</code>)) <code class="keyword">THEN</code></a>
<a href="eintarray.html#eintarrayi22" target="diffFile"><code class="comment">! Temperature is less than the smallest temperature</code></a>
<a href="eintarray.html#eintarrayi22" target="diffFile"><code class="comment">! in the curve fits. Use extrapolation using</code></a>
<a name="eintarrayi23"></a><a href="eintarray.html#eintarrayi22" target="diffFile"><code class="comment">! constant cv.</code></a>
<a name="eintarrayi24"></a>        <a href="eintarray.html#eintarrayi22" target="diffFile">eint(i) = scale*(cpeint(<code class="constant">0</code>)+cv0*(t-cptrange(<code class="constant">0</code>)))</a>
      <a href="eintarray.html#eintarrayi21" target="diffFile"><code class="keyword">ELSE </code></a><a href="eintarray.html#eintarrayi23" target="diffFile"><code class="keyword">IF</code> (t .GE. cptrange(cpnparts)) <code class="keyword">THEN</code></a>
<a href="eintarray.html#eintarrayi24" target="diffFile"><code class="comment">! Temperature is larger than the largest temperature</code></a>
<a href="eintarray.html#eintarrayi24" target="diffFile"><code class="comment">! in the curve fits. Use extrapolation using</code></a>
<a href="eintarray.html#eintarrayi24" target="diffFile"><code class="comment">! constant cv.</code></a>
<a name="eintarrayi25"></a>        <a href="eintarray.html#eintarrayi24" target="diffFile">eint(i) = scale*(cpeint(cpnparts)+cvn*(t-cptrange(cpnparts)))</a>
      <a href="eintarray.html#eintarrayi23" target="diffFile"><code class="keyword">ELSE</code></a>
<a href="eintarray.html#eintarrayi25" target="diffFile"><code class="comment">! Temperature is in the curve fit range.</code></a>
<a name="eintarrayi26"></a><a href="eintarray.html#eintarrayi25" target="diffFile"><code class="comment">! First find the valid range.</code></a>
<a name="eintarrayi27"></a>        <a href="eintarray.html#eintarrayi25" target="diffFile">ii = cpnparts</a>
<a name="eintarrayi28"></a>        <a href="eintarray.html#eintarrayi26" target="diffFile">start = <code class="constant">1</code></a>
<a href="eintarray.html#eintarrayi27" target="diffFile"><code class="label">interval:</code><code class="keyword">DO </code></a>
<a name="eintarrayi29"></a><a href="eintarray.html#eintarrayi28" target="diffFile"><code class="comment">! Next guess for the interval.</code></a>
          <a href="eintarray.html#eintarrayi28" target="diffFile">nn = start + ii/<code class="constant">2</code></a>
<a name="eintarrayi30"></a><a href="eintarray.html#eintarrayi29" target="diffFile"><code class="comment">! Determine the situation we are having here.</code></a>
          <a href="eintarray.html#eintarrayi29" target="diffFile"><code class="keyword">IF</code> (t .GT. cptrange(nn)) <code class="keyword">THEN</code></a>
<a href="eintarray.html#eintarrayi30" target="diffFile"><code class="comment">! Temperature is larger than the upper boundary of</code></a>
<a name="eintarrayi31"></a><a href="eintarray.html#eintarrayi30" target="diffFile"><code class="comment">! the current interval. Update the lower boundary.</code></a>
<a name="eintarrayi32"></a>            <a href="eintarray.html#eintarrayi30" target="diffFile">start = nn + <code class="constant">1</code></a>
            <a href="eintarray.html#eintarrayi31" target="diffFile">ii = ii - <code class="constant">1</code></a>
          <a href="eintarray.html#eintarrayi29" target="diffFile"><code class="keyword">ELSE </code></a><a href="eintarray.html#eintarrayi32" target="diffFile"><code class="keyword">IF</code> (t .GE. cptrange(nn-<code class="constant">1</code>)) <code class="keyword">THEN</code></a>
<a name="eintarrayi33"></a>            <a href="eintarray.html#eintarrayi32" target="diffFile"><code class="keyword">GOTO </code><code class="label">100</code></a>
          <a href="eintarray.html#eintarrayi29" target="diffFile"><code class="keyword">END IF</code></a>
<a href="eintarray.html#eintarrayi33" target="diffFile"><code class="comment">! This is the correct range. Exit the do-loop.</code></a>
<a href="eintarray.html#eintarrayi33" target="diffFile"><code class="comment">! Modify ii for the next branch to search.</code></a>
          <a href="eintarray.html#eintarrayi33" target="diffFile">ii = ii/<code class="constant">2</code></a>
        <a href="eintarray.html#eintarrayi27" target="diffFile"><code class="keyword">END DO </code><code class="label">interval</code></a>
<a name="eintarrayi34"></a><a href="eintarray.html#eintarrayi23" target="diffFile"><code class="comment">! Nn contains the correct curve fit interval.</code></a>
<a name="eintarrayi35"></a><a href="eintarray.html#eintarrayi23" target="diffFile"><code class="comment">! Integrate cv to compute eint.</code></a>
<a name="p1"></a><a name="eintarrayi36"></a> <a href="eintarray.html#eintarrayi23" target="diffFile"><code class="label">100 </code></a>   <a href="eintarray.html#eintarrayi34" target="diffFile">eint(i) = cptempfit(nn)%eint0 - t</a>
<a name="eintarrayi37"></a>        <a href="eintarray.html#eintarrayi35" target="diffFile"><code class="keyword">DO </code>ii=<code class="constant">1</code>,cptempfit(nn)%nterm</a>
          <a href="eintarray.html#eintarrayi36" target="diffFile"><code class="keyword">IF</code> (</a><a href="msg.html#p1" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="eintarray.html#eintarrayi36" target="diffFile">cptempfit(nn)%exponents(ii) .EQ. -<code class="constant">1_intType</code>) <code class="keyword">THEN</code></a>
<a name="eintarrayi38"></a>            <a href="eintarray.html#eintarrayi37" target="diffFile">eint(i) = eint(i) + cptempfit(nn)%constants(ii)*<code class="funcname">LOG</code>(t)</a>
<a name="eintarrayi39"></a>          <a href="eintarray.html#eintarrayi36" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="eintarrayi40"></a>            <a href="eintarray.html#eintarrayi38" target="diffFile">mm = cptempfit(nn)%exponents(ii) + <code class="constant">1</code></a>
            <a href="eintarray.html#eintarrayi39" target="diffFile">t2 = t**mm</a>
            <a href="eintarray.html#eintarrayi40" target="diffFile">eint(i) = eint(i) + cptempfit(nn)%constants(ii)*t2/mm</a>
<a name="eintarrayi41"></a>          <a href="eintarray.html#eintarrayi36" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="eintarray.html#eintarrayi35" target="diffFile"><code class="keyword">END DO</code></a>
<a name="eintarrayi42"></a>        <a href="eintarray.html#eintarrayi41" target="diffFile">eint(i) = scale*eint(i)</a>
<a name="eintarrayi43"></a>      <a href="eintarray.html#eintarrayi21" target="diffFile"><code class="keyword">END IF</code></a>
<a href="eintarray.html#eintarrayi42" target="diffFile"><code class="comment">! Add the turbulent energy if needed.</code></a>
      <a href="eintarray.html#eintarrayi42" target="diffFile"><code class="keyword">IF</code> (correctfork) </a><a href="eintarray.html#eintarrayi43" target="diffFile">eint(i) = eint(i) + k(i)</a>
    <a href="eintarray.html#eintarrayi16" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="eintarray.html#eintarrayi7" target="diffFile"><code class="keyword">END SELECT</code></a>
<a href="eintarray.html#eintarray" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">EINTARRAY</code></a>
</pre>
</body>
