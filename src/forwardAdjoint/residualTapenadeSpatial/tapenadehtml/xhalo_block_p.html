<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="xhalo_block"></a><a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      * File:          xhalo.f90                                       *</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      * Author:        Edwin van der Weide,C.A.(Sandy) Mader            *</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      * Starting date: 02-23-2003                                      *</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      * Last modified: 08-12-2009                                      *</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">XHALO_BLOCK</code>(<code class="vardecl">level</code>)</a>
  <a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
  <a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL</code></a>
  <a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">COMMUNICATION</code></a>
  <a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">BCTYPES</code></a>
  <a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      else if (BCType(mm) == EulerWall .or. BCType(nn) == FarField) then</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         ! Do a generic extrapolation</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         select case (BCFaceID(mm))</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         case (iMin)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            x0 => x(0,:,:,:); x1 => x(1,:,:,:); x2 => x(2,:,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         case (iMax)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            x0 => x(ie,:,:,:); x1 => x(il,:,:,:); x2 => x(nx,:,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         case (jMin)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            x0 => x(:,0,:,:); x1 => x(:,1,:,:); x2 => x(:,2,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         case (jMax)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            x0 => x(:,je,:,:); x1 => x(:,jl,:,:); x2 => x(:,ny,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         case (kMin)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            x0 => x(:,:,0,:); x1 => x(:,:,1,:); x2 => x(:,:,2,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         case (kMax)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            x0 => x(:,:,ke,:); x1 => x(:,:,kl,:); x2 => x(:,:,nz,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         end select</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         if(iBeg == 1)     iBeg = 0</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         if(iEnd == iiMax) iEnd = iiMax + 1</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         if(jBeg == 1)     jBeg = 0</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         if(jEnd == jjMax) jEnd = jjMax + 1</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         do j=jBeg,jEnd</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            do i=iBeg,iEnd</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!               x0(i+1,j+1,1) = two*x1(i+1,j+1,1) - x2(i+1,j+1,1)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!               x0(i+1,j+1,2) = two*x1(i+1,j+1,2) - x2(i+1,j+1,2)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!               x0(i+1,j+1,3) = two*x1(i+1,j+1,3) - x2(i+1,j+1,3)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            end do</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         end do</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!   do l=1,3</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      do k=0,ke</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         do j=0,je</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            do i=0,ie</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!               if (x_peturb(i,j,k,l)) then</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!                  x(i,j,k,l) = x_temp(i,j,k,l)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!               end if</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            end do</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         end do</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      end do</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!   end do</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!  loop1to1: do mm=1,n1to1</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      select case (BCFaceID(mm))</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      case (iMin)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x0 => x(0,:,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x1 => x_temp(0,:,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      case (iMax)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x0 => x(ie,:,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x1 => x_temp(ie,:,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      case (jMin)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x0 => x(:,0,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x1 => x_temp(:,0,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      case (jMax)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x0 => x(:,je,:,:);</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x1 => x_temp(:,je,:,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      case (kMin)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x0 => x(:,:,0,:);</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x1 => x_temp(:,:,0,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      case (kMax)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x0 => x(:,:,ke,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         x1 => x_temp(:,:,ke,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      end select</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      ! Basically we want to copy the RIGHT X back into X. This is</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      ! basically the same as the exchange coordinates execpt we</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      ! already had the right halos on input</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      if(iBeg == 1)     iBeg = 0</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      if(iEnd == iiMax) iEnd = iiMax + 1</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      if(jBeg == 1)     jBeg = 0</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      if(jEnd == jjMax) jEnd = jjMax + 1</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      ! Loop over the nodes of the subface and set the</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      ! corresponding halo coordinates.</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      print *,ibeg,iend,jbeg,jend</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      do j=jBeg,jEnd</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         do i=iBeg,iEnd</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!            x0(i+1,j+1,:) = x1(i+1,j+1,:)</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!         end do</code></a>
<a name="xhalo_blocki0"></a><a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!      end do</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="comment">!   end do loop1to1</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!,x_peturb)</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      * xhalo determines the coordinates of the nodal halo's.          *</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      * First it sets all halo coordinates by simple extrapolation,    *</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      * then the symmetry planes are treated (also the unit normal of  *</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      * symmetry planes are determined) and finally an exchange is     *</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      * made for the internal halo's.                                  *</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!      Subroutine arguments.</code></a>
<a name="xhalo_blocki1"></a><a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="comment">!</code></a>
  <a href="xhalo_block.html#xhalo_blocki0" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">level</code></a>
<a href="xhalo_block.html#xhalo_blocki1" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki1" target="diffFile"><code class="comment">!      Local variables.</code></a>
<a name="xhalo_blocki2"></a><a href="xhalo_block.html#xhalo_blocki1" target="diffFile"><code class="comment">!</code></a>
<a name="xhalo_blocki3"></a>  <a href="xhalo_block.html#xhalo_blocki1" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">nn</code>, <code class="vardecl">mm</code>, <code class="vardecl">sps</code>, <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">ii</code>, <code class="vardecl">jj</code>, <code class="vardecl">l</code></a>
  <a href="xhalo_block.html#xhalo_blocki2" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">ibeg</code>, <code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>, <code class="vardecl">jend</code>, <code class="vardecl">iimax</code>, <code class="vardecl">jjmax</code></a>
<a name="xhalo_blocki4"></a><a href="xhalo_block.html#xhalo_blocki3" target="diffFile"><code class="comment">!integer(kind=intType) :: iBeg2, iEnd2, jBeg2, jEnd2</code></a>
<a name="xhalo_blocki5"></a>  <a href="xhalo_block.html#xhalo_blocki3" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">x0</code>, <code class="vardecl">x1</code>, <code class="vardecl">x2</code></a>
<a name="xhalo_blocki6"></a>  <a href="xhalo_block.html#xhalo_blocki4" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">length</code>, <code class="vardecl">dot</code></a>
<a name="xhalo_blocki7"></a>  <a href="xhalo_block.html#xhalo_blocki5" target="diffFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">imininternal</code>, <code class="vardecl">jmininternal</code>, <code class="vardecl">kmininternal</code></a>
<a name="xhalo_blocki8"></a>  <a href="xhalo_block.html#xhalo_blocki6" target="diffFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">imaxinternal</code>, <code class="vardecl">jmaxinternal</code>, <code class="vardecl">kmaxinternal</code></a>
  <a href="xhalo_block.html#xhalo_blocki7" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code><code class="constant">3</code><code class="typename">) </code>:: <code class="vardecl">v1</code>, <code class="vardecl">v2</code>, <code class="vardecl">norm</code></a>
<a name="xhalo_blocki9"></a>  <a href="xhalo_block.html#xhalo_blocki8" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!real(kind=realType) :: x_temp(0:ie,0:je,0:ke,3)</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!logical :: x_peturb(0:ie,0:je,0:ke,3)</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          * Extrapolation of the coordinates. First extrapolation in   *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          * i-direction, without halo's, followed by extrapolation in  *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          * j-direction, with i-halo's and finally extrapolation in    *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          * k-direction, with both i- and j-halo's. In this way also   *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          * the indirect halo's get a value, albeit a bit arbitrary.   *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">! Make a copy of X</code></a>
<a name="xhalo_blocki10"></a><a href="xhalo_block.html#xhalo_blocki9" target="diffFile"><code class="comment">!x_temp = x</code></a>
<a name="xhalo_blocki11"></a>  <a href="xhalo_block.html#xhalo_blocki9" target="diffFile">imininternal = <code class="constant">.false.</code></a>
<a name="xhalo_blocki12"></a>  <a href="xhalo_block.html#xhalo_blocki10" target="diffFile">jmininternal = <code class="constant">.false.</code></a>
<a name="xhalo_blocki13"></a>  <a href="xhalo_block.html#xhalo_blocki11" target="diffFile">kmininternal = <code class="constant">.false.</code></a>
<a name="xhalo_blocki14"></a>  <a href="xhalo_block.html#xhalo_blocki12" target="diffFile">imaxinternal = <code class="constant">.false.</code></a>
<a name="xhalo_blocki15"></a>  <a href="xhalo_block.html#xhalo_blocki13" target="diffFile">jmaxinternal = <code class="constant">.false.</code></a>
  <a href="xhalo_block.html#xhalo_blocki14" target="diffFile">kmaxinternal = <code class="constant">.false.</code></a>
<a name="xhalo_blocki16"></a><a href="xhalo_block.html#xhalo_blocki15" target="diffFile"><code class="comment">!Bocos</code></a>
<a name="xhalo_blocki17"></a><a href="xhalo_block.html#xhalo_blocki15" target="diffFile"><code class="label">loopsubface:</code><code class="keyword">DO </code>mm=<code class="constant">1</code>,nsubface</a>
    <a href="xhalo_block.html#xhalo_blocki16" target="diffFile"><code class="keyword">IF</code> (bctype(mm) .EQ. b2bmatch) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki18"></a>      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">SELECT CASE </code> (bcfaceid(mm)) </a>
      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">CASE </code>(imin) </a>
<a name="xhalo_blocki19"></a>        <a href="xhalo_block.html#xhalo_blocki18" target="diffFile">imininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">CASE </code>(imax) </a>
<a name="xhalo_blocki20"></a>        <a href="xhalo_block.html#xhalo_blocki19" target="diffFile">imaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">CASE </code>(jmin) </a>
<a name="xhalo_blocki21"></a>        <a href="xhalo_block.html#xhalo_blocki20" target="diffFile">jmininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">CASE </code>(jmax) </a>
<a name="xhalo_blocki22"></a>        <a href="xhalo_block.html#xhalo_blocki21" target="diffFile">jmaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">CASE </code>(kmin) </a>
<a name="xhalo_blocki23"></a>        <a href="xhalo_block.html#xhalo_blocki22" target="diffFile">kmininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">CASE </code>(kmax) </a>
        <a href="xhalo_block.html#xhalo_blocki23" target="diffFile">kmaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block.html#xhalo_blocki17" target="diffFile"><code class="keyword">END SELECT</code></a>
<a name="xhalo_blocki24"></a>    <a href="xhalo_block.html#xhalo_blocki16" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="xhalo_block.html#xhalo_blocki15" target="diffFile"><code class="keyword">END DO </code><code class="label">loopsubface</code></a>
<a name="xhalo_blocki25"></a><a href="xhalo_block.html#xhalo_blocki24" target="diffFile"><code class="comment">! Extrapolation in i-direction.</code></a>
<a name="xhalo_blocki26"></a>  <a href="xhalo_block.html#xhalo_blocki24" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kl</a>
<a name="xhalo_blocki27"></a>    <a href="xhalo_block.html#xhalo_blocki25" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
<a name="xhalo_blocki28"></a>      <a href="xhalo_block.html#xhalo_blocki26" target="diffFile"><code class="keyword">IF</code> (.NOT.imininternal) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki29"></a>        <a href="xhalo_block.html#xhalo_blocki27" target="diffFile">x(<code class="constant">0</code>, j, k, <code class="constant">1</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">1</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki28" target="diffFile">x(<code class="constant">0</code>, j, k, <code class="constant">2</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">2</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">2</code>)</a>
<a name="xhalo_blocki30"></a>        <a href="xhalo_block.html#xhalo_blocki29" target="diffFile">x(<code class="constant">0</code>, j, k, <code class="constant">3</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">3</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">3</code>)</a>
<a name="xhalo_blocki31"></a>      <a href="xhalo_block.html#xhalo_blocki26" target="diffFile"><code class="keyword">END IF</code></a>
<a name="xhalo_blocki32"></a>      <a href="xhalo_block.html#xhalo_blocki30" target="diffFile"><code class="keyword">IF</code> (.NOT.imaxinternal) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki33"></a>        <a href="xhalo_block.html#xhalo_blocki31" target="diffFile">x(ie, j, k, <code class="constant">1</code>) = two*x(il, j, k, <code class="constant">1</code>) - x(nx, j, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki32" target="diffFile">x(ie, j, k, <code class="constant">2</code>) = two*x(il, j, k, <code class="constant">2</code>) - x(nx, j, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki33" target="diffFile">x(ie, j, k, <code class="constant">3</code>) = two*x(il, j, k, <code class="constant">3</code>) - x(nx, j, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block.html#xhalo_blocki30" target="diffFile"><code class="keyword">END IF</code></a>
<a name="xhalo_blocki34"></a>    <a href="xhalo_block.html#xhalo_blocki25" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block.html#xhalo_blocki24" target="diffFile"><code class="keyword">END DO</code></a>
<a name="xhalo_blocki35"></a><a href="xhalo_block.html#xhalo_blocki34" target="diffFile"><code class="comment">! Extrapolation in j-direction.</code></a>
<a name="xhalo_blocki36"></a>  <a href="xhalo_block.html#xhalo_blocki34" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kl</a>
<a name="xhalo_blocki37"></a>    <a href="xhalo_block.html#xhalo_blocki35" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ie</a>
<a name="xhalo_blocki38"></a>      <a href="xhalo_block.html#xhalo_blocki36" target="diffFile"><code class="keyword">IF</code> (.NOT.jmininternal) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki39"></a>        <a href="xhalo_block.html#xhalo_blocki37" target="diffFile">x(i, <code class="constant">0</code>, k, <code class="constant">1</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">1</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki38" target="diffFile">x(i, <code class="constant">0</code>, k, <code class="constant">2</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">2</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">2</code>)</a>
<a name="xhalo_blocki40"></a>        <a href="xhalo_block.html#xhalo_blocki39" target="diffFile">x(i, <code class="constant">0</code>, k, <code class="constant">3</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">3</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">3</code>)</a>
<a name="xhalo_blocki41"></a>      <a href="xhalo_block.html#xhalo_blocki36" target="diffFile"><code class="keyword">END IF</code></a>
<a name="xhalo_blocki42"></a>      <a href="xhalo_block.html#xhalo_blocki40" target="diffFile"><code class="keyword">IF</code> (.NOT.jmaxinternal) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki43"></a>        <a href="xhalo_block.html#xhalo_blocki41" target="diffFile">x(i, je, k, <code class="constant">1</code>) = two*x(i, jl, k, <code class="constant">1</code>) - x(i, ny, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki42" target="diffFile">x(i, je, k, <code class="constant">2</code>) = two*x(i, jl, k, <code class="constant">2</code>) - x(i, ny, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki43" target="diffFile">x(i, je, k, <code class="constant">3</code>) = two*x(i, jl, k, <code class="constant">3</code>) - x(i, ny, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block.html#xhalo_blocki40" target="diffFile"><code class="keyword">END IF</code></a>
<a name="xhalo_blocki44"></a>    <a href="xhalo_block.html#xhalo_blocki35" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block.html#xhalo_blocki34" target="diffFile"><code class="keyword">END DO</code></a>
<a name="xhalo_blocki45"></a><a href="xhalo_block.html#xhalo_blocki44" target="diffFile"><code class="comment">! Extrapolation in k-direction.</code></a>
<a name="xhalo_blocki46"></a>  <a href="xhalo_block.html#xhalo_blocki44" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">0</code>,je</a>
<a name="xhalo_blocki47"></a>    <a href="xhalo_block.html#xhalo_blocki45" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ie</a>
<a name="xhalo_blocki48"></a>      <a href="xhalo_block.html#xhalo_blocki46" target="diffFile"><code class="keyword">IF</code> (.NOT.kmininternal) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki49"></a>        <a href="xhalo_block.html#xhalo_blocki47" target="diffFile">x(i, j, <code class="constant">0</code>, <code class="constant">1</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">1</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki48" target="diffFile">x(i, j, <code class="constant">0</code>, <code class="constant">2</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">2</code>)</a>
<a name="xhalo_blocki50"></a>        <a href="xhalo_block.html#xhalo_blocki49" target="diffFile">x(i, j, <code class="constant">0</code>, <code class="constant">3</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">3</code>)</a>
<a name="xhalo_blocki51"></a>      <a href="xhalo_block.html#xhalo_blocki46" target="diffFile"><code class="keyword">END IF</code></a>
<a name="xhalo_blocki52"></a>      <a href="xhalo_block.html#xhalo_blocki50" target="diffFile"><code class="keyword">IF</code> (.NOT.kmaxinternal) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki53"></a>        <a href="xhalo_block.html#xhalo_blocki51" target="diffFile">x(i, j, ke, <code class="constant">1</code>) = two*x(i, j, kl, <code class="constant">1</code>) - x(i, j, nz, <code class="constant">1</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki52" target="diffFile">x(i, j, ke, <code class="constant">2</code>) = two*x(i, j, kl, <code class="constant">2</code>) - x(i, j, nz, <code class="constant">2</code>)</a>
        <a href="xhalo_block.html#xhalo_blocki53" target="diffFile">x(i, j, ke, <code class="constant">3</code>) = two*x(i, j, kl, <code class="constant">3</code>) - x(i, j, nz, <code class="constant">3</code>)</a>
      <a href="xhalo_block.html#xhalo_blocki50" target="diffFile"><code class="keyword">END IF</code></a>
<a name="xhalo_blocki54"></a>    <a href="xhalo_block.html#xhalo_blocki45" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block.html#xhalo_blocki44" target="diffFile"><code class="keyword">END DO</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!          * Mirror the halo coordinates adjacent to the symmetry       *</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!          * planes                                                     *</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">!</code></a>
<a name="xhalo_blocki55"></a><a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="comment">! Loop over boundary subfaces.</code></a>
<a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="label">loopbocos:</code><code class="keyword">DO </code>mm=<code class="constant">1</code>,nbocos</a>
<a href="xhalo_block.html#xhalo_blocki55" target="diffFile"><code class="comment">! The actual correction of the coordinates only takes</code></a>
<a name="xhalo_blocki56"></a><a href="xhalo_block.html#xhalo_blocki55" target="diffFile"><code class="comment">! place for symmetry planes.</code></a>
    <a href="xhalo_block.html#xhalo_blocki55" target="diffFile"><code class="keyword">IF</code> (bctype(mm) .EQ. symm) <code class="keyword">THEN</code></a>
<a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="comment">! Set some variables, depending on the block face on</code></a>
<a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="comment">! which the subface is located.</code></a>
<a name="xhalo_blocki57"></a>      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">SELECT CASE </code> (bcfaceid(mm)) </a>
<a name="xhalo_blocki58"></a>      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">CASE </code>(imin) </a>
<a name="xhalo_blocki59"></a>        <a href="xhalo_block.html#xhalo_blocki57" target="diffFile">ibeg = jnbeg(mm)</a>
<a name="xhalo_blocki60"></a>        <a href="xhalo_block.html#xhalo_blocki58" target="diffFile">iend = jnend(mm)</a>
<a name="xhalo_blocki61"></a>        <a href="xhalo_block.html#xhalo_blocki59" target="diffFile">iimax = jl</a>
<a name="xhalo_blocki62"></a>        <a href="xhalo_block.html#xhalo_blocki60" target="diffFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki61" target="diffFile">jend = knend(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki62" target="diffFile">jjmax = kl</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x0 => x(<code class="constant">0</code>, :, :, :)</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x1 => x(<code class="constant">1</code>, :, :, :)</a>
<a name="xhalo_blocki66"></a>        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x2 => x(<code class="constant">2</code>, :, :, :)</a>
<a name="xhalo_blocki67"></a>      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">CASE </code>(imax) </a>
<a name="xhalo_blocki68"></a>        <a href="xhalo_block.html#xhalo_blocki66" target="diffFile">ibeg = jnbeg(mm)</a>
<a name="xhalo_blocki69"></a>        <a href="xhalo_block.html#xhalo_blocki67" target="diffFile">iend = jnend(mm)</a>
<a name="xhalo_blocki70"></a>        <a href="xhalo_block.html#xhalo_blocki68" target="diffFile">iimax = jl</a>
<a name="xhalo_blocki71"></a>        <a href="xhalo_block.html#xhalo_blocki69" target="diffFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki70" target="diffFile">jend = knend(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki71" target="diffFile">jjmax = kl</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x0 => x(ie, :, :, :)</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x1 => x(il, :, :, :)</a>
<a name="xhalo_blocki75"></a>        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x2 => x(nx, :, :, :)</a>
<a name="xhalo_blocki76"></a>      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">CASE </code>(jmin) </a>
<a name="xhalo_blocki77"></a>        <a href="xhalo_block.html#xhalo_blocki75" target="diffFile">ibeg = inbeg(mm)</a>
<a name="xhalo_blocki78"></a>        <a href="xhalo_block.html#xhalo_blocki76" target="diffFile">iend = inend(mm)</a>
<a name="xhalo_blocki79"></a>        <a href="xhalo_block.html#xhalo_blocki77" target="diffFile">iimax = il</a>
<a name="xhalo_blocki80"></a>        <a href="xhalo_block.html#xhalo_blocki78" target="diffFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki79" target="diffFile">jend = knend(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki80" target="diffFile">jjmax = kl</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x0 => x(:, <code class="constant">0</code>, :, :)</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x1 => x(:, <code class="constant">1</code>, :, :)</a>
<a name="xhalo_blocki84"></a>        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x2 => x(:, <code class="constant">2</code>, :, :)</a>
<a name="xhalo_blocki85"></a>      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">CASE </code>(jmax) </a>
<a name="xhalo_blocki86"></a>        <a href="xhalo_block.html#xhalo_blocki84" target="diffFile">ibeg = inbeg(mm)</a>
<a name="xhalo_blocki87"></a>        <a href="xhalo_block.html#xhalo_blocki85" target="diffFile">iend = inend(mm)</a>
<a name="xhalo_blocki88"></a>        <a href="xhalo_block.html#xhalo_blocki86" target="diffFile">iimax = il</a>
<a name="xhalo_blocki89"></a>        <a href="xhalo_block.html#xhalo_blocki87" target="diffFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki88" target="diffFile">jend = knend(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki89" target="diffFile">jjmax = kl</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x0 => x(:, je, :, :)</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x1 => x(:, jl, :, :)</a>
<a name="xhalo_blocki93"></a>        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x2 => x(:, ny, :, :)</a>
<a name="xhalo_blocki94"></a>      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">CASE </code>(kmin) </a>
<a name="xhalo_blocki95"></a>        <a href="xhalo_block.html#xhalo_blocki93" target="diffFile">ibeg = inbeg(mm)</a>
<a name="xhalo_blocki96"></a>        <a href="xhalo_block.html#xhalo_blocki94" target="diffFile">iend = inend(mm)</a>
<a name="xhalo_blocki97"></a>        <a href="xhalo_block.html#xhalo_blocki95" target="diffFile">iimax = il</a>
<a name="xhalo_blocki98"></a>        <a href="xhalo_block.html#xhalo_blocki96" target="diffFile">jbeg = jnbeg(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki97" target="diffFile">jend = jnend(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki98" target="diffFile">jjmax = jl</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x0 => x(:, :, <code class="constant">0</code>, :)</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x1 => x(:, :, <code class="constant">1</code>, :)</a>
<a name="xhalo_blocki102"></a>        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x2 => x(:, :, <code class="constant">2</code>, :)</a>
<a name="xhalo_blocki103"></a>      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">CASE </code>(kmax) </a>
<a name="xhalo_blocki104"></a>        <a href="xhalo_block.html#xhalo_blocki102" target="diffFile">ibeg = inbeg(mm)</a>
<a name="xhalo_blocki105"></a>        <a href="xhalo_block.html#xhalo_blocki103" target="diffFile">iend = inend(mm)</a>
<a name="xhalo_blocki106"></a>        <a href="xhalo_block.html#xhalo_blocki104" target="diffFile">iimax = il</a>
<a name="xhalo_blocki107"></a>        <a href="xhalo_block.html#xhalo_blocki105" target="diffFile">jbeg = jnbeg(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki106" target="diffFile">jend = jnend(mm)</a>
        <a href="xhalo_block.html#xhalo_blocki107" target="diffFile">jjmax = jl</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x0 => x(:, :, ke, :)</a>
        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x1 => x(:, :, kl, :)</a>
<a name="xhalo_blocki111"></a>        <a href="xhalo_block.html#xhalo_blocki56" target="diffFile">x2 => x(:, :, nz, :)</a>
      <a href="xhalo_block.html#xhalo_blocki56" target="diffFile"><code class="keyword">END SELECT</code></a>
<a href="xhalo_block.html#xhalo_blocki111" target="diffFile"><code class="comment">! Determine the vector from the lower left corner to</code></a>
<a href="xhalo_block.html#xhalo_blocki111" target="diffFile"><code class="comment">! the upper right corner. Due to the usage of pointers</code></a>
<a href="xhalo_block.html#xhalo_blocki111" target="diffFile"><code class="comment">! an offset of +1 must be used, because the original</code></a>
<a name="xhalo_blocki112"></a><a href="xhalo_block.html#xhalo_blocki111" target="diffFile"><code class="comment">! array x start at 0.</code></a>
<a name="xhalo_blocki113"></a>      <a href="xhalo_block.html#xhalo_blocki111" target="diffFile">v1(<code class="constant">1</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="xhalo_blocki114"></a>      <a href="xhalo_block.html#xhalo_blocki112" target="diffFile">v1(<code class="constant">2</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>)</a>
      <a href="xhalo_block.html#xhalo_blocki113" target="diffFile">v1(<code class="constant">3</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block.html#xhalo_blocki114" target="diffFile"><code class="comment">! And the vector from the upper left corner to the</code></a>
<a name="xhalo_blocki115"></a><a href="xhalo_block.html#xhalo_blocki114" target="diffFile"><code class="comment">! lower right corner.</code></a>
<a name="xhalo_blocki116"></a>      <a href="xhalo_block.html#xhalo_blocki114" target="diffFile">v2(<code class="constant">1</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="xhalo_blocki117"></a>      <a href="xhalo_block.html#xhalo_blocki115" target="diffFile">v2(<code class="constant">2</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>)</a>
      <a href="xhalo_block.html#xhalo_blocki116" target="diffFile">v2(<code class="constant">3</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block.html#xhalo_blocki117" target="diffFile"><code class="comment">! Determine the normal of the face by taking the cross</code></a>
<a name="xhalo_blocki118"></a><a href="xhalo_block.html#xhalo_blocki117" target="diffFile"><code class="comment">! product of v1 and v2 and add it to norm.</code></a>
<a name="xhalo_blocki119"></a>      <a href="xhalo_block.html#xhalo_blocki117" target="diffFile">norm(<code class="constant">1</code>) = v1(<code class="constant">2</code>)*v2(<code class="constant">3</code>) - v1(<code class="constant">3</code>)*v2(<code class="constant">2</code>)</a>
<a name="xhalo_blocki120"></a>      <a href="xhalo_block.html#xhalo_blocki118" target="diffFile">norm(<code class="constant">2</code>) = v1(<code class="constant">3</code>)*v2(<code class="constant">1</code>) - v1(<code class="constant">1</code>)*v2(<code class="constant">3</code>)</a>
      <a href="xhalo_block.html#xhalo_blocki119" target="diffFile">norm(<code class="constant">3</code>) = v1(<code class="constant">1</code>)*v2(<code class="constant">2</code>) - v1(<code class="constant">2</code>)*v2(<code class="constant">1</code>)</a>
<a href="xhalo_block.html#xhalo_blocki120" target="diffFile"><code class="comment">! Compute the length of the normal and test if this is</code></a>
<a href="xhalo_block.html#xhalo_blocki120" target="diffFile"><code class="comment">! larger than eps. If this is the case this means that</code></a>
<a href="xhalo_block.html#xhalo_blocki120" target="diffFile"><code class="comment">! it is a nonsingular subface and the coordinates are</code></a>
<a name="xhalo_blocki121"></a><a href="xhalo_block.html#xhalo_blocki120" target="diffFile"><code class="comment">! corrected.</code></a>
<a name="xhalo_blocki122"></a>      <a href="xhalo_block.html#xhalo_blocki120" target="diffFile">arg1 = norm(<code class="constant">1</code>)**<code class="constant">2 </code>+ norm(<code class="constant">2</code>)**<code class="constant">2 </code>+ norm(<code class="constant">3</code>)**<code class="constant">2</code></a>
<a name="xhalo_blocki123"></a>      <a href="xhalo_block.html#xhalo_blocki121" target="diffFile">length = <code class="funcname">SQRT</code>(arg1)</a>
      <a href="xhalo_block.html#xhalo_blocki122" target="diffFile"><code class="keyword">IF</code> (length .GT. eps) <code class="keyword">THEN</code></a>
<a name="xhalo_blocki124"></a><a href="xhalo_block.html#xhalo_blocki123" target="diffFile"><code class="comment">! Compute the unit normal of the subface.</code></a>
<a name="xhalo_blocki125"></a>        <a href="xhalo_block.html#xhalo_blocki123" target="diffFile">norm(<code class="constant">1</code>) = norm(<code class="constant">1</code>)/length</a>
<a name="xhalo_blocki126"></a>        <a href="xhalo_block.html#xhalo_blocki124" target="diffFile">norm(<code class="constant">2</code>) = norm(<code class="constant">2</code>)/length</a>
        <a href="xhalo_block.html#xhalo_blocki125" target="diffFile">norm(<code class="constant">3</code>) = norm(<code class="constant">3</code>)/length</a>
<a href="xhalo_block.html#xhalo_blocki126" target="diffFile"><code class="comment">! Add an overlap to the symmetry subface if the</code></a>
<a name="xhalo_blocki127"></a><a href="xhalo_block.html#xhalo_blocki126" target="diffFile"><code class="comment">! boundaries coincide with the block boundaries.</code></a>
<a name="xhalo_blocki129"></a><a name="xhalo_blocki128"></a><a href="xhalo_block.html#xhalo_blocki126" target="diffFile"><code class="comment">! This way the indirect halo's are treated properly.</code></a>
<a name="xhalo_blocki131"></a><a name="xhalo_blocki130"></a>        <a href="xhalo_block.html#xhalo_blocki126" target="diffFile"><code class="keyword">IF</code> (ibeg .EQ. <code class="constant">1</code>) </a><a href="xhalo_block.html#xhalo_blocki127" target="diffFile">ibeg = <code class="constant">0</code></a>
<a name="xhalo_blocki133"></a><a name="xhalo_blocki132"></a>        <a href="xhalo_block.html#xhalo_blocki128" target="diffFile"><code class="keyword">IF</code> (iend .EQ. iimax) </a><a href="xhalo_block.html#xhalo_blocki129" target="diffFile">iend = iimax + <code class="constant">1</code></a>
<a name="xhalo_blocki134"></a>        <a href="xhalo_block.html#xhalo_blocki130" target="diffFile"><code class="keyword">IF</code> (jbeg .EQ. <code class="constant">1</code>) </a><a href="xhalo_block.html#xhalo_blocki131" target="diffFile">jbeg = <code class="constant">0</code></a>
        <a href="xhalo_block.html#xhalo_blocki132" target="diffFile"><code class="keyword">IF</code> (jend .EQ. jjmax) </a><a href="xhalo_block.html#xhalo_blocki133" target="diffFile">jend = jjmax + <code class="constant">1</code></a>
<a href="xhalo_block.html#xhalo_blocki134" target="diffFile"><code class="comment">! Loop over the nodes of the subface and set the</code></a>
<a name="xhalo_blocki135"></a><a href="xhalo_block.html#xhalo_blocki134" target="diffFile"><code class="comment">! corresponding halo coordinates.</code></a>
<a name="xhalo_blocki136"></a>        <a href="xhalo_block.html#xhalo_blocki134" target="diffFile"><code class="keyword">DO </code>j=jbeg,jend</a>
          <a href="xhalo_block.html#xhalo_blocki135" target="diffFile"><code class="keyword">DO </code>i=ibeg,iend</a>
<a href="xhalo_block.html#xhalo_blocki136" target="diffFile"><code class="comment">! Determine the vector from the internal node to the</code></a>
<a href="xhalo_block.html#xhalo_blocki136" target="diffFile"><code class="comment">! node on the face. Again an offset of +1 must be</code></a>
<a name="xhalo_blocki137"></a><a href="xhalo_block.html#xhalo_blocki136" target="diffFile"><code class="comment">! used, due to the usage of pointers.</code></a>
<a name="xhalo_blocki138"></a>            <a href="xhalo_block.html#xhalo_blocki136" target="diffFile">v1(<code class="constant">1</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="xhalo_blocki139"></a>            <a href="xhalo_block.html#xhalo_blocki137" target="diffFile">v1(<code class="constant">2</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>)</a>
            <a href="xhalo_block.html#xhalo_blocki138" target="diffFile">v1(<code class="constant">3</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block.html#xhalo_blocki139" target="diffFile"><code class="comment">! Determine two times the normal component of this</code></a>
<a href="xhalo_block.html#xhalo_blocki139" target="diffFile"><code class="comment">! vector; this vector must be added to the</code></a>
<a href="xhalo_block.html#xhalo_blocki139" target="diffFile"><code class="comment">! coordinates of the internal node to obtain the</code></a>
<a name="xhalo_blocki140"></a><a href="xhalo_block.html#xhalo_blocki139" target="diffFile"><code class="comment">! halo coordinates. Again the offset of +1.</code></a>
<a name="xhalo_blocki141"></a>            <a href="xhalo_block.html#xhalo_blocki139" target="diffFile">dot = two*(v1(<code class="constant">1</code>)*norm(<code class="constant">1</code>)+v1(<code class="constant">2</code>)*norm(<code class="constant">2</code>)+v1(<code class="constant">3</code>)*norm(<code class="constant">3</code>))</a>
<a name="xhalo_blocki142"></a>            <a href="xhalo_block.html#xhalo_blocki140" target="diffFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) + dot*norm(<code class="constant">1</code>)</a>
            <a href="xhalo_block.html#xhalo_blocki141" target="diffFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) + dot*norm(<code class="constant">2</code>)</a>
            <a href="xhalo_block.html#xhalo_blocki142" target="diffFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) + dot*norm(<code class="constant">3</code>)</a>
          <a href="xhalo_block.html#xhalo_blocki135" target="diffFile"><code class="keyword">END DO</code></a>
        <a href="xhalo_block.html#xhalo_blocki134" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="xhalo_block.html#xhalo_blocki122" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="xhalo_block.html#xhalo_blocki55" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="xhalo_block.html#xhalo_blocki54" target="diffFile"><code class="keyword">END DO </code><code class="label">loopbocos</code></a>
<a href="xhalo_block.html#xhalo_block" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">XHALO_BLOCK</code></a>
</pre>
</body>
