<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="sasolve"></a><a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * File:          saSolve.f90                                     *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Author:        Georgi Kalitzin, Edwin van der Weide,           *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                Steve Repsher (blanking)                        *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Starting date: 06-11-2003                                      *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Last modified: 07-05-2005                                      *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">SASOLVE</code>(<code class="vardecl">resonly</code>)</a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">USE </code><code class="funcname">CONSTANTS</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTITERATION</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">USE </code><code class="funcname">TURBMOD</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">USE </code><code class="funcname">BCTYPES</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">USE </code><code class="funcname">PARAMTURB</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * saSolve solves the turbulent transport equation for the        *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * original Spalart-Allmaras model in a segregated manner using   *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * a diagonal dominant ADI-scheme.                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      Subroutine arguments.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">resonly</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      Local parameters.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">xminn</code>=<code class="constant">1.e-10_realType</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      Local variables.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">nn</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">cv13</code>, <code class="vardecl">kar2inv</code>, <code class="vardecl">cw36</code>, <code class="vardecl">cb3inv</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fv1</code>, <code class="vardecl">fv2</code>, <code class="vardecl">ft2</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">ss</code>, <code class="vardecl">sst</code>, <code class="vardecl">nu</code>, <code class="vardecl">dist2inv</code>, <code class="vardecl">chi</code>, <code class="vardecl">chi2</code>, <code class="vardecl">chi3</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rr</code>, <code class="vardecl">gg</code>, <code class="vardecl">gg6</code>, <code class="vardecl">termfw</code>, <code class="vardecl">fwsa</code>, <code class="vardecl">term1</code>, <code class="vardecl">term2</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">dfv1</code>, <code class="vardecl">dfv2</code>, <code class="vardecl">dft2</code>, <code class="vardecl">drr</code>, <code class="vardecl">dgg</code>, <code class="vardecl">dfw</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">voli</code>, <code class="vardecl">volmi</code>, <code class="vardecl">volpi</code>, <code class="vardecl">xm</code>, <code class="vardecl">ym</code>, <code class="vardecl">zm</code>, <code class="vardecl">xp</code>, <code class="vardecl">yp</code>, <code class="vardecl">zp</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">xa</code>, <code class="vardecl">ya</code>, <code class="vardecl">za</code>, <code class="vardecl">ttm</code>, <code class="vardecl">ttp</code>, <code class="vardecl">cnud</code>, <code class="vardecl">cam</code>, <code class="vardecl">cap</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">nutm</code>, <code class="vardecl">nutp</code>, <code class="vardecl">num</code>, <code class="vardecl">nup</code>, <code class="vardecl">cdm</code>, <code class="vardecl">cdp</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">c1m</code>, <code class="vardecl">c1p</code>, <code class="vardecl">c10</code>, <code class="vardecl">b1</code>, <code class="vardecl">c1</code>, <code class="vardecl">d1</code>, <code class="vardecl">qs</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">uu</code>, <code class="vardecl">um</code>, <code class="vardecl">up</code>, <code class="vardecl">factor</code>, <code class="vardecl">f</code>, <code class="vardecl">tu1p</code>, <code class="vardecl">rblank</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code><code class="constant">2</code>:il, <code class="constant">2</code>:jl, <code class="constant">2</code>:kl<code class="typename">) </code>:: <code class="vardecl">qq</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">pwx1</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">EXP</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">EXTERNAL </code><code class="funcname">UNSTEADYTURBTERM</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">EXTERNAL </code><code class="funcname">TURBADVECTION</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">EXTERNAL </code><code class="funcname">PRODKATOLAUNDER</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max7</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max6</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max5</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max4</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max3</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max2</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL </code>:: <code class="vardecl">max1</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (kl .LT. il) <code class="keyword">THEN</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (il .LT. jl) <code class="keyword">THEN</code></a>
      <a href="sasolve.html#sasolve" target="diffFile">max1 = jl</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
      <a href="sasolve.html#sasolve" target="diffFile">max1 = il</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE IF</code> (kl .LT. jl) <code class="keyword">THEN</code></a>
    <a href="sasolve.html#sasolve" target="diffFile">max1 = jl</a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
    <a href="sasolve.html#sasolve" target="diffFile">max1 = kl</a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code><code class="constant">2</code>:max1<code class="typename">) </code>:: <code class="vardecl">bb</code>, <code class="vardecl">cc</code>, <code class="vardecl">dd</code>, <code class="vardecl">ff</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ddw</code>, <code class="vardecl">ww</code>, <code class="vardecl">ddvt</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rrlv</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">dd2wall</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">DIMENSION(</code><code class="constant">2</code>:jl, <code class="constant">2</code>:kl<code class="typename">)</code>, <code class="typename">TARGET </code>:: <code class="vardecl">flagi2</code>, <code class="vardecl">flagil</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">DIMENSION(</code><code class="constant">2</code>:il, <code class="constant">2</code>:kl<code class="typename">)</code>, <code class="typename">TARGET </code>:: <code class="vardecl">flagj2</code>, <code class="vardecl">flagjl</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">DIMENSION(</code><code class="constant">2</code>:il, <code class="constant">2</code>:jl<code class="typename">)</code>, <code class="typename">TARGET </code>:: <code class="vardecl">flagk2</code>, <code class="vardecl">flagkl</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">flag</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">EXTERNAL </code><code class="funcname">PRODKATOLAUNDER</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">EXTERNAL </code><code class="funcname">TURBADVECTION</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">EXTERNAL </code><code class="funcname">UNSTEADYTURBTERM</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set model constants</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">cv13 = rsacv1**<code class="constant">3</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">kar2inv = one/rsak**<code class="constant">2</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">cw36 = rsacw3**<code class="constant">6</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">cb3inv = one/rsacb3</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set the pointer for dvt in dw, such that the code is more</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! readable. Also set the pointers for the production term</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! and vorticity.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">dvt => dw(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:, idvt:)</a>
  <a href="sasolve.html#sasolve" target="diffFile">prod => dw(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:, iprod)</a>
  <a href="sasolve.html#sasolve" target="diffFile">vort => prod</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Production term.                                               *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">SELECT CASE </code> (turbprod) </a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(strain) </a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CALL </code><code class="funcname">PRODSMAG2</code>()</a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(vorticity) </a>
<a name="p29"></a>    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CALL </code><code class="funcname">PRODWMAG2</code>()</a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(katolaunder) </a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CALL </code></a><a href="msg.html#p29" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="sasolve.html#sasolve" target="diffFile"><code class="funcname">PRODKATOLAUNDER</code>()</a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END SELECT</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Source terms.                                                  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Determine the source term and its derivative w.r.t. nuTilde    *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * for all internal cells of the block.                           *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! First take the square root of the production term to</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! obtain the correct production term for spalart-allmaras.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">ss = <code class="funcname">SQRT</code>(prod(i, j, k))</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the laminar kinematic viscosity, the inverse of</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! wall distance squared, the ratio chi (ratio of nuTilde</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! and nu) and the functions fv1 and fv2. The latter corrects</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the production term near a viscous wall.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">nu = rlv(i, j, k)/w(i, j, k, irho)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dist2inv = one/d2wall(i, j, k)**<code class="constant">2</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">chi = w(i, j, k, itu1)/nu</a>
        <a href="sasolve.html#sasolve" target="diffFile">chi2 = chi*chi</a>
        <a href="sasolve.html#sasolve" target="diffFile">chi3 = chi*chi2</a>
        <a href="sasolve.html#sasolve" target="diffFile">fv1 = chi3/(chi3+cv13)</a>
        <a href="sasolve.html#sasolve" target="diffFile">fv2 = one - chi/(one+chi*fv1)</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The function ft2, which is designed to keep a laminar</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! solution laminar. When running in fully turbulent mode</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! this function should be set to 0.0.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">ft2 = rsact3*<code class="funcname">EXP</code>(-(rsact4*chi2))</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! ft2 = zero</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Correct the production term to account for the influence</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! of the wall. Make sure that this term remains positive</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! (the function fv2 is negative between chi = 1 and 18.4,</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! which can cause sst to go negative, which is undesirable).</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">sst = ss + w(i, j, k, itu1)*fv2*kar2inv*dist2inv</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (sst .LT. xminn) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">sst = xminn</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">sst = sst</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the function fw. The argument rr is cut off at 10</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! to avoid numerical problems. This is ok, because the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! asymptotical value of fw is then already reached.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">rr = w(i, j, k, itu1)*kar2inv*dist2inv/sst</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (rr .GT. <code class="constant">10.0_realType</code>) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">rr = <code class="constant">10.0_realType</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">rr = rr</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">gg = rr + rsacw2*(rr**<code class="constant">6</code>-rr)</a>
        <a href="sasolve.html#sasolve" target="diffFile">gg6 = gg**<code class="constant">6</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">pwx1 = (one+cw36)/(gg6+cw36)</a>
        <a href="sasolve.html#sasolve" target="diffFile">termfw = pwx1**sixth</a>
        <a href="sasolve.html#sasolve" target="diffFile">fwsa = gg*termfw</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the source term; some terms are saved for the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! linearization. The source term is stored in dvt.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">term1 = rsacb1*(one-ft2)*ss</a>
        <a href="sasolve.html#sasolve" target="diffFile">term2 = dist2inv*(kar2inv*rsacb1*((one-ft2)*fv2+ft2)-rsacw1*fwsa<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&          </code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dvt(i, j, k, <code class="constant">1</code>) = (term1+term2*w(i, j, k, itu1))*w(i, j, k, itu1<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&          </code>)</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute some derivatives w.r.t. nuTilde. These will occur</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! in the left hand side, i.e. the matrix for the implicit</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! treatment.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">dfv1 = three*chi2*cv13/(chi3+cv13)**<code class="constant">2</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">dfv2 = (chi2*dfv1-one)/(nu*(one+chi*fv1)**<code class="constant">2</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dft2 = -(two*rsact4*chi*ft2/nu)</a>
        <a href="sasolve.html#sasolve" target="diffFile">drr = (one-rr*(fv2+w(i, j, k, itu1)*dfv2))*kar2inv*dist2inv/sst</a>
        <a href="sasolve.html#sasolve" target="diffFile">dgg = (one-rsacw2+six*rsacw2*rr**<code class="constant">5</code>)*drr</a>
        <a href="sasolve.html#sasolve" target="diffFile">dfw = cw36/(gg6+cw36)*termfw*dgg</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the source term jacobian. Note that the part</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! containing term1 is treated explicitly. The reason is that</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! implicit treatment of this part leads to a decrease of the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! diagonal dominance of the jacobian and it thus decreases</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the stability. You may want to play around and try to</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! take this term into account in the jacobian.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Note that -dsource/dnu is stored.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = -(two*term2*w(i, j, k, itu1)) - dist2inv*w(i, j, k<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&          </code>, itu1)*w(i, j, k, itu1)*(rsacb1*kar2inv*(dfv2-ft2*dfv2-fv2*<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&          </code>dft2+dft2)-rsacw1*dfw)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (qq(i, j, k) .LT. zero) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = zero</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Advection and unsteady terms.                                  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a name="p30"></a><a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a name="p31"></a>  <a href="sasolve.html#sasolve" target="diffFile">nn = itu1 - <code class="constant">1</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CALL </code></a><a href="msg.html#p30" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="sasolve.html#sasolve" target="diffFile"><code class="funcname">TURBADVECTION</code>(<code class="constant">1_intType</code>, <code class="constant">1_intType</code>, nn, qq)</a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CALL </code></a><a href="msg.html#p31" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="sasolve.html#sasolve" target="diffFile"><code class="funcname">UNSTEADYTURBTERM</code>(<code class="constant">1_intType</code>, <code class="constant">1_intType</code>, nn, qq)</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Viscous terms in k-direction.                                  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the metrics in zeta-direction, i.e. along the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! line k = constant.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">voli = one/vol(i, j, k)</a>
        <a href="sasolve.html#sasolve" target="diffFile">volmi = two/(vol(i, j, k)+vol(i, j, k-<code class="constant">1</code>))</a>
        <a href="sasolve.html#sasolve" target="diffFile">volpi = two/(vol(i, j, k)+vol(i, j, k+<code class="constant">1</code>))</a>
        <a href="sasolve.html#sasolve" target="diffFile">xm = sk(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">ym = sk(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">zm = sk(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">xp = sk(i, j, k, <code class="constant">1</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">yp = sk(i, j, k, <code class="constant">2</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">zp = sk(i, j, k, <code class="constant">3</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">xa = half*(sk(i, j, k, <code class="constant">1</code>)+sk(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">ya = half*(sk(i, j, k, <code class="constant">2</code>)+sk(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">za = half*(sk(i, j, k, <code class="constant">3</code>)+sk(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">ttm = xm*xa + ym*ya + zm*za</a>
        <a href="sasolve.html#sasolve" target="diffFile">ttp = xp*xa + yp*ya + zp*za</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Computation of the viscous terms in zeta-direction; note</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! that cross-derivatives are neglected, i.e. the mesh is</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! assumed to be orthogonal.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Furthermore, the grad(nu)**2 has been rewritten as</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! div(nu grad(nu)) - nu div(grad nu) to enhance stability.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The second derivative in zeta-direction is constructed as</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the central difference of the first order derivatives, i.e.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! d^2/dzeta^2 = d/dzeta (d/dzeta k+1/2 - d/dzeta k-1/2).</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! In this way the metric can be taken into account.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the diffusion coefficients multiplying the nodes</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! k+1, k and k-1 in the second derivative. Make sure that</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! these coefficients are nonnegative.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">cnud = -(rsacb2*w(i, j, k, itu1)*cb3inv)</a>
        <a href="sasolve.html#sasolve" target="diffFile">cam = ttm*cnud</a>
        <a href="sasolve.html#sasolve" target="diffFile">cap = ttp*cnud</a>
        <a href="sasolve.html#sasolve" target="diffFile">nutm = half*(w(i, j, k-<code class="constant">1</code>, itu1)+w(i, j, k, itu1))</a>
        <a href="sasolve.html#sasolve" target="diffFile">nutp = half*(w(i, j, k+<code class="constant">1</code>, itu1)+w(i, j, k, itu1))</a>
        <a href="sasolve.html#sasolve" target="diffFile">nu = rlv(i, j, k)/w(i, j, k, irho)</a>
        <a href="sasolve.html#sasolve" target="diffFile">num = half*(rlv(i, j, k-<code class="constant">1</code>)/w(i, j, k-<code class="constant">1</code>, irho)+nu)</a>
        <a href="sasolve.html#sasolve" target="diffFile">nup = half*(rlv(i, j, k+<code class="constant">1</code>)/w(i, j, k+<code class="constant">1</code>, irho)+nu)</a>
        <a href="sasolve.html#sasolve" target="diffFile">cdm = (num+(one+rsacb2)*nutm)*ttm*cb3inv</a>
        <a href="sasolve.html#sasolve" target="diffFile">cdp = (nup+(one+rsacb2)*nutp)*ttp*cb3inv</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdm + cam .LT. zero) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1m = zero</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1m = cdm + cam</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdp + cap .LT. zero) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1p = zero</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1p = cdp + cap</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">c10 = c1m + c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Update the residual for this cell and store the possible</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! coefficients for the matrix in b1, c1 and d1.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">dvt(i, j, k, <code class="constant">1</code>) = dvt(i, j, k, <code class="constant">1</code>) + c1m*w(i, j, k-<code class="constant">1</code>, itu1) - c10<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&          </code>*w(i, j, k, itu1) + c1p*w(i, j, k+<code class="constant">1</code>, itu1)</a>
        <a href="sasolve.html#sasolve" target="diffFile">b1 = -c1m</a>
        <a href="sasolve.html#sasolve" target="diffFile">c1 = c10</a>
        <a href="sasolve.html#sasolve" target="diffFile">d1 = -c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Update the central jacobian. For nonboundary cells this</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! is simply c1. For boundary cells this is slightly more</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! complicated, because the boundary conditions are treated</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! implicitly and the off-diagonal terms b1 and d1 must be</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! taken into account.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The boundary conditions are only treated implicitly if</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the diagonal dominance of the matrix is increased.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (k .EQ. <code class="constant">2</code>) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (bmtk1(i, j, itu1, itu1) .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max2 = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max2 = bmtk1(i, j, itu1, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1 - b1*max2</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE IF</code> (k .EQ. kl) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (bmtk2(i, j, itu1, itu1) .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max3 = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max3 = bmtk2(i, j, itu1, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1 - d1*max3</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Viscous terms in j-direction.                                  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the metrics in eta-direction, i.e. along the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! line j = constant.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">voli = one/vol(i, j, k)</a>
        <a href="sasolve.html#sasolve" target="diffFile">volmi = two/(vol(i, j, k)+vol(i, j-<code class="constant">1</code>, k))</a>
        <a href="sasolve.html#sasolve" target="diffFile">volpi = two/(vol(i, j, k)+vol(i, j+<code class="constant">1</code>, k))</a>
        <a href="sasolve.html#sasolve" target="diffFile">xm = sj(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">ym = sj(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">zm = sj(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">xp = sj(i, j, k, <code class="constant">1</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">yp = sj(i, j, k, <code class="constant">2</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">zp = sj(i, j, k, <code class="constant">3</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">xa = half*(sj(i, j, k, <code class="constant">1</code>)+sj(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">ya = half*(sj(i, j, k, <code class="constant">2</code>)+sj(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">za = half*(sj(i, j, k, <code class="constant">3</code>)+sj(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">ttm = xm*xa + ym*ya + zm*za</a>
        <a href="sasolve.html#sasolve" target="diffFile">ttp = xp*xa + yp*ya + zp*za</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Computation of the viscous terms in eta-direction; note</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! that cross-derivatives are neglected, i.e. the mesh is</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! assumed to be orthogonal.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Furthermore, the grad(nu)**2 has been rewritten as</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! div(nu grad(nu)) - nu div(grad nu) to enhance stability.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The second derivative in eta-direction is constructed as</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the central difference of the first order derivatives, i.e.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! d^2/deta^2 = d/deta (d/deta j+1/2 - d/deta j-1/2).</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! In this way the metric can be taken into account.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the diffusion coefficients multiplying the nodes</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! j+1, j and j-1 in the second derivative. Make sure that</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! these coefficients are nonnegative.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">cnud = -(rsacb2*w(i, j, k, itu1)*cb3inv)</a>
        <a href="sasolve.html#sasolve" target="diffFile">cam = ttm*cnud</a>
        <a href="sasolve.html#sasolve" target="diffFile">cap = ttp*cnud</a>
        <a href="sasolve.html#sasolve" target="diffFile">nutm = half*(w(i, j-<code class="constant">1</code>, k, itu1)+w(i, j, k, itu1))</a>
        <a href="sasolve.html#sasolve" target="diffFile">nutp = half*(w(i, j+<code class="constant">1</code>, k, itu1)+w(i, j, k, itu1))</a>
        <a href="sasolve.html#sasolve" target="diffFile">nu = rlv(i, j, k)/w(i, j, k, irho)</a>
        <a href="sasolve.html#sasolve" target="diffFile">num = half*(rlv(i, j-<code class="constant">1</code>, k)/w(i, j-<code class="constant">1</code>, k, irho)+nu)</a>
        <a href="sasolve.html#sasolve" target="diffFile">nup = half*(rlv(i, j+<code class="constant">1</code>, k)/w(i, j+<code class="constant">1</code>, k, irho)+nu)</a>
        <a href="sasolve.html#sasolve" target="diffFile">cdm = (num+(one+rsacb2)*nutm)*ttm*cb3inv</a>
        <a href="sasolve.html#sasolve" target="diffFile">cdp = (nup+(one+rsacb2)*nutp)*ttp*cb3inv</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdm + cam .LT. zero) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1m = zero</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1m = cdm + cam</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdp + cap .LT. zero) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1p = zero</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1p = cdp + cap</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">c10 = c1m + c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Update the residual for this cell and store the possible</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! coefficients for the matrix in b1, c1 and d1.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">dvt(i, j, k, <code class="constant">1</code>) = dvt(i, j, k, <code class="constant">1</code>) + c1m*w(i, j-<code class="constant">1</code>, k, itu1) - c10<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&          </code>*w(i, j, k, itu1) + c1p*w(i, j+<code class="constant">1</code>, k, itu1)</a>
        <a href="sasolve.html#sasolve" target="diffFile">b1 = -c1m</a>
        <a href="sasolve.html#sasolve" target="diffFile">c1 = c10</a>
        <a href="sasolve.html#sasolve" target="diffFile">d1 = -c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Update the central jacobian. For nonboundary cells this</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! is simply c1. For boundary cells this is slightly more</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! complicated, because the boundary conditions are treated</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! implicitly and the off-diagonal terms b1 and d1 must be</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! taken into account.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The boundary conditions are only treated implicitly if</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the diagonal dominance of the matrix is increased.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (j .EQ. <code class="constant">2</code>) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (bmtj1(i, k, itu1, itu1) .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max4 = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max4 = bmtj1(i, k, itu1, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1 - b1*max4</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE IF</code> (j .EQ. jl) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (bmtj2(i, k, itu1, itu1) .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max5 = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max5 = bmtj2(i, k, itu1, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1 - d1*max5</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Viscous terms in i-direction.                                  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the metrics in xi-direction, i.e. along the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! line i = constant.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">voli = one/vol(i, j, k)</a>
        <a href="sasolve.html#sasolve" target="diffFile">volmi = two/(vol(i, j, k)+vol(i-<code class="constant">1</code>, j, k))</a>
        <a href="sasolve.html#sasolve" target="diffFile">volpi = two/(vol(i, j, k)+vol(i+<code class="constant">1</code>, j, k))</a>
        <a href="sasolve.html#sasolve" target="diffFile">xm = si(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">ym = si(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">zm = si(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>)*volmi</a>
        <a href="sasolve.html#sasolve" target="diffFile">xp = si(i, j, k, <code class="constant">1</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">yp = si(i, j, k, <code class="constant">2</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">zp = si(i, j, k, <code class="constant">3</code>)*volpi</a>
        <a href="sasolve.html#sasolve" target="diffFile">xa = half*(si(i, j, k, <code class="constant">1</code>)+si(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">ya = half*(si(i, j, k, <code class="constant">2</code>)+si(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">za = half*(si(i, j, k, <code class="constant">3</code>)+si(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>))*voli</a>
        <a href="sasolve.html#sasolve" target="diffFile">ttm = xm*xa + ym*ya + zm*za</a>
        <a href="sasolve.html#sasolve" target="diffFile">ttp = xp*xa + yp*ya + zp*za</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Computation of the viscous terms in xi-direction; note</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! that cross-derivatives are neglected, i.e. the mesh is</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! assumed to be orthogonal.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Furthermore, the grad(nu)**2 has been rewritten as</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! div(nu grad(nu)) - nu div(grad nu) to enhance stability.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The second derivative in xi-direction is constructed as</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the central difference of the first order derivatives, i.e.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! d^2/dxi^2 = d/dxi (d/dxi i+1/2 - d/dxi i-1/2).</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! In this way the metric can be taken into account.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the diffusion coefficients multiplying the nodes</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! i+1, i and i-1 in the second derivative. Make sure that</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! these coefficients are nonnegative.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">cnud = -(rsacb2*w(i, j, k, itu1)*cb3inv)</a>
        <a href="sasolve.html#sasolve" target="diffFile">cam = ttm*cnud</a>
        <a href="sasolve.html#sasolve" target="diffFile">cap = ttp*cnud</a>
        <a href="sasolve.html#sasolve" target="diffFile">nutm = half*(w(i-<code class="constant">1</code>, j, k, itu1)+w(i, j, k, itu1))</a>
        <a href="sasolve.html#sasolve" target="diffFile">nutp = half*(w(i+<code class="constant">1</code>, j, k, itu1)+w(i, j, k, itu1))</a>
        <a href="sasolve.html#sasolve" target="diffFile">nu = rlv(i, j, k)/w(i, j, k, irho)</a>
        <a href="sasolve.html#sasolve" target="diffFile">num = half*(rlv(i-<code class="constant">1</code>, j, k)/w(i-<code class="constant">1</code>, j, k, irho)+nu)</a>
        <a href="sasolve.html#sasolve" target="diffFile">nup = half*(rlv(i+<code class="constant">1</code>, j, k)/w(i+<code class="constant">1</code>, j, k, irho)+nu)</a>
        <a href="sasolve.html#sasolve" target="diffFile">cdm = (num+(one+rsacb2)*nutm)*ttm*cb3inv</a>
        <a href="sasolve.html#sasolve" target="diffFile">cdp = (nup+(one+rsacb2)*nutp)*ttp*cb3inv</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdm + cam .LT. zero) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1m = zero</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1m = cdm + cam</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdp + cap .LT. zero) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1p = zero</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">c1p = cdp + cap</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">c10 = c1m + c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Update the residual for this cell and store the possible</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! coefficients for the matrix in b1, c1 and d1.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">dvt(i, j, k, <code class="constant">1</code>) = dvt(i, j, k, <code class="constant">1</code>) + c1m*w(i-<code class="constant">1</code>, j, k, itu1) - c10<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&          </code>*w(i, j, k, itu1) + c1p*w(i+<code class="constant">1</code>, j, k, itu1)</a>
        <a href="sasolve.html#sasolve" target="diffFile">b1 = -c1m</a>
        <a href="sasolve.html#sasolve" target="diffFile">c1 = c10</a>
        <a href="sasolve.html#sasolve" target="diffFile">d1 = -c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Update the central jacobian. For nonboundary cells this</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! is simply c1. For boundary cells this is slightly more</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! complicated, because the boundary conditions are treated</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! implicitly and the off-diagonal terms b1 and d1 must be</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! taken into account.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The boundary conditions are only treated implicitly if</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the diagonal dominance of the matrix is increased.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (i .EQ. <code class="constant">2</code>) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (bmti1(j, k, itu1, itu1) .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max6 = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max6 = bmti1(j, k, itu1, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1 - b1*max6</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE IF</code> (i .EQ. il) <code class="keyword">THEN</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (bmti2(j, k, itu1, itu1) .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max7 = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">max7 = bmti2(j, k, itu1, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1 - d1*max7</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = qq(i, j, k) + c1</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Multiply the residual by the volume and store this in dw; this</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! is done for monitoring reasons only. The multiplication with the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! volume is present to be consistent with the flow residuals; also</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the negative value is taken, again to be consistent with the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! flow equations. Also multiply by iblank so that no updates occur</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! in holes or the overset boundary.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
        <a href="sasolve.html#sasolve" target="diffFile">rblank = <code class="funcname">REAL</code>(iblank(i, j, k), realtype)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dw(i, j, k, itu1) = -(vol(i, j, k)*dvt(i, j, k, <code class="constant">1</code>)*rblank)</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Initialize the wall function flags to .false.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">flagi2 = <code class="constant">.false.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">flagil = <code class="constant">.false.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">flagj2 = <code class="constant">.false.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">flagjl = <code class="constant">.false.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">flagk2 = <code class="constant">.false.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile">flagkl = <code class="constant">.false.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Modify the rhs of the 1st internal cell, if wall functions</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! are used; their value is determined by the table.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (wallfunctions) <code class="keyword">THEN</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">bocos:</code><code class="keyword">DO </code>nn=<code class="constant">1</code>,nviscbocos</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Determine the block face on which the subface is located</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! and set some variables. As flag points to the entire array</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! flagI2, etc., its starting indices are the starting indices</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! of its target and not 1.</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="sasolve.html#sasolve" target="diffFile">flag => flagi2</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddw => dw(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddvt => dvt(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ww => w(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">rrlv => rlv(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dd2wall => d2wall(<code class="constant">2</code>, :, :)</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(imax) </a>
        <a href="sasolve.html#sasolve" target="diffFile">flag => flagil</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddw => dw(il, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddvt => dvt(il, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ww => w(il, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">rrlv => rlv(il, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dd2wall => d2wall(il, :, :)</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(jmin) </a>
        <a href="sasolve.html#sasolve" target="diffFile">flag => flagj2</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddw => dw(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddvt => dvt(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ww => w(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dd2wall => d2wall(:, <code class="constant">2</code>, :)</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(jmax) </a>
        <a href="sasolve.html#sasolve" target="diffFile">flag => flagjl</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddw => dw(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddvt => dvt(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ww => w(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">rrlv => rlv(<code class="constant">1</code>:, jl, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dd2wall => d2wall(:, jl, :)</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(kmin) </a>
        <a href="sasolve.html#sasolve" target="diffFile">flag => flagk2</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddw => dw(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddvt => dvt(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ww => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dd2wall => d2wall(:, :, <code class="constant">2</code>)</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CASE </code>(kmax) </a>
        <a href="sasolve.html#sasolve" target="diffFile">flag => flagkl</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddw => dw(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ddvt => dvt(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">ww => w(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, <code class="constant">1</code>:)</a>
        <a href="sasolve.html#sasolve" target="diffFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, kl)</a>
        <a href="sasolve.html#sasolve" target="diffFile">dd2wall => d2wall(:, :, kl)</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END SELECT</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Loop over the owned faces of this subface. Therefore the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! nodal range of BCData must be used. The offset of +1 is</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! present, because the starting index of the cell range is</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! 1 larger than the starting index of the nodal range.</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=bcdata(nn)%jnbeg+<code class="constant">1</code>,bcdata(nn)%jnend</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=bcdata(nn)%inbeg+<code class="constant">1</code>,bcdata(nn)%inend</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set ddw to zero.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">ddw(i, j, itu1) = zero</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Enforce nu tilde in the 1st internal cell from the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! wall function table. There is an offset of -1 in the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! wall distance. Note that the offset compared to the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! current value must be stored, because dvt contains</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the update. Also note that the curve fits contain the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! non-dimensional value.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">yp = ww(i, j, irho)*dd2wall(i-<code class="constant">1</code>, j-<code class="constant">1</code>)*viscsubface(nn)%utau(i, <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&            </code>j)/rrlv(i, j)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">CALL </code><code class="funcname">CURVETUPYP</code>(tu1p, yp, itu1, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ddvt(i, j, <code class="constant">1</code>) = tu1p*rrlv(i, j)/ww(i, j, irho) - ww(i, j, itu1<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&            </code>)</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set the wall flag to .true.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">flag(i, j) = <code class="constant">.true.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO </code><code class="label">bocos</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Return if only the residual must be computed.</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (resonly) <code class="keyword">THEN</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">RETURN</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! For implicit relaxation take the local time step into account,</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! where dt is the inverse of the central jacobian times the cfl</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! number. The following system is solved:</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! (I/dt + cc + bb + dd)*dw = rhs, in which I/dt = cc/cfl. As in</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the rest of the algorithm only the modified central jacobian is</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! used, stored it now.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the factor multiplying the central jacobian, which</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! is 1 + 1/cfl (implicit relaxation only).</code></a>
    <a href="sasolve.html#sasolve" target="diffFile">factor = one</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (turbrelax .EQ. turbrelaximplicit) factor = one + (one-alfaturb)/<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&        </code>alfaturb</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
          <a href="sasolve.html#sasolve" target="diffFile">qq(i, j, k) = factor*qq(i, j, k)</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set qq to 1 if the value is determined by the</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! wall function table.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> ((((((i .EQ. <code class="constant">2 </code>.AND. flagi2(j, k)) .OR. (i .EQ. il .AND. <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>flagil(j, k))) .OR. (j .EQ. <code class="constant">2 </code>.AND. flagj2(i, k))) .OR. (j<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>.EQ. jl .AND. flagjl(i, k))) .OR. (k .EQ. <code class="constant">2 </code>.AND. flagk2(i<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>, j))) .OR. (k .EQ. kl .AND. flagkl(i, j))) qq(i, j, k) = <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>one</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Initialize the grid velocity to zero. This value will be used</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! if the block is not moving.</code></a>
    <a href="sasolve.html#sasolve" target="diffFile">qs = zero</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * dd-ADI step in j-direction. There is no particular reason to   *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * start in j-direction, it just happened to be so. As we solve   *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * in j-direction, the j-loop is the innermost loop.              *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! More or less the same code is executed here as above when</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the residual was built. However, now the off-diagonal</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! terms for the dd-ADI must be built and stored. This could</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! have been done earlier, but then all the coefficients had</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! to be stored. To save memory, they are recomputed.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Consequently, see the j-loop to build the residual for</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the comments.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">voli = one/vol(i, j, k)</a>
          <a href="sasolve.html#sasolve" target="diffFile">volmi = two/(vol(i, j, k)+vol(i, j-<code class="constant">1</code>, k))</a>
          <a href="sasolve.html#sasolve" target="diffFile">volpi = two/(vol(i, j, k)+vol(i, j+<code class="constant">1</code>, k))</a>
          <a href="sasolve.html#sasolve" target="diffFile">xm = sj(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">ym = sj(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">zm = sj(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">xp = sj(i, j, k, <code class="constant">1</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">yp = sj(i, j, k, <code class="constant">2</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">zp = sj(i, j, k, <code class="constant">3</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">xa = half*(sj(i, j, k, <code class="constant">1</code>)+sj(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">ya = half*(sj(i, j, k, <code class="constant">2</code>)+sj(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">za = half*(sj(i, j, k, <code class="constant">3</code>)+sj(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">ttm = xm*xa + ym*ya + zm*za</a>
          <a href="sasolve.html#sasolve" target="diffFile">ttp = xp*xa + yp*ya + zp*za</a>
          <a href="sasolve.html#sasolve" target="diffFile">cnud = -(rsacb2*w(i, j, k, itu1)*cb3inv)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cam = ttm*cnud</a>
          <a href="sasolve.html#sasolve" target="diffFile">cap = ttp*cnud</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Off-diagonal terms due to the diffusion terms</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! in j-direction.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">nutm = half*(w(i, j-<code class="constant">1</code>, k, itu1)+w(i, j, k, itu1))</a>
          <a href="sasolve.html#sasolve" target="diffFile">nutp = half*(w(i, j+<code class="constant">1</code>, k, itu1)+w(i, j, k, itu1))</a>
          <a href="sasolve.html#sasolve" target="diffFile">nu = rlv(i, j, k)/w(i, j, k, irho)</a>
          <a href="sasolve.html#sasolve" target="diffFile">num = half*(rlv(i, j-<code class="constant">1</code>, k)/w(i, j-<code class="constant">1</code>, k, irho)+nu)</a>
          <a href="sasolve.html#sasolve" target="diffFile">nup = half*(rlv(i, j+<code class="constant">1</code>, k)/w(i, j+<code class="constant">1</code>, k, irho)+nu)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cdm = (num+(one+rsacb2)*nutm)*ttm*cb3inv</a>
          <a href="sasolve.html#sasolve" target="diffFile">cdp = (nup+(one+rsacb2)*nutp)*ttp*cb3inv</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdm + cam .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1m = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1m = cdm + cam</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdp + cap .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1p = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1p = cdp + cap</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(j) = -c1m</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(j) = -c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the grid velocity if present.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! It is taken as the average of j and j-1,</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) qs = half*(sfacej(i, j, k)+sfacej(i, j-<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code><code class="constant">1</code>, k))*voli</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Off-diagonal terms due to the advection term in</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! j-direction. First order approximation.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">uu = xa*w(i, j, k, ivx) + ya*w(i, j, k, ivy) + za*w(i, j, k, <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&            </code>ivz) - qs</a>
          <a href="sasolve.html#sasolve" target="diffFile">um = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile">up = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (uu .LT. zero) um = uu</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (uu .GT. zero) up = uu</a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(j) = bb(j) - up</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(j) = dd(j) + um</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Store the central jacobian and rhs in cc and ff.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Multiply the off-diagonal terms and rhs by the iblank</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! value so the update determined for iblank = 0 is zero.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">rblank = <code class="funcname">REAL</code>(iblank(i, j, k), realtype)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cc(j) = qq(i, j, k)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(j) = dvt(i, j, k, <code class="constant">1</code>)*rblank</a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(j) = bb(j)*rblank</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(j) = dd(j)*rblank</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set the off diagonal terms to zero if the wall is flagged.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> ((((((i .EQ. <code class="constant">2 </code>.AND. flagi2(j, k)) .OR. (i .EQ. il .AND. <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>flagil(j, k))) .OR. (j .EQ. <code class="constant">2 </code>.AND. flagj2(i, k))) .OR. (j<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>.EQ. jl .AND. flagjl(i, k))) .OR. (k .EQ. <code class="constant">2 </code>.AND. flagk2(i<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>, j))) .OR. (k .EQ. kl .AND. flagkl(i, j))) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">bb(j) = zero</a>
            <a href="sasolve.html#sasolve" target="diffFile">dd(j) = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Solve the tri-diagonal system in j-direction.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! First the backward sweep to eliMinate the upper diagonal dd.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=ny,<code class="constant">2</code>,-<code class="constant">1</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">f = dd(j)/cc(j+<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cc(j) = cc(j) - f*bb(j+<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(j) = ff(j) - f*ff(j+<code class="constant">1</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The matrix is now in lower block bi-diagonal form.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Perform a forward sweep to compute the solution.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">ff(<code class="constant">2</code>) = ff(<code class="constant">2</code>)/cc(<code class="constant">2</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">3</code>,jl</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(j) = ff(j) - bb(j)*ff(j-<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(j) = ff(j)/cc(j)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Determine the new rhs for the next direction.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
          <a href="sasolve.html#sasolve" target="diffFile">dvt(i, j, k, <code class="constant">1</code>) = ff(j)*qq(i, j, k)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * dd-ADI step in i-direction. As we solve in i-direction, the    *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * i-loop is the innermost loop.                                  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! More or less the same code is executed here as above when</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the residual was built. However, now the off-diagonal</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! terms for the dd-ADI must be built and stored. This could</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! have been done earlier, but then all the coefficients had</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! to be stored. To save memory, they are recomputed.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Consequently, see the i-loop to build the residual for</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the comments.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">voli = one/vol(i, j, k)</a>
          <a href="sasolve.html#sasolve" target="diffFile">volmi = two/(vol(i, j, k)+vol(i-<code class="constant">1</code>, j, k))</a>
          <a href="sasolve.html#sasolve" target="diffFile">volpi = two/(vol(i, j, k)+vol(i+<code class="constant">1</code>, j, k))</a>
          <a href="sasolve.html#sasolve" target="diffFile">xm = si(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">ym = si(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">zm = si(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">xp = si(i, j, k, <code class="constant">1</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">yp = si(i, j, k, <code class="constant">2</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">zp = si(i, j, k, <code class="constant">3</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">xa = half*(si(i, j, k, <code class="constant">1</code>)+si(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">ya = half*(si(i, j, k, <code class="constant">2</code>)+si(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">za = half*(si(i, j, k, <code class="constant">3</code>)+si(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">ttm = xm*xa + ym*ya + zm*za</a>
          <a href="sasolve.html#sasolve" target="diffFile">ttp = xp*xa + yp*ya + zp*za</a>
          <a href="sasolve.html#sasolve" target="diffFile">cnud = -(rsacb2*w(i, j, k, itu1)*cb3inv)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cam = ttm*cnud</a>
          <a href="sasolve.html#sasolve" target="diffFile">cap = ttp*cnud</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Off-diagonal terms due to the diffusion terms</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! in i-direction.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">nutm = half*(w(i-<code class="constant">1</code>, j, k, itu1)+w(i, j, k, itu1))</a>
          <a href="sasolve.html#sasolve" target="diffFile">nutp = half*(w(i+<code class="constant">1</code>, j, k, itu1)+w(i, j, k, itu1))</a>
          <a href="sasolve.html#sasolve" target="diffFile">nu = rlv(i, j, k)/w(i, j, k, irho)</a>
          <a href="sasolve.html#sasolve" target="diffFile">num = half*(rlv(i-<code class="constant">1</code>, j, k)/w(i-<code class="constant">1</code>, j, k, irho)+nu)</a>
          <a href="sasolve.html#sasolve" target="diffFile">nup = half*(rlv(i+<code class="constant">1</code>, j, k)/w(i+<code class="constant">1</code>, j, k, irho)+nu)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cdm = (num+(one+rsacb2)*nutm)*ttm*cb3inv</a>
          <a href="sasolve.html#sasolve" target="diffFile">cdp = (nup+(one+rsacb2)*nutp)*ttp*cb3inv</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdm + cam .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1m = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1m = cdm + cam</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdp + cap .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1p = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1p = cdp + cap</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(i) = -c1m</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(i) = -c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the grid velocity if present.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! It is taken as the average of i and i-1,</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) qs = half*(sfacei(i, j, k)+sfacei(i-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>j, k))*voli</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Off-diagonal terms due to the advection term in</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! i-direction. First order approximation.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">uu = xa*w(i, j, k, ivx) + ya*w(i, j, k, ivy) + za*w(i, j, k, <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&            </code>ivz) - qs</a>
          <a href="sasolve.html#sasolve" target="diffFile">um = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile">up = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (uu .LT. zero) um = uu</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (uu .GT. zero) up = uu</a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(i) = bb(i) - up</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(i) = dd(i) + um</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Store the central jacobian and rhs in cc and ff.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Multiply the off-diagonal terms and rhs by the iblank</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! value so the update determined for iblank = 0 is zero.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">rblank = <code class="funcname">REAL</code>(iblank(i, j, k), realtype)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cc(i) = qq(i, j, k)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(i) = dvt(i, j, k, <code class="constant">1</code>)*rblank</a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(i) = bb(i)*rblank</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(i) = dd(i)*rblank</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set the off diagonal terms to zero if the wall is flagged.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> ((((((i .EQ. <code class="constant">2 </code>.AND. flagi2(j, k)) .OR. (i .EQ. il .AND. <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>flagil(j, k))) .OR. (j .EQ. <code class="constant">2 </code>.AND. flagj2(i, k))) .OR. (j<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>.EQ. jl .AND. flagjl(i, k))) .OR. (k .EQ. <code class="constant">2 </code>.AND. flagk2(i<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>, j))) .OR. (k .EQ. kl .AND. flagkl(i, j))) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">bb(i) = zero</a>
            <a href="sasolve.html#sasolve" target="diffFile">dd(i) = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Solve the tri-diagonal system in i-direction.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! First the backward sweep to eliMinate the upper diagonal dd.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=nx,<code class="constant">2</code>,-<code class="constant">1</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">f = dd(i)/cc(i+<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cc(i) = cc(i) - f*bb(i+<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(i) = ff(i) - f*ff(i+<code class="constant">1</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The matrix is now in lower block bi-diagonal form.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Perform a forward sweep to compute the solution.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">ff(<code class="constant">2</code>) = ff(<code class="constant">2</code>)/cc(<code class="constant">2</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">3</code>,il</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(i) = ff(i) - bb(i)*ff(i-<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(i) = ff(i)/cc(i)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Determine the new rhs for the next direction.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
          <a href="sasolve.html#sasolve" target="diffFile">dvt(i, j, k, <code class="constant">1</code>) = ff(i)*qq(i, j, k)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * dd-ADI step in k-direction. As we solve in k-direction, the    *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * k-loop is the innermost loop.                                  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! More or less the same code is executed here as above when</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the residual was built. However, now the off-diagonal</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! terms for the dd-ADI must be built and stored. This could</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! have been done earlier, but then all the coefficients had</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! to be stored. To save memory, they are recomputed.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Consequently, see the k-loop to build the residual for</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! the comments.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">voli = one/vol(i, j, k)</a>
          <a href="sasolve.html#sasolve" target="diffFile">volmi = two/(vol(i, j, k)+vol(i, j, k-<code class="constant">1</code>))</a>
          <a href="sasolve.html#sasolve" target="diffFile">volpi = two/(vol(i, j, k)+vol(i, j, k+<code class="constant">1</code>))</a>
          <a href="sasolve.html#sasolve" target="diffFile">xm = sk(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">ym = sk(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">zm = sk(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>)*volmi</a>
          <a href="sasolve.html#sasolve" target="diffFile">xp = sk(i, j, k, <code class="constant">1</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">yp = sk(i, j, k, <code class="constant">2</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">zp = sk(i, j, k, <code class="constant">3</code>)*volpi</a>
          <a href="sasolve.html#sasolve" target="diffFile">xa = half*(sk(i, j, k, <code class="constant">1</code>)+sk(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">ya = half*(sk(i, j, k, <code class="constant">2</code>)+sk(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">za = half*(sk(i, j, k, <code class="constant">3</code>)+sk(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))*voli</a>
          <a href="sasolve.html#sasolve" target="diffFile">ttm = xm*xa + ym*ya + zm*za</a>
          <a href="sasolve.html#sasolve" target="diffFile">ttp = xp*xa + yp*ya + zp*za</a>
          <a href="sasolve.html#sasolve" target="diffFile">cnud = -(rsacb2*w(i, j, k, itu1)*cb3inv)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cam = ttm*cnud</a>
          <a href="sasolve.html#sasolve" target="diffFile">cap = ttp*cnud</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Off-diagonal terms due to the diffusion terms</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! in k-direction.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">nutm = half*(w(i, j, k-<code class="constant">1</code>, itu1)+w(i, j, k, itu1))</a>
          <a href="sasolve.html#sasolve" target="diffFile">nutp = half*(w(i, j, k+<code class="constant">1</code>, itu1)+w(i, j, k, itu1))</a>
          <a href="sasolve.html#sasolve" target="diffFile">nu = rlv(i, j, k)/w(i, j, k, irho)</a>
          <a href="sasolve.html#sasolve" target="diffFile">num = half*(rlv(i, j, k-<code class="constant">1</code>)/w(i, j, k-<code class="constant">1</code>, irho)+nu)</a>
          <a href="sasolve.html#sasolve" target="diffFile">nup = half*(rlv(i, j, k+<code class="constant">1</code>)/w(i, j, k+<code class="constant">1</code>, irho)+nu)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cdm = (num+(one+rsacb2)*nutm)*ttm*cb3inv</a>
          <a href="sasolve.html#sasolve" target="diffFile">cdp = (nup+(one+rsacb2)*nutp)*ttp*cb3inv</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdm + cam .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1m = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1m = cdm + cam</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (cdp + cap .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1p = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">c1p = cdp + cap</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(k) = -c1m</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(k) = -c1p</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Compute the grid velocity if present.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! It is taken as the average of k and k-1,</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) qs = half*(sfacek(i, j, k)+sfacek(i, j<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>, k-<code class="constant">1</code>))*voli</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Off-diagonal terms due to the advection term in</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! k-direction. First order approximation.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">uu = xa*w(i, j, k, ivx) + ya*w(i, j, k, ivy) + za*w(i, j, k, <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&            </code>ivz) - qs</a>
          <a href="sasolve.html#sasolve" target="diffFile">um = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile">up = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (uu .LT. zero) um = uu</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (uu .GT. zero) up = uu</a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(k) = bb(k) - up</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(k) = dd(k) + um</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Store the central jacobian and rhs in cc and ff.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Multiply the off-diagonal terms and rhs by the iblank</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! value so the update determined for iblank = 0 is zero.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">rblank = <code class="funcname">REAL</code>(iblank(i, j, k), realtype)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cc(k) = qq(i, j, k)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(k) = dvt(i, j, k, <code class="constant">1</code>)*rblank</a>
          <a href="sasolve.html#sasolve" target="diffFile">bb(k) = bb(k)*rblank</a>
          <a href="sasolve.html#sasolve" target="diffFile">dd(k) = dd(k)*rblank</a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Set the off diagonal terms to zero if the wall is flagged.</code></a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> ((((((i .EQ. <code class="constant">2 </code>.AND. flagi2(j, k)) .OR. (i .EQ. il .AND. <code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>flagil(j, k))) .OR. (j .EQ. <code class="constant">2 </code>.AND. flagj2(i, k))) .OR. (j<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>.EQ. jl .AND. flagjl(i, k))) .OR. (k .EQ. <code class="constant">2 </code>.AND. flagk2(i<code class="label">&</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="label">&              </code>, j))) .OR. (k .EQ. kl .AND. flagkl(i, j))) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">bb(k) = zero</a>
            <a href="sasolve.html#sasolve" target="diffFile">dd(k) = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Solve the tri-diagonal system in k-direction.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! First the backward sweep to eliMinate the upper diagonal dd.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=nz,<code class="constant">2</code>,-<code class="constant">1</code></a>
          <a href="sasolve.html#sasolve" target="diffFile">f = dd(k)/cc(k+<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">cc(k) = cc(k) - f*bb(k+<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(k) = ff(k) - f*ff(k+<code class="constant">1</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! The matrix is now in lower block bi-diagonal form.</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Perform a forward sweep to compute the solution.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile">ff(<code class="constant">2</code>) = ff(<code class="constant">2</code>)/cc(<code class="constant">2</code>)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">3</code>,kl</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(k) = ff(k) - bb(k)*ff(k-<code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile">ff(k) = ff(k)/cc(k)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">! Store the update in dvt.</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
          <a href="sasolve.html#sasolve" target="diffFile">dvt(i, j, k, <code class="constant">1</code>) = ff(k)</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * Update the turbulent variables. For explicit relaxation the    *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * update must be relaxed; for implicit relaxation this has been  *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      * done via the time step.                                        *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="comment">!</code></a>
    <a href="sasolve.html#sasolve" target="diffFile">factor = one</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (turbrelax .EQ. turbrelaxexplicit) factor = alfaturb</a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
          <a href="sasolve.html#sasolve" target="diffFile">w(i, j, k, itu1) = w(i, j, k, itu1) + factor*dvt(i, j, k, <code class="constant">1</code>)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">IF</code> (w(i, j, k, itu1) .LT. zero) <code class="keyword">THEN</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">w(i, j, k, itu1) = zero</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">ELSE</code></a>
            <a href="sasolve.html#sasolve" target="diffFile">w(i, j, k, itu1) = w(i, j, k, itu1)</a>
          <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END IF</code></a>
<a href="sasolve.html#sasolve" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">SASOLVE</code></a>
</pre>
</body>
