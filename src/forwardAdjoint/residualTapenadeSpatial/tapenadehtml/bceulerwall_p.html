<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="bceulerwall"></a><a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      * File:          bcEulerWall.f90                                 *</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      * Author:        Edwin van der Weide                             *</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      * Starting date: 03-07-2003                                      *</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      * Last modified: 06-12-2005                                      *</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">BCEULERWALL</code>(<code class="vardecl">secondhalo</code>, <code class="vardecl">correctfork</code>)</a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">USE </code><code class="funcname">CONSTANTS</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTDISCRETIZATION</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">USE </code><code class="funcname">ITERATION</code></a>
<a name="bceulerwalli0"></a>  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">USE </code><code class="funcname">BCTYPES</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      * bcEulerWall applies the inviscid wall boundary condition to    *</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      * a block. It is assumed that the pointers in blockPointers are  *</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      * already set to the correct block on the correct grid level.    *</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!      Subroutine arguments.</code></a>
<a name="bceulerwalli1"></a><a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="comment">!</code></a>
  <a href="bceulerwall.html#bceulerwalli0" target="diffFile"><code class="typename">LOGICAL</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">secondhalo</code>, <code class="vardecl">correctfork</code></a>
<a href="bceulerwall.html#bceulerwalli1" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#bceulerwalli1" target="diffFile"><code class="comment">!      Local variables.</code></a>
<a name="bceulerwalli2"></a><a href="bceulerwall.html#bceulerwalli1" target="diffFile"><code class="comment">!</code></a>
<a name="bceulerwalli3"></a>  <a href="bceulerwall.html#bceulerwalli1" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">nn</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">l</code></a>
<a name="bceulerwalli4"></a>  <a href="bceulerwall.html#bceulerwalli2" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">jm1</code>, <code class="vardecl">jp1</code>, <code class="vardecl">km1</code>, <code class="vardecl">kp1</code></a>
<a name="bceulerwalli5"></a>  <a href="bceulerwall.html#bceulerwalli3" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">walltreatment</code></a>
<a name="bceulerwalli6"></a>  <a href="bceulerwall.html#bceulerwalli4" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">sixa</code>, <code class="vardecl">siya</code>, <code class="vardecl">siza</code>, <code class="vardecl">sjxa</code>, <code class="vardecl">sjya</code>, <code class="vardecl">sjza</code></a>
<a name="bceulerwalli7"></a>  <a href="bceulerwall.html#bceulerwalli5" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">skxa</code>, <code class="vardecl">skya</code>, <code class="vardecl">skza</code>, <code class="vardecl">a1</code>, <code class="vardecl">b1</code></a>
<a name="bceulerwalli8"></a>  <a href="bceulerwall.html#bceulerwalli6" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rxj</code>, <code class="vardecl">ryj</code>, <code class="vardecl">rzj</code>, <code class="vardecl">rxk</code>, <code class="vardecl">ryk</code>, <code class="vardecl">rzk</code></a>
<a name="bceulerwalli9"></a>  <a href="bceulerwall.html#bceulerwalli7" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">dpj</code>, <code class="vardecl">dpk</code>, <code class="vardecl">ri</code>, <code class="vardecl">rj</code>, <code class="vardecl">rk</code>, <code class="vardecl">qj</code>, <code class="vardecl">qk</code>, <code class="vardecl">vn</code></a>
<a name="bceulerwalli10"></a>  <a href="bceulerwall.html#bceulerwalli8" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="vardecl">uz</code></a>
<a name="bceulerwalli11"></a>  <a href="bceulerwall.html#bceulerwalli9" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ww1</code>, <code class="vardecl">ww2</code></a>
<a name="bceulerwalli12"></a>  <a href="bceulerwall.html#bceulerwalli10" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">pp1</code>, <code class="vardecl">pp2</code></a>
<a name="bceulerwalli13"></a>  <a href="bceulerwall.html#bceulerwalli11" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">pp3</code>, <code class="vardecl">pp4</code></a>
<a name="bceulerwalli14"></a>  <a href="bceulerwall.html#bceulerwalli12" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rlv1</code>, <code class="vardecl">rlv2</code></a>
<a name="bceulerwalli15"></a>  <a href="bceulerwall.html#bceulerwalli13" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rev1</code>, <code class="vardecl">rev2</code></a>
<a name="bceulerwalli16"></a>  <a href="bceulerwall.html#bceulerwalli14" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ssi</code>, <code class="vardecl">ssj</code>, <code class="vardecl">ssk</code></a>
<a name="bceulerwalli17"></a>  <a href="bceulerwall.html#bceulerwalli15" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">norm</code></a>
  <a href="bceulerwall.html#bceulerwalli16" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rface</code></a>
  <a href="bceulerwall.html#bceulerwalli17" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ss</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="funcname">DIM</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MIN</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="typename">REAL(</code><code class="modifier">intType</code><code class="typename">) </code>:: <code class="vardecl">max2</code></a>
<a name="setbcpointers"></a>  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="typename">REAL(</code><code class="modifier">intType</code><code class="typename">) </code>:: <code class="vardecl">max1</code></a>
  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">INTERFACE </code></a>
      <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">SETBCPOINTERS</code>(<code class="vardecl">nn</code>, <code class="vardecl">ww1</code>, <code class="vardecl">ww2</code>, <code class="vardecl">pp1</code>, <code class="vardecl">pp2</code>, <code class="vardecl">rlv1</code>, <code class="vardecl">rlv2</code>, <code class="vardecl">rev1</code><code class="label">&</code></a>
<a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="label">&        </code>, <code class="vardecl">rev2</code>, <code class="vardecl">offset</code>)</a>
        <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
        <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">nn</code>, <code class="vardecl">offset</code></a>
        <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ww1</code>, <code class="vardecl">ww2</code></a>
        <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">pp1</code>, <code class="vardecl">pp2</code></a>
        <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rlv1</code>, <code class="vardecl">rlv2</code></a>
        <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rev1</code>, <code class="vardecl">rev2</code></a>
      <a href="bceulerwall.html#setbcpointers" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">SETBCPOINTERS</code></a>
<a name="setbcpointersi18"></a>  <a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">END INTERFACE</code></a>

<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#i18" target="diffFile"><code class="comment">! Make sure that on the coarser grids the constant pressure</code></a>
<a name="setbcpointersi20"></a><a name="setbcpointersi19"></a><a href="bceulerwall.html#i18" target="diffFile"><code class="comment">! boundary condition is used.</code></a>
<a name="setbcpointersi21"></a>  <a href="bceulerwall.html#i18" target="diffFile">walltreatment = wallbctreatment</a>
  <a href="bceulerwall.html#i19" target="diffFile"><code class="keyword">IF</code> (currentlevel .GT. groundlevel) </a><a href="bceulerwall.html#i20" target="diffFile">walltreatment = constantpressure</a>
<a name="setbcpointersi22"></a><a href="bceulerwall.html#i21" target="diffFile"><code class="comment">! Loop over the boundary condition subfaces of this block.</code></a>
<a href="bceulerwall.html#i21" target="diffFile"><code class="label">bocos:</code><code class="keyword">DO </code>nn=<code class="constant">1</code>,nbocos</a>
<a href="bceulerwall.html#i22" target="diffFile"><code class="comment">! Check for Euler wall boundary condition.</code></a>
    <a href="bceulerwall.html#i22" target="diffFile"><code class="keyword">IF</code> (bctype(nn) .EQ. eulerwall) <code class="keyword">THEN</code></a>
<a href="bceulerwall.html#i22" target="diffFile"><code class="comment">! Set the pointers for the unit normal and the normal</code></a>
<a href="bceulerwall.html#i22" target="diffFile"><code class="comment">! velocity to make the code more readable.</code></a>
<a name="setbcpointersi25"></a>      <a href="bceulerwall.html#i22" target="diffFile">norm => bcdata(nn)%norm</a>
      <a href="bceulerwall.html#i22" target="diffFile">rface => bcdata(nn)%rface</a>
<a href="bceulerwall.html#i25" target="diffFile"><code class="comment">! Nullify the pointers and set them to the correct subface.</code></a>
<a href="bceulerwall.html#i25" target="diffFile"><code class="comment">! They are nullified first, because some compilers require</code></a>
<a href="bceulerwall.html#i25" target="diffFile"><code class="comment">! that.</code></a>
<a name="p20"></a><a href="bceulerwall.html#i25" target="diffFile"><code class="comment">!nullify(ww1, ww2, pp1, pp2, rlv1, rlv2, rev1, rev2)</code></a>
<a name="setbcpointersi26"></a>      <a href="bceulerwall.html#i25" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SETBCPOINTERS</code>(nn, ww1, ww2, pp1, pp2, rlv1, rlv2, rev1, rev2<code class="label">&</code></a>
<a href="bceulerwall.html#i25" target="diffFile"><code class="label">&                   </code>, </a><a href="msg.html#p20" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="bceulerwall.html#i25" target="diffFile"><code class="constant">0_intType</code>)</a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!          **************************************************************</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!          *                                                            *</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!          * Determine the boundary condition treatment and compute the *</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!          * undivided pressure gradient accordingly. This gradient is  *</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!          * temporarily stored in the halo pressure.                   *</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!          *                                                            *</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!          **************************************************************</code></a>
<a href="bceulerwall.html#i26" target="diffFile"><code class="comment">!</code></a>
<a name="setbcpointersi27"></a>      <a href="bceulerwall.html#i26" target="diffFile"><code class="keyword">SELECT CASE </code> (walltreatment) </a>
      <a href="bceulerwall.html#i26" target="diffFile"><code class="keyword">CASE </code>(constantpressure) </a>
<a name="setbcpointersi28"></a><a href="bceulerwall.html#i27" target="diffFile"><code class="comment">! Constant pressure. Set the gradient to zero.</code></a>
<a name="setbcpointersi29"></a>        <a href="bceulerwall.html#i27" target="diffFile"><code class="keyword">DO </code>k=bcdata(nn)%jcbeg,bcdata(nn)%jcend</a>
          <a href="bceulerwall.html#i28" target="diffFile"><code class="keyword">DO </code>j=bcdata(nn)%icbeg,bcdata(nn)%icend</a>
            <a href="bceulerwall.html#i29" target="diffFile">pp1(j, k) = zero</a>
          <a href="bceulerwall.html#i28" target="diffFile"><code class="keyword">END DO</code></a>
<a name="setbcpointersi30"></a>        <a href="bceulerwall.html#i27" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="bceulerwall.html#i26" target="diffFile"><code class="keyword">CASE </code>(linextrapolpressure) </a>
<a href="bceulerwall.html#i30" target="diffFile"><code class="comment">!===========================================================</code></a>
<a href="bceulerwall.html#i30" target="diffFile"><code class="comment">! Linear extrapolation. First set the additional pointer</code></a>
<a href="bceulerwall.html#i30" target="diffFile"><code class="comment">! for pp3, depending on the block face.</code></a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">CASE </code>(imin) </a>
          <a href="bceulerwall.html#i30" target="diffFile">pp3 => p(<code class="constant">3</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">CASE </code>(imax) </a>
          <a href="bceulerwall.html#i30" target="diffFile">pp3 => p(nx, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">CASE </code>(jmin) </a>
          <a href="bceulerwall.html#i30" target="diffFile">pp3 => p(<code class="constant">1</code>:, <code class="constant">3</code>, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">CASE </code>(jmax) </a>
          <a href="bceulerwall.html#i30" target="diffFile">pp3 => p(<code class="constant">1</code>:, ny, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">CASE </code>(kmin) </a>
          <a href="bceulerwall.html#i30" target="diffFile">pp3 => p(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">3</code>)</a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">CASE </code>(kmax) </a>
<a name="setbcpointersi37"></a>          <a href="bceulerwall.html#i30" target="diffFile">pp3 => p(<code class="constant">1</code>:, <code class="constant">1</code>:, nz)</a>
        <a href="bceulerwall.html#i30" target="diffFile"><code class="keyword">END SELECT</code></a>
<a name="setbcpointersi38"></a><a href="bceulerwall.html#i37" target="diffFile"><code class="comment">! Compute the gradient.</code></a>
<a name="setbcpointersi39"></a>        <a href="bceulerwall.html#i37" target="diffFile"><code class="keyword">DO </code>k=bcdata(nn)%jcbeg,bcdata(nn)%jcend</a>
          <a href="bceulerwall.html#i38" target="diffFile"><code class="keyword">DO </code>j=bcdata(nn)%icbeg,bcdata(nn)%icend</a>
            <a href="bceulerwall.html#i39" target="diffFile">pp1(j, k) = pp3(j, k) - pp2(j, k)</a>
          <a href="bceulerwall.html#i38" target="diffFile"><code class="keyword">END DO</code></a>
<a name="setbcpointersi40"></a>        <a href="bceulerwall.html#i37" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="bceulerwall.html#i26" target="diffFile"><code class="keyword">CASE </code>(quadextrapolpressure) </a>
<a href="bceulerwall.html#i40" target="diffFile"><code class="comment">!===========================================================</code></a>
<a href="bceulerwall.html#i40" target="diffFile"><code class="comment">! Quadratic extrapolation. First set the additional</code></a>
<a href="bceulerwall.html#i40" target="diffFile"><code class="comment">! pointers for pp3 and pp4, depending on the block face.</code></a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">CASE </code>(imin) </a>
          <a href="bceulerwall.html#i40" target="diffFile">pp3 => p(<code class="constant">3</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
          <a href="bceulerwall.html#i40" target="diffFile">pp4 => p(<code class="constant">4</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">CASE </code>(imax) </a>
          <a href="bceulerwall.html#i40" target="diffFile">pp3 => p(nx, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
          <a href="bceulerwall.html#i40" target="diffFile">pp4 => p(nx-<code class="constant">1</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">CASE </code>(jmin) </a>
          <a href="bceulerwall.html#i40" target="diffFile">pp3 => p(<code class="constant">1</code>:, <code class="constant">3</code>, <code class="constant">1</code>:)</a>
          <a href="bceulerwall.html#i40" target="diffFile">pp4 => p(<code class="constant">1</code>:, <code class="constant">4</code>, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">CASE </code>(jmax) </a>
          <a href="bceulerwall.html#i40" target="diffFile">pp3 => p(<code class="constant">1</code>:, ny, <code class="constant">1</code>:)</a>
          <a href="bceulerwall.html#i40" target="diffFile">pp4 => p(<code class="constant">1</code>:, ny-<code class="constant">1</code>, <code class="constant">1</code>:)</a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">CASE </code>(kmin) </a>
          <a href="bceulerwall.html#i40" target="diffFile">pp3 => p(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">3</code>)</a>
          <a href="bceulerwall.html#i40" target="diffFile">pp4 => p(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">4</code>)</a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">CASE </code>(kmax) </a>
          <a href="bceulerwall.html#i40" target="diffFile">pp3 => p(<code class="constant">1</code>:, <code class="constant">1</code>:, nz)</a>
<a name="setbcpointersi53"></a>          <a href="bceulerwall.html#i40" target="diffFile">pp4 => p(<code class="constant">1</code>:, <code class="constant">1</code>:, nz-<code class="constant">1</code>)</a>
        <a href="bceulerwall.html#i40" target="diffFile"><code class="keyword">END SELECT</code></a>
<a name="setbcpointersi54"></a><a href="bceulerwall.html#i53" target="diffFile"><code class="comment">! Compute the gradient.</code></a>
<a name="setbcpointersi55"></a>        <a href="bceulerwall.html#i53" target="diffFile"><code class="keyword">DO </code>k=bcdata(nn)%jcbeg,bcdata(nn)%jcend</a>
          <a href="bceulerwall.html#i54" target="diffFile"><code class="keyword">DO </code>j=bcdata(nn)%icbeg,bcdata(nn)%icend</a>
            <a href="bceulerwall.html#i55" target="diffFile">pp1(j, k) = two*pp3(j, k) - <code class="constant">1.5_realType</code>*pp2(j, k) - half*<code class="label">&</code></a>
<a href="bceulerwall.html#i55" target="diffFile"><code class="label">&              </code>pp4(j, k)</a>
          <a href="bceulerwall.html#i54" target="diffFile"><code class="keyword">END DO</code></a>
<a name="setbcpointersi56"></a>        <a href="bceulerwall.html#i53" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="bceulerwall.html#i26" target="diffFile"><code class="keyword">CASE </code>(normalmomentum) </a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">!===========================================================</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! Pressure gradient is computed using the normal momentum</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! equation. First set a couple of additional variables for</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! the normals, depending on the block face. Note that the</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! construction 1: should not be used in these pointers,</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! because element 0 is needed. Consequently there will be</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! an offset of 1 for these normals. This is commented in</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! the code. For moving faces also the grid velocity of</code></a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">! the 1st cell center from the wall is needed.</code></a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">CASE </code>(imin) </a>
          <a href="bceulerwall.html#i56" target="diffFile">ssi => si(<code class="constant">1</code>, :, :, :)</a>
<a name="setbcpointersi60"></a>          <a href="bceulerwall.html#i56" target="diffFile">ssj => sj(<code class="constant">2</code>, :, :, :)</a>
          <a href="bceulerwall.html#i56" target="diffFile">ssk => sk(<code class="constant">2</code>, :, :, :)</a>
          <a href="bceulerwall.html#i60" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) <code class="keyword">THEN</code></a>
            <a href="bceulerwall.html#i60" target="diffFile">ss => s(<code class="constant">2</code>, :, :, :)</a>
          <a href="bceulerwall.html#i60" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">CASE </code>(imax) </a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">!=======================================================</code></a>
          <a href="bceulerwall.html#i56" target="diffFile">ssi => si(il, :, :, :)</a>
<a name="setbcpointersi65"></a>          <a href="bceulerwall.html#i56" target="diffFile">ssj => sj(il, :, :, :)</a>
          <a href="bceulerwall.html#i56" target="diffFile">ssk => sk(il, :, :, :)</a>
          <a href="bceulerwall.html#i65" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) <code class="keyword">THEN</code></a>
            <a href="bceulerwall.html#i65" target="diffFile">ss => s(il, :, :, :)</a>
          <a href="bceulerwall.html#i65" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">CASE </code>(jmin) </a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">!=======================================================</code></a>
          <a href="bceulerwall.html#i56" target="diffFile">ssi => sj(:, <code class="constant">1</code>, :, :)</a>
<a name="setbcpointersi70"></a>          <a href="bceulerwall.html#i56" target="diffFile">ssj => si(:, <code class="constant">2</code>, :, :)</a>
          <a href="bceulerwall.html#i56" target="diffFile">ssk => sk(:, <code class="constant">2</code>, :, :)</a>
          <a href="bceulerwall.html#i70" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) <code class="keyword">THEN</code></a>
            <a href="bceulerwall.html#i70" target="diffFile">ss => s(:, <code class="constant">2</code>, :, :)</a>
          <a href="bceulerwall.html#i70" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">CASE </code>(jmax) </a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">!=======================================================</code></a>
          <a href="bceulerwall.html#i56" target="diffFile">ssi => sj(:, jl, :, :)</a>
<a name="setbcpointersi75"></a>          <a href="bceulerwall.html#i56" target="diffFile">ssj => si(:, jl, :, :)</a>
          <a href="bceulerwall.html#i56" target="diffFile">ssk => sk(:, jl, :, :)</a>
          <a href="bceulerwall.html#i75" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) <code class="keyword">THEN</code></a>
            <a href="bceulerwall.html#i75" target="diffFile">ss => s(:, jl, :, :)</a>
          <a href="bceulerwall.html#i75" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">CASE </code>(kmin) </a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">!=======================================================</code></a>
          <a href="bceulerwall.html#i56" target="diffFile">ssi => sk(:, :, <code class="constant">1</code>, :)</a>
<a name="setbcpointersi80"></a>          <a href="bceulerwall.html#i56" target="diffFile">ssj => si(:, :, <code class="constant">2</code>, :)</a>
          <a href="bceulerwall.html#i56" target="diffFile">ssk => sj(:, :, <code class="constant">2</code>, :)</a>
          <a href="bceulerwall.html#i80" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) <code class="keyword">THEN</code></a>
            <a href="bceulerwall.html#i80" target="diffFile">ss => s(:, :, <code class="constant">2</code>, :)</a>
          <a href="bceulerwall.html#i80" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">CASE </code>(kmax) </a>
<a href="bceulerwall.html#i56" target="diffFile"><code class="comment">!=======================================================</code></a>
          <a href="bceulerwall.html#i56" target="diffFile">ssi => sk(:, :, kl, :)</a>
<a name="setbcpointersi85"></a>          <a href="bceulerwall.html#i56" target="diffFile">ssj => si(:, :, kl, :)</a>
          <a href="bceulerwall.html#i56" target="diffFile">ssk => sj(:, :, kl, :)</a>
          <a href="bceulerwall.html#i85" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) <code class="keyword">THEN</code></a>
            <a href="bceulerwall.html#i85" target="diffFile">ss => s(:, :, kl, :)</a>
<a name="setbcpointersi87"></a>          <a href="bceulerwall.html#i85" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="bceulerwall.html#i56" target="diffFile"><code class="keyword">END SELECT</code></a>
<a name="setbcpointersi88"></a><a href="bceulerwall.html#i87" target="diffFile"><code class="comment">! Loop over the faces of the generic subface.</code></a>
        <a href="bceulerwall.html#i87" target="diffFile"><code class="keyword">DO </code>k=bcdata(nn)%jcbeg,bcdata(nn)%jcend</a>
<a href="bceulerwall.html#i88" target="diffFile"><code class="comment">! Store the indices k+1, k-1 a bit easier and make</code></a>
<a name="setbcpointersi89"></a><a href="bceulerwall.html#i88" target="diffFile"><code class="comment">! sure that they do not exceed the range of the arrays.</code></a>
<a name="setbcpointersi91"></a>          <a href="bceulerwall.html#i88" target="diffFile">km1 = k - <code class="constant">1</code></a>
          <a href="bceulerwall.html#i89" target="diffFile"><code class="keyword">IF</code> (bcdata(nn)%jcbeg .LT. km1) <code class="keyword">THEN</code></a>
<a name="setbcpointersi90"></a>            <a href="bceulerwall.html#i91" target="diffFile">km1 = km1</a>
          <a href="bceulerwall.html#i89" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="setbcpointersi92"></a>            <a href="bceulerwall.html#i90" target="diffFile">km1 = bcdata(nn)%jcbeg</a>
<a name="setbcpointersi93"></a>          <a href="bceulerwall.html#i89" target="diffFile"><code class="keyword">END IF</code></a>
<a name="setbcpointersi95"></a>          <a href="bceulerwall.html#i92" target="diffFile">kp1 = k + <code class="constant">1</code></a>
          <a href="bceulerwall.html#i93" target="diffFile"><code class="keyword">IF</code> (bcdata(nn)%jcend .GT. kp1) <code class="keyword">THEN</code></a>
<a name="setbcpointersi94"></a>            <a href="bceulerwall.html#i95" target="diffFile">kp1 = kp1</a>
          <a href="bceulerwall.html#i93" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="setbcpointersi96"></a>            <a href="bceulerwall.html#i94" target="diffFile">kp1 = bcdata(nn)%jcend</a>
<a name="setbcpointersi98"></a>          <a href="bceulerwall.html#i93" target="diffFile"><code class="keyword">END IF</code></a>
          <a href="bceulerwall.html#i96" target="diffFile"><code class="keyword">IF</code> (<code class="constant">1_intType </code>.LT. kp1 - km1) <code class="keyword">THEN</code></a>
<a name="setbcpointersi97"></a>            <a href="bceulerwall.html#i98" target="diffFile">max1 = kp1 - km1</a>
          <a href="bceulerwall.html#i96" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="setbcpointersi99"></a>            <a href="bceulerwall.html#i97" target="diffFile">max1 = <code class="constant">1_intType</code></a>
          <a href="bceulerwall.html#i96" target="diffFile"><code class="keyword">END IF</code></a>
<a href="bceulerwall.html#i99" target="diffFile"><code class="comment">! Compute the scaling factor for the central difference</code></a>
<a name="setbcpointersi100"></a><a href="bceulerwall.html#i99" target="diffFile"><code class="comment">! in the k-direction.</code></a>
          <a href="bceulerwall.html#i99" target="diffFile">b1 = one/max1</a>
<a name="setbcpointersi101"></a><a href="bceulerwall.html#i100" target="diffFile"><code class="comment">! The j-loop.</code></a>
          <a href="bceulerwall.html#i100" target="diffFile"><code class="keyword">DO </code>j=bcdata(nn)%icbeg,bcdata(nn)%icend</a>
<a href="bceulerwall.html#i101" target="diffFile"><code class="comment">! The indices j+1 and j-1. Make sure that they</code></a>
<a name="setbcpointersi102"></a><a href="bceulerwall.html#i101" target="diffFile"><code class="comment">! do not exceed the range of the arrays.</code></a>
<a name="setbcpointersi104"></a>            <a href="bceulerwall.html#i101" target="diffFile">jm1 = j - <code class="constant">1</code></a>
            <a href="bceulerwall.html#i102" target="diffFile"><code class="keyword">IF</code> (bcdata(nn)%icbeg .LT. jm1) <code class="keyword">THEN</code></a>
<a name="setbcpointersi103"></a>              <a href="bceulerwall.html#i104" target="diffFile">jm1 = jm1</a>
            <a href="bceulerwall.html#i102" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="setbcpointersi105"></a>              <a href="bceulerwall.html#i103" target="diffFile">jm1 = bcdata(nn)%icbeg</a>
<a name="setbcpointersi106"></a>            <a href="bceulerwall.html#i102" target="diffFile"><code class="keyword">END IF</code></a>
<a name="setbcpointersi108"></a>            <a href="bceulerwall.html#i105" target="diffFile">jp1 = j + <code class="constant">1</code></a>
            <a href="bceulerwall.html#i106" target="diffFile"><code class="keyword">IF</code> (bcdata(nn)%icend .GT. jp1) <code class="keyword">THEN</code></a>
<a name="setbcpointersi107"></a>              <a href="bceulerwall.html#i108" target="diffFile">jp1 = jp1</a>
            <a href="bceulerwall.html#i106" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="setbcpointersi109"></a>              <a href="bceulerwall.html#i107" target="diffFile">jp1 = bcdata(nn)%icend</a>
<a name="setbcpointersi111"></a>            <a href="bceulerwall.html#i106" target="diffFile"><code class="keyword">END IF</code></a>
            <a href="bceulerwall.html#i109" target="diffFile"><code class="keyword">IF</code> (<code class="constant">1_intType </code>.LT. jp1 - jm1) <code class="keyword">THEN</code></a>
<a name="setbcpointersi110"></a>              <a href="bceulerwall.html#i111" target="diffFile">max2 = jp1 - jm1</a>
            <a href="bceulerwall.html#i109" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="setbcpointersi112"></a>              <a href="bceulerwall.html#i110" target="diffFile">max2 = <code class="constant">1_intType</code></a>
            <a href="bceulerwall.html#i109" target="diffFile"><code class="keyword">END IF</code></a>
<a href="bceulerwall.html#i112" target="diffFile"><code class="comment">! Compute the scaling factor for the central</code></a>
<a name="setbcpointersi113"></a><a href="bceulerwall.html#i112" target="diffFile"><code class="comment">! difference in the j-direction.</code></a>
            <a href="bceulerwall.html#i112" target="diffFile">a1 = one/max2</a>
<a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! Compute (twice) the average normal in the generic i,</code></a>
<a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! j and k-direction. Note that in j and k-direction</code></a>
<a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! the average in the original indices should be taken</code></a>
<a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! using j-1 and j (and k-1 and k). However due to the</code></a>
<a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! usage of pointers ssj and ssk there is an offset in</code></a>
<a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! the indices of 1 and therefore now the correct</code></a>
<a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! average is obtained with the indices j and j+1</code></a>
<a name="setbcpointersi114"></a><a href="bceulerwall.html#i113" target="diffFile"><code class="comment">! (k and k+1).</code></a>
<a name="setbcpointersi115"></a>            <a href="bceulerwall.html#i113" target="diffFile">sixa = two*ssi(j, k, <code class="constant">1</code>)</a>
<a name="setbcpointersi116"></a>            <a href="bceulerwall.html#i114" target="diffFile">siya = two*ssi(j, k, <code class="constant">2</code>)</a>
<a name="setbcpointersi117"></a>            <a href="bceulerwall.html#i115" target="diffFile">siza = two*ssi(j, k, <code class="constant">3</code>)</a>
<a name="setbcpointersi118"></a>            <a href="bceulerwall.html#i116" target="diffFile">sjxa = ssj(j, k, <code class="constant">1</code>) + ssj(j+<code class="constant">1</code>, k, <code class="constant">1</code>)</a>
<a name="setbcpointersi119"></a>            <a href="bceulerwall.html#i117" target="diffFile">sjya = ssj(j, k, <code class="constant">2</code>) + ssj(j+<code class="constant">1</code>, k, <code class="constant">2</code>)</a>
<a name="setbcpointersi120"></a>            <a href="bceulerwall.html#i118" target="diffFile">sjza = ssj(j, k, <code class="constant">3</code>) + ssj(j+<code class="constant">1</code>, k, <code class="constant">3</code>)</a>
<a name="setbcpointersi121"></a>            <a href="bceulerwall.html#i119" target="diffFile">skxa = ssk(j, k, <code class="constant">1</code>) + ssk(j, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="setbcpointersi122"></a>            <a href="bceulerwall.html#i120" target="diffFile">skya = ssk(j, k, <code class="constant">2</code>) + ssk(j, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
            <a href="bceulerwall.html#i121" target="diffFile">skza = ssk(j, k, <code class="constant">3</code>) + ssk(j, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="bceulerwall.html#i122" target="diffFile"><code class="comment">! Compute the difference of the normal vector and</code></a>
<a href="bceulerwall.html#i122" target="diffFile"><code class="comment">! pressure in j and k-direction. As the indices are</code></a>
<a href="bceulerwall.html#i122" target="diffFile"><code class="comment">! restricted to the 1st halo-layer, the computation</code></a>
<a href="bceulerwall.html#i122" target="diffFile"><code class="comment">! of the internal halo values is not consistent;</code></a>
<a href="bceulerwall.html#i122" target="diffFile"><code class="comment">! however this is not really a problem, because these</code></a>
<a name="setbcpointersi123"></a><a href="bceulerwall.html#i122" target="diffFile"><code class="comment">! values are overwritten in the communication pattern.</code></a>
<a name="setbcpointersi124"></a>            <a href="bceulerwall.html#i122" target="diffFile">rxj = a1*(norm(jp1, k, <code class="constant">1</code>)-norm(jm1, k, <code class="constant">1</code>))</a>
<a name="setbcpointersi125"></a>            <a href="bceulerwall.html#i123" target="diffFile">ryj = a1*(norm(jp1, k, <code class="constant">2</code>)-norm(jm1, k, <code class="constant">2</code>))</a>
<a name="setbcpointersi126"></a>            <a href="bceulerwall.html#i124" target="diffFile">rzj = a1*(norm(jp1, k, <code class="constant">3</code>)-norm(jm1, k, <code class="constant">3</code>))</a>
<a name="setbcpointersi127"></a>            <a href="bceulerwall.html#i125" target="diffFile">dpj = a1*(pp2(jp1, k)-pp2(jm1, k))</a>
<a name="setbcpointersi128"></a>            <a href="bceulerwall.html#i126" target="diffFile">rxk = b1*(norm(j, kp1, <code class="constant">1</code>)-norm(j, km1, <code class="constant">1</code>))</a>
<a name="setbcpointersi129"></a>            <a href="bceulerwall.html#i127" target="diffFile">ryk = b1*(norm(j, kp1, <code class="constant">2</code>)-norm(j, km1, <code class="constant">2</code>))</a>
<a name="setbcpointersi130"></a>            <a href="bceulerwall.html#i128" target="diffFile">rzk = b1*(norm(j, kp1, <code class="constant">3</code>)-norm(j, km1, <code class="constant">3</code>))</a>
            <a href="bceulerwall.html#i129" target="diffFile">dpk = b1*(pp2(j, kp1)-pp2(j, km1))</a>
<a href="bceulerwall.html#i130" target="diffFile"><code class="comment">! Compute the dot product between the unit vector</code></a>
<a href="bceulerwall.html#i130" target="diffFile"><code class="comment">! and the normal vectors in i, j and k-direction.</code></a>
<a name="setbcpointersi131"></a>            <a href="bceulerwall.html#i130" target="diffFile">ri = norm(j, k, <code class="constant">1</code>)*sixa + norm(j, k, <code class="constant">2</code>)*siya + norm(j, k, <code class="constant">3</code>)<code class="label">&</code></a>
<a href="bceulerwall.html#i130" target="diffFile"><code class="label">&              </code>*siza</a>
<a name="setbcpointersi132"></a>            <a href="bceulerwall.html#i131" target="diffFile">rj = norm(j, k, <code class="constant">1</code>)*sjxa + norm(j, k, <code class="constant">2</code>)*sjya + norm(j, k, <code class="constant">3</code>)<code class="label">&</code></a>
<a href="bceulerwall.html#i131" target="diffFile"><code class="label">&              </code>*sjza</a>
<a name="setbcpointersi133"></a>            <a href="bceulerwall.html#i132" target="diffFile">rk = norm(j, k, <code class="constant">1</code>)*skxa + norm(j, k, <code class="constant">2</code>)*skya + norm(j, k, <code class="constant">3</code>)<code class="label">&</code></a>
<a href="bceulerwall.html#i132" target="diffFile"><code class="label">&              </code>*skza</a>
<a href="bceulerwall.html#i133" target="diffFile"><code class="comment">! Store the velocity components in ux, uy and uz and</code></a>
<a name="setbcpointersi134"></a><a href="bceulerwall.html#i133" target="diffFile"><code class="comment">! subtract the mesh velocity if the face is moving.</code></a>
<a name="setbcpointersi135"></a>            <a href="bceulerwall.html#i133" target="diffFile">ux = ww2(j, k, ivx)</a>
<a name="setbcpointersi136"></a>            <a href="bceulerwall.html#i134" target="diffFile">uy = ww2(j, k, ivy)</a>
<a name="setbcpointersi137"></a>            <a href="bceulerwall.html#i135" target="diffFile">uz = ww2(j, k, ivz)</a>
<a name="setbcpointersi138"></a>            <a href="bceulerwall.html#i136" target="diffFile"><code class="keyword">IF</code> (addgridvelocities) <code class="keyword">THEN</code></a>
<a name="setbcpointersi139"></a>              <a href="bceulerwall.html#i137" target="diffFile">ux = ux - ss(j, k, <code class="constant">1</code>)</a>
              <a href="bceulerwall.html#i138" target="diffFile">uy = uy - ss(j, k, <code class="constant">2</code>)</a>
<a name="setbcpointersi140"></a>              <a href="bceulerwall.html#i139" target="diffFile">uz = uz - ss(j, k, <code class="constant">3</code>)</a>
            <a href="bceulerwall.html#i136" target="diffFile"><code class="keyword">END IF</code></a>
<a href="bceulerwall.html#i140" target="diffFile"><code class="comment">! Compute the velocity components in j and</code></a>
<a name="setbcpointersi141"></a><a href="bceulerwall.html#i140" target="diffFile"><code class="comment">! k-direction.</code></a>
<a name="setbcpointersi142"></a>            <a href="bceulerwall.html#i140" target="diffFile">qj = ux*sjxa + uy*sjya + uz*sjza</a>
            <a href="bceulerwall.html#i141" target="diffFile">qk = ux*skxa + uy*skya + uz*skza</a>
<a href="bceulerwall.html#i142" target="diffFile"><code class="comment">! Compute the pressure gradient, which is stored</code></a>
<a href="bceulerwall.html#i142" target="diffFile"><code class="comment">! in pp1. I'm not entirely sure whether this</code></a>
<a href="bceulerwall.html#i142" target="diffFile"><code class="comment">! formulation is correct for moving meshes. It could</code></a>
<a href="bceulerwall.html#i142" target="diffFile"><code class="comment">! be that an additional term is needed there.</code></a>
            <a href="bceulerwall.html#i142" target="diffFile">pp1(j, k) = ((qj*(ux*rxj+uy*ryj+uz*rzj)+qk*(ux*rxk+uy*ryk+uz<code class="label">&</code></a>
<a href="bceulerwall.html#i142" target="diffFile"><code class="label">&              </code>*rzk))*ww2(j, k, irho)-rj*dpj-rk*dpk)/ri</a>
          <a href="bceulerwall.html#i100" target="diffFile"><code class="keyword">END DO</code></a>
<a name="setbcpointersi143"></a>        <a href="bceulerwall.html#i87" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="bceulerwall.html#i26" target="diffFile"><code class="keyword">END SELECT</code></a>
<a href="bceulerwall.html#i143" target="diffFile"><code class="comment">! Determine the state in the halo cell. Again loop over</code></a>
<a name="setbcpointersi144"></a><a href="bceulerwall.html#i143" target="diffFile"><code class="comment">! the cell range for this subface.</code></a>
<a name="setbcpointersi145"></a>      <a href="bceulerwall.html#i143" target="diffFile"><code class="keyword">DO </code>k=bcdata(nn)%jcbeg,bcdata(nn)%jcend</a>
        <a href="bceulerwall.html#i144" target="diffFile"><code class="keyword">DO </code>j=bcdata(nn)%icbeg,bcdata(nn)%icend</a>
<a href="bceulerwall.html#i145" target="diffFile"><code class="comment">! Compute the pressure density and velocity in the</code></a>
<a href="bceulerwall.html#i145" target="diffFile"><code class="comment">! halo cell. Note that rface is the grid velocity</code></a>
<a href="bceulerwall.html#i145" target="diffFile"><code class="comment">! component in the direction of norm, i.e. outward</code></a>
<a name="setbcpointersi146"></a><a href="bceulerwall.html#i145" target="diffFile"><code class="comment">! pointing.</code></a>
          <a href="bceulerwall.html#i145" target="diffFile">pp1(j, k) = <code class="funcname">DIM</code>(pp2(j, k), pp1(j, k))</a>
<a name="setbcpointersi147"></a>          <a href="bceulerwall.html#i146" target="diffFile">vn = two*(rface(j, k)-ww2(j, k, ivx)*norm(j, k, <code class="constant">1</code>)-ww2(j, k, <code class="label">&</code></a>
<a name="setbcpointersi148"></a><a href="bceulerwall.html#i146" target="diffFile"><code class="label">&            </code>ivy)*norm(j, k, <code class="constant">2</code>)-ww2(j, k, ivz)*norm(j, k, <code class="constant">3</code>))</a>
<a name="setbcpointersi149"></a>          <a href="bceulerwall.html#i147" target="diffFile">ww1(j, k, irho) = ww2(j, k, irho)</a>
<a name="setbcpointersi150"></a>          <a href="bceulerwall.html#i148" target="diffFile">ww1(j, k, ivx) = ww2(j, k, ivx) + vn*norm(j, k, <code class="constant">1</code>)</a>
<a name="setbcpointersi151"></a>          <a href="bceulerwall.html#i149" target="diffFile">ww1(j, k, ivy) = ww2(j, k, ivy) + vn*norm(j, k, <code class="constant">2</code>)</a>
          <a href="bceulerwall.html#i150" target="diffFile">ww1(j, k, ivz) = ww2(j, k, ivz) + vn*norm(j, k, <code class="constant">3</code>)</a>
<a name="setbcpointersi152"></a><a href="bceulerwall.html#i151" target="diffFile"><code class="comment">! Just copy the turbulent variables.</code></a>
          <a href="bceulerwall.html#i151" target="diffFile"><code class="keyword">DO </code>l=nt1mg,nt2mg</a>
<a name="setbcpointersi153"></a>            <a href="bceulerwall.html#i152" target="diffFile">ww1(j, k, l) = ww2(j, k, l)</a>
<a name="setbcpointersi154"></a>          <a href="bceulerwall.html#i151" target="diffFile"><code class="keyword">END DO</code></a>
<a name="setbcpointersi156"></a><a name="setbcpointersi155"></a><a href="bceulerwall.html#i153" target="diffFile"><code class="comment">! The laminar and eddy viscosity, if present.</code></a>
          <a href="bceulerwall.html#i153" target="diffFile"><code class="keyword">IF</code> (viscous) </a><a href="bceulerwall.html#i154" target="diffFile">rlv1(j, k) = rlv2(j, k)</a>
          <a href="bceulerwall.html#i155" target="diffFile"><code class="keyword">IF</code> (eddymodel) </a><a href="bceulerwall.html#i156" target="diffFile">rev1(j, k) = rev2(j, k)</a>
<a name="setbcpointersi157"></a>        <a href="bceulerwall.html#i144" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="bceulerwall.html#i143" target="diffFile"><code class="keyword">END DO</code></a>
<a href="bceulerwall.html#i157" target="diffFile"><code class="comment">! Compute the energy for these halo's.</code></a>
<a name="setbcpointersi158"></a>      <a href="bceulerwall.html#i157" target="diffFile"><code class="keyword">CALL </code><code class="funcname">COMPUTEETOT</code>(icbeg(nn), icend(nn), jcbeg(nn), jcend(nn), kcbeg<code class="label">&</code></a>
<a href="bceulerwall.html#i157" target="diffFile"><code class="label">&                 </code>(nn), kcend(nn), correctfork)</a>
<a name="setbcpointersi159"></a><a href="bceulerwall.html#i158" target="diffFile"><code class="comment">! Extrapolate the state vectors in case a second halo</code></a>
<a href="bceulerwall.html#i158" target="diffFile"><code class="comment">! is needed.</code></a>
      <a href="bceulerwall.html#i158" target="diffFile"><code class="keyword">IF</code> (secondhalo) </a><a href="bceulerwall.html#i159" target="diffFile"><code class="keyword">CALL </code><code class="funcname">EXTRAPOLATE2NDHALO</code>(nn, correctfork)</a>
    <a href="bceulerwall.html#i22" target="diffFile"><code class="keyword">END IF</code></a>
  <a href="bceulerwall.html#i21" target="diffFile"><code class="keyword">END DO </code><code class="label">bocos</code></a>
<a href="bceulerwall.html#bceulerwall" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">BCEULERWALL</code></a>
</pre>
</body>
