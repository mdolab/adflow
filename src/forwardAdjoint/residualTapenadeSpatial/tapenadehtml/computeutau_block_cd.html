<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="computeutau_block_cd"></a><a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * File:          computeUtau.f90                                 *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * Author:        Georgi Kalitzin, Edwin van der Weide            *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * Starting date: 03-03-2004                                      *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * Last modified: 03-25-2005                                      *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">COMPUTEUTAU_BLOCK_CD</code>()</a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">USE </code><code class="funcname">BCTYPES_SPATIAL_D</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS_SPATIAL_D</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">USE </code><code class="funcname">ITERATION_SPATIAL_D</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL_SPATIAL_D</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * computeUtau computes the skin friction velocity for the        *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * viscous subfaces. This data is only needed if wall functions   *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * are used.                                                      *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      Local variables.</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">sps</code>, <code class="vardecl">nn</code>, <code class="vardecl">mm</code>, <code class="vardecl">i</code>, <code class="vardecl">j</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">re</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code>, <code class="vardecl">veln</code>, <code class="vardecl">veltmag</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ww</code>, <code class="vardecl">norm</code>, <code class="vardecl">uslip</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">dd2wall</code>, <code class="vardecl">rrlv</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">utau</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      Function definition.</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="funcname">CURVEUPRE_CD</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">x1</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max1</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">y1</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Return immediately if no wall functions must be used.</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">IF</code> (.NOT.wallfunctions) <code class="keyword">THEN</code></a>
    <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">RETURN</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">ELSE</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Loop over the number of spectral solutions and local blocks.</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Loop over the viscous subfaces of this block.</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="label">viscsubfaces:</code><code class="keyword">DO </code>mm=<code class="constant">1</code>,nviscbocos</a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Set a bunch of pointers depending on the face id to make</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! a generic treatment possible.</code></a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(mm)) </a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">ww => w(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">dd2wall => d2wall(<code class="constant">2</code>, :, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">rrlv => rlv(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">CASE </code>(imax) </a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!=========================================================</code></a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">ww => w(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">dd2wall => d2wall(il, :, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">rrlv => rlv(il, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!=========================================================</code></a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">ww => w(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">dd2wall => d2wall(:, <code class="constant">2</code>, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!=========================================================</code></a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">ww => w(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">dd2wall => d2wall(:, jl, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">rrlv => rlv(<code class="constant">1</code>:, jl, <code class="constant">1</code>:)</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!=========================================================</code></a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">ww => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">dd2wall => d2wall(:, :, <code class="constant">2</code>)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>)</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">!=========================================================</code></a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">ww => w(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">dd2wall => d2wall(:, :, kl)</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, kl)</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END SELECT</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Set the pointers for the unit outward normals, uSlip</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! and utau to make the code more readable.</code></a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile">norm => bcdata(mm)%norm</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile">uslip => bcdata(mm)%uslip</a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile">utau => viscsubface(mm)%utau</a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Loop over the quadrilateral faces of the subface. Note</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! that the nodal range of BCData must be used and not the</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! cell range, because the latter may include the halo's in i</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! and j-direction. The offset +1 is there, because inBeg and</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! jnBeg refer to nodal ranges and not to cell ranges.</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Note that an offset of -1 must be used in dd2Wall, because</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! the original array d2Wall starts at 2.</code></a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">DO </code>j=bcdata(mm)%jnbeg+<code class="constant">1</code>,bcdata(mm)%jnend</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">DO </code>i=bcdata(mm)%inbeg+<code class="constant">1</code>,bcdata(mm)%inend</a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Compute the velocity difference between the internal</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! cell and the wall.</code></a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">vx = ww(i, j, ivx) - uslip(i, j, <code class="constant">1</code>)</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">vy = ww(i, j, ivy) - uslip(i, j, <code class="constant">2</code>)</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">vz = ww(i, j, ivz) - uslip(i, j, <code class="constant">3</code>)</a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Compute the normal velocity of the internal cell.</code></a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">veln = vx*norm(i, j, <code class="constant">1</code>) + vy*norm(i, j, <code class="constant">2</code>) + vz*norm(i, j, <code class="constant">3</code>)</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">arg1 = vx*vx + vy*vy + vz*vz - veln*veln</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">y1 = <code class="funcname">SQRT</code>(arg1)</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">IF</code> (eps .LT. y1) <code class="keyword">THEN</code></a>
            <a href="computeutau_block_p.html#computeutau_block" target="origFile">veltmag = y1</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="computeutau_block_p.html#computeutau_block" target="origFile">veltmag = eps</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END IF</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Compute the Reynolds number. Note that an offset of -1</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! must be used in dd2Wall, because the original array</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! d2Wall starts at 2.</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="comment">! Afterwards compute utau.</code></a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">re = ww(i, j, irho)*veltmag*dd2wall(i-<code class="constant">1</code>, j-<code class="constant">1</code>)/rrlv(i, j)</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">x1 = <code class="funcname">CURVEUPRE_CD</code>(re)</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">IF</code> (x1 .LT. eps) <code class="keyword">THEN</code></a>
            <a href="computeutau_block_p.html#computeutau_block" target="origFile">max1 = eps</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="computeutau_block_p.html#computeutau_block" target="origFile">max1 = x1</a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END IF</code></a>
          <a href="computeutau_block_p.html#computeutau_block" target="origFile">utau(i, j) = veltmag/max1</a>
        <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END DO</code></a>
      <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END DO</code></a>
    <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END DO </code><code class="label">viscsubfaces</code></a>
  <a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END IF</code></a>
<a href="computeutau_block_p.html#computeutau_block" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">COMPUTEUTAU_BLOCK_CD</code></a>
</pre>
</body>
