<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="vfeddyviscosity_cd"></a><a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      ==================================================================</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">VFEDDYVISCOSITY_CD</code>()</a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">USE </code><code class="funcname">BCTYPES_SPATIAL_D</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS_SPATIAL_D</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">USE </code><code class="funcname">PARAMTURB_SPATIAL_D</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">USE </code><code class="funcname">CONSTANTS_SPATIAL_D</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">USE </code><code class="funcname">TURBMOD_SPATIAL_D</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! call curveTupYp(tup(itu5:itu5), yp, itu5, itu5)</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! rrev(i,j) = tup(itu5)*rrlv(i,j)</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      * vfEddyViscosity computes the eddy-viscosity according to the   *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      * v2f turbulence model for the block given in blockPointers.     *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      * This routine is for both the n=1 and n=6 version.              *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      Local variables.</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">nn</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tke</code>, <code class="vardecl">tep</code>, <code class="vardecl">tkea</code>, <code class="vardecl">tepa</code>, <code class="vardecl">tepl</code>, <code class="vardecl">tv2</code>, <code class="vardecl">tv2a</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">yp</code>, <code class="vardecl">utau</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>itu1:itu5<code class="typename">) </code>:: <code class="vardecl">tup</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ww</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rrlv</code>, <code class="vardecl">rrev</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">dd2wall</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">EXTERNAL </code><code class="funcname">VFSCALE</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">ABS</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a name="p35"></a><a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">!</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! Compute time and length scale</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">CALL </code></a><a href="msg.html#p35" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="funcname">VFSCALE</code>()</a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! Loop over the cells of this block and compute the eddy viscosity.</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! Do not include halo's.</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
    <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tke = w(i, j, k, itu1)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tep = w(i, j, k, itu2)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tv2 = w(i, j, k, itu3)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">IF</code> (tke .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tkea = tke</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tkea = -tke</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END IF</code></a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">IF</code> (tep .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tepa = tep</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tepa = -tep</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END IF</code></a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">IF</code> (tv2 .GE. <code class="constant">0.</code>) <code class="keyword">THEN</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tv2a = tv2</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tv2a = -tv2</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END IF</code></a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">IF</code> (tepa .LT. rvflimite) <code class="keyword">THEN</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tepl = rvflimite</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">tepl = tepa</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END IF</code></a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rev(i, j, k) = rvfcmu*w(i, j, k, irho)*tv2a/tepl*sct(i, j, k)</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END DO</code></a>
    <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END DO</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END DO</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! Modify the rhs of the 1st internal cell, if wall functions</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! are used; their value is determined by the table.</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">IF</code> (wallfunctions) <code class="keyword">THEN</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="label">bocos:</code><code class="keyword">DO </code>nn=<code class="constant">1</code>,nviscbocos</a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! Determine the block face on which the subface is located</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! and set some variables. As flag points to the entire array</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! flagI2, etc., its starting indices are the starting indices</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! of its target and not 1.</code></a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">ww => w(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrlv => rlv(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">dd2wall => d2wall(<code class="constant">2</code>, :, :)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrev => rev(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">CASE </code>(imax) </a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">ww => w(il, <code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrlv => rlv(il, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">dd2wall => d2wall(il, :, :)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrev => rev(il, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">ww => w(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">dd2wall => d2wall(:, <code class="constant">2</code>, :)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrev => rev(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">ww => w(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrlv => rlv(<code class="constant">1</code>:, jl, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">dd2wall => d2wall(:, jl, :)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrev => rev(<code class="constant">1</code>:, jl, <code class="constant">1</code>:)</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">ww => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">dd2wall => d2wall(:, :, <code class="constant">2</code>)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrev => rev(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>)</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">ww => w(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, <code class="constant">1</code>:)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrlv => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, kl)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">dd2wall => d2wall(:, :, kl)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">rrev => rev(<code class="constant">1</code>:, <code class="constant">1</code>:, kl)</a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END SELECT</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! Loop over the owned faces of this subface. Therefore the</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! nodal range of bcData must be used. The offset of +1 is</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! present, because the starting index of the cell range is</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! 1 larger than the starting index of the nodal range.</code></a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">DO </code>j=bcdata(nn)%jnbeg+<code class="constant">1</code>,bcdata(nn)%jnend</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">DO </code>i=bcdata(nn)%inbeg+<code class="constant">1</code>,bcdata(nn)%inend</a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! Enforce k and epsilon in the 1st internal cell from</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! the wall function table. There is an offset of -1 in</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! the wall distance. Note that the offset compared to</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! the current value must be stored. Also note that the</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="comment">! curve fits contain the non-dimensional values.</code></a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">utau = viscsubface(nn)%utau(i, j)</a>
          <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile">yp = ww(i, j, irho)*dd2wall(i-<code class="constant">1</code>, j-<code class="constant">1</code>)*utau/rrlv(i, j)</a>
        <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END DO</code></a>
      <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END DO</code></a>
    <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END DO </code><code class="label">bocos</code></a>
  <a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END IF</code></a>
<a href="vfeddyviscosity_p.html#vfeddyviscosity" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">VFEDDYVISCOSITY_CD</code></a>
</pre>
</body>
