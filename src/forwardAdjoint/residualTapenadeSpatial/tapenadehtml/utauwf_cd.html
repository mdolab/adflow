<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="utauwf_cd"></a><a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * File:          utauWF.f90                                      *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * Author:        Georgi Kalitzin, Edwin van der Weide            *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * Starting date: 10-01-2003                                      *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * Last modified: 06-12-2005                                      *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">UTAUWF_CD</code>(<code class="vardecl">rfilv</code>)</a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">BCTYPES_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE_SPATIAL_D</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * utauWF substitutes the wall shear stress with values from a    *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * look-up table, if desired.                                     *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      Subroutine argument.</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">INTENT(IN) </code>:: <code class="vardecl">rfilv</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      Local variables.</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">nn</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fact</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxx</code>, <code class="vardecl">tauyy</code>, <code class="vardecl">tauzz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxy</code>, <code class="vardecl">tauxz</code>, <code class="vardecl">tauyz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rbar</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmx</code>, <code class="vardecl">fmy</code>, <code class="vardecl">fmz</code>, <code class="vardecl">frhoe</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">veln</code>, <code class="vardecl">velnx</code>, <code class="vardecl">velny</code>, <code class="vardecl">velnz</code>, <code class="vardecl">tx</code>, <code class="vardecl">ty</code>, <code class="vardecl">tz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">veltx</code>, <code class="vardecl">velty</code>, <code class="vardecl">veltz</code>, <code class="vardecl">veltmag</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">txnx</code>, <code class="vardecl">txny</code>, <code class="vardecl">txnz</code>, <code class="vardecl">tynx</code>, <code class="vardecl">tyny</code>, <code class="vardecl">tynz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tznx</code>, <code class="vardecl">tzny</code>, <code class="vardecl">tznz</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tautn</code>, <code class="vardecl">tauwall</code>, <code class="vardecl">utau</code>, <code class="vardecl">re</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ww1</code>, <code class="vardecl">ww2</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">ss</code>, <code class="vardecl">rres</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">norm</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">rrlv2</code>, <code class="vardecl">dd2wall2</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      Function definition.</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="funcname">CURVEUPRE_CD</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">x1</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">max1</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">y1</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Return immediately if no wall functions must be used.</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">IF</code> (.NOT.wallfunctions) <code class="keyword">THEN</code></a>
    <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">RETURN</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">ELSE</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Loop over the viscous subfaces of this block.</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">viscsubfaces:</code><code class="keyword">DO </code>nn=<code class="constant">1</code>,nviscbocos</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Set a bunch of variables depending on the face id to make</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! a generic treatment possible.</code></a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(nn)) </a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="utauwf_p.html#utauwf" target="origFile">fact = -one</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ss => si(<code class="constant">1</code>, :, :, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rres => fw(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww2 => w(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww1 => w(<code class="constant">1</code>, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">dd2wall2 => d2wall(<code class="constant">2</code>, :, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rrlv2 => rlv(<code class="constant">2</code>, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">CASE </code>(imax) </a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwf" target="origFile">fact = one</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ss => si(il, :, :, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rres => fw(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww2 => w(il, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww1 => w(ie, <code class="constant">1</code>:, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">dd2wall2 => d2wall(il, :, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rrlv2 => rlv(il, <code class="constant">1</code>:, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwf" target="origFile">fact = -one</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ss => sj(:, <code class="constant">1</code>, :, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rres => fw(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">dd2wall2 => d2wall(:, <code class="constant">2</code>, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">2</code>, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwf" target="origFile">fact = one</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ss => sj(:, jl, :, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rres => fw(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww2 => w(<code class="constant">1</code>:, jl, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww1 => w(<code class="constant">1</code>:, je, <code class="constant">1</code>:, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">dd2wall2 => d2wall(:, jl, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, jl, <code class="constant">1</code>:)</a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwf" target="origFile">fact = -one</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ss => sk(:, :, <code class="constant">1</code>, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rres => fw(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">1</code>, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">dd2wall2 => d2wall(:, :, <code class="constant">2</code>)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, <code class="constant">2</code>)</a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">!===========================================================</code></a>
        <a href="utauwf_p.html#utauwf" target="origFile">fact = one</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ss => sk(:, :, kl, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rres => fw(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww2 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, kl, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">ww1 => w(<code class="constant">1</code>:, <code class="constant">1</code>:, ke, :)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">dd2wall2 => d2wall(:, :, kl)</a>
        <a href="utauwf_p.html#utauwf" target="origFile">rrlv2 => rlv(<code class="constant">1</code>:, <code class="constant">1</code>:, kl)</a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END SELECT</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Set the pointer for the unit outward normals.</code></a>
      <a href="utauwf_p.html#utauwf" target="origFile">norm => bcdata(nn)%norm</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Loop over the quadrilateral faces of the subface. Note</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! that the nodal range of BCData must be used and not the</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! cell range, because the latter may include the halo's in i</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! and j-direction. The offset +1 is there, because inBeg and</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! jnBeg refer to nodal ranges and not to cell ranges.</code></a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">DO </code>j=bcdata(nn)%jnbeg+<code class="constant">1</code>,bcdata(nn)%jnend</a>
        <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">DO </code>i=bcdata(nn)%inbeg+<code class="constant">1</code>,bcdata(nn)%inend</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Store the viscous stress tensor a bit easier.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauxx = viscsubface(nn)%tau(i, j, <code class="constant">1</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauyy = viscsubface(nn)%tau(i, j, <code class="constant">2</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauzz = viscsubface(nn)%tau(i, j, <code class="constant">3</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauxy = viscsubface(nn)%tau(i, j, <code class="constant">4</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauxz = viscsubface(nn)%tau(i, j, <code class="constant">5</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauyz = viscsubface(nn)%tau(i, j, <code class="constant">6</code>)</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the velocities at the wall face; these are only</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! non-zero for moving a block. Also compute the density,</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! which is needed to compute the wall shear stress via</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! wall functions.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">rbar = half*(ww2(i, j, irho)+ww1(i, j, irho))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">ubar = half*(ww2(i, j, ivx)+ww1(i, j, ivx))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">vbar = half*(ww2(i, j, ivy)+ww1(i, j, ivy))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">wbar = half*(ww2(i, j, ivz)+ww1(i, j, ivz))</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the velocity difference between the internal cell</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! and the wall.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">vx = ww2(i, j, ivx) - ubar</a>
          <a href="utauwf_p.html#utauwf" target="origFile">vy = ww2(i, j, ivy) - vbar</a>
          <a href="utauwf_p.html#utauwf" target="origFile">vz = ww2(i, j, ivz) - wbar</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the normal velocity of the internal cell.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">veln = vx*norm(i, j, <code class="constant">1</code>) + vy*norm(i, j, <code class="constant">2</code>) + vz*norm(i, j, <code class="constant">3</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">velnx = veln*norm(i, j, <code class="constant">1</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">velny = veln*norm(i, j, <code class="constant">2</code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">velnz = veln*norm(i, j, <code class="constant">3</code>)</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the tangential velocity, its magnitude and its</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! unit vector of the internal cell.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">veltx = vx - velnx</a>
          <a href="utauwf_p.html#utauwf" target="origFile">velty = vy - velny</a>
          <a href="utauwf_p.html#utauwf" target="origFile">veltz = vz - velnz</a>
          <a href="utauwf_p.html#utauwf" target="origFile">arg1 = veltx**<code class="constant">2 </code>+ velty**<code class="constant">2 </code>+ veltz**<code class="constant">2</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">y1 = <code class="funcname">SQRT</code>(arg1)</a>
          <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">IF</code> (eps .LT. y1) <code class="keyword">THEN</code></a>
            <a href="utauwf_p.html#utauwf" target="origFile">veltmag = y1</a>
          <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="utauwf_p.html#utauwf" target="origFile">veltmag = eps</a>
          <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END IF</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">tx = veltx/veltmag</a>
          <a href="utauwf_p.html#utauwf" target="origFile">ty = velty/veltmag</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tz = veltz/veltmag</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute some coefficients needed for the transformation</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! between the cartesian frame and the frame defined by the</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! tangential direction (tx,ty,tz) and the normal direction.</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! The minus sign is present, because for this transformation</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! the normal direction should be inward pointing and norm</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! is outward pointing.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">txnx = -(tx*norm(i, j, <code class="constant">1</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">txny = -(tx*norm(i, j, <code class="constant">2</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">txnz = -(tx*norm(i, j, <code class="constant">3</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tynx = -(ty*norm(i, j, <code class="constant">1</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tyny = -(ty*norm(i, j, <code class="constant">2</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tynz = -(ty*norm(i, j, <code class="constant">3</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tznx = -(tz*norm(i, j, <code class="constant">1</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tzny = -(tz*norm(i, j, <code class="constant">2</code>))</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tznz = -(tz*norm(i, j, <code class="constant">3</code>))</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the tn component of the wall shear stress</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! tensor. Normally this is the only nonzero shear</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! stress component in the t-n frame.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">tautn = tauxx*txnx + tauyy*tyny + tauzz*tznz + tauxy*(txny+<code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>tynx) + tauxz*(txnz+tznx) + tauyz*(tynz+tzny)</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the Reynolds number using the velocity, density,</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! laminar viscosity and wall distance. Note that an offset</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! of -1 must be used in dd2Wall2, because the original array</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! d2Wall starts at 2.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">re = ww2(i, j, irho)*veltmag*dd2wall2(i-<code class="constant">1</code>, j-<code class="constant">1</code>)/rrlv2(i, j)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">x1 = <code class="funcname">CURVEUPRE_CD</code>(re)</a>
          <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">IF</code> (x1 .LT. eps) <code class="keyword">THEN</code></a>
            <a href="utauwf_p.html#utauwf" target="origFile">max1 = eps</a>
          <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="utauwf_p.html#utauwf" target="origFile">max1 = x1</a>
          <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END IF</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Determine the friction velocity from the table and</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! compute the wall shear stress from it.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">utau = veltmag/max1</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauwall = rbar*utau*utau</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the correction to the wall shear stress tautn and</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! transform this correction back to the cartesian frame.</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Take rFilv into account, such that the correction to the</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! stress tensor is computed correctly.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">tautn = rfilv*tauwall - tautn</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauxx = two*tautn*txnx</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauyy = two*tautn*tyny</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauzz = two*tautn*tznz</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauxy = tautn*(txny+tynx)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauxz = tautn*(txnz+tznx)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">tauyz = tautn*(tynz+tzny)</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Compute the correction to the viscous flux at the wall.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">fmx = tauxx*ss(i, j, <code class="constant">1</code>) + tauxy*ss(i, j, <code class="constant">2</code>) + tauxz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">fmy = tauxy*ss(i, j, <code class="constant">1</code>) + tauyy*ss(i, j, <code class="constant">2</code>) + tauyz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">fmz = tauxz*ss(i, j, <code class="constant">1</code>) + tauyz*ss(i, j, <code class="constant">2</code>) + tauzz*ss(i, j, <code class="constant">3</code><code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>)</a>
          <a href="utauwf_p.html#utauwf" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*ss(i, j, <code class="constant">1</code>) + (ubar<code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>*tauxy+vbar*tauyy+wbar*tauyz)*ss(i, j, <code class="constant">2</code>) + (ubar*tauxz+vbar<code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>*tauyz+wbar*tauzz)*ss(i, j, <code class="constant">3</code>)</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Add them to the residual. Note that now the factor rFilv</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! is already taken into account via tau. Fact is present to</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! take inward/outward pointing normals into account</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">rres(i, j, imx) = rres(i, j, imx) - fact*fmx</a>
          <a href="utauwf_p.html#utauwf" target="origFile">rres(i, j, imy) = rres(i, j, imy) - fact*fmy</a>
          <a href="utauwf_p.html#utauwf" target="origFile">rres(i, j, imz) = rres(i, j, imz) - fact*fmz</a>
          <a href="utauwf_p.html#utauwf" target="origFile">rres(i, j, irhoe) = rres(i, j, irhoe) - fact*frhoe</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Store the friction velocity for later use.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">viscsubface(nn)%utau(i, j) = utau</a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="comment">! Also add the correction to the wall stress tensor.</code></a>
          <a href="utauwf_p.html#utauwf" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = viscsubface(nn)%tau(i, j, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>tauxx</a>
          <a href="utauwf_p.html#utauwf" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = viscsubface(nn)%tau(i, j, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>tauyy</a>
          <a href="utauwf_p.html#utauwf" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = viscsubface(nn)%tau(i, j, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>tauzz</a>
          <a href="utauwf_p.html#utauwf" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = viscsubface(nn)%tau(i, j, <code class="constant">4</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>tauxy</a>
          <a href="utauwf_p.html#utauwf" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = viscsubface(nn)%tau(i, j, <code class="constant">5</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>tauxz</a>
          <a href="utauwf_p.html#utauwf" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = viscsubface(nn)%tau(i, j, <code class="constant">6</code>) + <code class="label">&</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="label">&            </code>tauyz</a>
        <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END DO</code></a>
      <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END DO</code></a>
    <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END DO </code><code class="label">viscsubfaces</code></a>
  <a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END IF</code></a>
<a href="utauwf_p.html#utauwf" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">UTAUWF_CD</code></a>
</pre>
</body>
