<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="block_res_spatial"></a><a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">!</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! This is a super-combined function that combines the original</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! functionality of: </code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! Pressure Computation</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! timeStep</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! applyAllBCs</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! initRes</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! residual </code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! The real difference between this and the original modules is that it</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! it only operates on a single block at a time and as such the</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! block/sps loop is outside the calculation. This routine is suitable</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="comment">! for forward mode AD with Tapenade</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">BLOCK_RES_SPATIAL</code>(<code class="vardecl">nn</code>, <code class="vardecl">sps</code>)</a>
  <a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS</code></a>
  <a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
  <a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL</code></a>
  <a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE</code></a>
<a name="block_res_spatiali0"></a>  <a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">USE </code><code class="funcname">ITERATION</code></a>
  <a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="block_res_spatial.html#block_res_spatiali0" target="diffFile"><code class="comment">!,x_peturb)</code></a>
<a href="block_res_spatial.html#block_res_spatiali0" target="diffFile"><code class="comment">! i/j/kl/b/e, i/j/k/Min/MaxBoundaryStencil</code></a>
<a name="block_res_spatiali1"></a><a href="block_res_spatial.html#block_res_spatiali0" target="diffFile"><code class="comment">! nw</code></a>
<a name="block_res_spatiali2"></a>  <a href="block_res_spatial.html#block_res_spatiali0" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">gm1</code>, <code class="vardecl">v2</code></a>
  <a href="block_res_spatial.html#block_res_spatiali1" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">nn</code>, <code class="vardecl">sps</code>, <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">sps2</code>, <code class="vardecl">mm</code>, <code class="vardecl">l</code></a>
<a name="block_res_spatiali3"></a>  <a href="block_res_spatial.html#block_res_spatiali2" target="diffFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">correctfork</code></a>
<a name="p44"></a>  <a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">MAX</code></a>
<a name="block_res_spatiali4"></a><a href="block_res_spatial.html#block_res_spatiali3" target="diffFile"><code class="comment">!  logical :: x_peturb(0:ie,0:je,0:ke,3)</code></a>
  <a href="block_res_spatial.html#block_res_spatiali3" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE</code>(nn, sps, </a><a href="msg.html#p44" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial.html#block_res_spatiali3" target="diffFile">sps)</a>
<a name="block_res_spatiali5"></a><a href="block_res_spatial.html#block_res_spatiali4" target="diffFile"><code class="comment">! Do the spatial things first:</code></a>
  <a href="block_res_spatial.html#block_res_spatiali4" target="diffFile"><code class="keyword">CALL </code><code class="funcname">XHALO_BLOCK</code>(<code class="constant">1</code>)</a>
<a name="block_res_spatiali6"></a><a href="block_res_spatial.html#block_res_spatiali5" target="diffFile"><code class="comment">!,x_peturb)</code></a>
  <a href="block_res_spatial.html#block_res_spatiali5" target="diffFile"><code class="keyword">CALL </code><code class="funcname">METRIC_BLOCK</code>(nn, <code class="constant">1</code>, sps)</a>
<a href="block_res_spatial.html#block_res_spatiali6" target="diffFile"><code class="comment">! call gridVelocities(useOldCoor, t, sps) ! Required for TS</code></a>
<a href="block_res_spatial.html#block_res_spatiali6" target="diffFile"><code class="comment">! call normalVelocitiesAllLevels(sps) ! Required for TS</code></a>
<a name="block_res_spatiali7"></a><a href="block_res_spatial.html#block_res_spatiali6" target="diffFile"><code class="comment">! Compute the pressures</code></a>
<a name="block_res_spatiali8"></a>  <a href="block_res_spatial.html#block_res_spatiali6" target="diffFile">gm1 = gammaconstant - one</a>
  <a href="block_res_spatial.html#block_res_spatiali7" target="diffFile">correctfork = <code class="constant">.false.</code></a>
<a name="block_res_spatiali9"></a><a href="block_res_spatial.html#block_res_spatiali8" target="diffFile"><code class="comment">! Compute P </code></a>
<a name="block_res_spatiali10"></a>  <a href="block_res_spatial.html#block_res_spatiali8" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">0</code>,kb</a>
<a name="block_res_spatiali11"></a>    <a href="block_res_spatial.html#block_res_spatiali9" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">0</code>,jb</a>
      <a href="block_res_spatial.html#block_res_spatiali10" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ib</a>
<a name="block_res_spatiali12"></a>        <a href="block_res_spatial.html#block_res_spatiali11" target="diffFile">v2 = w(i, j, k, ivx)**<code class="constant">2 </code>+ w(i, j, k, ivy)**<code class="constant">2 </code>+ w(i, j, k, ivz)**<code class="label">&</code></a>
<a name="block_res_spatiali13"></a><a href="block_res_spatial.html#block_res_spatiali11" target="diffFile"><code class="label">&          </code><code class="constant">2</code></a>
<a name="block_res_spatiali15"></a>        <a href="block_res_spatial.html#block_res_spatiali12" target="diffFile">p(i, j, k) = gm1*(w(i, j, k, irhoe)-half*w(i, j, k, irho)*v2)</a>
        <a href="block_res_spatial.html#block_res_spatiali13" target="diffFile"><code class="keyword">IF</code> (p(i, j, k) .LT. <code class="constant">1.e-4_realType</code>*pinfcorr) <code class="keyword">THEN</code></a>
<a name="block_res_spatiali14"></a>          <a href="block_res_spatial.html#block_res_spatiali15" target="diffFile">p(i, j, k) = <code class="constant">1.e-4_realType</code>*pinfcorr</a>
        <a href="block_res_spatial.html#block_res_spatiali13" target="diffFile"><code class="keyword">ELSE</code></a>
          <a href="block_res_spatial.html#block_res_spatiali14" target="diffFile">p(i, j, k) = p(i, j, k)</a>
        <a href="block_res_spatial.html#block_res_spatiali13" target="diffFile"><code class="keyword">END IF</code></a>
      <a href="block_res_spatial.html#block_res_spatiali10" target="diffFile"><code class="keyword">END DO</code></a>
<a name="block_res_spatiali16"></a>    <a href="block_res_spatial.html#block_res_spatiali9" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="block_res_spatial.html#block_res_spatiali8" target="diffFile"><code class="keyword">END DO</code></a>
<a href="block_res_spatial.html#block_res_spatiali16" target="diffFile"><code class="comment">!call computeEtot(0,ib,0,jb,0,kb,correctForK)</code></a>
<a name="block_res_spatiali17"></a><a href="block_res_spatial.html#block_res_spatiali16" target="diffFile"><code class="comment">!  Apply all BC's</code></a>
  <a href="block_res_spatial.html#block_res_spatiali16" target="diffFile"><code class="keyword">CALL </code><code class="funcname">APPLYALLBC_BLOCK</code>(<code class="constant">.true.</code>)</a>
<a name="block_res_spatiali18"></a><a href="block_res_spatial.html#block_res_spatiali17" target="diffFile"><code class="comment">! Compute skin_friction Velocity</code></a>
  <a href="block_res_spatial.html#block_res_spatiali17" target="diffFile"><code class="keyword">CALL </code><code class="funcname">COMPUTEUTAU_BLOCK</code>()</a>
<a name="block_res_spatiali19"></a><a href="block_res_spatial.html#block_res_spatiali18" target="diffFile"><code class="comment">! Compute time step and spectral radius</code></a>
  <a href="block_res_spatial.html#block_res_spatiali18" target="diffFile"><code class="keyword">CALL </code><code class="funcname">TIMESTEP_BLOCK</code>(<code class="constant">.false.</code>)</a>
<a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="comment">!   if( equations == RANSEquations ) then</code></a>
<a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="comment">!      call initres_block(nt1MG, nMGVar,nn,sps) ! Initialize only the Turblent Variables</code></a>
<a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="comment">!      call turbResidual_block</code></a>
<a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="comment">!   endif</code></a>
<a name="block_res_spatiali20"></a>  <a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="keyword">SELECT CASE </code> (equationmode) </a>
  <a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="keyword">CASE </code>(steady) </a>
<a name="block_res_spatiali21"></a>    <a href="block_res_spatial.html#block_res_spatiali20" target="diffFile">dw = <code class="constant">0.0</code></a>
<a name="p45"></a><a name="block_res_spatiali22"></a>  <a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="keyword">CASE </code>(timespectral) </a>
<a name="block_res_spatiali23"></a>    <a href="block_res_spatial.html#block_res_spatiali21" target="diffFile"><code class="keyword">DO </code>sps2=<code class="constant">1</code>,ntimeintervalsspectral</a>
<a name="block_res_spatiali24"></a>      <a href="block_res_spatial.html#block_res_spatiali22" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE</code>(nn, sps2, </a><a href="msg.html#p45" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial.html#block_res_spatiali22" target="diffFile">sps2)</a>
<a name="block_res_spatiali25"></a>      <a href="block_res_spatial.html#block_res_spatiali23" target="diffFile">dw = <code class="constant">0.0</code></a>
<a name="block_res_spatiali26"></a>      <a href="block_res_spatial.html#block_res_spatiali24" target="diffFile"><code class="keyword">DO </code>mm=<code class="constant">1</code>,ntimeintervalsspectral</a>
        <a href="block_res_spatial.html#block_res_spatiali25" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE</code>(nn, sps2, mm)</a>
        <a href="block_res_spatial.html#block_res_spatiali26" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INITRES_BLOCK_TS</code>(<code class="constant">1</code>, nwf, nn, sps2, mm)</a>
      <a href="block_res_spatial.html#block_res_spatiali24" target="diffFile"><code class="keyword">END DO</code></a>
<a name="block_res_spatiali27"></a>    <a href="block_res_spatial.html#block_res_spatiali21" target="diffFile"><code class="keyword">END DO</code></a>
<a name="p46"></a>  <a href="block_res_spatial.html#block_res_spatiali19" target="diffFile"><code class="keyword">END SELECT</code></a>
<a name="block_res_spatiali28"></a><a href="block_res_spatial.html#block_res_spatiali27" target="diffFile"><code class="comment">! Rest the pointers the the "on time instance"</code></a>
  <a href="block_res_spatial.html#block_res_spatiali27" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE</code>(nn, sps, </a><a href="msg.html#p46" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial.html#block_res_spatiali27" target="diffFile">sps)</a>
<a name="block_res_spatiali29"></a><a href="block_res_spatial.html#block_res_spatiali28" target="diffFile"><code class="comment">! Actual residual calc</code></a>
  <a href="block_res_spatial.html#block_res_spatiali28" target="diffFile"><code class="keyword">CALL </code><code class="funcname">RESIDUAL_BLOCK</code>()</a>
<a name="p47"></a><a name="block_res_spatiali30"></a><a href="block_res_spatial.html#block_res_spatiali29" target="diffFile"><code class="comment">! Divide through by the volume</code></a>
<a name="block_res_spatiali31"></a>  <a href="block_res_spatial.html#block_res_spatiali29" target="diffFile"><code class="keyword">DO </code>sps2=<code class="constant">1</code>,ntimeintervalsspectral</a>
<a name="block_res_spatiali32"></a>    <a href="block_res_spatial.html#block_res_spatiali30" target="diffFile"><code class="keyword">CALL </code><code class="funcname">SETPOINTERSOFFTSINSTANCE</code>(nn, sps2, </a><a href="msg.html#p47" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="block_res_spatial.html#block_res_spatiali30" target="diffFile">sps2)</a>
<a name="block_res_spatiali33"></a>    <a href="block_res_spatial.html#block_res_spatiali31" target="diffFile"><code class="keyword">DO </code>l=<code class="constant">1</code>,nw</a>
<a name="block_res_spatiali34"></a>      <a href="block_res_spatial.html#block_res_spatiali32" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
<a name="block_res_spatiali35"></a>        <a href="block_res_spatial.html#block_res_spatiali33" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
          <a href="block_res_spatial.html#block_res_spatiali34" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
            <a href="block_res_spatial.html#block_res_spatiali35" target="diffFile">dw(i, j, k, l) = dw(i, j, k, l)/vol(i, j, k)</a>
          <a href="block_res_spatial.html#block_res_spatiali34" target="diffFile"><code class="keyword">END DO</code></a>
        <a href="block_res_spatial.html#block_res_spatiali33" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="block_res_spatial.html#block_res_spatiali32" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="block_res_spatial.html#block_res_spatiali31" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="block_res_spatial.html#block_res_spatiali29" target="diffFile"><code class="keyword">END DO</code></a>
<a href="block_res_spatial.html#block_res_spatial" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">BLOCK_RES_SPATIAL</code></a>
</pre>
</body>
