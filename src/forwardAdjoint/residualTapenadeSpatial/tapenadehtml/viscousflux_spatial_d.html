<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="viscousflux_spatial_d"></a><a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!  Differentiation of viscousflux in forward (tangent) mode:</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!   variations   of useful results: *fw</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!   with respect to varying inputs: *p *gamma *w *x *vol *si *sj</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!                *sk *fw prandtlturb prandtl</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * File:          viscousFlux.f90                                 *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * Author:        Edwin van der Weide                             *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * Starting date: 03-21-2003                                      *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * Last modified: 04-18-2005                                      *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">VISCOUSFLUX_SPATIAL_D</code>()</a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">ITERATION_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">DIFFSIZES</code></a>
<a name="viscousflux_spatial_di0"></a><a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!  Hint: ISIZE3OFviscsubface should be the size of dimension 3 of array viscsubface</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      * viscousFlux computes the viscous fluxes using a central        *</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      * difference scheme for a block.                                 *</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      * It is assumed that the pointers in block pointer already point *</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      * to the correct block.                                          *</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!      Local parameter.</code></a>
<a name="viscousflux_spatial_di1"></a><a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="comment">!</code></a>
  <a href="viscousflux_p.html#viscousfluxi0" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">twothird</code>=<code class="vardecl">two</code>*<code class="vardecl">third</code></a>
<a href="viscousflux_p.html#viscousfluxi1" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi1" target="origFile"><code class="comment">!      Local variables.</code></a>
<a name="viscousflux_spatial_di2"></a><a href="viscousflux_p.html#viscousfluxi1" target="origFile"><code class="comment">!</code></a>
<a name="viscousflux_spatial_di3"></a>  <a href="viscousflux_p.html#viscousfluxi1" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">nn</code></a>
  <a href="viscousflux_p.html#viscousfluxi2" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="vardecl">kk</code></a>
<a name="viscousflux_spatial_di4"></a>  <a href="viscousflux_p.html#viscousfluxi3" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rfilv</code>, <code class="vardecl">por</code>, <code class="vardecl">mul</code>, <code class="vardecl">mue</code>, <code class="vardecl">mut</code>, <code class="vardecl">heatcoef</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">heatcoefd</code></a>
<a name="viscousflux_spatial_di5"></a>  <a href="viscousflux_p.html#viscousfluxi4" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">gm1</code>, <code class="vardecl">factlamheat</code>, <code class="vardecl">factturbheat</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">gm1d</code>, <code class="vardecl">factlamheatd</code>, <code class="vardecl">factturbheatd</code></a>
  <a href="viscousflux_p.html#viscousfluxi5" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">u_x</code>, <code class="vardecl">u_y</code>, <code class="vardecl">u_z</code>, <code class="vardecl">v_x</code>, <code class="vardecl">v_y</code>, <code class="vardecl">v_z</code>, <code class="vardecl">w_x</code>, <code class="vardecl">w_y</code>, <code class="vardecl">w_z</code></a>
<a name="viscousflux_spatial_di6"></a>  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">u_xd</code>, <code class="vardecl">u_yd</code>, <code class="vardecl">u_zd</code>, <code class="vardecl">v_xd</code>, <code class="vardecl">v_yd</code>, <code class="vardecl">v_zd</code>, <code class="vardecl">w_xd</code>, <code class="vardecl">w_yd</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&  </code>, <code class="vardecl">w_zd</code></a>
<a name="viscousflux_spatial_di7"></a>  <a href="viscousflux_p.html#viscousfluxi6" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">q_x</code>, <code class="vardecl">q_y</code>, <code class="vardecl">q_z</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">q_xd</code>, <code class="vardecl">q_yd</code>, <code class="vardecl">q_zd</code>, <code class="vardecl">ubard</code>, <code class="vardecl">vbard</code>, <code class="vardecl">wbard</code></a>
<a name="viscousflux_spatial_di8"></a>  <a href="viscousflux_p.html#viscousfluxi7" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">corr</code>, <code class="vardecl">ssx</code>, <code class="vardecl">ssy</code>, <code class="vardecl">ssz</code>, <code class="vardecl">ss</code>, <code class="vardecl">fracdiv</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">corrd</code>, <code class="vardecl">ssxd</code>, <code class="vardecl">ssyd</code>, <code class="vardecl">sszd</code>, <code class="vardecl">ssd</code>, <code class="vardecl">fracdivd</code></a>
<a name="viscousflux_spatial_di9"></a>  <a href="viscousflux_p.html#viscousfluxi8" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxx</code>, <code class="vardecl">tauyy</code>, <code class="vardecl">tauzz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxxd</code>, <code class="vardecl">tauyyd</code>, <code class="vardecl">tauzzd</code></a>
<a name="viscousflux_spatial_di10"></a>  <a href="viscousflux_p.html#viscousfluxi9" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxy</code>, <code class="vardecl">tauxz</code>, <code class="vardecl">tauyz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxyd</code>, <code class="vardecl">tauxzd</code>, <code class="vardecl">tauyzd</code></a>
<a name="viscousflux_spatial_di11"></a>  <a href="viscousflux_p.html#viscousfluxi10" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmx</code>, <code class="vardecl">fmy</code>, <code class="vardecl">fmz</code>, <code class="vardecl">frhoe</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmxd</code>, <code class="vardecl">fmyd</code>, <code class="vardecl">fmzd</code>, <code class="vardecl">frhoed</code></a>
<a name="viscousflux_spatial_di12"></a>  <a href="viscousflux_p.html#viscousfluxi11" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="vardecl">uz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(il, jl, <code class="constant">2</code>) :: <code class="vardecl">uxd</code>, <code class="vardecl">uyd</code>, <code class="vardecl">uzd</code></a>
<a name="viscousflux_spatial_di13"></a>  <a href="viscousflux_p.html#viscousfluxi12" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(il, jl, <code class="constant">2</code>) :: <code class="vardecl">vxd</code>, <code class="vardecl">vyd</code>, <code class="vardecl">vzd</code></a>
<a name="viscousflux_spatial_di14"></a>  <a href="viscousflux_p.html#viscousfluxi13" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(il, jl, <code class="constant">2</code>) :: <code class="vardecl">wxd</code>, <code class="vardecl">wyd</code>, <code class="vardecl">wzd</code></a>
<a name="viscousflux_spatial_di15"></a>  <a href="viscousflux_p.html#viscousfluxi14" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="vardecl">qz</code></a>
<a name="viscousflux_spatial_di16"></a>  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(il, jl, <code class="constant">2</code>) :: <code class="vardecl">qxd</code>, <code class="vardecl">qyd</code>, <code class="vardecl">qzd</code></a>
  <a href="viscousflux_p.html#viscousfluxi15" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">correctfork</code>, <code class="vardecl">storewalltensor</code></a>
<a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a name="viscousflux_spatial_di17"></a><a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="comment">! </code></a>
  <a href="viscousflux_p.html#viscousfluxi16" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">unitvf</code>=<code class="constant">1011</code>, <code class="vardecl">ierror</code></a>
<a name="viscousflux_spatial_di18"></a>  <a href="viscousflux_p.html#viscousfluxi17" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1d</code></a>
  <a href="viscousflux_p.html#viscousfluxi18" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">result1</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">result1d</code></a>
<a name="viscousflux_spatial_di19"></a>  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">ii1</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a name="p18"></a><a name="viscousflux_spatial_di21"></a><a name="viscousflux_spatial_di20"></a>  <a href="viscousflux_p.html#viscousfluxi19" target="origFile"><code class="keyword">OPEN</code>(<code class="keyword">unit</code>=unitvf, <code class="keyword">file</code>=<code class="string">'verifyvf.out'</code>, <code class="keyword">status</code>=<code class="string">'replace'</code>, <code class="keyword">action</code>=<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi19" target="origFile"><code class="label">& </code><code class="string">'write'</code>, <code class="keyword">iostat</code>=ierror) </a>
  <a href="viscousflux_p.html#viscousfluxi20" target="origFile"><code class="keyword">IF</code> (ierror .NE. <code class="constant">0</code>) </a><a href="msg.html#p18" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="viscousflux_p.html#viscousfluxi21" target="origFile"><code class="keyword">CALL </code><code class="funcname">TERMINATE_CD</code>(<code class="string">'verifyvf'</code>, <code class="label">&</code></a>
<a name="viscousflux_spatial_di22"></a><a href="viscousflux_p.html#viscousfluxi21" target="origFile"><code class="label">&                                 </code><code class="string">'Something wrong when '</code>, <code class="string">'calling open'</code><code class="label">&</code></a>
<a name="viscousflux_spatial_di23"></a><a href="viscousflux_p.html#viscousfluxi21" target="origFile"><code class="label">&                                </code>)</a>
  <a href="viscousflux_p.html#viscousfluxi22" target="origFile"><code class="keyword">PRINT*</code>, <code class="string">'ierror:'</code>, ierror</a>
<a href="viscousflux_p.html#viscousfluxi23" target="origFile"><code class="comment">! Set rFilv to rFil to indicate that this is the viscous part.</code></a>
<a href="viscousflux_p.html#viscousfluxi23" target="origFile"><code class="comment">! If rFilv == 0 the viscous residuals need not to be computed</code></a>
<a name="p19"></a><a name="viscousflux_spatial_di24"></a><a href="viscousflux_p.html#viscousfluxi23" target="origFile"><code class="comment">! and a return can be made.</code></a>
<a name="viscousflux_spatial_di25"></a>  <a href="viscousflux_p.html#viscousfluxi23" target="origFile">rfilv = rfil</a>
  <a href="viscousflux_p.html#viscousfluxi24" target="origFile"><code class="keyword">IF</code> (</a><a href="msg.html#p19" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="viscousflux_p.html#viscousfluxi24" target="origFile">rfilv .EQ. zero) <code class="keyword">THEN</code></a>
<a name="viscousflux_spatial_di26"></a>    <a href="viscousflux_p.html#viscousfluxi25" target="origFile"><code class="keyword">RETURN</code></a>
  <a href="viscousflux_p.html#viscousfluxi24" target="origFile"><code class="keyword">ELSE</code></a>
<a href="viscousflux_p.html#viscousfluxi26" target="origFile"><code class="comment">! Determine whether or not the pressure must be corrected</code></a>
<a name="viscousflux_spatial_di27"></a><a href="viscousflux_p.html#viscousfluxi26" target="origFile"><code class="comment">! for the presence of the turbulent kinetic energy.</code></a>
<a name="viscousflux_spatial_di28"></a>    <a href="viscousflux_p.html#viscousfluxi26" target="origFile"><code class="keyword">IF</code> (kpresent) <code class="keyword">THEN</code></a>
      <a href="viscousflux_p.html#viscousfluxi27" target="origFile"><code class="keyword">IF</code> (currentlevel .LE. groundlevel .OR. turbcoupled) <code class="keyword">THEN</code></a>
<a name="viscousflux_spatial_di29"></a>        <a href="viscousflux_p.html#viscousfluxi28" target="origFile">correctfork = <code class="constant">.true.</code></a>
      <a href="viscousflux_p.html#viscousfluxi27" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="viscousflux_p.html#viscousfluxi29" target="origFile">correctfork = <code class="constant">.false.</code></a>
<a name="viscousflux_spatial_di30"></a>      <a href="viscousflux_p.html#viscousfluxi27" target="origFile"><code class="keyword">END IF</code></a>
    <a href="viscousflux_p.html#viscousfluxi26" target="origFile"><code class="keyword">ELSE</code></a>
<a name="viscousflux_spatial_di31"></a>      <a href="viscousflux_p.html#viscousfluxi30" target="origFile">correctfork = <code class="constant">.false.</code></a>
    <a href="viscousflux_p.html#viscousfluxi26" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousfluxi31" target="origFile"><code class="comment">! Determine whether or not the wall stress tensor and wall heat</code></a>
<a name="viscousflux_spatial_di32"></a><a href="viscousflux_p.html#viscousfluxi31" target="origFile"><code class="comment">! flux must be stored for viscous walls.</code></a>
<a name="viscousflux_spatial_di33"></a>    <a href="viscousflux_p.html#viscousfluxi31" target="origFile">storewalltensor = <code class="constant">.false.</code></a>
<a name="viscousflux_spatial_di34"></a>    <a href="viscousflux_p.html#viscousfluxi32" target="origFile"><code class="keyword">IF</code> (wallfunctions) <code class="keyword">THEN</code></a>
<a name="viscousflux_spatial_di35"></a>      <a href="viscousflux_p.html#viscousfluxi33" target="origFile">storewalltensor = <code class="constant">.true.</code></a>
    <a href="viscousflux_p.html#viscousfluxi32" target="origFile"><code class="keyword">ELSE </code></a><a href="viscousflux_p.html#viscousfluxi34" target="origFile"><code class="keyword">IF</code> (rkstage .EQ. <code class="constant">0 </code>.AND. currentlevel .EQ. groundlevel) <code class="keyword">THEN</code></a>
<a name="viscousflux_spatial_di36"></a>      <a href="viscousflux_p.html#viscousfluxi35" target="origFile">storewalltensor = <code class="constant">.true.</code></a>
    <a href="viscousflux_p.html#viscousfluxi32" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousfluxi36" target="origFile"><code class="comment">! Store the speed of sound squared instead of the pressure.</code></a>
<a href="viscousflux_p.html#viscousfluxi36" target="origFile"><code class="comment">! To be 100 percent correct, substract 2/3*rho*k (if present)</code></a>
<a href="viscousflux_p.html#viscousfluxi36" target="origFile"><code class="comment">! from the pressure to obtain the true presssure. First layer of</code></a>
<a name="viscousflux_spatial_di37"></a><a href="viscousflux_p.html#viscousfluxi36" target="origFile"><code class="comment">! halo's, because that's what is needed by the viscous stencil.</code></a>
<a name="viscousflux_spatial_di38"></a>    <a href="viscousflux_p.html#viscousfluxi36" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
<a name="viscousflux_spatial_di39"></a>      <a href="viscousflux_p.html#viscousfluxi37" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
<a name="viscousflux_spatial_di40"></a>        <a href="viscousflux_p.html#viscousfluxi38" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
          <a href="viscousflux_p.html#viscousfluxi39" target="origFile"><code class="keyword">IF</code> (correctfork) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi40" target="origFile">pd(i, j, k) = pd(i, j, k) - twothird*(wd(i, j, k, irho)*w(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi40" target="origFile"><code class="label">&              </code>, j, k, itu1)+w(i, j, k, irho)*wd(i, j, k, itu1))</a>
            <a href="viscousflux_p.html#viscousfluxi40" target="origFile">p(i, j, k) = p(i, j, k) - twothird*w(i, j, k, irho)*w(i, j, <code class="label">&</code></a>
<a name="viscousflux_spatial_di41"></a><a href="viscousflux_p.html#viscousfluxi40" target="origFile"><code class="label">&              </code>k, itu1)</a>
          <a href="viscousflux_p.html#viscousfluxi39" target="origFile"><code class="keyword">END IF</code></a>
          <a href="viscousflux_p.html#viscousfluxi41" target="origFile">pd(i, j, k) = ((gammad(i, j, k)*p(i, j, k)+gamma(i, j, k)*pd(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi41" target="origFile"><code class="label">&            </code>, j, k))*w(i, j, k, irho)-gamma(i, j, k)*p(i, j, k)*wd(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi41" target="origFile"><code class="label">&            </code>, k, irho))/w(i, j, k, irho)**<code class="constant">2</code></a>
          <a href="viscousflux_p.html#viscousfluxi41" target="origFile">p(i, j, k) = gamma(i, j, k)*p(i, j, k)/w(i, j, k, irho)</a>
        <a href="viscousflux_p.html#viscousfluxi38" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di42"></a>      <a href="viscousflux_p.html#viscousfluxi37" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousfluxi36" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di43"></a><a href="viscousflux_p.html#viscousfluxi42" target="origFile"><code class="comment">! Compute the nodal gradients for the nodes in the plane k = 1.</code></a>
<a name="viscousflux_spatial_di44"></a>    <a href="viscousflux_p.html#viscousfluxi42" target="origFile">k = <code class="constant">1</code></a>
    <a href="viscousflux_p.html#viscousfluxi43" target="origFile">k1 = <code class="constant">1</code></a>
    <a href="viscousflux_p.html#viscousfluxi44" target="origFile">k2 = <code class="constant">2</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">uxd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">uyd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">uzd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">vxd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">vyd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">vzd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">wxd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">wyd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">wzd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">qxd = <code class="constant">0.0</code></a>
<a name="viscousflux_spatial_di45"></a>    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">qyd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile">qzd = <code class="constant">0.0</code></a>
    <a href="viscousflux_p.html#viscousfluxi45" target="origFile"><code class="keyword">CALL </code><code class="funcname">NODALGRADIENTS_SPATIAL_D</code>(ux, uxd, uy, uyd, uz, uzd, vx, vxd, vy<code class="label">&</code></a>
<a name="viscousflux_spatial_di46"></a><a href="viscousflux_p.html#viscousfluxi45" target="origFile"><code class="label">&                            </code>, vyd, vz, vzd, wx, wxd, wy, wyd, wz, wzd, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi45" target="origFile"><code class="label">&                            </code>qx, qxd, qy, qyd, qz, qzd)</a>
<a href="viscousflux_p.html#viscousfluxi46" target="origFile"><code class="comment">! Compute the viscous fluxes for the faces k == 1 and update</code></a>
<a href="viscousflux_p.html#viscousfluxi46" target="origFile"><code class="comment">! the residuals for the cells k == 2.</code></a>
    <a href="viscousflux_p.html#viscousfluxi46" target="origFile">mue = zero</a>
    <a href="viscousflux_p.html#viscousfluxi24" target="origFile"><code class="keyword">DO </code>ii1=<code class="constant">1</code>,ISIZE3OFviscsubface</a>
<a name="viscousflux_spatial_di47"></a>      <a href="viscousflux_p.html#viscousfluxi24" target="origFile">viscsubfaced(ii1)%tau = <code class="constant">0.0</code></a>
<a name="viscousflux_spatial_di48"></a>    <a href="viscousflux_p.html#viscousfluxi24" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di49"></a>    <a href="viscousflux_p.html#viscousfluxi47" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="viscousflux_p.html#viscousfluxi48" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux_p.html#viscousfluxi49" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousfluxi49" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousflux_spatial_di51"></a><a name="viscousflux_spatial_di50"></a><a href="viscousflux_p.html#viscousfluxi49" target="origFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousflux_spatial_di52"></a>        <a href="viscousflux_p.html#viscousfluxi49" target="origFile">por = half*rfilv</a>
        <a href="viscousflux_p.html#viscousfluxi50" target="origFile"><code class="keyword">IF</code> (pork(i, j, <code class="constant">1</code>) .EQ. noflux) </a><a href="viscousflux_p.html#viscousfluxi51" target="origFile">por = zero</a>
<a href="viscousflux_p.html#viscousfluxi52" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousfluxi52" target="origFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousfluxi52" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousflux_spatial_di54"></a><a name="viscousflux_spatial_di53"></a><a href="viscousflux_p.html#viscousfluxi52" target="origFile"><code class="comment">! flux.</code></a>
<a name="viscousflux_spatial_di55"></a>        <a href="viscousflux_p.html#viscousfluxi52" target="origFile">mul = por*(rlv(i, j, <code class="constant">1</code>)+rlv(i, j, <code class="constant">2</code>))</a>
<a name="viscousflux_spatial_di56"></a>        <a href="viscousflux_p.html#viscousfluxi53" target="origFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux_p.html#viscousfluxi54" target="origFile">mue = por*(rev(i, j, <code class="constant">1</code>)+rev(i, j, <code class="constant">2</code>))</a>
        <a href="viscousflux_p.html#viscousfluxi55" target="origFile">mut = mul + mue</a>
<a name="viscousflux_spatial_di57"></a>        <a href="viscousflux_p.html#viscousfluxi56" target="origFile">gm1d = half*(gammad(i, j, <code class="constant">1</code>)+gammad(i, j, <code class="constant">2</code>))</a>
        <a href="viscousflux_p.html#viscousfluxi56" target="origFile">gm1 = half*(gamma(i, j, <code class="constant">1</code>)+gamma(i, j, <code class="constant">2</code>)) - one</a>
<a name="viscousflux_spatial_di58"></a>        <a href="viscousflux_p.html#viscousfluxi57" target="origFile">factlamheatd = -(one*prandtl*gm1d/(prandtl*gm1)**<code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#viscousfluxi57" target="origFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousflux_spatial_di59"></a>        <a href="viscousflux_p.html#viscousfluxi58" target="origFile">factturbheatd = -(one*prandtlturb*gm1d/(prandtlturb*gm1)**<code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#viscousfluxi58" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
<a name="viscousflux_spatial_di60"></a>        <a href="viscousflux_p.html#viscousfluxi59" target="origFile">heatcoefd = mul*factlamheatd + mue*factturbheatd</a>
        <a href="viscousflux_p.html#viscousfluxi59" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousfluxi60" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousfluxi60" target="origFile"><code class="comment">! nodal values.</code></a>
        <a href="viscousflux_p.html#viscousfluxi60" target="origFile">u_xd = fourth*(uxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uxd(i, j-<code class="constant">1</code>, k1)+uxd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi60" target="origFile"><code class="label">&          </code>+uxd(i, j, k1))</a>
<a name="viscousflux_spatial_di61"></a>        <a href="viscousflux_p.html#viscousfluxi60" target="origFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+ux(i, j-<code class="constant">1</code>, k1)+ux(i-<code class="constant">1</code>, j, k1)+ux(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi60" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi61" target="origFile">u_yd = fourth*(uyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uyd(i, j-<code class="constant">1</code>, k1)+uyd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi61" target="origFile"><code class="label">&          </code>+uyd(i, j, k1))</a>
<a name="viscousflux_spatial_di62"></a>        <a href="viscousflux_p.html#viscousfluxi61" target="origFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uy(i, j-<code class="constant">1</code>, k1)+uy(i-<code class="constant">1</code>, j, k1)+uy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi61" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi62" target="origFile">u_zd = fourth*(uzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uzd(i, j-<code class="constant">1</code>, k1)+uzd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi62" target="origFile"><code class="label">&          </code>+uzd(i, j, k1))</a>
<a name="viscousflux_spatial_di63"></a>        <a href="viscousflux_p.html#viscousfluxi62" target="origFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uz(i, j-<code class="constant">1</code>, k1)+uz(i-<code class="constant">1</code>, j, k1)+uz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi62" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi63" target="origFile">v_xd = fourth*(vxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vxd(i, j-<code class="constant">1</code>, k1)+vxd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi63" target="origFile"><code class="label">&          </code>+vxd(i, j, k1))</a>
<a name="viscousflux_spatial_di64"></a>        <a href="viscousflux_p.html#viscousfluxi63" target="origFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vx(i, j-<code class="constant">1</code>, k1)+vx(i-<code class="constant">1</code>, j, k1)+vx(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi63" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi64" target="origFile">v_yd = fourth*(vyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vyd(i, j-<code class="constant">1</code>, k1)+vyd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi64" target="origFile"><code class="label">&          </code>+vyd(i, j, k1))</a>
<a name="viscousflux_spatial_di65"></a>        <a href="viscousflux_p.html#viscousfluxi64" target="origFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vy(i, j-<code class="constant">1</code>, k1)+vy(i-<code class="constant">1</code>, j, k1)+vy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi64" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi65" target="origFile">v_zd = fourth*(vzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vzd(i, j-<code class="constant">1</code>, k1)+vzd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi65" target="origFile"><code class="label">&          </code>+vzd(i, j, k1))</a>
<a name="viscousflux_spatial_di66"></a>        <a href="viscousflux_p.html#viscousfluxi65" target="origFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vz(i, j-<code class="constant">1</code>, k1)+vz(i-<code class="constant">1</code>, j, k1)+vz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi65" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi66" target="origFile">w_xd = fourth*(wxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wxd(i, j-<code class="constant">1</code>, k1)+wxd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi66" target="origFile"><code class="label">&          </code>+wxd(i, j, k1))</a>
<a name="viscousflux_spatial_di67"></a>        <a href="viscousflux_p.html#viscousfluxi66" target="origFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wx(i, j-<code class="constant">1</code>, k1)+wx(i-<code class="constant">1</code>, j, k1)+wx(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi66" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi67" target="origFile">w_yd = fourth*(wyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wyd(i, j-<code class="constant">1</code>, k1)+wyd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi67" target="origFile"><code class="label">&          </code>+wyd(i, j, k1))</a>
<a name="viscousflux_spatial_di68"></a>        <a href="viscousflux_p.html#viscousfluxi67" target="origFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wy(i, j-<code class="constant">1</code>, k1)+wy(i-<code class="constant">1</code>, j, k1)+wy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi67" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi68" target="origFile">w_zd = fourth*(wzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wzd(i, j-<code class="constant">1</code>, k1)+wzd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi68" target="origFile"><code class="label">&          </code>+wzd(i, j, k1))</a>
<a name="viscousflux_spatial_di69"></a>        <a href="viscousflux_p.html#viscousfluxi68" target="origFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wz(i, j-<code class="constant">1</code>, k1)+wz(i-<code class="constant">1</code>, j, k1)+wz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi68" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi69" target="origFile">q_xd = fourth*(qxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qxd(i, j-<code class="constant">1</code>, k1)+qxd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi69" target="origFile"><code class="label">&          </code>+qxd(i, j, k1))</a>
<a name="viscousflux_spatial_di70"></a>        <a href="viscousflux_p.html#viscousfluxi69" target="origFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qx(i, j-<code class="constant">1</code>, k1)+qx(i-<code class="constant">1</code>, j, k1)+qx(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi69" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi70" target="origFile">q_yd = fourth*(qyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qyd(i, j-<code class="constant">1</code>, k1)+qyd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi70" target="origFile"><code class="label">&          </code>+qyd(i, j, k1))</a>
<a name="viscousflux_spatial_di71"></a>        <a href="viscousflux_p.html#viscousfluxi70" target="origFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qy(i, j-<code class="constant">1</code>, k1)+qy(i-<code class="constant">1</code>, j, k1)+qy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi70" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousfluxi71" target="origFile">q_zd = fourth*(qzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qzd(i, j-<code class="constant">1</code>, k1)+qzd(i-<code class="constant">1</code>, j, k1)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi71" target="origFile"><code class="label">&          </code>+qzd(i, j, k1))</a>
<a name="viscousflux_spatial_di72"></a>        <a href="viscousflux_p.html#viscousfluxi71" target="origFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qz(i, j-<code class="constant">1</code>, k1)+qz(i-<code class="constant">1</code>, j, k1)+qz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi71" target="origFile"><code class="label">&          </code>i, j, k1))</a>
<a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="comment">! cell center k to cell center k+1.</code></a>
        <a href="viscousflux_p.html#viscousfluxi72" target="origFile">ssxd = eighth*(xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="label">&          </code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i, j-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="label">&          </code>k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
        <a href="viscousflux_p.html#viscousfluxi72" target="origFile">ssx = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a name="viscousflux_spatial_di73"></a><a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi72" target="origFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
        <a href="viscousflux_p.html#viscousfluxi73" target="origFile">ssyd = eighth*(xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi73" target="origFile"><code class="label">&          </code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i, j-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi73" target="origFile"><code class="label">&          </code>k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
        <a href="viscousflux_p.html#viscousfluxi73" target="origFile">ssy = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a name="viscousflux_spatial_di74"></a><a href="viscousflux_p.html#viscousfluxi73" target="origFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi73" target="origFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
        <a href="viscousflux_p.html#viscousfluxi74" target="origFile">sszd = eighth*(xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi74" target="origFile"><code class="label">&          </code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i, j-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi74" target="origFile"><code class="label">&          </code>k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
        <a href="viscousflux_p.html#viscousfluxi74" target="origFile">ssz = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a name="viscousflux_spatial_di75"></a><a href="viscousflux_p.html#viscousfluxi74" target="origFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi74" target="origFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousfluxi75" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousfluxi75" target="origFile"><code class="comment">! unit normal.</code></a>
        <a href="viscousflux_p.html#viscousfluxi75" target="origFile">arg1d = ssxd*ssx + ssx*ssxd + ssyd*ssy + ssy*ssyd + sszd*ssz + <code class="label">&</code></a>
<a name="viscousflux_spatial_di76"></a><a href="viscousflux_p.html#viscousfluxi75" target="origFile"><code class="label">&          </code>ssz*sszd</a>
        <a href="viscousflux_p.html#viscousfluxi75" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
        <a href="viscousflux_p.html#viscousfluxi76" target="origFile"><code class="keyword">IF</code> (arg1 .EQ. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
          <a href="viscousflux_p.html#viscousfluxi76" target="origFile">result1d = <code class="constant">0.0</code></a>
        <a href="viscousflux_p.html#viscousfluxi76" target="origFile"><code class="keyword">ELSE</code></a>
          <a href="viscousflux_p.html#viscousfluxi76" target="origFile">result1d = arg1d/(<code class="constant">2.0</code>*<code class="funcname">SQRT</code>(arg1))</a>
<a name="viscousflux_spatial_di77"></a>        <a href="viscousflux_p.html#viscousfluxi76" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#viscousfluxi76" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousflux_spatial_di78"></a>        <a href="viscousflux_p.html#viscousfluxi77" target="origFile">ssd = -(one*result1d/result1**<code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#viscousfluxi77" target="origFile">ss = one/result1</a>
<a name="viscousflux_spatial_di79"></a>        <a href="viscousflux_p.html#viscousfluxi78" target="origFile">ssxd = ssd*ssx + ss*ssxd</a>
        <a href="viscousflux_p.html#viscousfluxi78" target="origFile">ssx = ss*ssx</a>
<a name="viscousflux_spatial_di80"></a>        <a href="viscousflux_p.html#viscousfluxi79" target="origFile">ssyd = ssd*ssy + ss*ssyd</a>
        <a href="viscousflux_p.html#viscousfluxi79" target="origFile">ssy = ss*ssy</a>
<a name="viscousflux_spatial_di81"></a>        <a href="viscousflux_p.html#viscousfluxi80" target="origFile">sszd = ssd*ssz + ss*sszd</a>
        <a href="viscousflux_p.html#viscousfluxi80" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousfluxi81" target="origFile"><code class="comment">! Correct the gradients.</code></a>
        <a href="viscousflux_p.html#viscousfluxi81" target="origFile">corrd = u_xd*ssx + u_x*ssxd + u_yd*ssy + u_y*ssyd + u_zd*ssz + <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi81" target="origFile"><code class="label">&          </code>u_z*sszd - (wd(i, j, k+<code class="constant">1</code>, ivx)-wd(i, j, k, ivx))*ss - (w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi81" target="origFile"><code class="label">&          </code>, k+<code class="constant">1</code>, ivx)-w(i, j, k, ivx))*ssd</a>
<a name="viscousflux_spatial_di82"></a>        <a href="viscousflux_p.html#viscousfluxi81" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivx)-w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi81" target="origFile"><code class="label">&          </code>k, ivx))*ss</a>
<a name="viscousflux_spatial_di83"></a>        <a href="viscousflux_p.html#viscousfluxi82" target="origFile">u_xd = u_xd - corrd*ssx - corr*ssxd</a>
        <a href="viscousflux_p.html#viscousfluxi82" target="origFile">u_x = u_x - corr*ssx</a>
<a name="viscousflux_spatial_di84"></a>        <a href="viscousflux_p.html#viscousfluxi83" target="origFile">u_yd = u_yd - corrd*ssy - corr*ssyd</a>
        <a href="viscousflux_p.html#viscousfluxi83" target="origFile">u_y = u_y - corr*ssy</a>
<a name="viscousflux_spatial_di85"></a>        <a href="viscousflux_p.html#viscousfluxi84" target="origFile">u_zd = u_zd - corrd*ssz - corr*sszd</a>
        <a href="viscousflux_p.html#viscousfluxi84" target="origFile">u_z = u_z - corr*ssz</a>
        <a href="viscousflux_p.html#viscousfluxi85" target="origFile">corrd = v_xd*ssx + v_x*ssxd + v_yd*ssy + v_y*ssyd + v_zd*ssz + <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi85" target="origFile"><code class="label">&          </code>v_z*sszd - (wd(i, j, k+<code class="constant">1</code>, ivy)-wd(i, j, k, ivy))*ss - (w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi85" target="origFile"><code class="label">&          </code>, k+<code class="constant">1</code>, ivy)-w(i, j, k, ivy))*ssd</a>
<a name="viscousflux_spatial_di86"></a>        <a href="viscousflux_p.html#viscousfluxi85" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivy)-w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi85" target="origFile"><code class="label">&          </code>k, ivy))*ss</a>
<a name="viscousflux_spatial_di87"></a>        <a href="viscousflux_p.html#viscousfluxi86" target="origFile">v_xd = v_xd - corrd*ssx - corr*ssxd</a>
        <a href="viscousflux_p.html#viscousfluxi86" target="origFile">v_x = v_x - corr*ssx</a>
<a name="viscousflux_spatial_di88"></a>        <a href="viscousflux_p.html#viscousfluxi87" target="origFile">v_yd = v_yd - corrd*ssy - corr*ssyd</a>
        <a href="viscousflux_p.html#viscousfluxi87" target="origFile">v_y = v_y - corr*ssy</a>
<a name="viscousflux_spatial_di89"></a>        <a href="viscousflux_p.html#viscousfluxi88" target="origFile">v_zd = v_zd - corrd*ssz - corr*sszd</a>
        <a href="viscousflux_p.html#viscousfluxi88" target="origFile">v_z = v_z - corr*ssz</a>
        <a href="viscousflux_p.html#viscousfluxi89" target="origFile">corrd = w_xd*ssx + w_x*ssxd + w_yd*ssy + w_y*ssyd + w_zd*ssz + <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi89" target="origFile"><code class="label">&          </code>w_z*sszd - (wd(i, j, k+<code class="constant">1</code>, ivz)-wd(i, j, k, ivz))*ss - (w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi89" target="origFile"><code class="label">&          </code>, k+<code class="constant">1</code>, ivz)-w(i, j, k, ivz))*ssd</a>
<a name="viscousflux_spatial_di90"></a>        <a href="viscousflux_p.html#viscousfluxi89" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivz)-w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi89" target="origFile"><code class="label">&          </code>k, ivz))*ss</a>
<a name="viscousflux_spatial_di91"></a>        <a href="viscousflux_p.html#viscousfluxi90" target="origFile">w_xd = w_xd - corrd*ssx - corr*ssxd</a>
        <a href="viscousflux_p.html#viscousfluxi90" target="origFile">w_x = w_x - corr*ssx</a>
<a name="viscousflux_spatial_di92"></a>        <a href="viscousflux_p.html#viscousfluxi91" target="origFile">w_yd = w_yd - corrd*ssy - corr*ssyd</a>
        <a href="viscousflux_p.html#viscousfluxi91" target="origFile">w_y = w_y - corr*ssy</a>
<a name="viscousflux_spatial_di93"></a>        <a href="viscousflux_p.html#viscousfluxi92" target="origFile">w_zd = w_zd - corrd*ssz - corr*sszd</a>
        <a href="viscousflux_p.html#viscousfluxi92" target="origFile">w_z = w_z - corr*ssz</a>
        <a href="viscousflux_p.html#viscousfluxi93" target="origFile">corrd = q_xd*ssx + q_x*ssxd + q_yd*ssy + q_y*ssyd + q_zd*ssz + <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi93" target="origFile"><code class="label">&          </code>q_z*sszd + (pd(i, j, k+<code class="constant">1</code>)-pd(i, j, k))*ss + (p(i, j, k+<code class="constant">1</code>)-p(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi93" target="origFile"><code class="label">&          </code>, j, k))*ssd</a>
<a name="viscousflux_spatial_di94"></a>        <a href="viscousflux_p.html#viscousfluxi93" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j, k+<code class="constant">1</code>)-p(i, j, k))*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi93" target="origFile"><code class="label">&          </code>ss</a>
<a name="viscousflux_spatial_di95"></a>        <a href="viscousflux_p.html#viscousfluxi94" target="origFile">q_xd = q_xd - corrd*ssx - corr*ssxd</a>
        <a href="viscousflux_p.html#viscousfluxi94" target="origFile">q_x = q_x - corr*ssx</a>
<a name="viscousflux_spatial_di96"></a>        <a href="viscousflux_p.html#viscousfluxi95" target="origFile">q_yd = q_yd - corrd*ssy - corr*ssyd</a>
        <a href="viscousflux_p.html#viscousfluxi95" target="origFile">q_y = q_y - corr*ssy</a>
<a name="viscousflux_spatial_di97"></a>        <a href="viscousflux_p.html#viscousfluxi96" target="origFile">q_zd = q_zd - corrd*ssz - corr*sszd</a>
        <a href="viscousflux_p.html#viscousfluxi96" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousfluxi97" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousflux_spatial_di98"></a>        <a href="viscousflux_p.html#viscousfluxi97" target="origFile">fracdivd = twothird*(u_xd+v_yd+w_zd)</a>
        <a href="viscousflux_p.html#viscousfluxi97" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousflux_spatial_di99"></a>        <a href="viscousflux_p.html#viscousfluxi98" target="origFile">tauxxd = mut*(two*u_xd-fracdivd)</a>
        <a href="viscousflux_p.html#viscousfluxi98" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousflux_spatial_di100"></a>        <a href="viscousflux_p.html#viscousfluxi99" target="origFile">tauyyd = mut*(two*v_yd-fracdivd)</a>
        <a href="viscousflux_p.html#viscousfluxi99" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousflux_spatial_di101"></a>        <a href="viscousflux_p.html#viscousfluxi100" target="origFile">tauzzd = mut*(two*w_zd-fracdivd)</a>
        <a href="viscousflux_p.html#viscousfluxi100" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousflux_spatial_di102"></a>        <a href="viscousflux_p.html#viscousfluxi101" target="origFile">tauxyd = mut*(u_yd+v_xd)</a>
        <a href="viscousflux_p.html#viscousfluxi101" target="origFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousflux_spatial_di103"></a>        <a href="viscousflux_p.html#viscousfluxi102" target="origFile">tauxzd = mut*(u_zd+w_xd)</a>
        <a href="viscousflux_p.html#viscousfluxi102" target="origFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousflux_spatial_di104"></a>        <a href="viscousflux_p.html#viscousfluxi103" target="origFile">tauyzd = mut*(v_zd+w_yd)</a>
        <a href="viscousflux_p.html#viscousfluxi103" target="origFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousflux_spatial_di105"></a>        <a href="viscousflux_p.html#viscousfluxi104" target="origFile">q_xd = heatcoefd*q_x + heatcoef*q_xd</a>
        <a href="viscousflux_p.html#viscousfluxi104" target="origFile">q_x = heatcoef*q_x</a>
<a name="viscousflux_spatial_di106"></a>        <a href="viscousflux_p.html#viscousfluxi105" target="origFile">q_yd = heatcoefd*q_y + heatcoef*q_yd</a>
        <a href="viscousflux_p.html#viscousfluxi105" target="origFile">q_y = heatcoef*q_y</a>
<a name="viscousflux_spatial_di107"></a>        <a href="viscousflux_p.html#viscousfluxi106" target="origFile">q_zd = heatcoefd*q_z + heatcoef*q_zd</a>
        <a href="viscousflux_p.html#viscousfluxi106" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousfluxi107" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousfluxi107" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousflux_spatial_di108"></a>        <a href="viscousflux_p.html#viscousfluxi107" target="origFile">ubard = half*(wd(i, j, <code class="constant">1</code>, ivx)+wd(i, j, <code class="constant">2</code>, ivx))</a>
        <a href="viscousflux_p.html#viscousfluxi107" target="origFile">ubar = half*(w(i, j, <code class="constant">1</code>, ivx)+w(i, j, <code class="constant">2</code>, ivx))</a>
<a name="viscousflux_spatial_di109"></a>        <a href="viscousflux_p.html#viscousfluxi108" target="origFile">vbard = half*(wd(i, j, <code class="constant">1</code>, ivy)+wd(i, j, <code class="constant">2</code>, ivy))</a>
        <a href="viscousflux_p.html#viscousfluxi108" target="origFile">vbar = half*(w(i, j, <code class="constant">1</code>, ivy)+w(i, j, <code class="constant">2</code>, ivy))</a>
<a name="viscousflux_spatial_di110"></a>        <a href="viscousflux_p.html#viscousfluxi109" target="origFile">wbard = half*(wd(i, j, <code class="constant">1</code>, ivz)+wd(i, j, <code class="constant">2</code>, ivz))</a>
        <a href="viscousflux_p.html#viscousfluxi109" target="origFile">wbar = half*(w(i, j, <code class="constant">1</code>, ivz)+w(i, j, <code class="constant">2</code>, ivz))</a>
<a href="viscousflux_p.html#viscousfluxi110" target="origFile"><code class="comment">! Compute the viscous fluxes for this k-face.</code></a>
        <a href="viscousflux_p.html#viscousfluxi110" target="origFile">fmxd = tauxxd*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauxx*skd(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauxyd*sk<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi110" target="origFile"><code class="label">&          </code>(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauxy*skd(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauxzd*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>) +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi110" target="origFile"><code class="label">&          </code>tauxz*skd(i, j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di111"></a>        <a href="viscousflux_p.html#viscousfluxi110" target="origFile">fmx = tauxx*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauxy*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauxz*sk(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi110" target="origFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#viscousfluxi111" target="origFile">fmyd = tauxyd*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauxy*skd(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyyd*sk<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi111" target="origFile"><code class="label">&          </code>(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauyy*skd(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauyzd*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>) +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi111" target="origFile"><code class="label">&          </code>tauyz*skd(i, j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di112"></a>        <a href="viscousflux_p.html#viscousfluxi111" target="origFile">fmy = tauxy*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyy*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauyz*sk(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi111" target="origFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#viscousfluxi112" target="origFile">fmzd = tauxzd*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauxz*skd(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyzd*sk<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi112" target="origFile"><code class="label">&          </code>(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauyz*skd(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauzzd*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>) +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi112" target="origFile"><code class="label">&          </code>tauzz*skd(i, j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di113"></a>        <a href="viscousflux_p.html#viscousfluxi112" target="origFile">fmz = tauxz*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyz*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauzz*sk(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi112" target="origFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#viscousfluxi113" target="origFile">frhoed = (ubard*tauxx+ubar*tauxxd+vbard*tauxy+vbar*tauxyd+wbard*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>tauxz+wbar*tauxzd)*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + (ubar*tauxx+vbar*tauxy+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>wbar*tauxz)*skd(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + (ubard*tauxy+ubar*tauxyd+vbard*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>tauyy+vbar*tauyyd+wbard*tauyz+wbar*tauyzd)*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*skd(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + (ubard*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>tauxz+ubar*tauxzd+vbard*tauyz+vbar*tauyzd+wbard*tauzz+wbar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>tauzzd)*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>) + (ubar*tauxz+vbar*tauyz+wbar*tauzz)*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>skd(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - q_xd*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - q_x*skd(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>q_yd*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - q_y*skd(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - q_zd*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>) - q_z*skd(i, j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#viscousfluxi113" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + (ubar*tauxz<code class="label">&</code></a>
<a name="viscousflux_spatial_di114"></a><a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>+vbar*tauyz+wbar*tauzz)*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - q_x*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi113" target="origFile"><code class="label">&          </code>q_y*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - q_z*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousfluxi114" target="origFile"><code class="comment">! Update the residuals of cell k == 2.</code></a>
<a name="viscousflux_spatial_di115"></a>        <a href="viscousflux_p.html#viscousfluxi114" target="origFile">fwd(i, j, <code class="constant">2</code>, imx) = fwd(i, j, <code class="constant">2</code>, imx) + fmxd</a>
        <a href="viscousflux_p.html#viscousfluxi114" target="origFile">fw(i, j, <code class="constant">2</code>, imx) = fw(i, j, <code class="constant">2</code>, imx) + fmx</a>
<a name="viscousflux_spatial_di116"></a>        <a href="viscousflux_p.html#viscousfluxi115" target="origFile">fwd(i, j, <code class="constant">2</code>, imy) = fwd(i, j, <code class="constant">2</code>, imy) + fmyd</a>
        <a href="viscousflux_p.html#viscousfluxi115" target="origFile">fw(i, j, <code class="constant">2</code>, imy) = fw(i, j, <code class="constant">2</code>, imy) + fmy</a>
<a name="viscousflux_spatial_di117"></a>        <a href="viscousflux_p.html#viscousfluxi116" target="origFile">fwd(i, j, <code class="constant">2</code>, imz) = fwd(i, j, <code class="constant">2</code>, imz) + fmzd</a>
        <a href="viscousflux_p.html#viscousfluxi116" target="origFile">fw(i, j, <code class="constant">2</code>, imz) = fw(i, j, <code class="constant">2</code>, imz) + fmz</a>
<a name="viscousflux_spatial_di118"></a>        <a href="viscousflux_p.html#viscousfluxi117" target="origFile">fwd(i, j, <code class="constant">2</code>, irhoe) = fwd(i, j, <code class="constant">2</code>, irhoe) + frhoed</a>
        <a href="viscousflux_p.html#viscousfluxi117" target="origFile">fw(i, j, <code class="constant">2</code>, irhoe) = fw(i, j, <code class="constant">2</code>, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousfluxi118" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a name="viscousflux_spatial_di119"></a><a href="viscousflux_p.html#viscousfluxi118" target="origFile"><code class="comment">! face is part of a viscous subface.</code></a>
<a name="viscousflux_spatial_di120"></a>        <a href="viscousflux_p.html#viscousfluxi118" target="origFile"><code class="keyword">IF</code> (storewalltensor .AND. visckminpointer(i, j) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
          <a href="viscousflux_p.html#viscousfluxi119" target="origFile">nn = visckminpointer(i, j)</a>
<a name="viscousflux_spatial_di121"></a>          <a href="viscousflux_p.html#viscousfluxi120" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">1</code>) = tauxxd</a>
          <a href="viscousflux_p.html#viscousfluxi120" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = tauxx</a>
<a name="viscousflux_spatial_di122"></a>          <a href="viscousflux_p.html#viscousfluxi121" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">2</code>) = tauyyd</a>
          <a href="viscousflux_p.html#viscousfluxi121" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = tauyy</a>
<a name="viscousflux_spatial_di123"></a>          <a href="viscousflux_p.html#viscousfluxi122" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">3</code>) = tauzzd</a>
          <a href="viscousflux_p.html#viscousfluxi122" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = tauzz</a>
<a name="viscousflux_spatial_di124"></a>          <a href="viscousflux_p.html#viscousfluxi123" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">4</code>) = tauxyd</a>
          <a href="viscousflux_p.html#viscousfluxi123" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = tauxy</a>
<a name="viscousflux_spatial_di125"></a>          <a href="viscousflux_p.html#viscousfluxi124" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">5</code>) = tauxzd</a>
          <a href="viscousflux_p.html#viscousfluxi124" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = tauxz</a>
<a name="viscousflux_spatial_di126"></a>          <a href="viscousflux_p.html#viscousfluxi125" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">6</code>) = tauyzd</a>
<a name="viscousflux_spatial_di127"></a>          <a href="viscousflux_p.html#viscousfluxi125" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = tauyz</a>
<a name="viscousflux_spatial_di128"></a>          <a href="viscousflux_p.html#viscousfluxi126" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">1</code>) = q_x</a>
          <a href="viscousflux_p.html#viscousfluxi127" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">2</code>) = q_y</a>
          <a href="viscousflux_p.html#viscousfluxi128" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">3</code>) = q_z</a>
        <a href="viscousflux_p.html#viscousfluxi118" target="origFile"><code class="keyword">END IF</code></a>
<a name="viscousflux_spatial_di129"></a>      <a href="viscousflux_p.html#viscousfluxi48" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousfluxi47" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di130"></a><a href="viscousflux_p.html#viscousfluxi129" target="origFile"><code class="comment">! Loop over the k-planes.</code></a>
<a href="viscousflux_p.html#viscousfluxi129" target="origFile"><code class="label">kloop:</code><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
<a name="viscousflux_spatial_di131"></a><a href="viscousflux_p.html#viscousfluxi130" target="origFile"><code class="comment">! Switch the indices k1 and k2.</code></a>
<a name="viscousflux_spatial_di132"></a>      <a href="viscousflux_p.html#viscousfluxi130" target="origFile">kk = k1</a>
<a name="viscousflux_spatial_di133"></a>      <a href="viscousflux_p.html#viscousfluxi131" target="origFile">k1 = k2</a>
      <a href="viscousflux_p.html#viscousfluxi132" target="origFile">k2 = kk</a>
<a href="viscousflux_p.html#viscousfluxi133" target="origFile"><code class="comment">! Compute the nodal gradients for the nodes in this k-plane.</code></a>
<a href="viscousflux_p.html#viscousfluxi133" target="origFile"><code class="comment">! The results are stored in ux(:,:,k1), etc.</code></a>
      <a href="viscousflux_p.html#viscousfluxi133" target="origFile"><code class="keyword">CALL </code><code class="funcname">NODALGRADIENTS_SPATIAL_D</code>(ux, uxd, uy, uyd, uz, uzd, vx, vxd, <code class="label">&</code></a>
<a name="viscousflux_spatial_di134"></a><a href="viscousflux_p.html#viscousfluxi133" target="origFile"><code class="label">&                              </code>vy, vyd, vz, vzd, wx, wxd, wy, wyd, wz, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi133" target="origFile"><code class="label">&                              </code>wzd, qx, qxd, qy, qyd, qz, qzd)</a>
<a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="comment">!        * Viscous fluxes in the k-direction.                           *</code></a>
<a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a name="viscousflux_spatial_di135"></a><a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="comment">!</code></a>
<a name="viscousflux_spatial_di136"></a>      <a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="viscousflux_p.html#viscousfluxi135" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux_p.html#viscousfluxi136" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousfluxi136" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousflux_spatial_di138"></a><a name="viscousflux_spatial_di137"></a><a href="viscousflux_p.html#viscousfluxi136" target="origFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousflux_spatial_di139"></a>          <a href="viscousflux_p.html#viscousfluxi136" target="origFile">por = half*rfilv</a>
          <a href="viscousflux_p.html#viscousfluxi137" target="origFile"><code class="keyword">IF</code> (pork(i, j, k) .EQ. noflux) </a><a href="viscousflux_p.html#viscousfluxi138" target="origFile">por = zero</a>
<a href="viscousflux_p.html#viscousfluxi139" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousfluxi139" target="origFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousfluxi139" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousflux_spatial_di141"></a><a name="viscousflux_spatial_di140"></a><a href="viscousflux_p.html#viscousfluxi139" target="origFile"><code class="comment">! flux.</code></a>
<a name="viscousflux_spatial_di142"></a>          <a href="viscousflux_p.html#viscousfluxi139" target="origFile">mul = por*(rlv(i, j, k)+rlv(i, j, k+<code class="constant">1</code>))</a>
<a name="viscousflux_spatial_di143"></a>          <a href="viscousflux_p.html#viscousfluxi140" target="origFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux_p.html#viscousfluxi141" target="origFile">mue = por*(rev(i, j, k)+rev(i, j, k+<code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi142" target="origFile">mut = mul + mue</a>
<a name="viscousflux_spatial_di144"></a>          <a href="viscousflux_p.html#viscousfluxi143" target="origFile">gm1d = half*(gammad(i, j, k)+gammad(i, j, k+<code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi143" target="origFile">gm1 = half*(gamma(i, j, k)+gamma(i, j, k+<code class="constant">1</code>)) - one</a>
<a name="viscousflux_spatial_di145"></a>          <a href="viscousflux_p.html#viscousfluxi144" target="origFile">factlamheatd = -(one*prandtl*gm1d/(prandtl*gm1)**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi144" target="origFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousflux_spatial_di146"></a>          <a href="viscousflux_p.html#viscousfluxi145" target="origFile">factturbheatd = -(one*prandtlturb*gm1d/(prandtlturb*gm1)**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi145" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
<a name="viscousflux_spatial_di147"></a>          <a href="viscousflux_p.html#viscousfluxi146" target="origFile">heatcoefd = mul*factlamheatd + mue*factturbheatd</a>
          <a href="viscousflux_p.html#viscousfluxi146" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousfluxi147" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousfluxi147" target="origFile"><code class="comment">! nodal values.</code></a>
          <a href="viscousflux_p.html#viscousfluxi147" target="origFile">u_xd = fourth*(uxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uxd(i, j-<code class="constant">1</code>, k1)+uxd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi147" target="origFile"><code class="label">&            </code>k1)+uxd(i, j, k1))</a>
<a name="viscousflux_spatial_di148"></a>          <a href="viscousflux_p.html#viscousfluxi147" target="origFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+ux(i, j-<code class="constant">1</code>, k1)+ux(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi147" target="origFile"><code class="label">&            </code>ux(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi148" target="origFile">u_yd = fourth*(uyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uyd(i, j-<code class="constant">1</code>, k1)+uyd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi148" target="origFile"><code class="label">&            </code>k1)+uyd(i, j, k1))</a>
<a name="viscousflux_spatial_di149"></a>          <a href="viscousflux_p.html#viscousfluxi148" target="origFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uy(i, j-<code class="constant">1</code>, k1)+uy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi148" target="origFile"><code class="label">&            </code>uy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi149" target="origFile">u_zd = fourth*(uzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uzd(i, j-<code class="constant">1</code>, k1)+uzd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi149" target="origFile"><code class="label">&            </code>k1)+uzd(i, j, k1))</a>
<a name="viscousflux_spatial_di150"></a>          <a href="viscousflux_p.html#viscousfluxi149" target="origFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uz(i, j-<code class="constant">1</code>, k1)+uz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi149" target="origFile"><code class="label">&            </code>uz(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi150" target="origFile">v_xd = fourth*(vxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vxd(i, j-<code class="constant">1</code>, k1)+vxd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi150" target="origFile"><code class="label">&            </code>k1)+vxd(i, j, k1))</a>
<a name="viscousflux_spatial_di151"></a>          <a href="viscousflux_p.html#viscousfluxi150" target="origFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vx(i, j-<code class="constant">1</code>, k1)+vx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi150" target="origFile"><code class="label">&            </code>vx(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi151" target="origFile">v_yd = fourth*(vyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vyd(i, j-<code class="constant">1</code>, k1)+vyd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi151" target="origFile"><code class="label">&            </code>k1)+vyd(i, j, k1))</a>
<a name="viscousflux_spatial_di152"></a>          <a href="viscousflux_p.html#viscousfluxi151" target="origFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vy(i, j-<code class="constant">1</code>, k1)+vy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi151" target="origFile"><code class="label">&            </code>vy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi152" target="origFile">v_zd = fourth*(vzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vzd(i, j-<code class="constant">1</code>, k1)+vzd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi152" target="origFile"><code class="label">&            </code>k1)+vzd(i, j, k1))</a>
<a name="viscousflux_spatial_di153"></a>          <a href="viscousflux_p.html#viscousfluxi152" target="origFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vz(i, j-<code class="constant">1</code>, k1)+vz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi152" target="origFile"><code class="label">&            </code>vz(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi153" target="origFile">w_xd = fourth*(wxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wxd(i, j-<code class="constant">1</code>, k1)+wxd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi153" target="origFile"><code class="label">&            </code>k1)+wxd(i, j, k1))</a>
<a name="viscousflux_spatial_di154"></a>          <a href="viscousflux_p.html#viscousfluxi153" target="origFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wx(i, j-<code class="constant">1</code>, k1)+wx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi153" target="origFile"><code class="label">&            </code>wx(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi154" target="origFile">w_yd = fourth*(wyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wyd(i, j-<code class="constant">1</code>, k1)+wyd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi154" target="origFile"><code class="label">&            </code>k1)+wyd(i, j, k1))</a>
<a name="viscousflux_spatial_di155"></a>          <a href="viscousflux_p.html#viscousfluxi154" target="origFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wy(i, j-<code class="constant">1</code>, k1)+wy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi154" target="origFile"><code class="label">&            </code>wy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi155" target="origFile">w_zd = fourth*(wzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wzd(i, j-<code class="constant">1</code>, k1)+wzd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi155" target="origFile"><code class="label">&            </code>k1)+wzd(i, j, k1))</a>
<a name="viscousflux_spatial_di156"></a>          <a href="viscousflux_p.html#viscousfluxi155" target="origFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wz(i, j-<code class="constant">1</code>, k1)+wz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi155" target="origFile"><code class="label">&            </code>wz(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi156" target="origFile">q_xd = fourth*(qxd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qxd(i, j-<code class="constant">1</code>, k1)+qxd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi156" target="origFile"><code class="label">&            </code>k1)+qxd(i, j, k1))</a>
<a name="viscousflux_spatial_di157"></a>          <a href="viscousflux_p.html#viscousfluxi156" target="origFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qx(i, j-<code class="constant">1</code>, k1)+qx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi156" target="origFile"><code class="label">&            </code>qx(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi157" target="origFile">q_yd = fourth*(qyd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qyd(i, j-<code class="constant">1</code>, k1)+qyd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi157" target="origFile"><code class="label">&            </code>k1)+qyd(i, j, k1))</a>
<a name="viscousflux_spatial_di158"></a>          <a href="viscousflux_p.html#viscousfluxi157" target="origFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qy(i, j-<code class="constant">1</code>, k1)+qy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi157" target="origFile"><code class="label">&            </code>qy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousfluxi158" target="origFile">q_zd = fourth*(qzd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qzd(i, j-<code class="constant">1</code>, k1)+qzd(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi158" target="origFile"><code class="label">&            </code>k1)+qzd(i, j, k1))</a>
<a name="viscousflux_spatial_di159"></a>          <a href="viscousflux_p.html#viscousfluxi158" target="origFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qz(i, j-<code class="constant">1</code>, k1)+qz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi158" target="origFile"><code class="label">&            </code>qz(i, j, k1))</a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="comment">!!$             write(unitvf,*) i,j,k, u_x, u_y, u_z</code></a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="comment">! cell center k to cell center k+1.</code></a>
          <a href="viscousflux_p.html#viscousfluxi159" target="origFile">ssxd = eighth*(xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i, j-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="label">&            </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-xd(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi159" target="origFile">ssx = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di160"></a><a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi159" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi160" target="origFile">ssyd = eighth*(xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi160" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i, j-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi160" target="origFile"><code class="label">&            </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-xd(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi160" target="origFile">ssy = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di161"></a><a href="viscousflux_p.html#viscousfluxi160" target="origFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi160" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi161" target="origFile">sszd = eighth*(xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi161" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i, j-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi161" target="origFile"><code class="label">&            </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-xd(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi161" target="origFile">ssz = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di162"></a><a href="viscousflux_p.html#viscousfluxi161" target="origFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi161" target="origFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousfluxi162" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousfluxi162" target="origFile"><code class="comment">! unit normal.</code></a>
          <a href="viscousflux_p.html#viscousfluxi162" target="origFile">arg1d = ssxd*ssx + ssx*ssxd + ssyd*ssy + ssy*ssyd + sszd*ssz +<code class="label">&</code></a>
<a name="viscousflux_spatial_di163"></a><a href="viscousflux_p.html#viscousfluxi162" target="origFile"><code class="label">&            </code>ssz*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi162" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi163" target="origFile"><code class="keyword">IF</code> (arg1 .EQ. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi163" target="origFile">result1d = <code class="constant">0.0</code></a>
          <a href="viscousflux_p.html#viscousfluxi163" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="viscousflux_p.html#viscousfluxi163" target="origFile">result1d = arg1d/(<code class="constant">2.0</code>*<code class="funcname">SQRT</code>(arg1))</a>
<a name="viscousflux_spatial_di164"></a>          <a href="viscousflux_p.html#viscousfluxi163" target="origFile"><code class="keyword">END IF</code></a>
          <a href="viscousflux_p.html#viscousfluxi163" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousflux_spatial_di165"></a>          <a href="viscousflux_p.html#viscousfluxi164" target="origFile">ssd = -(one*result1d/result1**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi164" target="origFile">ss = one/result1</a>
<a name="viscousflux_spatial_di166"></a>          <a href="viscousflux_p.html#viscousfluxi165" target="origFile">ssxd = ssd*ssx + ss*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi165" target="origFile">ssx = ss*ssx</a>
<a name="viscousflux_spatial_di167"></a>          <a href="viscousflux_p.html#viscousfluxi166" target="origFile">ssyd = ssd*ssy + ss*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi166" target="origFile">ssy = ss*ssy</a>
<a name="viscousflux_spatial_di168"></a>          <a href="viscousflux_p.html#viscousfluxi167" target="origFile">sszd = ssd*ssz + ss*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi167" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousfluxi168" target="origFile"><code class="comment">! Correct the gradients.</code></a>
          <a href="viscousflux_p.html#viscousfluxi168" target="origFile">corrd = u_xd*ssx + u_x*ssxd + u_yd*ssy + u_y*ssyd + u_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi168" target="origFile"><code class="label">&            </code>u_z*sszd - (wd(i, j, k+<code class="constant">1</code>, ivx)-wd(i, j, k, ivx))*ss - (w(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi168" target="origFile"><code class="label">&            </code>j, k+<code class="constant">1</code>, ivx)-w(i, j, k, ivx))*ssd</a>
<a name="viscousflux_spatial_di169"></a>          <a href="viscousflux_p.html#viscousfluxi168" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivx)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi168" target="origFile"><code class="label">&            </code>, k, ivx))*ss</a>
<a name="viscousflux_spatial_di170"></a>          <a href="viscousflux_p.html#viscousfluxi169" target="origFile">u_xd = u_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi169" target="origFile">u_x = u_x - corr*ssx</a>
<a name="viscousflux_spatial_di171"></a>          <a href="viscousflux_p.html#viscousfluxi170" target="origFile">u_yd = u_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi170" target="origFile">u_y = u_y - corr*ssy</a>
<a name="viscousflux_spatial_di172"></a>          <a href="viscousflux_p.html#viscousfluxi171" target="origFile">u_zd = u_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi171" target="origFile">u_z = u_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi172" target="origFile">corrd = v_xd*ssx + v_x*ssxd + v_yd*ssy + v_y*ssyd + v_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi172" target="origFile"><code class="label">&            </code>v_z*sszd - (wd(i, j, k+<code class="constant">1</code>, ivy)-wd(i, j, k, ivy))*ss - (w(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi172" target="origFile"><code class="label">&            </code>j, k+<code class="constant">1</code>, ivy)-w(i, j, k, ivy))*ssd</a>
<a name="viscousflux_spatial_di173"></a>          <a href="viscousflux_p.html#viscousfluxi172" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivy)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi172" target="origFile"><code class="label">&            </code>, k, ivy))*ss</a>
<a name="viscousflux_spatial_di174"></a>          <a href="viscousflux_p.html#viscousfluxi173" target="origFile">v_xd = v_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi173" target="origFile">v_x = v_x - corr*ssx</a>
<a name="viscousflux_spatial_di175"></a>          <a href="viscousflux_p.html#viscousfluxi174" target="origFile">v_yd = v_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi174" target="origFile">v_y = v_y - corr*ssy</a>
<a name="viscousflux_spatial_di176"></a>          <a href="viscousflux_p.html#viscousfluxi175" target="origFile">v_zd = v_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi175" target="origFile">v_z = v_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi176" target="origFile">corrd = w_xd*ssx + w_x*ssxd + w_yd*ssy + w_y*ssyd + w_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi176" target="origFile"><code class="label">&            </code>w_z*sszd - (wd(i, j, k+<code class="constant">1</code>, ivz)-wd(i, j, k, ivz))*ss - (w(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi176" target="origFile"><code class="label">&            </code>j, k+<code class="constant">1</code>, ivz)-w(i, j, k, ivz))*ssd</a>
<a name="viscousflux_spatial_di177"></a>          <a href="viscousflux_p.html#viscousfluxi176" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivz)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi176" target="origFile"><code class="label">&            </code>, k, ivz))*ss</a>
<a name="viscousflux_spatial_di178"></a>          <a href="viscousflux_p.html#viscousfluxi177" target="origFile">w_xd = w_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi177" target="origFile">w_x = w_x - corr*ssx</a>
<a name="viscousflux_spatial_di179"></a>          <a href="viscousflux_p.html#viscousfluxi178" target="origFile">w_yd = w_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi178" target="origFile">w_y = w_y - corr*ssy</a>
<a name="viscousflux_spatial_di180"></a>          <a href="viscousflux_p.html#viscousfluxi179" target="origFile">w_zd = w_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi179" target="origFile">w_z = w_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi180" target="origFile">corrd = q_xd*ssx + q_x*ssxd + q_yd*ssy + q_y*ssyd + q_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi180" target="origFile"><code class="label">&            </code>q_z*sszd + (pd(i, j, k+<code class="constant">1</code>)-pd(i, j, k))*ss + (p(i, j, k+<code class="constant">1</code>)-p(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi180" target="origFile"><code class="label">&            </code>i, j, k))*ssd</a>
<a name="viscousflux_spatial_di181"></a>          <a href="viscousflux_p.html#viscousfluxi180" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j, k+<code class="constant">1</code>)-p(i, j, k))<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi180" target="origFile"><code class="label">&            </code>*ss</a>
<a name="viscousflux_spatial_di182"></a>          <a href="viscousflux_p.html#viscousfluxi181" target="origFile">q_xd = q_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi181" target="origFile">q_x = q_x - corr*ssx</a>
<a name="viscousflux_spatial_di183"></a>          <a href="viscousflux_p.html#viscousfluxi182" target="origFile">q_yd = q_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi182" target="origFile">q_y = q_y - corr*ssy</a>
<a name="viscousflux_spatial_di184"></a>          <a href="viscousflux_p.html#viscousfluxi183" target="origFile">q_zd = q_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi183" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousfluxi184" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousflux_spatial_di185"></a>          <a href="viscousflux_p.html#viscousfluxi184" target="origFile">fracdivd = twothird*(u_xd+v_yd+w_zd)</a>
          <a href="viscousflux_p.html#viscousfluxi184" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousflux_spatial_di186"></a>          <a href="viscousflux_p.html#viscousfluxi185" target="origFile">tauxxd = mut*(two*u_xd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi185" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousflux_spatial_di187"></a>          <a href="viscousflux_p.html#viscousfluxi186" target="origFile">tauyyd = mut*(two*v_yd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi186" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousflux_spatial_di188"></a>          <a href="viscousflux_p.html#viscousfluxi187" target="origFile">tauzzd = mut*(two*w_zd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi187" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousflux_spatial_di189"></a>          <a href="viscousflux_p.html#viscousfluxi188" target="origFile">tauxyd = mut*(u_yd+v_xd)</a>
          <a href="viscousflux_p.html#viscousfluxi188" target="origFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousflux_spatial_di190"></a>          <a href="viscousflux_p.html#viscousfluxi189" target="origFile">tauxzd = mut*(u_zd+w_xd)</a>
          <a href="viscousflux_p.html#viscousfluxi189" target="origFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousflux_spatial_di191"></a>          <a href="viscousflux_p.html#viscousfluxi190" target="origFile">tauyzd = mut*(v_zd+w_yd)</a>
          <a href="viscousflux_p.html#viscousfluxi190" target="origFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousflux_spatial_di192"></a>          <a href="viscousflux_p.html#viscousfluxi191" target="origFile">q_xd = heatcoefd*q_x + heatcoef*q_xd</a>
          <a href="viscousflux_p.html#viscousfluxi191" target="origFile">q_x = heatcoef*q_x</a>
<a name="viscousflux_spatial_di193"></a>          <a href="viscousflux_p.html#viscousfluxi192" target="origFile">q_yd = heatcoefd*q_y + heatcoef*q_yd</a>
          <a href="viscousflux_p.html#viscousfluxi192" target="origFile">q_y = heatcoef*q_y</a>
<a name="viscousflux_spatial_di194"></a>          <a href="viscousflux_p.html#viscousfluxi193" target="origFile">q_zd = heatcoefd*q_z + heatcoef*q_zd</a>
          <a href="viscousflux_p.html#viscousfluxi193" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousfluxi194" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousfluxi194" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousflux_spatial_di195"></a>          <a href="viscousflux_p.html#viscousfluxi194" target="origFile">ubard = half*(wd(i, j, k, ivx)+wd(i, j, k+<code class="constant">1</code>, ivx))</a>
          <a href="viscousflux_p.html#viscousfluxi194" target="origFile">ubar = half*(w(i, j, k, ivx)+w(i, j, k+<code class="constant">1</code>, ivx))</a>
<a name="viscousflux_spatial_di196"></a>          <a href="viscousflux_p.html#viscousfluxi195" target="origFile">vbard = half*(wd(i, j, k, ivy)+wd(i, j, k+<code class="constant">1</code>, ivy))</a>
          <a href="viscousflux_p.html#viscousfluxi195" target="origFile">vbar = half*(w(i, j, k, ivy)+w(i, j, k+<code class="constant">1</code>, ivy))</a>
<a name="viscousflux_spatial_di197"></a>          <a href="viscousflux_p.html#viscousfluxi196" target="origFile">wbard = half*(wd(i, j, k, ivz)+wd(i, j, k+<code class="constant">1</code>, ivz))</a>
          <a href="viscousflux_p.html#viscousfluxi196" target="origFile">wbar = half*(w(i, j, k, ivz)+w(i, j, k+<code class="constant">1</code>, ivz))</a>
<a href="viscousflux_p.html#viscousfluxi197" target="origFile"><code class="comment">! Compute the viscous fluxes for this k-face.</code></a>
          <a href="viscousflux_p.html#viscousfluxi197" target="origFile">fmxd = tauxxd*sk(i, j, k, <code class="constant">1</code>) + tauxx*skd(i, j, k, <code class="constant">1</code>) + tauxyd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi197" target="origFile"><code class="label">&            </code>sk(i, j, k, <code class="constant">2</code>) + tauxy*skd(i, j, k, <code class="constant">2</code>) + tauxzd*sk(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi197" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauxz*skd(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di198"></a>          <a href="viscousflux_p.html#viscousfluxi197" target="origFile">fmx = tauxx*sk(i, j, k, <code class="constant">1</code>) + tauxy*sk(i, j, k, <code class="constant">2</code>) + tauxz*sk(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi197" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi198" target="origFile">fmyd = tauxyd*sk(i, j, k, <code class="constant">1</code>) + tauxy*skd(i, j, k, <code class="constant">1</code>) + tauyyd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi198" target="origFile"><code class="label">&            </code>sk(i, j, k, <code class="constant">2</code>) + tauyy*skd(i, j, k, <code class="constant">2</code>) + tauyzd*sk(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi198" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauyz*skd(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di199"></a>          <a href="viscousflux_p.html#viscousfluxi198" target="origFile">fmy = tauxy*sk(i, j, k, <code class="constant">1</code>) + tauyy*sk(i, j, k, <code class="constant">2</code>) + tauyz*sk(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi198" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi199" target="origFile">fmzd = tauxzd*sk(i, j, k, <code class="constant">1</code>) + tauxz*skd(i, j, k, <code class="constant">1</code>) + tauyzd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi199" target="origFile"><code class="label">&            </code>sk(i, j, k, <code class="constant">2</code>) + tauyz*skd(i, j, k, <code class="constant">2</code>) + tauzzd*sk(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi199" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauzz*skd(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di200"></a>          <a href="viscousflux_p.html#viscousfluxi199" target="origFile">fmz = tauxz*sk(i, j, k, <code class="constant">1</code>) + tauyz*sk(i, j, k, <code class="constant">2</code>) + tauzz*sk(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi199" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi200" target="origFile">frhoed = (ubard*tauxx+ubar*tauxxd+vbard*tauxy+vbar*tauxyd+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>wbard*tauxz+wbar*tauxzd)*sk(i, j, k, <code class="constant">1</code>) + (ubar*tauxx+vbar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>tauxy+wbar*tauxz)*skd(i, j, k, <code class="constant">1</code>) + (ubard*tauxy+ubar*tauxyd<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>+vbard*tauyy+vbar*tauyyd+wbard*tauyz+wbar*tauyzd)*sk(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>) + (ubar*tauxy+vbar*tauyy+wbar*tauyz)*skd(i, j, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>(ubard*tauxz+ubar*tauxzd+vbard*tauyz+vbar*tauyzd+wbard*tauzz<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>+wbar*tauzzd)*sk(i, j, k, <code class="constant">3</code>) + (ubar*tauxz+vbar*tauyz+wbar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>tauzz)*skd(i, j, k, <code class="constant">3</code>) - q_xd*sk(i, j, k, <code class="constant">1</code>) - q_x*skd(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>, k, <code class="constant">1</code>) - q_yd*sk(i, j, k, <code class="constant">2</code>) - q_y*skd(i, j, k, <code class="constant">2</code>) - q_zd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>sk(i, j, k, <code class="constant">3</code>) - q_z*skd(i, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi200" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sk(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sk(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a name="viscousflux_spatial_di201"></a><a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*sk(i, j, k, <code class="constant">3</code>) - q_x*sk(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi200" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*sk(i, j, k, <code class="constant">2</code>) - q_z*sk(i, j, k, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousfluxi201" target="origFile"><code class="comment">! Update the residuals of cell k and k+1.</code></a>
<a name="viscousflux_spatial_di202"></a>          <a href="viscousflux_p.html#viscousfluxi201" target="origFile">fwd(i, j, k, imx) = fwd(i, j, k, imx) - fmxd</a>
          <a href="viscousflux_p.html#viscousfluxi201" target="origFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
<a name="viscousflux_spatial_di203"></a>          <a href="viscousflux_p.html#viscousfluxi202" target="origFile">fwd(i, j, k, imy) = fwd(i, j, k, imy) - fmyd</a>
          <a href="viscousflux_p.html#viscousfluxi202" target="origFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
<a name="viscousflux_spatial_di204"></a>          <a href="viscousflux_p.html#viscousfluxi203" target="origFile">fwd(i, j, k, imz) = fwd(i, j, k, imz) - fmzd</a>
          <a href="viscousflux_p.html#viscousfluxi203" target="origFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
<a name="viscousflux_spatial_di205"></a>          <a href="viscousflux_p.html#viscousfluxi204" target="origFile">fwd(i, j, k, irhoe) = fwd(i, j, k, irhoe) - frhoed</a>
          <a href="viscousflux_p.html#viscousfluxi204" target="origFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
<a name="viscousflux_spatial_di206"></a>          <a href="viscousflux_p.html#viscousfluxi205" target="origFile">fwd(i, j, k+<code class="constant">1</code>, imx) = fwd(i, j, k+<code class="constant">1</code>, imx) + fmxd</a>
          <a href="viscousflux_p.html#viscousfluxi205" target="origFile">fw(i, j, k+<code class="constant">1</code>, imx) = fw(i, j, k+<code class="constant">1</code>, imx) + fmx</a>
<a name="viscousflux_spatial_di207"></a>          <a href="viscousflux_p.html#viscousfluxi206" target="origFile">fwd(i, j, k+<code class="constant">1</code>, imy) = fwd(i, j, k+<code class="constant">1</code>, imy) + fmyd</a>
          <a href="viscousflux_p.html#viscousfluxi206" target="origFile">fw(i, j, k+<code class="constant">1</code>, imy) = fw(i, j, k+<code class="constant">1</code>, imy) + fmy</a>
<a name="viscousflux_spatial_di208"></a>          <a href="viscousflux_p.html#viscousfluxi207" target="origFile">fwd(i, j, k+<code class="constant">1</code>, imz) = fwd(i, j, k+<code class="constant">1</code>, imz) + fmzd</a>
          <a href="viscousflux_p.html#viscousfluxi207" target="origFile">fw(i, j, k+<code class="constant">1</code>, imz) = fw(i, j, k+<code class="constant">1</code>, imz) + fmz</a>
<a name="viscousflux_spatial_di209"></a>          <a href="viscousflux_p.html#viscousfluxi208" target="origFile">fwd(i, j, k+<code class="constant">1</code>, irhoe) = fwd(i, j, k+<code class="constant">1</code>, irhoe) + frhoed</a>
          <a href="viscousflux_p.html#viscousfluxi208" target="origFile">fw(i, j, k+<code class="constant">1</code>, irhoe) = fw(i, j, k+<code class="constant">1</code>, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousfluxi209" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux_p.html#viscousfluxi209" target="origFile"><code class="comment">! face is part of a viscous subface.</code></a>
<a name="viscousflux_spatial_di210"></a>          <a href="viscousflux_p.html#viscousfluxi209" target="origFile"><code class="keyword">IF</code> (k .EQ. kl .AND. storewalltensor .AND. visckmaxpointer(i, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di211"></a><a href="viscousflux_p.html#viscousfluxi209" target="origFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi210" target="origFile">nn = visckmaxpointer(i, j)</a>
<a name="viscousflux_spatial_di212"></a>            <a href="viscousflux_p.html#viscousfluxi211" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">1</code>) = tauxxd</a>
            <a href="viscousflux_p.html#viscousfluxi211" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = tauxx</a>
<a name="viscousflux_spatial_di213"></a>            <a href="viscousflux_p.html#viscousfluxi212" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">2</code>) = tauyyd</a>
            <a href="viscousflux_p.html#viscousfluxi212" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = tauyy</a>
<a name="viscousflux_spatial_di214"></a>            <a href="viscousflux_p.html#viscousfluxi213" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">3</code>) = tauzzd</a>
            <a href="viscousflux_p.html#viscousfluxi213" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = tauzz</a>
<a name="viscousflux_spatial_di215"></a>            <a href="viscousflux_p.html#viscousfluxi214" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">4</code>) = tauxyd</a>
            <a href="viscousflux_p.html#viscousfluxi214" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = tauxy</a>
<a name="viscousflux_spatial_di216"></a>            <a href="viscousflux_p.html#viscousfluxi215" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">5</code>) = tauxzd</a>
            <a href="viscousflux_p.html#viscousfluxi215" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = tauxz</a>
<a name="viscousflux_spatial_di217"></a>            <a href="viscousflux_p.html#viscousfluxi216" target="origFile">viscsubfaced(nn)%tau(i, j, <code class="constant">6</code>) = tauyzd</a>
<a name="viscousflux_spatial_di218"></a>            <a href="viscousflux_p.html#viscousfluxi216" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = tauyz</a>
<a name="viscousflux_spatial_di219"></a>            <a href="viscousflux_p.html#viscousfluxi217" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousfluxi218" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousfluxi219" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousfluxi209" target="origFile"><code class="keyword">END IF</code></a>
<a name="viscousflux_spatial_di220"></a>        <a href="viscousflux_p.html#viscousfluxi135" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousfluxi134" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="comment">!        * Viscous fluxes in the j-direction.                           *</code></a>
<a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a name="viscousflux_spatial_di221"></a><a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="comment">!</code></a>
<a name="viscousflux_spatial_di222"></a>      <a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
        <a href="viscousflux_p.html#viscousfluxi221" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux_p.html#viscousfluxi222" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousfluxi222" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousflux_spatial_di224"></a><a name="viscousflux_spatial_di223"></a><a href="viscousflux_p.html#viscousfluxi222" target="origFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousflux_spatial_di225"></a>          <a href="viscousflux_p.html#viscousfluxi222" target="origFile">por = half*rfilv</a>
          <a href="viscousflux_p.html#viscousfluxi223" target="origFile"><code class="keyword">IF</code> (porj(i, j, k) .EQ. noflux) </a><a href="viscousflux_p.html#viscousfluxi224" target="origFile">por = zero</a>
<a href="viscousflux_p.html#viscousfluxi225" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousfluxi225" target="origFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousfluxi225" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousflux_spatial_di227"></a><a name="viscousflux_spatial_di226"></a><a href="viscousflux_p.html#viscousfluxi225" target="origFile"><code class="comment">! flux.</code></a>
<a name="viscousflux_spatial_di228"></a>          <a href="viscousflux_p.html#viscousfluxi225" target="origFile">mul = por*(rlv(i, j, k)+rlv(i, j+<code class="constant">1</code>, k))</a>
<a name="viscousflux_spatial_di229"></a>          <a href="viscousflux_p.html#viscousfluxi226" target="origFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux_p.html#viscousfluxi227" target="origFile">mue = por*(rev(i, j, k)+rev(i, j+<code class="constant">1</code>, k))</a>
          <a href="viscousflux_p.html#viscousfluxi228" target="origFile">mut = mul + mue</a>
<a name="viscousflux_spatial_di230"></a>          <a href="viscousflux_p.html#viscousfluxi229" target="origFile">gm1d = half*(gammad(i, j, k)+gammad(i, j+<code class="constant">1</code>, k))</a>
          <a href="viscousflux_p.html#viscousfluxi229" target="origFile">gm1 = half*(gamma(i, j, k)+gamma(i, j+<code class="constant">1</code>, k)) - one</a>
<a name="viscousflux_spatial_di231"></a>          <a href="viscousflux_p.html#viscousfluxi230" target="origFile">factlamheatd = -(one*prandtl*gm1d/(prandtl*gm1)**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi230" target="origFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousflux_spatial_di232"></a>          <a href="viscousflux_p.html#viscousfluxi231" target="origFile">factturbheatd = -(one*prandtlturb*gm1d/(prandtlturb*gm1)**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi231" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
<a name="viscousflux_spatial_di233"></a>          <a href="viscousflux_p.html#viscousfluxi232" target="origFile">heatcoefd = mul*factlamheatd + mue*factturbheatd</a>
          <a href="viscousflux_p.html#viscousfluxi232" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousfluxi233" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousfluxi233" target="origFile"><code class="comment">! nodal values.</code></a>
          <a href="viscousflux_p.html#viscousfluxi233" target="origFile">u_xd = fourth*(uxd(i-<code class="constant">1</code>, j, k1)+uxd(i, j, k1)+uxd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi233" target="origFile"><code class="label">&            </code>uxd(i, j, k2))</a>
<a name="viscousflux_spatial_di234"></a>          <a href="viscousflux_p.html#viscousfluxi233" target="origFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j, k1)+ux(i, j, k1)+ux(i-<code class="constant">1</code>, j, k2)+ux(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi233" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi234" target="origFile">u_yd = fourth*(uyd(i-<code class="constant">1</code>, j, k1)+uyd(i, j, k1)+uyd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi234" target="origFile"><code class="label">&            </code>uyd(i, j, k2))</a>
<a name="viscousflux_spatial_di235"></a>          <a href="viscousflux_p.html#viscousfluxi234" target="origFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j, k1)+uy(i, j, k1)+uy(i-<code class="constant">1</code>, j, k2)+uy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi234" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi235" target="origFile">u_zd = fourth*(uzd(i-<code class="constant">1</code>, j, k1)+uzd(i, j, k1)+uzd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi235" target="origFile"><code class="label">&            </code>uzd(i, j, k2))</a>
<a name="viscousflux_spatial_di236"></a>          <a href="viscousflux_p.html#viscousfluxi235" target="origFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j, k1)+uz(i, j, k1)+uz(i-<code class="constant">1</code>, j, k2)+uz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi235" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi236" target="origFile">v_xd = fourth*(vxd(i-<code class="constant">1</code>, j, k1)+vxd(i, j, k1)+vxd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi236" target="origFile"><code class="label">&            </code>vxd(i, j, k2))</a>
<a name="viscousflux_spatial_di237"></a>          <a href="viscousflux_p.html#viscousfluxi236" target="origFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j, k1)+vx(i, j, k1)+vx(i-<code class="constant">1</code>, j, k2)+vx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi236" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi237" target="origFile">v_yd = fourth*(vyd(i-<code class="constant">1</code>, j, k1)+vyd(i, j, k1)+vyd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi237" target="origFile"><code class="label">&            </code>vyd(i, j, k2))</a>
<a name="viscousflux_spatial_di238"></a>          <a href="viscousflux_p.html#viscousfluxi237" target="origFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j, k1)+vy(i, j, k1)+vy(i-<code class="constant">1</code>, j, k2)+vy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi237" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi238" target="origFile">v_zd = fourth*(vzd(i-<code class="constant">1</code>, j, k1)+vzd(i, j, k1)+vzd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi238" target="origFile"><code class="label">&            </code>vzd(i, j, k2))</a>
<a name="viscousflux_spatial_di239"></a>          <a href="viscousflux_p.html#viscousfluxi238" target="origFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j, k1)+vz(i, j, k1)+vz(i-<code class="constant">1</code>, j, k2)+vz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi238" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi239" target="origFile">w_xd = fourth*(wxd(i-<code class="constant">1</code>, j, k1)+wxd(i, j, k1)+wxd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi239" target="origFile"><code class="label">&            </code>wxd(i, j, k2))</a>
<a name="viscousflux_spatial_di240"></a>          <a href="viscousflux_p.html#viscousfluxi239" target="origFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j, k1)+wx(i, j, k1)+wx(i-<code class="constant">1</code>, j, k2)+wx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi239" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi240" target="origFile">w_yd = fourth*(wyd(i-<code class="constant">1</code>, j, k1)+wyd(i, j, k1)+wyd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi240" target="origFile"><code class="label">&            </code>wyd(i, j, k2))</a>
<a name="viscousflux_spatial_di241"></a>          <a href="viscousflux_p.html#viscousfluxi240" target="origFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j, k1)+wy(i, j, k1)+wy(i-<code class="constant">1</code>, j, k2)+wy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi240" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi241" target="origFile">w_zd = fourth*(wzd(i-<code class="constant">1</code>, j, k1)+wzd(i, j, k1)+wzd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi241" target="origFile"><code class="label">&            </code>wzd(i, j, k2))</a>
<a name="viscousflux_spatial_di242"></a>          <a href="viscousflux_p.html#viscousfluxi241" target="origFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j, k1)+wz(i, j, k1)+wz(i-<code class="constant">1</code>, j, k2)+wz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi241" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi242" target="origFile">q_xd = fourth*(qxd(i-<code class="constant">1</code>, j, k1)+qxd(i, j, k1)+qxd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi242" target="origFile"><code class="label">&            </code>qxd(i, j, k2))</a>
<a name="viscousflux_spatial_di243"></a>          <a href="viscousflux_p.html#viscousfluxi242" target="origFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j, k1)+qx(i, j, k1)+qx(i-<code class="constant">1</code>, j, k2)+qx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi242" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi243" target="origFile">q_yd = fourth*(qyd(i-<code class="constant">1</code>, j, k1)+qyd(i, j, k1)+qyd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi243" target="origFile"><code class="label">&            </code>qyd(i, j, k2))</a>
<a name="viscousflux_spatial_di244"></a>          <a href="viscousflux_p.html#viscousfluxi243" target="origFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j, k1)+qy(i, j, k1)+qy(i-<code class="constant">1</code>, j, k2)+qy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi243" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi244" target="origFile">q_zd = fourth*(qzd(i-<code class="constant">1</code>, j, k1)+qzd(i, j, k1)+qzd(i-<code class="constant">1</code>, j, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi244" target="origFile"><code class="label">&            </code>qzd(i, j, k2))</a>
<a name="viscousflux_spatial_di245"></a>          <a href="viscousflux_p.html#viscousfluxi244" target="origFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j, k1)+qz(i, j, k1)+qz(i-<code class="constant">1</code>, j, k2)+qz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi244" target="origFile"><code class="label">&            </code>, j, k2))</a>
<a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="comment">! cell center j to cell center j+1.</code></a>
          <a href="viscousflux_p.html#viscousfluxi245" target="origFile">ssxd = eighth*(xd(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+xd(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-xd(i, j-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="label">&            </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>)-xd(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi245" target="origFile">ssx = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di246"></a><a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi245" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi246" target="origFile">ssyd = eighth*(xd(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi246" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+xd(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-xd(i, j-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi246" target="origFile"><code class="label">&            </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>)-xd(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi246" target="origFile">ssy = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di247"></a><a href="viscousflux_p.html#viscousfluxi246" target="origFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi246" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi247" target="origFile">sszd = eighth*(xd(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi247" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+xd(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-xd(i, j-<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi247" target="origFile"><code class="label">&            </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>)-xd(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi247" target="origFile">ssz = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di248"></a><a href="viscousflux_p.html#viscousfluxi247" target="origFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi247" target="origFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousfluxi248" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousfluxi248" target="origFile"><code class="comment">! unit normal.</code></a>
          <a href="viscousflux_p.html#viscousfluxi248" target="origFile">arg1d = ssxd*ssx + ssx*ssxd + ssyd*ssy + ssy*ssyd + sszd*ssz +<code class="label">&</code></a>
<a name="viscousflux_spatial_di249"></a><a href="viscousflux_p.html#viscousfluxi248" target="origFile"><code class="label">&            </code>ssz*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi248" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi249" target="origFile"><code class="keyword">IF</code> (arg1 .EQ. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi249" target="origFile">result1d = <code class="constant">0.0</code></a>
          <a href="viscousflux_p.html#viscousfluxi249" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="viscousflux_p.html#viscousfluxi249" target="origFile">result1d = arg1d/(<code class="constant">2.0</code>*<code class="funcname">SQRT</code>(arg1))</a>
<a name="viscousflux_spatial_di250"></a>          <a href="viscousflux_p.html#viscousfluxi249" target="origFile"><code class="keyword">END IF</code></a>
          <a href="viscousflux_p.html#viscousfluxi249" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousflux_spatial_di251"></a>          <a href="viscousflux_p.html#viscousfluxi250" target="origFile">ssd = -(one*result1d/result1**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi250" target="origFile">ss = one/result1</a>
<a name="viscousflux_spatial_di252"></a>          <a href="viscousflux_p.html#viscousfluxi251" target="origFile">ssxd = ssd*ssx + ss*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi251" target="origFile">ssx = ss*ssx</a>
<a name="viscousflux_spatial_di253"></a>          <a href="viscousflux_p.html#viscousfluxi252" target="origFile">ssyd = ssd*ssy + ss*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi252" target="origFile">ssy = ss*ssy</a>
<a name="viscousflux_spatial_di254"></a>          <a href="viscousflux_p.html#viscousfluxi253" target="origFile">sszd = ssd*ssz + ss*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi253" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousfluxi254" target="origFile"><code class="comment">! Correct the gradients.</code></a>
          <a href="viscousflux_p.html#viscousfluxi254" target="origFile">corrd = u_xd*ssx + u_x*ssxd + u_yd*ssy + u_y*ssyd + u_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi254" target="origFile"><code class="label">&            </code>u_z*sszd - (wd(i, j+<code class="constant">1</code>, k, ivx)-wd(i, j, k, ivx))*ss - (w(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi254" target="origFile"><code class="label">&            </code>j+<code class="constant">1</code>, k, ivx)-w(i, j, k, ivx))*ssd</a>
<a name="viscousflux_spatial_di255"></a>          <a href="viscousflux_p.html#viscousfluxi254" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivx)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi254" target="origFile"><code class="label">&            </code>, k, ivx))*ss</a>
<a name="viscousflux_spatial_di256"></a>          <a href="viscousflux_p.html#viscousfluxi255" target="origFile">u_xd = u_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi255" target="origFile">u_x = u_x - corr*ssx</a>
<a name="viscousflux_spatial_di257"></a>          <a href="viscousflux_p.html#viscousfluxi256" target="origFile">u_yd = u_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi256" target="origFile">u_y = u_y - corr*ssy</a>
<a name="viscousflux_spatial_di258"></a>          <a href="viscousflux_p.html#viscousfluxi257" target="origFile">u_zd = u_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi257" target="origFile">u_z = u_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi258" target="origFile">corrd = v_xd*ssx + v_x*ssxd + v_yd*ssy + v_y*ssyd + v_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi258" target="origFile"><code class="label">&            </code>v_z*sszd - (wd(i, j+<code class="constant">1</code>, k, ivy)-wd(i, j, k, ivy))*ss - (w(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi258" target="origFile"><code class="label">&            </code>j+<code class="constant">1</code>, k, ivy)-w(i, j, k, ivy))*ssd</a>
<a name="viscousflux_spatial_di259"></a>          <a href="viscousflux_p.html#viscousfluxi258" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivy)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi258" target="origFile"><code class="label">&            </code>, k, ivy))*ss</a>
<a name="viscousflux_spatial_di260"></a>          <a href="viscousflux_p.html#viscousfluxi259" target="origFile">v_xd = v_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi259" target="origFile">v_x = v_x - corr*ssx</a>
<a name="viscousflux_spatial_di261"></a>          <a href="viscousflux_p.html#viscousfluxi260" target="origFile">v_yd = v_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi260" target="origFile">v_y = v_y - corr*ssy</a>
<a name="viscousflux_spatial_di262"></a>          <a href="viscousflux_p.html#viscousfluxi261" target="origFile">v_zd = v_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi261" target="origFile">v_z = v_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi262" target="origFile">corrd = w_xd*ssx + w_x*ssxd + w_yd*ssy + w_y*ssyd + w_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi262" target="origFile"><code class="label">&            </code>w_z*sszd - (wd(i, j+<code class="constant">1</code>, k, ivz)-wd(i, j, k, ivz))*ss - (w(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi262" target="origFile"><code class="label">&            </code>j+<code class="constant">1</code>, k, ivz)-w(i, j, k, ivz))*ssd</a>
<a name="viscousflux_spatial_di263"></a>          <a href="viscousflux_p.html#viscousfluxi262" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivz)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi262" target="origFile"><code class="label">&            </code>, k, ivz))*ss</a>
<a name="viscousflux_spatial_di264"></a>          <a href="viscousflux_p.html#viscousfluxi263" target="origFile">w_xd = w_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi263" target="origFile">w_x = w_x - corr*ssx</a>
<a name="viscousflux_spatial_di265"></a>          <a href="viscousflux_p.html#viscousfluxi264" target="origFile">w_yd = w_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi264" target="origFile">w_y = w_y - corr*ssy</a>
<a name="viscousflux_spatial_di266"></a>          <a href="viscousflux_p.html#viscousfluxi265" target="origFile">w_zd = w_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi265" target="origFile">w_z = w_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi266" target="origFile">corrd = q_xd*ssx + q_x*ssxd + q_yd*ssy + q_y*ssyd + q_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi266" target="origFile"><code class="label">&            </code>q_z*sszd + (pd(i, j+<code class="constant">1</code>, k)-pd(i, j, k))*ss + (p(i, j+<code class="constant">1</code>, k)-p(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi266" target="origFile"><code class="label">&            </code>i, j, k))*ssd</a>
<a name="viscousflux_spatial_di267"></a>          <a href="viscousflux_p.html#viscousfluxi266" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j+<code class="constant">1</code>, k)-p(i, j, k))<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi266" target="origFile"><code class="label">&            </code>*ss</a>
<a name="viscousflux_spatial_di268"></a>          <a href="viscousflux_p.html#viscousfluxi267" target="origFile">q_xd = q_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi267" target="origFile">q_x = q_x - corr*ssx</a>
<a name="viscousflux_spatial_di269"></a>          <a href="viscousflux_p.html#viscousfluxi268" target="origFile">q_yd = q_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi268" target="origFile">q_y = q_y - corr*ssy</a>
<a name="viscousflux_spatial_di270"></a>          <a href="viscousflux_p.html#viscousfluxi269" target="origFile">q_zd = q_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi269" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousfluxi270" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousflux_spatial_di271"></a>          <a href="viscousflux_p.html#viscousfluxi270" target="origFile">fracdivd = twothird*(u_xd+v_yd+w_zd)</a>
          <a href="viscousflux_p.html#viscousfluxi270" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousflux_spatial_di272"></a>          <a href="viscousflux_p.html#viscousfluxi271" target="origFile">tauxxd = mut*(two*u_xd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi271" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousflux_spatial_di273"></a>          <a href="viscousflux_p.html#viscousfluxi272" target="origFile">tauyyd = mut*(two*v_yd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi272" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousflux_spatial_di274"></a>          <a href="viscousflux_p.html#viscousfluxi273" target="origFile">tauzzd = mut*(two*w_zd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi273" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousflux_spatial_di275"></a>          <a href="viscousflux_p.html#viscousfluxi274" target="origFile">tauxyd = mut*(u_yd+v_xd)</a>
          <a href="viscousflux_p.html#viscousfluxi274" target="origFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousflux_spatial_di276"></a>          <a href="viscousflux_p.html#viscousfluxi275" target="origFile">tauxzd = mut*(u_zd+w_xd)</a>
          <a href="viscousflux_p.html#viscousfluxi275" target="origFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousflux_spatial_di277"></a>          <a href="viscousflux_p.html#viscousfluxi276" target="origFile">tauyzd = mut*(v_zd+w_yd)</a>
          <a href="viscousflux_p.html#viscousfluxi276" target="origFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousflux_spatial_di278"></a>          <a href="viscousflux_p.html#viscousfluxi277" target="origFile">q_xd = heatcoefd*q_x + heatcoef*q_xd</a>
          <a href="viscousflux_p.html#viscousfluxi277" target="origFile">q_x = heatcoef*q_x</a>
<a name="viscousflux_spatial_di279"></a>          <a href="viscousflux_p.html#viscousfluxi278" target="origFile">q_yd = heatcoefd*q_y + heatcoef*q_yd</a>
          <a href="viscousflux_p.html#viscousfluxi278" target="origFile">q_y = heatcoef*q_y</a>
<a name="viscousflux_spatial_di280"></a>          <a href="viscousflux_p.html#viscousfluxi279" target="origFile">q_zd = heatcoefd*q_z + heatcoef*q_zd</a>
          <a href="viscousflux_p.html#viscousfluxi279" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousfluxi280" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousfluxi280" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousflux_spatial_di281"></a>          <a href="viscousflux_p.html#viscousfluxi280" target="origFile">ubard = half*(wd(i, j, k, ivx)+wd(i, j+<code class="constant">1</code>, k, ivx))</a>
          <a href="viscousflux_p.html#viscousfluxi280" target="origFile">ubar = half*(w(i, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, ivx))</a>
<a name="viscousflux_spatial_di282"></a>          <a href="viscousflux_p.html#viscousfluxi281" target="origFile">vbard = half*(wd(i, j, k, ivy)+wd(i, j+<code class="constant">1</code>, k, ivy))</a>
          <a href="viscousflux_p.html#viscousfluxi281" target="origFile">vbar = half*(w(i, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, ivy))</a>
<a name="viscousflux_spatial_di283"></a>          <a href="viscousflux_p.html#viscousfluxi282" target="origFile">wbard = half*(wd(i, j, k, ivz)+wd(i, j+<code class="constant">1</code>, k, ivz))</a>
          <a href="viscousflux_p.html#viscousfluxi282" target="origFile">wbar = half*(w(i, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, ivz))</a>
<a href="viscousflux_p.html#viscousfluxi283" target="origFile"><code class="comment">! Compute the viscous fluxes for this j-face.</code></a>
          <a href="viscousflux_p.html#viscousfluxi283" target="origFile">fmxd = tauxxd*sj(i, j, k, <code class="constant">1</code>) + tauxx*sjd(i, j, k, <code class="constant">1</code>) + tauxyd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi283" target="origFile"><code class="label">&            </code>sj(i, j, k, <code class="constant">2</code>) + tauxy*sjd(i, j, k, <code class="constant">2</code>) + tauxzd*sj(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi283" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauxz*sjd(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di284"></a>          <a href="viscousflux_p.html#viscousfluxi283" target="origFile">fmx = tauxx*sj(i, j, k, <code class="constant">1</code>) + tauxy*sj(i, j, k, <code class="constant">2</code>) + tauxz*sj(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi283" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi284" target="origFile">fmyd = tauxyd*sj(i, j, k, <code class="constant">1</code>) + tauxy*sjd(i, j, k, <code class="constant">1</code>) + tauyyd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi284" target="origFile"><code class="label">&            </code>sj(i, j, k, <code class="constant">2</code>) + tauyy*sjd(i, j, k, <code class="constant">2</code>) + tauyzd*sj(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi284" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauyz*sjd(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di285"></a>          <a href="viscousflux_p.html#viscousfluxi284" target="origFile">fmy = tauxy*sj(i, j, k, <code class="constant">1</code>) + tauyy*sj(i, j, k, <code class="constant">2</code>) + tauyz*sj(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi284" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi285" target="origFile">fmzd = tauxzd*sj(i, j, k, <code class="constant">1</code>) + tauxz*sjd(i, j, k, <code class="constant">1</code>) + tauyzd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi285" target="origFile"><code class="label">&            </code>sj(i, j, k, <code class="constant">2</code>) + tauyz*sjd(i, j, k, <code class="constant">2</code>) + tauzzd*sj(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi285" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauzz*sjd(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di286"></a>          <a href="viscousflux_p.html#viscousfluxi285" target="origFile">fmz = tauxz*sj(i, j, k, <code class="constant">1</code>) + tauyz*sj(i, j, k, <code class="constant">2</code>) + tauzz*sj(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi285" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi286" target="origFile">frhoed = (ubard*tauxx+ubar*tauxxd+vbard*tauxy+vbar*tauxyd+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>wbard*tauxz+wbar*tauxzd)*sj(i, j, k, <code class="constant">1</code>) + (ubar*tauxx+vbar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>tauxy+wbar*tauxz)*sjd(i, j, k, <code class="constant">1</code>) + (ubard*tauxy+ubar*tauxyd<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>+vbard*tauyy+vbar*tauyyd+wbard*tauyz+wbar*tauyzd)*sj(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>) + (ubar*tauxy+vbar*tauyy+wbar*tauyz)*sjd(i, j, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>(ubard*tauxz+ubar*tauxzd+vbard*tauyz+vbar*tauyzd+wbard*tauzz<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>+wbar*tauzzd)*sj(i, j, k, <code class="constant">3</code>) + (ubar*tauxz+vbar*tauyz+wbar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>tauzz)*sjd(i, j, k, <code class="constant">3</code>) - q_xd*sj(i, j, k, <code class="constant">1</code>) - q_x*sjd(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>, k, <code class="constant">1</code>) - q_yd*sj(i, j, k, <code class="constant">2</code>) - q_y*sjd(i, j, k, <code class="constant">2</code>) - q_zd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>sj(i, j, k, <code class="constant">3</code>) - q_z*sjd(i, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi286" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sj(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sj(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a name="viscousflux_spatial_di287"></a><a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*sj(i, j, k, <code class="constant">3</code>) - q_x*sj(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi286" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*sj(i, j, k, <code class="constant">2</code>) - q_z*sj(i, j, k, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousfluxi287" target="origFile"><code class="comment">! Update the residuals of cell j and j+1.</code></a>
<a name="viscousflux_spatial_di288"></a>          <a href="viscousflux_p.html#viscousfluxi287" target="origFile">fwd(i, j, k, imx) = fwd(i, j, k, imx) - fmxd</a>
          <a href="viscousflux_p.html#viscousfluxi287" target="origFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
<a name="viscousflux_spatial_di289"></a>          <a href="viscousflux_p.html#viscousfluxi288" target="origFile">fwd(i, j, k, imy) = fwd(i, j, k, imy) - fmyd</a>
          <a href="viscousflux_p.html#viscousfluxi288" target="origFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
<a name="viscousflux_spatial_di290"></a>          <a href="viscousflux_p.html#viscousfluxi289" target="origFile">fwd(i, j, k, imz) = fwd(i, j, k, imz) - fmzd</a>
          <a href="viscousflux_p.html#viscousfluxi289" target="origFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
<a name="viscousflux_spatial_di291"></a>          <a href="viscousflux_p.html#viscousfluxi290" target="origFile">fwd(i, j, k, irhoe) = fwd(i, j, k, irhoe) - frhoed</a>
          <a href="viscousflux_p.html#viscousfluxi290" target="origFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
<a name="viscousflux_spatial_di292"></a>          <a href="viscousflux_p.html#viscousfluxi291" target="origFile">fwd(i, j+<code class="constant">1</code>, k, imx) = fwd(i, j+<code class="constant">1</code>, k, imx) + fmxd</a>
          <a href="viscousflux_p.html#viscousfluxi291" target="origFile">fw(i, j+<code class="constant">1</code>, k, imx) = fw(i, j+<code class="constant">1</code>, k, imx) + fmx</a>
<a name="viscousflux_spatial_di293"></a>          <a href="viscousflux_p.html#viscousfluxi292" target="origFile">fwd(i, j+<code class="constant">1</code>, k, imy) = fwd(i, j+<code class="constant">1</code>, k, imy) + fmyd</a>
          <a href="viscousflux_p.html#viscousfluxi292" target="origFile">fw(i, j+<code class="constant">1</code>, k, imy) = fw(i, j+<code class="constant">1</code>, k, imy) + fmy</a>
<a name="viscousflux_spatial_di294"></a>          <a href="viscousflux_p.html#viscousfluxi293" target="origFile">fwd(i, j+<code class="constant">1</code>, k, imz) = fwd(i, j+<code class="constant">1</code>, k, imz) + fmzd</a>
          <a href="viscousflux_p.html#viscousfluxi293" target="origFile">fw(i, j+<code class="constant">1</code>, k, imz) = fw(i, j+<code class="constant">1</code>, k, imz) + fmz</a>
<a name="viscousflux_spatial_di295"></a>          <a href="viscousflux_p.html#viscousfluxi294" target="origFile">fwd(i, j+<code class="constant">1</code>, k, irhoe) = fwd(i, j+<code class="constant">1</code>, k, irhoe) + frhoed</a>
          <a href="viscousflux_p.html#viscousfluxi294" target="origFile">fw(i, j+<code class="constant">1</code>, k, irhoe) = fw(i, j+<code class="constant">1</code>, k, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousfluxi295" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux_p.html#viscousfluxi295" target="origFile"><code class="comment">! face is part of a viscous subface. Both the cases j == 1</code></a>
<a href="viscousflux_p.html#viscousfluxi295" target="origFile"><code class="comment">! and j == jl must be tested.</code></a>
<a name="viscousflux_spatial_di296"></a>          <a href="viscousflux_p.html#viscousfluxi295" target="origFile"><code class="keyword">IF</code> (j .EQ. <code class="constant">1 </code>.AND. storewalltensor .AND. viscjminpointer(i, k)<code class="label">&</code></a>
<a name="viscousflux_spatial_di297"></a><a href="viscousflux_p.html#viscousfluxi295" target="origFile"><code class="label">&              </code>.GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi296" target="origFile">nn = viscjminpointer(i, k)</a>
<a name="viscousflux_spatial_di298"></a>            <a href="viscousflux_p.html#viscousfluxi297" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">1</code>) = tauxxd</a>
            <a href="viscousflux_p.html#viscousfluxi297" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousflux_spatial_di299"></a>            <a href="viscousflux_p.html#viscousfluxi298" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">2</code>) = tauyyd</a>
            <a href="viscousflux_p.html#viscousfluxi298" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousflux_spatial_di300"></a>            <a href="viscousflux_p.html#viscousfluxi299" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">3</code>) = tauzzd</a>
            <a href="viscousflux_p.html#viscousfluxi299" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousflux_spatial_di301"></a>            <a href="viscousflux_p.html#viscousfluxi300" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">4</code>) = tauxyd</a>
            <a href="viscousflux_p.html#viscousfluxi300" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousflux_spatial_di302"></a>            <a href="viscousflux_p.html#viscousfluxi301" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">5</code>) = tauxzd</a>
            <a href="viscousflux_p.html#viscousfluxi301" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousflux_spatial_di303"></a>            <a href="viscousflux_p.html#viscousfluxi302" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">6</code>) = tauyzd</a>
<a name="viscousflux_spatial_di304"></a>            <a href="viscousflux_p.html#viscousfluxi302" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousflux_spatial_di305"></a>            <a href="viscousflux_p.html#viscousfluxi303" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousfluxi304" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">2</code>) = q_y</a>
<a name="viscousflux_spatial_di306"></a>            <a href="viscousflux_p.html#viscousfluxi305" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousfluxi295" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousfluxi306" target="origFile"><code class="comment">! And the j == jl case.</code></a>
<a name="viscousflux_spatial_di307"></a>          <a href="viscousflux_p.html#viscousfluxi306" target="origFile"><code class="keyword">IF</code> (j .EQ. jl .AND. storewalltensor .AND. viscjmaxpointer(i, k<code class="label">&</code></a>
<a name="viscousflux_spatial_di308"></a><a href="viscousflux_p.html#viscousfluxi306" target="origFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi307" target="origFile">nn = viscjmaxpointer(i, k)</a>
<a name="viscousflux_spatial_di309"></a>            <a href="viscousflux_p.html#viscousfluxi308" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">1</code>) = tauxxd</a>
            <a href="viscousflux_p.html#viscousfluxi308" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousflux_spatial_di310"></a>            <a href="viscousflux_p.html#viscousfluxi309" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">2</code>) = tauyyd</a>
            <a href="viscousflux_p.html#viscousfluxi309" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousflux_spatial_di311"></a>            <a href="viscousflux_p.html#viscousfluxi310" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">3</code>) = tauzzd</a>
            <a href="viscousflux_p.html#viscousfluxi310" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousflux_spatial_di312"></a>            <a href="viscousflux_p.html#viscousfluxi311" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">4</code>) = tauxyd</a>
            <a href="viscousflux_p.html#viscousfluxi311" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousflux_spatial_di313"></a>            <a href="viscousflux_p.html#viscousfluxi312" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">5</code>) = tauxzd</a>
            <a href="viscousflux_p.html#viscousfluxi312" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousflux_spatial_di314"></a>            <a href="viscousflux_p.html#viscousfluxi313" target="origFile">viscsubfaced(nn)%tau(i, k, <code class="constant">6</code>) = tauyzd</a>
<a name="viscousflux_spatial_di315"></a>            <a href="viscousflux_p.html#viscousfluxi313" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousflux_spatial_di316"></a>            <a href="viscousflux_p.html#viscousfluxi314" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousfluxi315" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousfluxi316" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousfluxi306" target="origFile"><code class="keyword">END IF</code></a>
<a name="viscousflux_spatial_di317"></a>        <a href="viscousflux_p.html#viscousfluxi221" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousfluxi220" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="comment">!        * Viscous fluxes in the i-direction.                           *</code></a>
<a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a name="viscousflux_spatial_di318"></a><a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="comment">!</code></a>
<a name="viscousflux_spatial_di319"></a>      <a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="viscousflux_p.html#viscousfluxi318" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#viscousfluxi319" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousfluxi319" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousflux_spatial_di321"></a><a name="viscousflux_spatial_di320"></a><a href="viscousflux_p.html#viscousfluxi319" target="origFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousflux_spatial_di322"></a>          <a href="viscousflux_p.html#viscousfluxi319" target="origFile">por = half*rfilv</a>
          <a href="viscousflux_p.html#viscousfluxi320" target="origFile"><code class="keyword">IF</code> (pori(i, j, k) .EQ. noflux) </a><a href="viscousflux_p.html#viscousfluxi321" target="origFile">por = zero</a>
<a href="viscousflux_p.html#viscousfluxi322" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousfluxi322" target="origFile"><code class="comment">! multiplied the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousfluxi322" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousflux_spatial_di324"></a><a name="viscousflux_spatial_di323"></a><a href="viscousflux_p.html#viscousfluxi322" target="origFile"><code class="comment">! flux.</code></a>
<a name="viscousflux_spatial_di325"></a>          <a href="viscousflux_p.html#viscousfluxi322" target="origFile">mul = por*(rlv(i, j, k)+rlv(i+<code class="constant">1</code>, j, k))</a>
<a name="viscousflux_spatial_di326"></a>          <a href="viscousflux_p.html#viscousfluxi323" target="origFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux_p.html#viscousfluxi324" target="origFile">mue = por*(rev(i, j, k)+rev(i+<code class="constant">1</code>, j, k))</a>
          <a href="viscousflux_p.html#viscousfluxi325" target="origFile">mut = mul + mue</a>
<a name="viscousflux_spatial_di327"></a>          <a href="viscousflux_p.html#viscousfluxi326" target="origFile">gm1d = half*(gammad(i, j, k)+gammad(i+<code class="constant">1</code>, j, k))</a>
          <a href="viscousflux_p.html#viscousfluxi326" target="origFile">gm1 = half*(gamma(i, j, k)+gamma(i+<code class="constant">1</code>, j, k)) - one</a>
<a name="viscousflux_spatial_di328"></a>          <a href="viscousflux_p.html#viscousfluxi327" target="origFile">factlamheatd = -(one*prandtl*gm1d/(prandtl*gm1)**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi327" target="origFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousflux_spatial_di329"></a>          <a href="viscousflux_p.html#viscousfluxi328" target="origFile">factturbheatd = -(one*prandtlturb*gm1d/(prandtlturb*gm1)**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi328" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
<a name="viscousflux_spatial_di330"></a>          <a href="viscousflux_p.html#viscousfluxi329" target="origFile">heatcoefd = mul*factlamheatd + mue*factturbheatd</a>
          <a href="viscousflux_p.html#viscousfluxi329" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousfluxi330" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousfluxi330" target="origFile"><code class="comment">! nodal values.</code></a>
          <a href="viscousflux_p.html#viscousfluxi330" target="origFile">u_xd = fourth*(uxd(i, j-<code class="constant">1</code>, k1)+uxd(i, j, k1)+uxd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi330" target="origFile"><code class="label">&            </code>uxd(i, j, k2))</a>
<a name="viscousflux_spatial_di331"></a>          <a href="viscousflux_p.html#viscousfluxi330" target="origFile">u_x = fourth*(ux(i, j-<code class="constant">1</code>, k1)+ux(i, j, k1)+ux(i, j-<code class="constant">1</code>, k2)+ux(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi330" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi331" target="origFile">u_yd = fourth*(uyd(i, j-<code class="constant">1</code>, k1)+uyd(i, j, k1)+uyd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi331" target="origFile"><code class="label">&            </code>uyd(i, j, k2))</a>
<a name="viscousflux_spatial_di332"></a>          <a href="viscousflux_p.html#viscousfluxi331" target="origFile">u_y = fourth*(uy(i, j-<code class="constant">1</code>, k1)+uy(i, j, k1)+uy(i, j-<code class="constant">1</code>, k2)+uy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi331" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi332" target="origFile">u_zd = fourth*(uzd(i, j-<code class="constant">1</code>, k1)+uzd(i, j, k1)+uzd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi332" target="origFile"><code class="label">&            </code>uzd(i, j, k2))</a>
<a name="viscousflux_spatial_di333"></a>          <a href="viscousflux_p.html#viscousfluxi332" target="origFile">u_z = fourth*(uz(i, j-<code class="constant">1</code>, k1)+uz(i, j, k1)+uz(i, j-<code class="constant">1</code>, k2)+uz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi332" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi333" target="origFile">v_xd = fourth*(vxd(i, j-<code class="constant">1</code>, k1)+vxd(i, j, k1)+vxd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi333" target="origFile"><code class="label">&            </code>vxd(i, j, k2))</a>
<a name="viscousflux_spatial_di334"></a>          <a href="viscousflux_p.html#viscousfluxi333" target="origFile">v_x = fourth*(vx(i, j-<code class="constant">1</code>, k1)+vx(i, j, k1)+vx(i, j-<code class="constant">1</code>, k2)+vx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi333" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi334" target="origFile">v_yd = fourth*(vyd(i, j-<code class="constant">1</code>, k1)+vyd(i, j, k1)+vyd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi334" target="origFile"><code class="label">&            </code>vyd(i, j, k2))</a>
<a name="viscousflux_spatial_di335"></a>          <a href="viscousflux_p.html#viscousfluxi334" target="origFile">v_y = fourth*(vy(i, j-<code class="constant">1</code>, k1)+vy(i, j, k1)+vy(i, j-<code class="constant">1</code>, k2)+vy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi334" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi335" target="origFile">v_zd = fourth*(vzd(i, j-<code class="constant">1</code>, k1)+vzd(i, j, k1)+vzd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi335" target="origFile"><code class="label">&            </code>vzd(i, j, k2))</a>
<a name="viscousflux_spatial_di336"></a>          <a href="viscousflux_p.html#viscousfluxi335" target="origFile">v_z = fourth*(vz(i, j-<code class="constant">1</code>, k1)+vz(i, j, k1)+vz(i, j-<code class="constant">1</code>, k2)+vz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi335" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi336" target="origFile">w_xd = fourth*(wxd(i, j-<code class="constant">1</code>, k1)+wxd(i, j, k1)+wxd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi336" target="origFile"><code class="label">&            </code>wxd(i, j, k2))</a>
<a name="viscousflux_spatial_di337"></a>          <a href="viscousflux_p.html#viscousfluxi336" target="origFile">w_x = fourth*(wx(i, j-<code class="constant">1</code>, k1)+wx(i, j, k1)+wx(i, j-<code class="constant">1</code>, k2)+wx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi336" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi337" target="origFile">w_yd = fourth*(wyd(i, j-<code class="constant">1</code>, k1)+wyd(i, j, k1)+wyd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi337" target="origFile"><code class="label">&            </code>wyd(i, j, k2))</a>
<a name="viscousflux_spatial_di338"></a>          <a href="viscousflux_p.html#viscousfluxi337" target="origFile">w_y = fourth*(wy(i, j-<code class="constant">1</code>, k1)+wy(i, j, k1)+wy(i, j-<code class="constant">1</code>, k2)+wy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi337" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi338" target="origFile">w_zd = fourth*(wzd(i, j-<code class="constant">1</code>, k1)+wzd(i, j, k1)+wzd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi338" target="origFile"><code class="label">&            </code>wzd(i, j, k2))</a>
<a name="viscousflux_spatial_di339"></a>          <a href="viscousflux_p.html#viscousfluxi338" target="origFile">w_z = fourth*(wz(i, j-<code class="constant">1</code>, k1)+wz(i, j, k1)+wz(i, j-<code class="constant">1</code>, k2)+wz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi338" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi339" target="origFile">q_xd = fourth*(qxd(i, j-<code class="constant">1</code>, k1)+qxd(i, j, k1)+qxd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi339" target="origFile"><code class="label">&            </code>qxd(i, j, k2))</a>
<a name="viscousflux_spatial_di340"></a>          <a href="viscousflux_p.html#viscousfluxi339" target="origFile">q_x = fourth*(qx(i, j-<code class="constant">1</code>, k1)+qx(i, j, k1)+qx(i, j-<code class="constant">1</code>, k2)+qx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi339" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi340" target="origFile">q_yd = fourth*(qyd(i, j-<code class="constant">1</code>, k1)+qyd(i, j, k1)+qyd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi340" target="origFile"><code class="label">&            </code>qyd(i, j, k2))</a>
<a name="viscousflux_spatial_di341"></a>          <a href="viscousflux_p.html#viscousfluxi340" target="origFile">q_y = fourth*(qy(i, j-<code class="constant">1</code>, k1)+qy(i, j, k1)+qy(i, j-<code class="constant">1</code>, k2)+qy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi340" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousfluxi341" target="origFile">q_zd = fourth*(qzd(i, j-<code class="constant">1</code>, k1)+qzd(i, j, k1)+qzd(i, j-<code class="constant">1</code>, k2)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi341" target="origFile"><code class="label">&            </code>qzd(i, j, k2))</a>
<a name="viscousflux_spatial_di342"></a>          <a href="viscousflux_p.html#viscousfluxi341" target="origFile">q_z = fourth*(qz(i, j-<code class="constant">1</code>, k1)+qz(i, j, k1)+qz(i, j-<code class="constant">1</code>, k2)+qz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi341" target="origFile"><code class="label">&            </code>, j, k2))</a>
<a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="comment">! cell center i to cell center i+1.</code></a>
          <a href="viscousflux_p.html#viscousfluxi342" target="origFile">ssxd = eighth*(xd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+xd(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="label">&            </code>j, k-<code class="constant">1</code>, <code class="constant">1</code>)+xd(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>)-xd(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi342" target="origFile">ssx = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di343"></a><a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi342" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi343" target="origFile">ssyd = eighth*(xd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi343" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+xd(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi343" target="origFile"><code class="label">&            </code>j, k-<code class="constant">1</code>, <code class="constant">2</code>)+xd(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>)-xd(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi343" target="origFile">ssy = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di344"></a><a href="viscousflux_p.html#viscousfluxi343" target="origFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi343" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi344" target="origFile">sszd = eighth*(xd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi344" target="origFile"><code class="label">&            </code><code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+xd(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi344" target="origFile"><code class="label">&            </code>j, k-<code class="constant">1</code>, <code class="constant">3</code>)+xd(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>)-xd(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>))</a>
          <a href="viscousflux_p.html#viscousfluxi344" target="origFile">ssz = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousflux_spatial_di345"></a><a href="viscousflux_p.html#viscousfluxi344" target="origFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi344" target="origFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousfluxi345" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousfluxi345" target="origFile"><code class="comment">! unit normal.</code></a>
          <a href="viscousflux_p.html#viscousfluxi345" target="origFile">arg1d = ssxd*ssx + ssx*ssxd + ssyd*ssy + ssy*ssyd + sszd*ssz +<code class="label">&</code></a>
<a name="viscousflux_spatial_di346"></a><a href="viscousflux_p.html#viscousfluxi345" target="origFile"><code class="label">&            </code>ssz*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi345" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi346" target="origFile"><code class="keyword">IF</code> (arg1 .EQ. <code class="constant">0.0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi346" target="origFile">result1d = <code class="constant">0.0</code></a>
          <a href="viscousflux_p.html#viscousfluxi346" target="origFile"><code class="keyword">ELSE</code></a>
            <a href="viscousflux_p.html#viscousfluxi346" target="origFile">result1d = arg1d/(<code class="constant">2.0</code>*<code class="funcname">SQRT</code>(arg1))</a>
<a name="viscousflux_spatial_di347"></a>          <a href="viscousflux_p.html#viscousfluxi346" target="origFile"><code class="keyword">END IF</code></a>
          <a href="viscousflux_p.html#viscousfluxi346" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousflux_spatial_di348"></a>          <a href="viscousflux_p.html#viscousfluxi347" target="origFile">ssd = -(one*result1d/result1**<code class="constant">2</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi347" target="origFile">ss = one/result1</a>
<a name="viscousflux_spatial_di349"></a>          <a href="viscousflux_p.html#viscousfluxi348" target="origFile">ssxd = ssd*ssx + ss*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi348" target="origFile">ssx = ss*ssx</a>
<a name="viscousflux_spatial_di350"></a>          <a href="viscousflux_p.html#viscousfluxi349" target="origFile">ssyd = ssd*ssy + ss*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi349" target="origFile">ssy = ss*ssy</a>
<a name="viscousflux_spatial_di351"></a>          <a href="viscousflux_p.html#viscousfluxi350" target="origFile">sszd = ssd*ssz + ss*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi350" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousfluxi351" target="origFile"><code class="comment">! Correct the gradients.</code></a>
          <a href="viscousflux_p.html#viscousfluxi351" target="origFile">corrd = u_xd*ssx + u_x*ssxd + u_yd*ssy + u_y*ssyd + u_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi351" target="origFile"><code class="label">&            </code>u_z*sszd - (wd(i+<code class="constant">1</code>, j, k, ivx)-wd(i, j, k, ivx))*ss - (w(i+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi351" target="origFile"><code class="label">&            </code>, j, k, ivx)-w(i, j, k, ivx))*ssd</a>
<a name="viscousflux_spatial_di352"></a>          <a href="viscousflux_p.html#viscousfluxi351" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivx)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi351" target="origFile"><code class="label">&            </code>, k, ivx))*ss</a>
<a name="viscousflux_spatial_di353"></a>          <a href="viscousflux_p.html#viscousfluxi352" target="origFile">u_xd = u_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi352" target="origFile">u_x = u_x - corr*ssx</a>
<a name="viscousflux_spatial_di354"></a>          <a href="viscousflux_p.html#viscousfluxi353" target="origFile">u_yd = u_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi353" target="origFile">u_y = u_y - corr*ssy</a>
<a name="viscousflux_spatial_di355"></a>          <a href="viscousflux_p.html#viscousfluxi354" target="origFile">u_zd = u_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi354" target="origFile">u_z = u_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi355" target="origFile">corrd = v_xd*ssx + v_x*ssxd + v_yd*ssy + v_y*ssyd + v_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi355" target="origFile"><code class="label">&            </code>v_z*sszd - (wd(i+<code class="constant">1</code>, j, k, ivy)-wd(i, j, k, ivy))*ss - (w(i+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi355" target="origFile"><code class="label">&            </code>, j, k, ivy)-w(i, j, k, ivy))*ssd</a>
<a name="viscousflux_spatial_di356"></a>          <a href="viscousflux_p.html#viscousfluxi355" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivy)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi355" target="origFile"><code class="label">&            </code>, k, ivy))*ss</a>
<a name="viscousflux_spatial_di357"></a>          <a href="viscousflux_p.html#viscousfluxi356" target="origFile">v_xd = v_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi356" target="origFile">v_x = v_x - corr*ssx</a>
<a name="viscousflux_spatial_di358"></a>          <a href="viscousflux_p.html#viscousfluxi357" target="origFile">v_yd = v_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi357" target="origFile">v_y = v_y - corr*ssy</a>
<a name="viscousflux_spatial_di359"></a>          <a href="viscousflux_p.html#viscousfluxi358" target="origFile">v_zd = v_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi358" target="origFile">v_z = v_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi359" target="origFile">corrd = w_xd*ssx + w_x*ssxd + w_yd*ssy + w_y*ssyd + w_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi359" target="origFile"><code class="label">&            </code>w_z*sszd - (wd(i+<code class="constant">1</code>, j, k, ivz)-wd(i, j, k, ivz))*ss - (w(i+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi359" target="origFile"><code class="label">&            </code>, j, k, ivz)-w(i, j, k, ivz))*ssd</a>
<a name="viscousflux_spatial_di360"></a>          <a href="viscousflux_p.html#viscousfluxi359" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivz)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi359" target="origFile"><code class="label">&            </code>, k, ivz))*ss</a>
<a name="viscousflux_spatial_di361"></a>          <a href="viscousflux_p.html#viscousfluxi360" target="origFile">w_xd = w_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi360" target="origFile">w_x = w_x - corr*ssx</a>
<a name="viscousflux_spatial_di362"></a>          <a href="viscousflux_p.html#viscousfluxi361" target="origFile">w_yd = w_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi361" target="origFile">w_y = w_y - corr*ssy</a>
<a name="viscousflux_spatial_di363"></a>          <a href="viscousflux_p.html#viscousfluxi362" target="origFile">w_zd = w_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi362" target="origFile">w_z = w_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousfluxi363" target="origFile">corrd = q_xd*ssx + q_x*ssxd + q_yd*ssy + q_y*ssyd + q_zd*ssz +<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi363" target="origFile"><code class="label">&            </code>q_z*sszd + (pd(i+<code class="constant">1</code>, j, k)-pd(i, j, k))*ss + (p(i+<code class="constant">1</code>, j, k)-p(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi363" target="origFile"><code class="label">&            </code>i, j, k))*ssd</a>
<a name="viscousflux_spatial_di364"></a>          <a href="viscousflux_p.html#viscousfluxi363" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i+<code class="constant">1</code>, j, k)-p(i, j, k))<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi363" target="origFile"><code class="label">&            </code>*ss</a>
<a name="viscousflux_spatial_di365"></a>          <a href="viscousflux_p.html#viscousfluxi364" target="origFile">q_xd = q_xd - corrd*ssx - corr*ssxd</a>
          <a href="viscousflux_p.html#viscousfluxi364" target="origFile">q_x = q_x - corr*ssx</a>
<a name="viscousflux_spatial_di366"></a>          <a href="viscousflux_p.html#viscousfluxi365" target="origFile">q_yd = q_yd - corrd*ssy - corr*ssyd</a>
          <a href="viscousflux_p.html#viscousfluxi365" target="origFile">q_y = q_y - corr*ssy</a>
<a name="viscousflux_spatial_di367"></a>          <a href="viscousflux_p.html#viscousfluxi366" target="origFile">q_zd = q_zd - corrd*ssz - corr*sszd</a>
          <a href="viscousflux_p.html#viscousfluxi366" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousfluxi367" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousflux_spatial_di368"></a>          <a href="viscousflux_p.html#viscousfluxi367" target="origFile">fracdivd = twothird*(u_xd+v_yd+w_zd)</a>
          <a href="viscousflux_p.html#viscousfluxi367" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousflux_spatial_di369"></a>          <a href="viscousflux_p.html#viscousfluxi368" target="origFile">tauxxd = mut*(two*u_xd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi368" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousflux_spatial_di370"></a>          <a href="viscousflux_p.html#viscousfluxi369" target="origFile">tauyyd = mut*(two*v_yd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi369" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousflux_spatial_di371"></a>          <a href="viscousflux_p.html#viscousfluxi370" target="origFile">tauzzd = mut*(two*w_zd-fracdivd)</a>
          <a href="viscousflux_p.html#viscousfluxi370" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousflux_spatial_di372"></a>          <a href="viscousflux_p.html#viscousfluxi371" target="origFile">tauxyd = mut*(u_yd+v_xd)</a>
          <a href="viscousflux_p.html#viscousfluxi371" target="origFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousflux_spatial_di373"></a>          <a href="viscousflux_p.html#viscousfluxi372" target="origFile">tauxzd = mut*(u_zd+w_xd)</a>
          <a href="viscousflux_p.html#viscousfluxi372" target="origFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousflux_spatial_di374"></a>          <a href="viscousflux_p.html#viscousfluxi373" target="origFile">tauyzd = mut*(v_zd+w_yd)</a>
          <a href="viscousflux_p.html#viscousfluxi373" target="origFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousflux_spatial_di375"></a>          <a href="viscousflux_p.html#viscousfluxi374" target="origFile">q_xd = heatcoefd*q_x + heatcoef*q_xd</a>
          <a href="viscousflux_p.html#viscousfluxi374" target="origFile">q_x = heatcoef*q_x</a>
<a name="viscousflux_spatial_di376"></a>          <a href="viscousflux_p.html#viscousfluxi375" target="origFile">q_yd = heatcoefd*q_y + heatcoef*q_yd</a>
          <a href="viscousflux_p.html#viscousfluxi375" target="origFile">q_y = heatcoef*q_y</a>
<a name="viscousflux_spatial_di377"></a>          <a href="viscousflux_p.html#viscousfluxi376" target="origFile">q_zd = heatcoefd*q_z + heatcoef*q_zd</a>
          <a href="viscousflux_p.html#viscousfluxi376" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousfluxi377" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousfluxi377" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousflux_spatial_di378"></a>          <a href="viscousflux_p.html#viscousfluxi377" target="origFile">ubard = half*(wd(i, j, k, ivx)+wd(i+<code class="constant">1</code>, j, k, ivx))</a>
          <a href="viscousflux_p.html#viscousfluxi377" target="origFile">ubar = half*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx))</a>
<a name="viscousflux_spatial_di379"></a>          <a href="viscousflux_p.html#viscousfluxi378" target="origFile">vbard = half*(wd(i, j, k, ivy)+wd(i+<code class="constant">1</code>, j, k, ivy))</a>
          <a href="viscousflux_p.html#viscousfluxi378" target="origFile">vbar = half*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy))</a>
<a name="viscousflux_spatial_di380"></a>          <a href="viscousflux_p.html#viscousfluxi379" target="origFile">wbard = half*(wd(i, j, k, ivz)+wd(i+<code class="constant">1</code>, j, k, ivz))</a>
          <a href="viscousflux_p.html#viscousfluxi379" target="origFile">wbar = half*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz))</a>
<a href="viscousflux_p.html#viscousfluxi380" target="origFile"><code class="comment">! Compute the viscous fluxes for this i-face.</code></a>
          <a href="viscousflux_p.html#viscousfluxi380" target="origFile">fmxd = tauxxd*si(i, j, k, <code class="constant">1</code>) + tauxx*sid(i, j, k, <code class="constant">1</code>) + tauxyd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi380" target="origFile"><code class="label">&            </code>si(i, j, k, <code class="constant">2</code>) + tauxy*sid(i, j, k, <code class="constant">2</code>) + tauxzd*si(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi380" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauxz*sid(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di381"></a>          <a href="viscousflux_p.html#viscousfluxi380" target="origFile">fmx = tauxx*si(i, j, k, <code class="constant">1</code>) + tauxy*si(i, j, k, <code class="constant">2</code>) + tauxz*si(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi380" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi381" target="origFile">fmyd = tauxyd*si(i, j, k, <code class="constant">1</code>) + tauxy*sid(i, j, k, <code class="constant">1</code>) + tauyyd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi381" target="origFile"><code class="label">&            </code>si(i, j, k, <code class="constant">2</code>) + tauyy*sid(i, j, k, <code class="constant">2</code>) + tauyzd*si(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi381" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauyz*sid(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di382"></a>          <a href="viscousflux_p.html#viscousfluxi381" target="origFile">fmy = tauxy*si(i, j, k, <code class="constant">1</code>) + tauyy*si(i, j, k, <code class="constant">2</code>) + tauyz*si(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi381" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi382" target="origFile">fmzd = tauxzd*si(i, j, k, <code class="constant">1</code>) + tauxz*sid(i, j, k, <code class="constant">1</code>) + tauyzd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi382" target="origFile"><code class="label">&            </code>si(i, j, k, <code class="constant">2</code>) + tauyz*sid(i, j, k, <code class="constant">2</code>) + tauzzd*si(i, j, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi382" target="origFile"><code class="label">&            </code><code class="constant">3</code>) + tauzz*sid(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousflux_spatial_di383"></a>          <a href="viscousflux_p.html#viscousfluxi382" target="origFile">fmz = tauxz*si(i, j, k, <code class="constant">1</code>) + tauyz*si(i, j, k, <code class="constant">2</code>) + tauzz*si(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi382" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi383" target="origFile">frhoed = (ubard*tauxx+ubar*tauxxd+vbard*tauxy+vbar*tauxyd+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>wbard*tauxz+wbar*tauxzd)*si(i, j, k, <code class="constant">1</code>) + (ubar*tauxx+vbar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>tauxy+wbar*tauxz)*sid(i, j, k, <code class="constant">1</code>) + (ubard*tauxy+ubar*tauxyd<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>+vbard*tauyy+vbar*tauyyd+wbard*tauyz+wbar*tauyzd)*si(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>) + (ubar*tauxy+vbar*tauyy+wbar*tauyz)*sid(i, j, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>(ubard*tauxz+ubar*tauxzd+vbard*tauyz+vbar*tauyzd+wbard*tauzz<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>+wbar*tauzzd)*si(i, j, k, <code class="constant">3</code>) + (ubar*tauxz+vbar*tauyz+wbar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>tauzz)*sid(i, j, k, <code class="constant">3</code>) - q_xd*si(i, j, k, <code class="constant">1</code>) - q_x*sid(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>, k, <code class="constant">1</code>) - q_yd*si(i, j, k, <code class="constant">2</code>) - q_y*sid(i, j, k, <code class="constant">2</code>) - q_zd*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>si(i, j, k, <code class="constant">3</code>) - q_z*sid(i, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousfluxi383" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*si(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*si(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a name="viscousflux_spatial_di384"></a><a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*si(i, j, k, <code class="constant">3</code>) - q_x*si(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi383" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*si(i, j, k, <code class="constant">2</code>) - q_z*si(i, j, k, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousfluxi384" target="origFile"><code class="comment">! Update the residuals of cell i and i+1.</code></a>
<a name="viscousflux_spatial_di385"></a>          <a href="viscousflux_p.html#viscousfluxi384" target="origFile">fwd(i, j, k, imx) = fwd(i, j, k, imx) - fmxd</a>
          <a href="viscousflux_p.html#viscousfluxi384" target="origFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
<a name="viscousflux_spatial_di386"></a>          <a href="viscousflux_p.html#viscousfluxi385" target="origFile">fwd(i, j, k, imy) = fwd(i, j, k, imy) - fmyd</a>
          <a href="viscousflux_p.html#viscousfluxi385" target="origFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
<a name="viscousflux_spatial_di387"></a>          <a href="viscousflux_p.html#viscousfluxi386" target="origFile">fwd(i, j, k, imz) = fwd(i, j, k, imz) - fmzd</a>
          <a href="viscousflux_p.html#viscousfluxi386" target="origFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
<a name="viscousflux_spatial_di388"></a>          <a href="viscousflux_p.html#viscousfluxi387" target="origFile">fwd(i, j, k, irhoe) = fwd(i, j, k, irhoe) - frhoed</a>
          <a href="viscousflux_p.html#viscousfluxi387" target="origFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
<a name="viscousflux_spatial_di389"></a>          <a href="viscousflux_p.html#viscousfluxi388" target="origFile">fwd(i+<code class="constant">1</code>, j, k, imx) = fwd(i+<code class="constant">1</code>, j, k, imx) + fmxd</a>
          <a href="viscousflux_p.html#viscousfluxi388" target="origFile">fw(i+<code class="constant">1</code>, j, k, imx) = fw(i+<code class="constant">1</code>, j, k, imx) + fmx</a>
<a name="viscousflux_spatial_di390"></a>          <a href="viscousflux_p.html#viscousfluxi389" target="origFile">fwd(i+<code class="constant">1</code>, j, k, imy) = fwd(i+<code class="constant">1</code>, j, k, imy) + fmyd</a>
          <a href="viscousflux_p.html#viscousfluxi389" target="origFile">fw(i+<code class="constant">1</code>, j, k, imy) = fw(i+<code class="constant">1</code>, j, k, imy) + fmy</a>
<a name="viscousflux_spatial_di391"></a>          <a href="viscousflux_p.html#viscousfluxi390" target="origFile">fwd(i+<code class="constant">1</code>, j, k, imz) = fwd(i+<code class="constant">1</code>, j, k, imz) + fmzd</a>
          <a href="viscousflux_p.html#viscousfluxi390" target="origFile">fw(i+<code class="constant">1</code>, j, k, imz) = fw(i+<code class="constant">1</code>, j, k, imz) + fmz</a>
<a name="viscousflux_spatial_di392"></a>          <a href="viscousflux_p.html#viscousfluxi391" target="origFile">fwd(i+<code class="constant">1</code>, j, k, irhoe) = fwd(i+<code class="constant">1</code>, j, k, irhoe) + frhoed</a>
          <a href="viscousflux_p.html#viscousfluxi391" target="origFile">fw(i+<code class="constant">1</code>, j, k, irhoe) = fw(i+<code class="constant">1</code>, j, k, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousfluxi392" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux_p.html#viscousfluxi392" target="origFile"><code class="comment">! face is part of a viscous subface. Both the cases i == 1</code></a>
<a href="viscousflux_p.html#viscousfluxi392" target="origFile"><code class="comment">! and i == il must be tested.</code></a>
<a name="viscousflux_spatial_di393"></a>          <a href="viscousflux_p.html#viscousfluxi392" target="origFile"><code class="keyword">IF</code> (i .EQ. <code class="constant">1 </code>.AND. storewalltensor .AND. visciminpointer(j, k)<code class="label">&</code></a>
<a name="viscousflux_spatial_di394"></a><a href="viscousflux_p.html#viscousfluxi392" target="origFile"><code class="label">&              </code>.GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi393" target="origFile">nn = visciminpointer(j, k)</a>
<a name="viscousflux_spatial_di395"></a>            <a href="viscousflux_p.html#viscousfluxi394" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">1</code>) = tauxxd</a>
            <a href="viscousflux_p.html#viscousfluxi394" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousflux_spatial_di396"></a>            <a href="viscousflux_p.html#viscousfluxi395" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">2</code>) = tauyyd</a>
            <a href="viscousflux_p.html#viscousfluxi395" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousflux_spatial_di397"></a>            <a href="viscousflux_p.html#viscousfluxi396" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">3</code>) = tauzzd</a>
            <a href="viscousflux_p.html#viscousfluxi396" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousflux_spatial_di398"></a>            <a href="viscousflux_p.html#viscousfluxi397" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">4</code>) = tauxyd</a>
            <a href="viscousflux_p.html#viscousfluxi397" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousflux_spatial_di399"></a>            <a href="viscousflux_p.html#viscousfluxi398" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">5</code>) = tauxzd</a>
            <a href="viscousflux_p.html#viscousfluxi398" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousflux_spatial_di400"></a>            <a href="viscousflux_p.html#viscousfluxi399" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">6</code>) = tauyzd</a>
<a name="viscousflux_spatial_di401"></a>            <a href="viscousflux_p.html#viscousfluxi399" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousflux_spatial_di402"></a>            <a href="viscousflux_p.html#viscousfluxi400" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousfluxi401" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">2</code>) = q_y</a>
<a name="viscousflux_spatial_di403"></a>            <a href="viscousflux_p.html#viscousfluxi402" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousfluxi392" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousfluxi403" target="origFile"><code class="comment">! And the i == il case.</code></a>
<a name="viscousflux_spatial_di404"></a>          <a href="viscousflux_p.html#viscousfluxi403" target="origFile"><code class="keyword">IF</code> (i .EQ. il .AND. storewalltensor .AND. viscimaxpointer(j, k<code class="label">&</code></a>
<a name="viscousflux_spatial_di405"></a><a href="viscousflux_p.html#viscousfluxi403" target="origFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousfluxi404" target="origFile">nn = viscimaxpointer(j, k)</a>
<a name="viscousflux_spatial_di406"></a>            <a href="viscousflux_p.html#viscousfluxi405" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">1</code>) = tauxxd</a>
            <a href="viscousflux_p.html#viscousfluxi405" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousflux_spatial_di407"></a>            <a href="viscousflux_p.html#viscousfluxi406" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">2</code>) = tauyyd</a>
            <a href="viscousflux_p.html#viscousfluxi406" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousflux_spatial_di408"></a>            <a href="viscousflux_p.html#viscousfluxi407" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">3</code>) = tauzzd</a>
            <a href="viscousflux_p.html#viscousfluxi407" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousflux_spatial_di409"></a>            <a href="viscousflux_p.html#viscousfluxi408" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">4</code>) = tauxyd</a>
            <a href="viscousflux_p.html#viscousfluxi408" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousflux_spatial_di410"></a>            <a href="viscousflux_p.html#viscousfluxi409" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">5</code>) = tauxzd</a>
            <a href="viscousflux_p.html#viscousfluxi409" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousflux_spatial_di411"></a>            <a href="viscousflux_p.html#viscousfluxi410" target="origFile">viscsubfaced(nn)%tau(j, k, <code class="constant">6</code>) = tauyzd</a>
<a name="viscousflux_spatial_di412"></a>            <a href="viscousflux_p.html#viscousfluxi410" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousflux_spatial_di413"></a>            <a href="viscousflux_p.html#viscousfluxi411" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousfluxi412" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousfluxi413" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousfluxi403" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#viscousfluxi318" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di414"></a>      <a href="viscousflux_p.html#viscousfluxi317" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousfluxi129" target="origFile"><code class="keyword">END DO </code><code class="label">kloop</code></a>
<a href="viscousflux_p.html#viscousfluxi414" target="origFile"><code class="comment">! Restore the pressure in p. Again only the first layer of</code></a>
<a name="viscousflux_spatial_di415"></a><a href="viscousflux_p.html#viscousfluxi414" target="origFile"><code class="comment">! halo cells.</code></a>
<a name="viscousflux_spatial_di416"></a>    <a href="viscousflux_p.html#viscousfluxi414" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
<a name="viscousflux_spatial_di417"></a>      <a href="viscousflux_p.html#viscousfluxi415" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
        <a href="viscousflux_p.html#viscousfluxi416" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
          <a href="viscousflux_p.html#viscousfluxi417" target="origFile">p(i, j, k) = w(i, j, k, irho)*p(i, j, k)/gamma(i, j, k)</a>
        <a href="viscousflux_p.html#viscousfluxi416" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di418"></a>      <a href="viscousflux_p.html#viscousfluxi415" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di419"></a>    <a href="viscousflux_p.html#viscousfluxi414" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di420"></a>    <a href="viscousflux_p.html#viscousfluxi418" target="origFile"><code class="keyword">IF</code> (correctfork) <code class="keyword">THEN</code></a>
<a name="viscousflux_spatial_di421"></a>      <a href="viscousflux_p.html#viscousfluxi419" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
<a name="viscousflux_spatial_di422"></a>        <a href="viscousflux_p.html#viscousfluxi420" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
          <a href="viscousflux_p.html#viscousfluxi421" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
            <a href="viscousflux_p.html#viscousfluxi422" target="origFile">p(i, j, k) = p(i, j, k) + twothird*w(i, j, k, irho)*w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousfluxi422" target="origFile"><code class="label">&              </code>k, itu1)</a>
          <a href="viscousflux_p.html#viscousfluxi421" target="origFile"><code class="keyword">END DO</code></a>
        <a href="viscousflux_p.html#viscousfluxi420" target="origFile"><code class="keyword">END DO</code></a>
<a name="viscousflux_spatial_di423"></a>      <a href="viscousflux_p.html#viscousfluxi419" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousfluxi418" target="origFile"><code class="keyword">END IF</code></a>
<a name="viscousflux_spatial_di424"></a><a href="viscousflux_p.html#viscousfluxi423" target="origFile"><code class="comment">! Possibly correct the wall shear stress.</code></a>
    <a href="viscousflux_p.html#viscousfluxi423" target="origFile"><code class="keyword">CALL </code><code class="funcname">UTAUWF_SPATIAL_D</code>(rfilv)</a>
    <a href="viscousflux_p.html#viscousfluxi424" target="origFile"><code class="keyword">CLOSE</code>(unitvf) </a>
  <a href="viscousflux_p.html#viscousfluxi24" target="origFile"><code class="keyword">END IF</code></a>
<a name="nodalgradients_spatial_d"></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">CONTAINS</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!  Differentiation of nodalgradients in forward (tangent) mode:</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!   variations   of useful results: wx wy wz qx qy qz ux uy uz</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!                vx vy vz</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!   with respect to varying inputs: *p *w *vol *si *sj *sk wx wy</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!                wz qx qy qz ux uy uz vx vy vz</code></a>
  <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">NODALGRADIENTS_SPATIAL_D</code>(<code class="vardecl">ux</code>, <code class="vardecl">uxd</code>, <code class="vardecl">uy</code>, <code class="vardecl">uyd</code>, <code class="vardecl">uz</code>, <code class="vardecl">uzd</code>, <code class="vardecl">vx</code>, <code class="vardecl">vxd</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&    </code>, <code class="vardecl">vy</code>, <code class="vardecl">vyd</code>, <code class="vardecl">vz</code>, <code class="vardecl">vzd</code>, <code class="vardecl">wx</code>, <code class="vardecl">wxd</code>, <code class="vardecl">wy</code>, <code class="vardecl">wyd</code>, <code class="vardecl">wz</code>, <code class="vardecl">wzd</code>, <code class="vardecl">qx</code>, <code class="vardecl">qxd</code>, <code class="vardecl">qy</code>, <code class="vardecl">qyd</code>, <code class="vardecl">qz</code><code class="label">&</code></a>
<a name="nodalgradients_spatial_di0"></a><a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&    </code>, <code class="vardecl">qzd</code>)</a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="viscousflux_p.html#nodalgradientsi0" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradientsi0" target="origFile"><code class="comment">!        Subroutine arguments</code></a>
<a href="viscousflux_p.html#nodalgradientsi0" target="origFile"><code class="comment">!</code></a>
    <a href="viscousflux_p.html#nodalgradientsi0" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi0" target="origFile"><code class="label">&    </code><code class="vardecl">uz</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code>, <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code>, <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="vardecl">qz</code></a>
<a name="nodalgradients_spatial_di1"></a>    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, DIMENSION(il, jl, <code class="constant">2</code>), <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">uxd</code>, <code class="vardecl">uyd</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&    </code>, <code class="vardecl">uzd</code>, <code class="vardecl">vxd</code>, <code class="vardecl">vyd</code>, <code class="vardecl">vzd</code>, <code class="vardecl">wxd</code>, <code class="vardecl">wyd</code>, <code class="vardecl">wzd</code>, <code class="vardecl">qxd</code>, <code class="vardecl">qyd</code>, <code class="vardecl">qzd</code></a>
<a href="viscousflux_p.html#nodalgradientsi1" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradientsi1" target="origFile"><code class="comment">!        Local variables.</code></a>
<a href="viscousflux_p.html#nodalgradientsi1" target="origFile"><code class="comment">!</code></a>
<a name="nodalgradients_spatial_di2"></a>    <a href="viscousflux_p.html#nodalgradientsi1" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">oneoverv</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code>, <code class="vardecl">a2</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">oneovervd</code>, <code class="vardecl">ubard</code>, <code class="vardecl">vbard</code>, <code class="vardecl">wbard</code>, <code class="vardecl">a2d</code></a>
<a name="nodalgradients_spatial_di3"></a>    <a href="viscousflux_p.html#nodalgradientsi2" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">sx</code>, <code class="vardecl">sx1</code>, <code class="vardecl">sy</code>, <code class="vardecl">sy1</code>, <code class="vardecl">sz</code>, <code class="vardecl">sz1</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">sxd</code>, <code class="vardecl">sx1d</code>, <code class="vardecl">syd</code>, <code class="vardecl">sy1d</code>, <code class="vardecl">szd</code>, <code class="vardecl">sz1d</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">!        * Begin execution                                              *</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">! First part. Contribution in the k-direction. As the viscous</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">! fluxes are computed per k-plane, the values of the surface</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">! integrals in gauss's theorem are only scattered to one node.</code></a>
<a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">! Consequently this part is an initialization as well.</code></a>
<a name="nodalgradients_spatial_di4"></a><a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="comment">! Loop over the j and i direction.</code></a>
<a name="nodalgradients_spatial_di5"></a>    <a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux_p.html#nodalgradientsi4" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#nodalgradientsi5" target="origFile"><code class="comment">! Store 8 times the average normal for the contribution from</code></a>
<a href="viscousflux_p.html#nodalgradientsi5" target="origFile"><code class="comment">! the k-layer of cells. The factor 8 drops out later when</code></a>
<a href="viscousflux_p.html#nodalgradientsi5" target="origFile"><code class="comment">! dividing by the volume.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi5" target="origFile">sx1d = skd(i, j, k, <code class="constant">1</code>) + skd(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>) + skd(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>) +<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi5" target="origFile"><code class="label">&          </code>skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>)</a>
<a name="nodalgradients_spatial_di6"></a>        <a href="viscousflux_p.html#nodalgradientsi5" target="origFile">sx1 = sk(i, j, k, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi5" target="origFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi6" target="origFile">sy1d = skd(i, j, k, <code class="constant">2</code>) + skd(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>) + skd(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>) +<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi6" target="origFile"><code class="label">&          </code>skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>)</a>
<a name="nodalgradients_spatial_di7"></a>        <a href="viscousflux_p.html#nodalgradientsi6" target="origFile">sy1 = sk(i, j, k, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi6" target="origFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi7" target="origFile">sz1d = skd(i, j, k, <code class="constant">3</code>) + skd(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>) + skd(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>) +<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi7" target="origFile"><code class="label">&          </code>skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>)</a>
<a name="nodalgradients_spatial_di8"></a>        <a href="viscousflux_p.html#nodalgradientsi7" target="origFile">sz1 = sk(i, j, k, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi7" target="origFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi8" target="origFile">sxd = sx1d + skd(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + skd(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + skd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi8" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>) + skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="nodalgradients_spatial_di9"></a>        <a href="viscousflux_p.html#nodalgradientsi8" target="origFile">sx = sx1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi8" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi9" target="origFile">syd = sy1d + skd(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + skd(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + skd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi9" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>) + skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)</a>
<a name="nodalgradients_spatial_di10"></a>        <a href="viscousflux_p.html#nodalgradientsi9" target="origFile">sy = sy1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi9" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi10" target="origFile">szd = sz1d + skd(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + skd(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + skd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi10" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>) + skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="nodalgradients_spatial_di11"></a>        <a href="viscousflux_p.html#nodalgradientsi10" target="origFile">sz = sz1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi10" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradientsi11" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradientsi11" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradientsi11" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi11" target="origFile">ubard = fourth*(wd(i, j, k, ivx)+wd(i+<code class="constant">1</code>, j, k, ivx)+wd(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi11" target="origFile"><code class="label">&          </code>, ivx)+wd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivx))</a>
<a name="nodalgradients_spatial_di12"></a>        <a href="viscousflux_p.html#nodalgradientsi11" target="origFile">ubar = fourth*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi11" target="origFile"><code class="label">&          </code>ivx)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivx))</a>
        <a href="viscousflux_p.html#nodalgradientsi12" target="origFile">vbard = fourth*(wd(i, j, k, ivy)+wd(i+<code class="constant">1</code>, j, k, ivy)+wd(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi12" target="origFile"><code class="label">&          </code>, ivy)+wd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivy))</a>
<a name="nodalgradients_spatial_di13"></a>        <a href="viscousflux_p.html#nodalgradientsi12" target="origFile">vbar = fourth*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi12" target="origFile"><code class="label">&          </code>ivy)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivy))</a>
        <a href="viscousflux_p.html#nodalgradientsi13" target="origFile">wbard = fourth*(wd(i, j, k, ivz)+wd(i+<code class="constant">1</code>, j, k, ivz)+wd(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi13" target="origFile"><code class="label">&          </code>, ivz)+wd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivz))</a>
<a name="nodalgradients_spatial_di14"></a>        <a href="viscousflux_p.html#nodalgradientsi13" target="origFile">wbar = fourth*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi13" target="origFile"><code class="label">&          </code>ivz)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivz))</a>
        <a href="viscousflux_p.html#nodalgradientsi14" target="origFile">a2d = fourth*(pd(i, j, k)+pd(i+<code class="constant">1</code>, j, k)+pd(i, j+<code class="constant">1</code>, k)+pd(i+<code class="constant">1</code>, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi14" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k))</a>
<a name="nodalgradients_spatial_di15"></a>        <a href="viscousflux_p.html#nodalgradientsi14" target="origFile">a2 = fourth*(p(i, j, k)+p(i+<code class="constant">1</code>, j, k)+p(i, j+<code class="constant">1</code>, k)+p(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k)<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi14" target="origFile"><code class="label">&          </code>)</a>
<a href="viscousflux_p.html#nodalgradientsi15" target="origFile"><code class="comment">! Set the velocity and speed of sound square gradients.</code></a>
<a href="viscousflux_p.html#nodalgradientsi15" target="origFile"><code class="comment">! The minus sign is there, because these normals are inward</code></a>
<a href="viscousflux_p.html#nodalgradientsi15" target="origFile"><code class="comment">! pointing for the nodal k-layer. The exception is a2,</code></a>
<a href="viscousflux_p.html#nodalgradientsi15" target="origFile"><code class="comment">! because the gradient of -a2 is stored, as this is needed</code></a>
<a href="viscousflux_p.html#nodalgradientsi15" target="origFile"><code class="comment">! in the heat fluxes.</code></a>
<a name="nodalgradients_spatial_di16"></a>        <a href="viscousflux_p.html#nodalgradientsi15" target="origFile">uxd(i, j, k1) = -(ubard*sx+ubar*sxd)</a>
        <a href="viscousflux_p.html#nodalgradientsi15" target="origFile">ux(i, j, k1) = -(ubar*sx)</a>
<a name="nodalgradients_spatial_di17"></a>        <a href="viscousflux_p.html#nodalgradientsi16" target="origFile">uyd(i, j, k1) = -(ubard*sy+ubar*syd)</a>
        <a href="viscousflux_p.html#nodalgradientsi16" target="origFile">uy(i, j, k1) = -(ubar*sy)</a>
<a name="nodalgradients_spatial_di18"></a>        <a href="viscousflux_p.html#nodalgradientsi17" target="origFile">uzd(i, j, k1) = -(ubard*sz+ubar*szd)</a>
        <a href="viscousflux_p.html#nodalgradientsi17" target="origFile">uz(i, j, k1) = -(ubar*sz)</a>
<a name="nodalgradients_spatial_di19"></a>        <a href="viscousflux_p.html#nodalgradientsi18" target="origFile">vxd(i, j, k1) = -(vbard*sx+vbar*sxd)</a>
        <a href="viscousflux_p.html#nodalgradientsi18" target="origFile">vx(i, j, k1) = -(vbar*sx)</a>
<a name="nodalgradients_spatial_di20"></a>        <a href="viscousflux_p.html#nodalgradientsi19" target="origFile">vyd(i, j, k1) = -(vbard*sy+vbar*syd)</a>
        <a href="viscousflux_p.html#nodalgradientsi19" target="origFile">vy(i, j, k1) = -(vbar*sy)</a>
<a name="nodalgradients_spatial_di21"></a>        <a href="viscousflux_p.html#nodalgradientsi20" target="origFile">vzd(i, j, k1) = -(vbard*sz+vbar*szd)</a>
        <a href="viscousflux_p.html#nodalgradientsi20" target="origFile">vz(i, j, k1) = -(vbar*sz)</a>
<a name="nodalgradients_spatial_di22"></a>        <a href="viscousflux_p.html#nodalgradientsi21" target="origFile">wxd(i, j, k1) = -(wbard*sx+wbar*sxd)</a>
        <a href="viscousflux_p.html#nodalgradientsi21" target="origFile">wx(i, j, k1) = -(wbar*sx)</a>
<a name="nodalgradients_spatial_di23"></a>        <a href="viscousflux_p.html#nodalgradientsi22" target="origFile">wyd(i, j, k1) = -(wbard*sy+wbar*syd)</a>
        <a href="viscousflux_p.html#nodalgradientsi22" target="origFile">wy(i, j, k1) = -(wbar*sy)</a>
<a name="nodalgradients_spatial_di24"></a>        <a href="viscousflux_p.html#nodalgradientsi23" target="origFile">wzd(i, j, k1) = -(wbard*sz+wbar*szd)</a>
        <a href="viscousflux_p.html#nodalgradientsi23" target="origFile">wz(i, j, k1) = -(wbar*sz)</a>
<a name="nodalgradients_spatial_di25"></a>        <a href="viscousflux_p.html#nodalgradientsi24" target="origFile">qxd(i, j, k1) = a2d*sx + a2*sxd</a>
        <a href="viscousflux_p.html#nodalgradientsi24" target="origFile">qx(i, j, k1) = a2*sx</a>
<a name="nodalgradients_spatial_di26"></a>        <a href="viscousflux_p.html#nodalgradientsi25" target="origFile">qyd(i, j, k1) = a2d*sy + a2*syd</a>
        <a href="viscousflux_p.html#nodalgradientsi25" target="origFile">qy(i, j, k1) = a2*sy</a>
<a name="nodalgradients_spatial_di27"></a>        <a href="viscousflux_p.html#nodalgradientsi26" target="origFile">qzd(i, j, k1) = a2d*sz + a2*szd</a>
        <a href="viscousflux_p.html#nodalgradientsi26" target="origFile">qz(i, j, k1) = a2*sz</a>
<a href="viscousflux_p.html#nodalgradientsi27" target="origFile"><code class="comment">! Store 8 times the average normal for the contribution from</code></a>
<a href="viscousflux_p.html#nodalgradientsi27" target="origFile"><code class="comment">! the k+1 layer of cells. The factor 8 drops out later when</code></a>
<a href="viscousflux_p.html#nodalgradientsi27" target="origFile"><code class="comment">! dividing by the volume.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi27" target="origFile">sxd = sx1d + skd(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + skd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + skd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi27" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="nodalgradients_spatial_di28"></a>        <a href="viscousflux_p.html#nodalgradientsi27" target="origFile">sx = sx1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi27" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi28" target="origFile">syd = sy1d + skd(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + skd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + skd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi28" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
<a name="nodalgradients_spatial_di29"></a>        <a href="viscousflux_p.html#nodalgradientsi28" target="origFile">sy = sy1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi28" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi29" target="origFile">szd = sz1d + skd(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + skd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + skd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi29" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + skd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="nodalgradients_spatial_di30"></a>        <a href="viscousflux_p.html#nodalgradientsi29" target="origFile">sz = sz1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi29" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradientsi30" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradientsi30" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradientsi30" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi30" target="origFile">ubard = fourth*(wd(i, j, k+<code class="constant">1</code>, ivx)+wd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx)+wd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi30" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k+<code class="constant">1</code>, ivx)+wd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
<a name="nodalgradients_spatial_di31"></a>        <a href="viscousflux_p.html#nodalgradientsi30" target="origFile">ubar = fourth*(w(i, j, k+<code class="constant">1</code>, ivx)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi30" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, ivx)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
        <a href="viscousflux_p.html#nodalgradientsi31" target="origFile">vbard = fourth*(wd(i, j, k+<code class="constant">1</code>, ivy)+wd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy)+wd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi31" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k+<code class="constant">1</code>, ivy)+wd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
<a name="nodalgradients_spatial_di32"></a>        <a href="viscousflux_p.html#nodalgradientsi31" target="origFile">vbar = fourth*(w(i, j, k+<code class="constant">1</code>, ivy)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi31" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, ivy)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
        <a href="viscousflux_p.html#nodalgradientsi32" target="origFile">wbard = fourth*(wd(i, j, k+<code class="constant">1</code>, ivz)+wd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz)+wd(i, j+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi32" target="origFile"><code class="label">&          </code><code class="constant">1</code>, k+<code class="constant">1</code>, ivz)+wd(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
<a name="nodalgradients_spatial_di33"></a>        <a href="viscousflux_p.html#nodalgradientsi32" target="origFile">wbar = fourth*(w(i, j, k+<code class="constant">1</code>, ivz)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi32" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, ivz)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
        <a href="viscousflux_p.html#nodalgradientsi33" target="origFile">a2d = fourth*(pd(i, j, k+<code class="constant">1</code>)+pd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+pd(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+pd(i<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi33" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>))</a>
<a name="nodalgradients_spatial_di34"></a>        <a href="viscousflux_p.html#nodalgradientsi33" target="origFile">a2 = fourth*(p(i, j, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+p(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi33" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, k+<code class="constant">1</code>))</a>
<a href="viscousflux_p.html#nodalgradientsi34" target="origFile"><code class="comment">! Update the velocity and (minus) the speed of sound</code></a>
<a href="viscousflux_p.html#nodalgradientsi34" target="origFile"><code class="comment">! gradients. As the normals are now outward pointing for</code></a>
<a href="viscousflux_p.html#nodalgradientsi34" target="origFile"><code class="comment">! the nodes in the k-layer, there is a plus sign for the</code></a>
<a href="viscousflux_p.html#nodalgradientsi34" target="origFile"><code class="comment">! velocity gradients and a minus sign for minus the speed</code></a>
<a href="viscousflux_p.html#nodalgradientsi34" target="origFile"><code class="comment">! of sound squared.</code></a>
<a name="nodalgradients_spatial_di35"></a>        <a href="viscousflux_p.html#nodalgradientsi34" target="origFile">uxd(i, j, k1) = uxd(i, j, k1) + ubard*sx + ubar*sxd</a>
        <a href="viscousflux_p.html#nodalgradientsi34" target="origFile">ux(i, j, k1) = ux(i, j, k1) + ubar*sx</a>
<a name="nodalgradients_spatial_di36"></a>        <a href="viscousflux_p.html#nodalgradientsi35" target="origFile">uyd(i, j, k1) = uyd(i, j, k1) + ubard*sy + ubar*syd</a>
        <a href="viscousflux_p.html#nodalgradientsi35" target="origFile">uy(i, j, k1) = uy(i, j, k1) + ubar*sy</a>
<a name="nodalgradients_spatial_di37"></a>        <a href="viscousflux_p.html#nodalgradientsi36" target="origFile">uzd(i, j, k1) = uzd(i, j, k1) + ubard*sz + ubar*szd</a>
        <a href="viscousflux_p.html#nodalgradientsi36" target="origFile">uz(i, j, k1) = uz(i, j, k1) + ubar*sz</a>
<a name="nodalgradients_spatial_di38"></a>        <a href="viscousflux_p.html#nodalgradientsi37" target="origFile">vxd(i, j, k1) = vxd(i, j, k1) + vbard*sx + vbar*sxd</a>
        <a href="viscousflux_p.html#nodalgradientsi37" target="origFile">vx(i, j, k1) = vx(i, j, k1) + vbar*sx</a>
<a name="nodalgradients_spatial_di39"></a>        <a href="viscousflux_p.html#nodalgradientsi38" target="origFile">vyd(i, j, k1) = vyd(i, j, k1) + vbard*sy + vbar*syd</a>
        <a href="viscousflux_p.html#nodalgradientsi38" target="origFile">vy(i, j, k1) = vy(i, j, k1) + vbar*sy</a>
<a name="nodalgradients_spatial_di40"></a>        <a href="viscousflux_p.html#nodalgradientsi39" target="origFile">vzd(i, j, k1) = vzd(i, j, k1) + vbard*sz + vbar*szd</a>
        <a href="viscousflux_p.html#nodalgradientsi39" target="origFile">vz(i, j, k1) = vz(i, j, k1) + vbar*sz</a>
<a name="nodalgradients_spatial_di41"></a>        <a href="viscousflux_p.html#nodalgradientsi40" target="origFile">wxd(i, j, k1) = wxd(i, j, k1) + wbard*sx + wbar*sxd</a>
        <a href="viscousflux_p.html#nodalgradientsi40" target="origFile">wx(i, j, k1) = wx(i, j, k1) + wbar*sx</a>
<a name="nodalgradients_spatial_di42"></a>        <a href="viscousflux_p.html#nodalgradientsi41" target="origFile">wyd(i, j, k1) = wyd(i, j, k1) + wbard*sy + wbar*syd</a>
        <a href="viscousflux_p.html#nodalgradientsi41" target="origFile">wy(i, j, k1) = wy(i, j, k1) + wbar*sy</a>
<a name="nodalgradients_spatial_di43"></a>        <a href="viscousflux_p.html#nodalgradientsi42" target="origFile">wzd(i, j, k1) = wzd(i, j, k1) + wbard*sz + wbar*szd</a>
        <a href="viscousflux_p.html#nodalgradientsi42" target="origFile">wz(i, j, k1) = wz(i, j, k1) + wbar*sz</a>
<a name="nodalgradients_spatial_di44"></a>        <a href="viscousflux_p.html#nodalgradientsi43" target="origFile">qxd(i, j, k1) = qxd(i, j, k1) - a2d*sx - a2*sxd</a>
        <a href="viscousflux_p.html#nodalgradientsi43" target="origFile">qx(i, j, k1) = qx(i, j, k1) - a2*sx</a>
<a name="nodalgradients_spatial_di45"></a>        <a href="viscousflux_p.html#nodalgradientsi44" target="origFile">qyd(i, j, k1) = qyd(i, j, k1) - a2d*sy - a2*syd</a>
        <a href="viscousflux_p.html#nodalgradientsi44" target="origFile">qy(i, j, k1) = qy(i, j, k1) - a2*sy</a>
        <a href="viscousflux_p.html#nodalgradientsi45" target="origFile">qzd(i, j, k1) = qzd(i, j, k1) - a2d*sz - a2*szd</a>
        <a href="viscousflux_p.html#nodalgradientsi45" target="origFile">qz(i, j, k1) = qz(i, j, k1) - a2*sz</a>
<a name="nodalgradients_spatial_di46"></a>      <a href="viscousflux_p.html#nodalgradientsi4" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#nodalgradientsi3" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#nodalgradientsi46" target="origFile"><code class="comment">! Second part. Contribution in the j-direction.</code></a>
<a href="viscousflux_p.html#nodalgradientsi46" target="origFile"><code class="comment">! The contribution is scattered to both the left and right node</code></a>
<a name="nodalgradients_spatial_di47"></a><a href="viscousflux_p.html#nodalgradientsi46" target="origFile"><code class="comment">! in j-direction.</code></a>
<a name="nodalgradients_spatial_di48"></a>    <a href="viscousflux_p.html#nodalgradientsi46" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
      <a href="viscousflux_p.html#nodalgradientsi47" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#nodalgradientsi48" target="origFile"><code class="comment">! Compute 8 times the average normal for this part of</code></a>
<a href="viscousflux_p.html#nodalgradientsi48" target="origFile"><code class="comment">! the control volume. The factor 8 is taken care of later</code></a>
<a href="viscousflux_p.html#nodalgradientsi48" target="origFile"><code class="comment">! on when the division by the volume takes place.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi48" target="origFile">sxd = sjd(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sjd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sjd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi48" target="origFile"><code class="label">&          </code>, <code class="constant">1</code>) + sjd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + sjd(i, j, k, <code class="constant">1</code>) + sjd(i+<code class="constant">1</code>, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi48" target="origFile"><code class="label">&          </code>, <code class="constant">1</code>) + sjd(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sjd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi48" target="origFile">sx = sj(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) <code class="label">&</code></a>
<a name="nodalgradients_spatial_di49"></a><a href="viscousflux_p.html#nodalgradientsi48" target="origFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + sj(i, j, k, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi48" target="origFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi49" target="origFile">syd = sjd(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sjd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sjd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi49" target="origFile"><code class="label">&          </code>, <code class="constant">2</code>) + sjd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + sjd(i, j, k, <code class="constant">2</code>) + sjd(i+<code class="constant">1</code>, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi49" target="origFile"><code class="label">&          </code>, <code class="constant">2</code>) + sjd(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sjd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi49" target="origFile">sy = sj(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) <code class="label">&</code></a>
<a name="nodalgradients_spatial_di50"></a><a href="viscousflux_p.html#nodalgradientsi49" target="origFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + sj(i, j, k, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi49" target="origFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi50" target="origFile">szd = sjd(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sjd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sjd(i, j-<code class="constant">1</code>, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi50" target="origFile"><code class="label">&          </code>, <code class="constant">3</code>) + sjd(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + sjd(i, j, k, <code class="constant">3</code>) + sjd(i+<code class="constant">1</code>, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi50" target="origFile"><code class="label">&          </code>, <code class="constant">3</code>) + sjd(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sjd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi50" target="origFile">sz = sj(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) <code class="label">&</code></a>
<a name="nodalgradients_spatial_di51"></a><a href="viscousflux_p.html#nodalgradientsi50" target="origFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + sj(i, j, k, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi50" target="origFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradientsi51" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradientsi51" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradientsi51" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi51" target="origFile">ubard = fourth*(wd(i, j, k, ivx)+wd(i+<code class="constant">1</code>, j, k, ivx)+wd(i, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi51" target="origFile"><code class="label">&          </code>, ivx)+wd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx))</a>
<a name="nodalgradients_spatial_di52"></a>        <a href="viscousflux_p.html#nodalgradientsi51" target="origFile">ubar = fourth*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi51" target="origFile"><code class="label">&          </code>ivx)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx))</a>
        <a href="viscousflux_p.html#nodalgradientsi52" target="origFile">vbard = fourth*(wd(i, j, k, ivy)+wd(i+<code class="constant">1</code>, j, k, ivy)+wd(i, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi52" target="origFile"><code class="label">&          </code>, ivy)+wd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy))</a>
<a name="nodalgradients_spatial_di53"></a>        <a href="viscousflux_p.html#nodalgradientsi52" target="origFile">vbar = fourth*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi52" target="origFile"><code class="label">&          </code>ivy)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy))</a>
        <a href="viscousflux_p.html#nodalgradientsi53" target="origFile">wbard = fourth*(wd(i, j, k, ivz)+wd(i+<code class="constant">1</code>, j, k, ivz)+wd(i, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi53" target="origFile"><code class="label">&          </code>, ivz)+wd(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz))</a>
<a name="nodalgradients_spatial_di54"></a>        <a href="viscousflux_p.html#nodalgradientsi53" target="origFile">wbar = fourth*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi53" target="origFile"><code class="label">&          </code>ivz)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz))</a>
        <a href="viscousflux_p.html#nodalgradientsi54" target="origFile">a2d = fourth*(pd(i, j, k)+pd(i+<code class="constant">1</code>, j, k)+pd(i, j, k+<code class="constant">1</code>)+pd(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi54" target="origFile"><code class="label">&          </code>, k+<code class="constant">1</code>))</a>
<a name="nodalgradients_spatial_di55"></a>        <a href="viscousflux_p.html#nodalgradientsi54" target="origFile">a2 = fourth*(p(i, j, k)+p(i+<code class="constant">1</code>, j, k)+p(i, j, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi54" target="origFile"><code class="label">&          </code>)</a>
<a href="viscousflux_p.html#nodalgradientsi55" target="origFile"><code class="comment">! Add the contributions to the surface integral to the node</code></a>
<a href="viscousflux_p.html#nodalgradientsi55" target="origFile"><code class="comment">! j-1 and substract it from the node j. For the heat flux it</code></a>
<a href="viscousflux_p.html#nodalgradientsi55" target="origFile"><code class="comment">! is reversed, because the negative of the gradient of the</code></a>
<a name="nodalgradients_spatial_di56"></a><a href="viscousflux_p.html#nodalgradientsi55" target="origFile"><code class="comment">! speed of sound must be computed.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi55" target="origFile"><code class="keyword">IF</code> (j .GT. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a name="nodalgradients_spatial_di57"></a>          <a href="viscousflux_p.html#nodalgradientsi56" target="origFile">uxd(i, j-<code class="constant">1</code>, k1) = uxd(i, j-<code class="constant">1</code>, k1) + ubard*sx + ubar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi56" target="origFile">ux(i, j-<code class="constant">1</code>, k1) = ux(i, j-<code class="constant">1</code>, k1) + ubar*sx</a>
<a name="nodalgradients_spatial_di58"></a>          <a href="viscousflux_p.html#nodalgradientsi57" target="origFile">uyd(i, j-<code class="constant">1</code>, k1) = uyd(i, j-<code class="constant">1</code>, k1) + ubard*sy + ubar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi57" target="origFile">uy(i, j-<code class="constant">1</code>, k1) = uy(i, j-<code class="constant">1</code>, k1) + ubar*sy</a>
<a name="nodalgradients_spatial_di59"></a>          <a href="viscousflux_p.html#nodalgradientsi58" target="origFile">uzd(i, j-<code class="constant">1</code>, k1) = uzd(i, j-<code class="constant">1</code>, k1) + ubard*sz + ubar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi58" target="origFile">uz(i, j-<code class="constant">1</code>, k1) = uz(i, j-<code class="constant">1</code>, k1) + ubar*sz</a>
<a name="nodalgradients_spatial_di60"></a>          <a href="viscousflux_p.html#nodalgradientsi59" target="origFile">vxd(i, j-<code class="constant">1</code>, k1) = vxd(i, j-<code class="constant">1</code>, k1) + vbard*sx + vbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi59" target="origFile">vx(i, j-<code class="constant">1</code>, k1) = vx(i, j-<code class="constant">1</code>, k1) + vbar*sx</a>
<a name="nodalgradients_spatial_di61"></a>          <a href="viscousflux_p.html#nodalgradientsi60" target="origFile">vyd(i, j-<code class="constant">1</code>, k1) = vyd(i, j-<code class="constant">1</code>, k1) + vbard*sy + vbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi60" target="origFile">vy(i, j-<code class="constant">1</code>, k1) = vy(i, j-<code class="constant">1</code>, k1) + vbar*sy</a>
<a name="nodalgradients_spatial_di62"></a>          <a href="viscousflux_p.html#nodalgradientsi61" target="origFile">vzd(i, j-<code class="constant">1</code>, k1) = vzd(i, j-<code class="constant">1</code>, k1) + vbard*sz + vbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi61" target="origFile">vz(i, j-<code class="constant">1</code>, k1) = vz(i, j-<code class="constant">1</code>, k1) + vbar*sz</a>
<a name="nodalgradients_spatial_di63"></a>          <a href="viscousflux_p.html#nodalgradientsi62" target="origFile">wxd(i, j-<code class="constant">1</code>, k1) = wxd(i, j-<code class="constant">1</code>, k1) + wbard*sx + wbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi62" target="origFile">wx(i, j-<code class="constant">1</code>, k1) = wx(i, j-<code class="constant">1</code>, k1) + wbar*sx</a>
<a name="nodalgradients_spatial_di64"></a>          <a href="viscousflux_p.html#nodalgradientsi63" target="origFile">wyd(i, j-<code class="constant">1</code>, k1) = wyd(i, j-<code class="constant">1</code>, k1) + wbard*sy + wbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi63" target="origFile">wy(i, j-<code class="constant">1</code>, k1) = wy(i, j-<code class="constant">1</code>, k1) + wbar*sy</a>
<a name="nodalgradients_spatial_di65"></a>          <a href="viscousflux_p.html#nodalgradientsi64" target="origFile">wzd(i, j-<code class="constant">1</code>, k1) = wzd(i, j-<code class="constant">1</code>, k1) + wbard*sz + wbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi64" target="origFile">wz(i, j-<code class="constant">1</code>, k1) = wz(i, j-<code class="constant">1</code>, k1) + wbar*sz</a>
<a name="nodalgradients_spatial_di66"></a>          <a href="viscousflux_p.html#nodalgradientsi65" target="origFile">qxd(i, j-<code class="constant">1</code>, k1) = qxd(i, j-<code class="constant">1</code>, k1) - a2d*sx - a2*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi65" target="origFile">qx(i, j-<code class="constant">1</code>, k1) = qx(i, j-<code class="constant">1</code>, k1) - a2*sx</a>
<a name="nodalgradients_spatial_di67"></a>          <a href="viscousflux_p.html#nodalgradientsi66" target="origFile">qyd(i, j-<code class="constant">1</code>, k1) = qyd(i, j-<code class="constant">1</code>, k1) - a2d*sy - a2*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi66" target="origFile">qy(i, j-<code class="constant">1</code>, k1) = qy(i, j-<code class="constant">1</code>, k1) - a2*sy</a>
          <a href="viscousflux_p.html#nodalgradientsi67" target="origFile">qzd(i, j-<code class="constant">1</code>, k1) = qzd(i, j-<code class="constant">1</code>, k1) - a2d*sz - a2*szd</a>
<a name="nodalgradients_spatial_di68"></a>          <a href="viscousflux_p.html#nodalgradientsi67" target="origFile">qz(i, j-<code class="constant">1</code>, k1) = qz(i, j-<code class="constant">1</code>, k1) - a2*sz</a>
<a name="nodalgradients_spatial_di69"></a>        <a href="viscousflux_p.html#nodalgradientsi55" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#nodalgradientsi68" target="origFile"><code class="keyword">IF</code> (j .LT. je) <code class="keyword">THEN</code></a>
<a name="nodalgradients_spatial_di70"></a>          <a href="viscousflux_p.html#nodalgradientsi69" target="origFile">uxd(i, j, k1) = uxd(i, j, k1) - ubard*sx - ubar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi69" target="origFile">ux(i, j, k1) = ux(i, j, k1) - ubar*sx</a>
<a name="nodalgradients_spatial_di71"></a>          <a href="viscousflux_p.html#nodalgradientsi70" target="origFile">uyd(i, j, k1) = uyd(i, j, k1) - ubard*sy - ubar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi70" target="origFile">uy(i, j, k1) = uy(i, j, k1) - ubar*sy</a>
<a name="nodalgradients_spatial_di72"></a>          <a href="viscousflux_p.html#nodalgradientsi71" target="origFile">uzd(i, j, k1) = uzd(i, j, k1) - ubard*sz - ubar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi71" target="origFile">uz(i, j, k1) = uz(i, j, k1) - ubar*sz</a>
<a name="nodalgradients_spatial_di73"></a>          <a href="viscousflux_p.html#nodalgradientsi72" target="origFile">vxd(i, j, k1) = vxd(i, j, k1) - vbard*sx - vbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi72" target="origFile">vx(i, j, k1) = vx(i, j, k1) - vbar*sx</a>
<a name="nodalgradients_spatial_di74"></a>          <a href="viscousflux_p.html#nodalgradientsi73" target="origFile">vyd(i, j, k1) = vyd(i, j, k1) - vbard*sy - vbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi73" target="origFile">vy(i, j, k1) = vy(i, j, k1) - vbar*sy</a>
<a name="nodalgradients_spatial_di75"></a>          <a href="viscousflux_p.html#nodalgradientsi74" target="origFile">vzd(i, j, k1) = vzd(i, j, k1) - vbard*sz - vbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi74" target="origFile">vz(i, j, k1) = vz(i, j, k1) - vbar*sz</a>
<a name="nodalgradients_spatial_di76"></a>          <a href="viscousflux_p.html#nodalgradientsi75" target="origFile">wxd(i, j, k1) = wxd(i, j, k1) - wbard*sx - wbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi75" target="origFile">wx(i, j, k1) = wx(i, j, k1) - wbar*sx</a>
<a name="nodalgradients_spatial_di77"></a>          <a href="viscousflux_p.html#nodalgradientsi76" target="origFile">wyd(i, j, k1) = wyd(i, j, k1) - wbard*sy - wbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi76" target="origFile">wy(i, j, k1) = wy(i, j, k1) - wbar*sy</a>
<a name="nodalgradients_spatial_di78"></a>          <a href="viscousflux_p.html#nodalgradientsi77" target="origFile">wzd(i, j, k1) = wzd(i, j, k1) - wbard*sz - wbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi77" target="origFile">wz(i, j, k1) = wz(i, j, k1) - wbar*sz</a>
<a name="nodalgradients_spatial_di79"></a>          <a href="viscousflux_p.html#nodalgradientsi78" target="origFile">qxd(i, j, k1) = qxd(i, j, k1) + a2d*sx + a2*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi78" target="origFile">qx(i, j, k1) = qx(i, j, k1) + a2*sx</a>
<a name="nodalgradients_spatial_di80"></a>          <a href="viscousflux_p.html#nodalgradientsi79" target="origFile">qyd(i, j, k1) = qyd(i, j, k1) + a2d*sy + a2*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi79" target="origFile">qy(i, j, k1) = qy(i, j, k1) + a2*sy</a>
          <a href="viscousflux_p.html#nodalgradientsi80" target="origFile">qzd(i, j, k1) = qzd(i, j, k1) + a2d*sz + a2*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi80" target="origFile">qz(i, j, k1) = qz(i, j, k1) + a2*sz</a>
        <a href="viscousflux_p.html#nodalgradientsi68" target="origFile"><code class="keyword">END IF</code></a>
<a name="nodalgradients_spatial_di81"></a>      <a href="viscousflux_p.html#nodalgradientsi47" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#nodalgradientsi46" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#nodalgradientsi81" target="origFile"><code class="comment">! Third part. Contribution in the i-direction.</code></a>
<a href="viscousflux_p.html#nodalgradientsi81" target="origFile"><code class="comment">! The contribution is scattered to both the left and right node</code></a>
<a name="nodalgradients_spatial_di82"></a><a href="viscousflux_p.html#nodalgradientsi81" target="origFile"><code class="comment">! in i-direction.</code></a>
<a name="nodalgradients_spatial_di83"></a>    <a href="viscousflux_p.html#nodalgradientsi81" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux_p.html#nodalgradientsi82" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
<a href="viscousflux_p.html#nodalgradientsi83" target="origFile"><code class="comment">! Compute 8 times the average normal for this part of</code></a>
<a href="viscousflux_p.html#nodalgradientsi83" target="origFile"><code class="comment">! the control volume. The factor 8 is taken care of later</code></a>
<a href="viscousflux_p.html#nodalgradientsi83" target="origFile"><code class="comment">! on when the division by the volume takes place.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi83" target="origFile">sxd = sid(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>) + sid(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + sid(i-<code class="constant">1</code>, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi83" target="origFile"><code class="label">&          </code>, <code class="constant">1</code>) + sid(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + sid(i, j, k, <code class="constant">1</code>) + sid(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi83" target="origFile"><code class="label">&          </code>, <code class="constant">1</code>) + sid(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sid(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi83" target="origFile">sx = si(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>) <code class="label">&</code></a>
<a name="nodalgradients_spatial_di84"></a><a href="viscousflux_p.html#nodalgradientsi83" target="origFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + si(i, j, k, <code class="constant">1</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi83" target="origFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi84" target="origFile">syd = sid(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>) + sid(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + sid(i-<code class="constant">1</code>, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi84" target="origFile"><code class="label">&          </code>, <code class="constant">2</code>) + sid(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + sid(i, j, k, <code class="constant">2</code>) + sid(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi84" target="origFile"><code class="label">&          </code>, <code class="constant">2</code>) + sid(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sid(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi84" target="origFile">sy = si(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>) <code class="label">&</code></a>
<a name="nodalgradients_spatial_di85"></a><a href="viscousflux_p.html#nodalgradientsi84" target="origFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + si(i, j, k, <code class="constant">2</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi84" target="origFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi85" target="origFile">szd = sid(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>) + sid(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + sid(i-<code class="constant">1</code>, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi85" target="origFile"><code class="label">&          </code>, <code class="constant">3</code>) + sid(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + sid(i, j, k, <code class="constant">3</code>) + sid(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi85" target="origFile"><code class="label">&          </code>, <code class="constant">3</code>) + sid(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sid(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi85" target="origFile">sz = si(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>) <code class="label">&</code></a>
<a name="nodalgradients_spatial_di86"></a><a href="viscousflux_p.html#nodalgradientsi85" target="origFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + si(i, j, k, <code class="constant">3</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi85" target="origFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradientsi86" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradientsi86" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradientsi86" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi86" target="origFile">ubard = fourth*(wd(i, j, k, ivx)+wd(i, j+<code class="constant">1</code>, k, ivx)+wd(i, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi86" target="origFile"><code class="label">&          </code>, ivx)+wd(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
<a name="nodalgradients_spatial_di87"></a>        <a href="viscousflux_p.html#nodalgradientsi86" target="origFile">ubar = fourth*(w(i, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, ivx)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi86" target="origFile"><code class="label">&          </code>ivx)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
        <a href="viscousflux_p.html#nodalgradientsi87" target="origFile">vbard = fourth*(wd(i, j, k, ivy)+wd(i, j+<code class="constant">1</code>, k, ivy)+wd(i, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi87" target="origFile"><code class="label">&          </code>, ivy)+wd(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
<a name="nodalgradients_spatial_di88"></a>        <a href="viscousflux_p.html#nodalgradientsi87" target="origFile">vbar = fourth*(w(i, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, ivy)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi87" target="origFile"><code class="label">&          </code>ivy)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
        <a href="viscousflux_p.html#nodalgradientsi88" target="origFile">wbard = fourth*(wd(i, j, k, ivz)+wd(i, j+<code class="constant">1</code>, k, ivz)+wd(i, j, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi88" target="origFile"><code class="label">&          </code>, ivz)+wd(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
<a name="nodalgradients_spatial_di89"></a>        <a href="viscousflux_p.html#nodalgradientsi88" target="origFile">wbar = fourth*(w(i, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, ivz)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi88" target="origFile"><code class="label">&          </code>ivz)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
        <a href="viscousflux_p.html#nodalgradientsi89" target="origFile">a2d = fourth*(pd(i, j, k)+pd(i, j+<code class="constant">1</code>, k)+pd(i, j, k+<code class="constant">1</code>)+pd(i, j+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi89" target="origFile"><code class="label">&          </code>, k+<code class="constant">1</code>))</a>
<a name="nodalgradients_spatial_di90"></a>        <a href="viscousflux_p.html#nodalgradientsi89" target="origFile">a2 = fourth*(p(i, j, k)+p(i, j+<code class="constant">1</code>, k)+p(i, j, k+<code class="constant">1</code>)+p(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi89" target="origFile"><code class="label">&          </code>)</a>
<a href="viscousflux_p.html#nodalgradientsi90" target="origFile"><code class="comment">! Add the contributions to the surface integral to the node</code></a>
<a href="viscousflux_p.html#nodalgradientsi90" target="origFile"><code class="comment">! j-1 and substract it from the node j. For the heat flux it</code></a>
<a href="viscousflux_p.html#nodalgradientsi90" target="origFile"><code class="comment">! is reversed, because the negative of the gradient of the</code></a>
<a name="nodalgradients_spatial_di91"></a><a href="viscousflux_p.html#nodalgradientsi90" target="origFile"><code class="comment">! speed of sound must be computed.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi90" target="origFile"><code class="keyword">IF</code> (i .GT. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a name="nodalgradients_spatial_di92"></a>          <a href="viscousflux_p.html#nodalgradientsi91" target="origFile">uxd(i-<code class="constant">1</code>, j, k1) = uxd(i-<code class="constant">1</code>, j, k1) + ubard*sx + ubar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi91" target="origFile">ux(i-<code class="constant">1</code>, j, k1) = ux(i-<code class="constant">1</code>, j, k1) + ubar*sx</a>
<a name="nodalgradients_spatial_di93"></a>          <a href="viscousflux_p.html#nodalgradientsi92" target="origFile">uyd(i-<code class="constant">1</code>, j, k1) = uyd(i-<code class="constant">1</code>, j, k1) + ubard*sy + ubar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi92" target="origFile">uy(i-<code class="constant">1</code>, j, k1) = uy(i-<code class="constant">1</code>, j, k1) + ubar*sy</a>
<a name="nodalgradients_spatial_di94"></a>          <a href="viscousflux_p.html#nodalgradientsi93" target="origFile">uzd(i-<code class="constant">1</code>, j, k1) = uzd(i-<code class="constant">1</code>, j, k1) + ubard*sz + ubar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi93" target="origFile">uz(i-<code class="constant">1</code>, j, k1) = uz(i-<code class="constant">1</code>, j, k1) + ubar*sz</a>
<a name="nodalgradients_spatial_di95"></a>          <a href="viscousflux_p.html#nodalgradientsi94" target="origFile">vxd(i-<code class="constant">1</code>, j, k1) = vxd(i-<code class="constant">1</code>, j, k1) + vbard*sx + vbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi94" target="origFile">vx(i-<code class="constant">1</code>, j, k1) = vx(i-<code class="constant">1</code>, j, k1) + vbar*sx</a>
<a name="nodalgradients_spatial_di96"></a>          <a href="viscousflux_p.html#nodalgradientsi95" target="origFile">vyd(i-<code class="constant">1</code>, j, k1) = vyd(i-<code class="constant">1</code>, j, k1) + vbard*sy + vbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi95" target="origFile">vy(i-<code class="constant">1</code>, j, k1) = vy(i-<code class="constant">1</code>, j, k1) + vbar*sy</a>
<a name="nodalgradients_spatial_di97"></a>          <a href="viscousflux_p.html#nodalgradientsi96" target="origFile">vzd(i-<code class="constant">1</code>, j, k1) = vzd(i-<code class="constant">1</code>, j, k1) + vbard*sz + vbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi96" target="origFile">vz(i-<code class="constant">1</code>, j, k1) = vz(i-<code class="constant">1</code>, j, k1) + vbar*sz</a>
<a name="nodalgradients_spatial_di98"></a>          <a href="viscousflux_p.html#nodalgradientsi97" target="origFile">wxd(i-<code class="constant">1</code>, j, k1) = wxd(i-<code class="constant">1</code>, j, k1) + wbard*sx + wbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi97" target="origFile">wx(i-<code class="constant">1</code>, j, k1) = wx(i-<code class="constant">1</code>, j, k1) + wbar*sx</a>
<a name="nodalgradients_spatial_di99"></a>          <a href="viscousflux_p.html#nodalgradientsi98" target="origFile">wyd(i-<code class="constant">1</code>, j, k1) = wyd(i-<code class="constant">1</code>, j, k1) + wbard*sy + wbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi98" target="origFile">wy(i-<code class="constant">1</code>, j, k1) = wy(i-<code class="constant">1</code>, j, k1) + wbar*sy</a>
<a name="nodalgradients_spatial_di100"></a>          <a href="viscousflux_p.html#nodalgradientsi99" target="origFile">wzd(i-<code class="constant">1</code>, j, k1) = wzd(i-<code class="constant">1</code>, j, k1) + wbard*sz + wbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi99" target="origFile">wz(i-<code class="constant">1</code>, j, k1) = wz(i-<code class="constant">1</code>, j, k1) + wbar*sz</a>
<a name="nodalgradients_spatial_di101"></a>          <a href="viscousflux_p.html#nodalgradientsi100" target="origFile">qxd(i-<code class="constant">1</code>, j, k1) = qxd(i-<code class="constant">1</code>, j, k1) - a2d*sx - a2*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi100" target="origFile">qx(i-<code class="constant">1</code>, j, k1) = qx(i-<code class="constant">1</code>, j, k1) - a2*sx</a>
<a name="nodalgradients_spatial_di102"></a>          <a href="viscousflux_p.html#nodalgradientsi101" target="origFile">qyd(i-<code class="constant">1</code>, j, k1) = qyd(i-<code class="constant">1</code>, j, k1) - a2d*sy - a2*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi101" target="origFile">qy(i-<code class="constant">1</code>, j, k1) = qy(i-<code class="constant">1</code>, j, k1) - a2*sy</a>
          <a href="viscousflux_p.html#nodalgradientsi102" target="origFile">qzd(i-<code class="constant">1</code>, j, k1) = qzd(i-<code class="constant">1</code>, j, k1) - a2d*sz - a2*szd</a>
<a name="nodalgradients_spatial_di103"></a>          <a href="viscousflux_p.html#nodalgradientsi102" target="origFile">qz(i-<code class="constant">1</code>, j, k1) = qz(i-<code class="constant">1</code>, j, k1) - a2*sz</a>
<a name="nodalgradients_spatial_di104"></a>        <a href="viscousflux_p.html#nodalgradientsi90" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#nodalgradientsi103" target="origFile"><code class="keyword">IF</code> (i .LT. ie) <code class="keyword">THEN</code></a>
<a name="nodalgradients_spatial_di105"></a>          <a href="viscousflux_p.html#nodalgradientsi104" target="origFile">uxd(i, j, k1) = uxd(i, j, k1) - ubard*sx - ubar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi104" target="origFile">ux(i, j, k1) = ux(i, j, k1) - ubar*sx</a>
<a name="nodalgradients_spatial_di106"></a>          <a href="viscousflux_p.html#nodalgradientsi105" target="origFile">uyd(i, j, k1) = uyd(i, j, k1) - ubard*sy - ubar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi105" target="origFile">uy(i, j, k1) = uy(i, j, k1) - ubar*sy</a>
<a name="nodalgradients_spatial_di107"></a>          <a href="viscousflux_p.html#nodalgradientsi106" target="origFile">uzd(i, j, k1) = uzd(i, j, k1) - ubard*sz - ubar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi106" target="origFile">uz(i, j, k1) = uz(i, j, k1) - ubar*sz</a>
<a name="nodalgradients_spatial_di108"></a>          <a href="viscousflux_p.html#nodalgradientsi107" target="origFile">vxd(i, j, k1) = vxd(i, j, k1) - vbard*sx - vbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi107" target="origFile">vx(i, j, k1) = vx(i, j, k1) - vbar*sx</a>
<a name="nodalgradients_spatial_di109"></a>          <a href="viscousflux_p.html#nodalgradientsi108" target="origFile">vyd(i, j, k1) = vyd(i, j, k1) - vbard*sy - vbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi108" target="origFile">vy(i, j, k1) = vy(i, j, k1) - vbar*sy</a>
<a name="nodalgradients_spatial_di110"></a>          <a href="viscousflux_p.html#nodalgradientsi109" target="origFile">vzd(i, j, k1) = vzd(i, j, k1) - vbard*sz - vbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi109" target="origFile">vz(i, j, k1) = vz(i, j, k1) - vbar*sz</a>
<a name="nodalgradients_spatial_di111"></a>          <a href="viscousflux_p.html#nodalgradientsi110" target="origFile">wxd(i, j, k1) = wxd(i, j, k1) - wbard*sx - wbar*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi110" target="origFile">wx(i, j, k1) = wx(i, j, k1) - wbar*sx</a>
<a name="nodalgradients_spatial_di112"></a>          <a href="viscousflux_p.html#nodalgradientsi111" target="origFile">wyd(i, j, k1) = wyd(i, j, k1) - wbard*sy - wbar*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi111" target="origFile">wy(i, j, k1) = wy(i, j, k1) - wbar*sy</a>
<a name="nodalgradients_spatial_di113"></a>          <a href="viscousflux_p.html#nodalgradientsi112" target="origFile">wzd(i, j, k1) = wzd(i, j, k1) - wbard*sz - wbar*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi112" target="origFile">wz(i, j, k1) = wz(i, j, k1) - wbar*sz</a>
<a name="nodalgradients_spatial_di114"></a>          <a href="viscousflux_p.html#nodalgradientsi113" target="origFile">qxd(i, j, k1) = qxd(i, j, k1) + a2d*sx + a2*sxd</a>
          <a href="viscousflux_p.html#nodalgradientsi113" target="origFile">qx(i, j, k1) = qx(i, j, k1) + a2*sx</a>
<a name="nodalgradients_spatial_di115"></a>          <a href="viscousflux_p.html#nodalgradientsi114" target="origFile">qyd(i, j, k1) = qyd(i, j, k1) + a2d*sy + a2*syd</a>
          <a href="viscousflux_p.html#nodalgradientsi114" target="origFile">qy(i, j, k1) = qy(i, j, k1) + a2*sy</a>
          <a href="viscousflux_p.html#nodalgradientsi115" target="origFile">qzd(i, j, k1) = qzd(i, j, k1) + a2d*sz + a2*szd</a>
          <a href="viscousflux_p.html#nodalgradientsi115" target="origFile">qz(i, j, k1) = qz(i, j, k1) + a2*sz</a>
        <a href="viscousflux_p.html#nodalgradientsi103" target="origFile"><code class="keyword">END IF</code></a>
<a name="nodalgradients_spatial_di116"></a>      <a href="viscousflux_p.html#nodalgradientsi82" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#nodalgradientsi81" target="origFile"><code class="keyword">END DO</code></a>
<a name="nodalgradients_spatial_di117"></a><a href="viscousflux_p.html#nodalgradientsi116" target="origFile"><code class="comment">! Divide by 8 times the volume to obtain the correct gradients.</code></a>
<a name="nodalgradients_spatial_di118"></a>    <a href="viscousflux_p.html#nodalgradientsi116" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux_p.html#nodalgradientsi117" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#nodalgradientsi118" target="origFile"><code class="comment">! Compute the inverse of 8 times the volume for this node.</code></a>
        <a href="viscousflux_p.html#nodalgradientsi118" target="origFile">oneovervd = -(one*(vold(i, j, k)+vold(i, j, k+<code class="constant">1</code>)+vold(i+<code class="constant">1</code>, j, k)<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi118" target="origFile"><code class="label">&          </code>+vold(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+vold(i, j+<code class="constant">1</code>, k)+vold(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+vold(i+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi118" target="origFile"><code class="label">&          </code>, j+<code class="constant">1</code>, k)+vold(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>))/(vol(i, j, k)+vol(i, j, k+<code class="constant">1</code>)+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi118" target="origFile"><code class="label">&          </code>vol(i+<code class="constant">1</code>, j, k)+vol(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+vol(i, j+<code class="constant">1</code>, k)+vol(i, j+<code class="constant">1</code>, k+<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi118" target="origFile"><code class="label">&          </code>)+vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k)+vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>))**<code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradientsi118" target="origFile">oneoverv = one/(vol(i, j, k)+vol(i, j, k+<code class="constant">1</code>)+vol(i+<code class="constant">1</code>, j, k)+vol(i<code class="label">&</code></a>
<a name="nodalgradients_spatial_di119"></a><a href="viscousflux_p.html#nodalgradientsi118" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+vol(i, j+<code class="constant">1</code>, k)+vol(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k)+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradientsi118" target="origFile"><code class="label">&          </code>vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>))</a>
<a href="viscousflux_p.html#nodalgradientsi119" target="origFile"><code class="comment">! Compute the correct velocity gradients and "unit" heat</code></a>
<a href="viscousflux_p.html#nodalgradientsi119" target="origFile"><code class="comment">! fluxes. The velocity gradients are stored in ux, etc.</code></a>
<a name="nodalgradients_spatial_di120"></a>        <a href="viscousflux_p.html#nodalgradientsi119" target="origFile">uxd(i, j, k1) = uxd(i, j, k1)*oneoverv + ux(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi119" target="origFile">ux(i, j, k1) = ux(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di121"></a>        <a href="viscousflux_p.html#nodalgradientsi120" target="origFile">uyd(i, j, k1) = uyd(i, j, k1)*oneoverv + uy(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi120" target="origFile">uy(i, j, k1) = uy(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di122"></a>        <a href="viscousflux_p.html#nodalgradientsi121" target="origFile">uzd(i, j, k1) = uzd(i, j, k1)*oneoverv + uz(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi121" target="origFile">uz(i, j, k1) = uz(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di123"></a>        <a href="viscousflux_p.html#nodalgradientsi122" target="origFile">vxd(i, j, k1) = vxd(i, j, k1)*oneoverv + vx(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi122" target="origFile">vx(i, j, k1) = vx(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di124"></a>        <a href="viscousflux_p.html#nodalgradientsi123" target="origFile">vyd(i, j, k1) = vyd(i, j, k1)*oneoverv + vy(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi123" target="origFile">vy(i, j, k1) = vy(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di125"></a>        <a href="viscousflux_p.html#nodalgradientsi124" target="origFile">vzd(i, j, k1) = vzd(i, j, k1)*oneoverv + vz(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi124" target="origFile">vz(i, j, k1) = vz(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di126"></a>        <a href="viscousflux_p.html#nodalgradientsi125" target="origFile">wxd(i, j, k1) = wxd(i, j, k1)*oneoverv + wx(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi125" target="origFile">wx(i, j, k1) = wx(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di127"></a>        <a href="viscousflux_p.html#nodalgradientsi126" target="origFile">wyd(i, j, k1) = wyd(i, j, k1)*oneoverv + wy(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi126" target="origFile">wy(i, j, k1) = wy(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di128"></a>        <a href="viscousflux_p.html#nodalgradientsi127" target="origFile">wzd(i, j, k1) = wzd(i, j, k1)*oneoverv + wz(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi127" target="origFile">wz(i, j, k1) = wz(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di129"></a>        <a href="viscousflux_p.html#nodalgradientsi128" target="origFile">qxd(i, j, k1) = qxd(i, j, k1)*oneoverv + qx(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi128" target="origFile">qx(i, j, k1) = qx(i, j, k1)*oneoverv</a>
<a name="nodalgradients_spatial_di130"></a>        <a href="viscousflux_p.html#nodalgradientsi129" target="origFile">qyd(i, j, k1) = qyd(i, j, k1)*oneoverv + qy(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi129" target="origFile">qy(i, j, k1) = qy(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradientsi130" target="origFile">qzd(i, j, k1) = qzd(i, j, k1)*oneoverv + qz(i, j, k1)*oneovervd</a>
        <a href="viscousflux_p.html#nodalgradientsi130" target="origFile">qz(i, j, k1) = qz(i, j, k1)*oneoverv</a>
      <a href="viscousflux_p.html#nodalgradientsi117" target="origFile"><code class="keyword">END DO</code></a>
<a name="nodalgradients"></a>    <a href="viscousflux_p.html#nodalgradientsi116" target="origFile"><code class="keyword">END DO</code></a>
  <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">NODALGRADIENTS_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">NODALGRADIENTS</code>(<code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="vardecl">uz</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code>, <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code>, <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&    </code><code class="vardecl">qz</code>)</a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!        Subroutine arguments</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&    </code><code class="vardecl">uz</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code>, <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code>, <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="vardecl">qz</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!        Local variables.</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">oneoverv</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code>, <code class="vardecl">a2</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">sx</code>, <code class="vardecl">sx1</code>, <code class="vardecl">sy</code>, <code class="vardecl">sy1</code>, <code class="vardecl">sz</code>, <code class="vardecl">sz1</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!        * Begin execution                                              *</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! First part. Contribution in the k-direction. As the viscous</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! fluxes are computed per k-plane, the values of the surface</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! integrals in gauss's theorem are only scattered to one node.</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Consequently this part is an initialization as well.</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Loop over the j and i direction.</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Store 8 times the average normal for the contribution from</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! the k-layer of cells. The factor 8 drops out later when</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! dividing by the volume.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sx1 = sk(i, j, k, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sy1 = sk(i, j, k, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sz1 = sk(i, j, k, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sx = sx1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sy = sy1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sz = sz1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">ubar = fourth*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivx)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivx))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vbar = fourth*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivy)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivy))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wbar = fourth*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivz)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivz))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">a2 = fourth*(p(i, j, k)+p(i+<code class="constant">1</code>, j, k)+p(i, j+<code class="constant">1</code>, k)+p(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k)<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>)</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Set the velocity and speed of sound square gradients.</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! The minus sign is there, because these normals are inward</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! pointing for the nodal k-layer. The exception is a2,</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! because the gradient of -a2 is stored, as this is needed</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! in the heat fluxes.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">ux(i, j, k1) = -(ubar*sx)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">uy(i, j, k1) = -(ubar*sy)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">uz(i, j, k1) = -(ubar*sz)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vx(i, j, k1) = -(vbar*sx)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vy(i, j, k1) = -(vbar*sy)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vz(i, j, k1) = -(vbar*sz)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wx(i, j, k1) = -(wbar*sx)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wy(i, j, k1) = -(wbar*sy)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wz(i, j, k1) = -(wbar*sz)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qx(i, j, k1) = a2*sx</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qy(i, j, k1) = a2*sy</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qz(i, j, k1) = a2*sz</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Store 8 times the average normal for the contribution from</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! the k+1 layer of cells. The factor 8 drops out later when</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! dividing by the volume.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sx = sx1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sy = sy1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sz = sz1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">ubar = fourth*(w(i, j, k+<code class="constant">1</code>, ivx)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, ivx)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vbar = fourth*(w(i, j, k+<code class="constant">1</code>, ivy)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, ivy)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wbar = fourth*(w(i, j, k+<code class="constant">1</code>, ivz)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, ivz)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">a2 = fourth*(p(i, j, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+p(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, k+<code class="constant">1</code>))</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Update the velocity and (minus) the speed of sound</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! gradients. As the normals are now outward pointing for</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! the nodes in the k-layer, there is a plus sign for the</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! velocity gradients and a minus sign for minus the speed</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! of sound squared.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">ux(i, j, k1) = ux(i, j, k1) + ubar*sx</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">uy(i, j, k1) = uy(i, j, k1) + ubar*sy</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">uz(i, j, k1) = uz(i, j, k1) + ubar*sz</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vx(i, j, k1) = vx(i, j, k1) + vbar*sx</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vy(i, j, k1) = vy(i, j, k1) + vbar*sy</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vz(i, j, k1) = vz(i, j, k1) + vbar*sz</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wx(i, j, k1) = wx(i, j, k1) + wbar*sx</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wy(i, j, k1) = wy(i, j, k1) + wbar*sy</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wz(i, j, k1) = wz(i, j, k1) + wbar*sz</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qx(i, j, k1) = qx(i, j, k1) - a2*sx</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qy(i, j, k1) = qy(i, j, k1) - a2*sy</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qz(i, j, k1) = qz(i, j, k1) - a2*sz</a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Second part. Contribution in the j-direction.</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! The contribution is scattered to both the left and right node</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! in j-direction.</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute 8 times the average normal for this part of</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! the control volume. The factor 8 is taken care of later</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! on when the division by the volume takes place.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sx = sj(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + sj(i, j, k, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sy = sj(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + sj(i, j, k, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sz = sj(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + sj(i, j, k, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">ubar = fourth*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivx)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vbar = fourth*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivy)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wbar = fourth*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivz)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">a2 = fourth*(p(i, j, k)+p(i+<code class="constant">1</code>, j, k)+p(i, j, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>)</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Add the contributions to the surface integral to the node</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! j-1 and substract it from the node j. For the heat flux it</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! is reversed, because the negative of the gradient of the</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! speed of sound must be computed.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">IF</code> (j .GT. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">ux(i, j-<code class="constant">1</code>, k1) = ux(i, j-<code class="constant">1</code>, k1) + ubar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uy(i, j-<code class="constant">1</code>, k1) = uy(i, j-<code class="constant">1</code>, k1) + ubar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uz(i, j-<code class="constant">1</code>, k1) = uz(i, j-<code class="constant">1</code>, k1) + ubar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vx(i, j-<code class="constant">1</code>, k1) = vx(i, j-<code class="constant">1</code>, k1) + vbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vy(i, j-<code class="constant">1</code>, k1) = vy(i, j-<code class="constant">1</code>, k1) + vbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vz(i, j-<code class="constant">1</code>, k1) = vz(i, j-<code class="constant">1</code>, k1) + vbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wx(i, j-<code class="constant">1</code>, k1) = wx(i, j-<code class="constant">1</code>, k1) + wbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wy(i, j-<code class="constant">1</code>, k1) = wy(i, j-<code class="constant">1</code>, k1) + wbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wz(i, j-<code class="constant">1</code>, k1) = wz(i, j-<code class="constant">1</code>, k1) + wbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qx(i, j-<code class="constant">1</code>, k1) = qx(i, j-<code class="constant">1</code>, k1) - a2*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qy(i, j-<code class="constant">1</code>, k1) = qy(i, j-<code class="constant">1</code>, k1) - a2*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qz(i, j-<code class="constant">1</code>, k1) = qz(i, j-<code class="constant">1</code>, k1) - a2*sz</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">IF</code> (j .LT. je) <code class="keyword">THEN</code></a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">ux(i, j, k1) = ux(i, j, k1) - ubar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uy(i, j, k1) = uy(i, j, k1) - ubar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uz(i, j, k1) = uz(i, j, k1) - ubar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vx(i, j, k1) = vx(i, j, k1) - vbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vy(i, j, k1) = vy(i, j, k1) - vbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vz(i, j, k1) = vz(i, j, k1) - vbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wx(i, j, k1) = wx(i, j, k1) - wbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wy(i, j, k1) = wy(i, j, k1) - wbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wz(i, j, k1) = wz(i, j, k1) - wbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qx(i, j, k1) = qx(i, j, k1) + a2*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qy(i, j, k1) = qy(i, j, k1) + a2*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qz(i, j, k1) = qz(i, j, k1) + a2*sz</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END IF</code></a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Third part. Contribution in the i-direction.</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! The contribution is scattered to both the left and right node</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! in i-direction.</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute 8 times the average normal for this part of</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! the control volume. The factor 8 is taken care of later</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! on when the division by the volume takes place.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sx = si(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>) <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + si(i, j, k, <code class="constant">1</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sy = si(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>) <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + si(i, j, k, <code class="constant">2</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">sz = si(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>) <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + si(i, j, k, <code class="constant">3</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">ubar = fourth*(w(i, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, ivx)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivx)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vbar = fourth*(w(i, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, ivy)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivy)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wbar = fourth*(w(i, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, ivz)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>ivz)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">a2 = fourth*(p(i, j, k)+p(i, j+<code class="constant">1</code>, k)+p(i, j, k+<code class="constant">1</code>)+p(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>)</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Add the contributions to the surface integral to the node</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! j-1 and substract it from the node j. For the heat flux it</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! is reversed, because the negative of the gradient of the</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! speed of sound must be computed.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">IF</code> (i .GT. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">ux(i-<code class="constant">1</code>, j, k1) = ux(i-<code class="constant">1</code>, j, k1) + ubar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uy(i-<code class="constant">1</code>, j, k1) = uy(i-<code class="constant">1</code>, j, k1) + ubar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uz(i-<code class="constant">1</code>, j, k1) = uz(i-<code class="constant">1</code>, j, k1) + ubar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vx(i-<code class="constant">1</code>, j, k1) = vx(i-<code class="constant">1</code>, j, k1) + vbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vy(i-<code class="constant">1</code>, j, k1) = vy(i-<code class="constant">1</code>, j, k1) + vbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vz(i-<code class="constant">1</code>, j, k1) = vz(i-<code class="constant">1</code>, j, k1) + vbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wx(i-<code class="constant">1</code>, j, k1) = wx(i-<code class="constant">1</code>, j, k1) + wbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wy(i-<code class="constant">1</code>, j, k1) = wy(i-<code class="constant">1</code>, j, k1) + wbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wz(i-<code class="constant">1</code>, j, k1) = wz(i-<code class="constant">1</code>, j, k1) + wbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qx(i-<code class="constant">1</code>, j, k1) = qx(i-<code class="constant">1</code>, j, k1) - a2*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qy(i-<code class="constant">1</code>, j, k1) = qy(i-<code class="constant">1</code>, j, k1) - a2*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qz(i-<code class="constant">1</code>, j, k1) = qz(i-<code class="constant">1</code>, j, k1) - a2*sz</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">IF</code> (i .LT. ie) <code class="keyword">THEN</code></a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">ux(i, j, k1) = ux(i, j, k1) - ubar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uy(i, j, k1) = uy(i, j, k1) - ubar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">uz(i, j, k1) = uz(i, j, k1) - ubar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vx(i, j, k1) = vx(i, j, k1) - vbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vy(i, j, k1) = vy(i, j, k1) - vbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">vz(i, j, k1) = vz(i, j, k1) - vbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wx(i, j, k1) = wx(i, j, k1) - wbar*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wy(i, j, k1) = wy(i, j, k1) - wbar*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">wz(i, j, k1) = wz(i, j, k1) - wbar*sz</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qx(i, j, k1) = qx(i, j, k1) + a2*sx</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qy(i, j, k1) = qy(i, j, k1) + a2*sy</a>
          <a href="viscousflux_p.html#nodalgradients" target="origFile">qz(i, j, k1) = qz(i, j, k1) + a2*sz</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END IF</code></a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Divide by 8 times the volume to obtain the correct gradients.</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute the inverse of 8 times the volume for this node.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">oneoverv = one/(vol(i, j, k)+vol(i, j, k+<code class="constant">1</code>)+vol(i+<code class="constant">1</code>, j, k)+vol(i<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+vol(i, j+<code class="constant">1</code>, k)+vol(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k)+<code class="label">&</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="label">&          </code>vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>))</a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! Compute the correct velocity gradients and "unit" heat</code></a>
<a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="comment">! fluxes. The velocity gradients are stored in ux, etc.</code></a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">ux(i, j, k1) = ux(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">uy(i, j, k1) = uy(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">uz(i, j, k1) = uz(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vx(i, j, k1) = vx(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vy(i, j, k1) = vy(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">vz(i, j, k1) = vz(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wx(i, j, k1) = wx(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wy(i, j, k1) = wy(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">wz(i, j, k1) = wz(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qx(i, j, k1) = qx(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qy(i, j, k1) = qy(i, j, k1)*oneoverv</a>
        <a href="viscousflux_p.html#nodalgradients" target="origFile">qz(i, j, k1) = qz(i, j, k1)*oneoverv</a>
      <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END DO</code></a>
  <a href="viscousflux_p.html#nodalgradients" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">NODALGRADIENTS</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">VISCOUSFLUX_SPATIAL_D</code></a>
</pre>
</body>
