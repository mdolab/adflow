<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="xhalo_block_cd"></a><a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * File:          xhalo.f90                                       *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * Author:        Edwin van der Weide,C.A.(Sandy) Mader            *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * Starting date: 02-23-2003                                      *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * Last modified: 08-12-2009                                      *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">XHALO_BLOCK_CD</code>(<code class="vardecl">level</code>)</a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">BCTYPES_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">COMMUNICATION_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      else if (BCType(mm) == EulerWall .or. BCType(nn) == FarField) then</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         ! Do a generic extrapolation</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         select case (BCFaceID(mm))</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (iMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(0,:,:,:); x1 => x(1,:,:,:); x2 => x(2,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (iMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(ie,:,:,:); x1 => x(il,:,:,:); x2 => x(nx,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (jMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,0,:,:); x1 => x(:,1,:,:); x2 => x(:,2,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (jMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,je,:,:); x1 => x(:,jl,:,:); x2 => x(:,ny,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (kMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,:,0,:); x1 => x(:,:,1,:); x2 => x(:,:,2,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         case (kMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0 => x(:,:,ke,:); x1 => x(:,:,kl,:); x2 => x(:,:,nz,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end select</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(iBeg == 1)     iBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(iEnd == iiMax) iEnd = iiMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(jBeg == 1)     jBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         if(jEnd == jjMax) jEnd = jjMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         do j=jBeg,jEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            do i=iBeg,iEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               x0(i+1,j+1,1) = two*x1(i+1,j+1,1) - x2(i+1,j+1,1)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               x0(i+1,j+1,2) = two*x1(i+1,j+1,2) - x2(i+1,j+1,2)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               x0(i+1,j+1,3) = two*x1(i+1,j+1,3) - x2(i+1,j+1,3)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   do l=1,3</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      do k=0,ke</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         do j=0,je</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            do i=0,ie</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               if (x_peturb(i,j,k,l)) then</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!                  x(i,j,k,l) = x_temp(i,j,k,l)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!               end if</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!  loop1to1: do mm=1,n1to1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      select case (BCFaceID(mm))</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (iMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(0,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(0,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (iMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = jnBeg(mm); iEnd = jnEnd(mm); iiMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(ie,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(ie,:,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (jMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,0,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,0,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (jMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = knBeg(mm); jEnd = knEnd(mm); jjMax = kl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,je,:,:);</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,je,:,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (kMin)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,:,0,:);</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,:,0,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      case (kMax)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         iBeg = inBeg(mm); iEnd = inEnd(mm); iiMax = il</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         jBeg = jnBeg(mm); jEnd = jnEnd(mm); jjMax = jl</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x0 => x(:,:,ke,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         x1 => x_temp(:,:,ke,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      end select</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! Basically we want to copy the RIGHT X back into X. This is</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! basically the same as the exchange coordinates execpt we</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! already had the right halos on input</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(iBeg == 1)     iBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(iEnd == iiMax) iEnd = iiMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(jBeg == 1)     jBeg = 0</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      if(jEnd == jjMax) jEnd = jjMax + 1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! Loop over the nodes of the subface and set the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ! corresponding halo coordinates.</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      print *,ibeg,iend,jbeg,jend</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      do j=jBeg,jEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         do i=iBeg,iEnd</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!            x0(i+1,j+1,:) = x1(i+1,j+1,:)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!         end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      end do</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!   end do loop1to1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!,x_peturb)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * xhalo determines the coordinates of the nodal halo's.          *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * First it sets all halo coordinates by simple extrapolation,    *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * then the symmetry planes are treated (also the unit normal of  *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * symmetry planes are determined) and finally an exchange is     *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * made for the internal halo's.                                  *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      Subroutine arguments.</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">level</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      Local variables.</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">nn</code>, <code class="vardecl">mm</code>, <code class="vardecl">sps</code>, <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">ii</code>, <code class="vardecl">jj</code>, <code class="vardecl">l</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">ibeg</code>, <code class="vardecl">iend</code>, <code class="vardecl">jbeg</code>, <code class="vardecl">jend</code>, <code class="vardecl">iimax</code>, <code class="vardecl">jjmax</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!integer(kind=intType) :: iBeg2, iEnd2, jBeg2, jEnd2</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>:, :, :<code class="typename">)</code>, <code class="typename">POINTER </code>:: <code class="vardecl">x0</code>, <code class="vardecl">x1</code>, <code class="vardecl">x2</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">length</code>, <code class="vardecl">dot</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">imininternal</code>, <code class="vardecl">jmininternal</code>, <code class="vardecl">kmininternal</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">imaxinternal</code>, <code class="vardecl">jmaxinternal</code>, <code class="vardecl">kmaxinternal</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code><code class="constant">3</code><code class="typename">) </code>:: <code class="vardecl">v1</code>, <code class="vardecl">v2</code>, <code class="vardecl">norm</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!real(kind=realType) :: x_temp(0:ie,0:je,0:ke,3)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!logical :: x_peturb(0:ie,0:je,0:ke,3)</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          * Extrapolation of the coordinates. First extrapolation in   *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          * i-direction, without halo's, followed by extrapolation in  *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          * j-direction, with i-halo's and finally extrapolation in    *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          * k-direction, with both i- and j-halo's. In this way also   *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          * the indirect halo's get a value, albeit a bit arbitrary.   *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Make a copy of X</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!x_temp = x</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">imininternal = <code class="constant">.false.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">jmininternal = <code class="constant">.false.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">kmininternal = <code class="constant">.false.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">imaxinternal = <code class="constant">.false.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">jmaxinternal = <code class="constant">.false.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile">kmaxinternal = <code class="constant">.false.</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!Bocos</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="label">loopsubface:</code><code class="keyword">DO </code>mm=<code class="constant">1</code>,nsubface</a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (bctype(mm) .EQ. b2bmatch) <code class="keyword">THEN</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(mm)) </a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">imininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(imax) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">imaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jmininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jmaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">kmininternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">kmaxinternal = <code class="constant">.true.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END SELECT</code></a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO </code><code class="label">loopsubface</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Extrapolation in i-direction.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kl</a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (.NOT.imininternal) <code class="keyword">THEN</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(<code class="constant">0</code>, j, k, <code class="constant">1</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">1</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(<code class="constant">0</code>, j, k, <code class="constant">2</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">2</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(<code class="constant">0</code>, j, k, <code class="constant">3</code>) = two*x(<code class="constant">1</code>, j, k, <code class="constant">3</code>) - x(<code class="constant">2</code>, j, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (.NOT.imaxinternal) <code class="keyword">THEN</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(ie, j, k, <code class="constant">1</code>) = two*x(il, j, k, <code class="constant">1</code>) - x(nx, j, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(ie, j, k, <code class="constant">2</code>) = two*x(il, j, k, <code class="constant">2</code>) - x(nx, j, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(ie, j, k, <code class="constant">3</code>) = two*x(il, j, k, <code class="constant">3</code>) - x(nx, j, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Extrapolation in j-direction.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,kl</a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ie</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (.NOT.jmininternal) <code class="keyword">THEN</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, <code class="constant">0</code>, k, <code class="constant">1</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">1</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, <code class="constant">0</code>, k, <code class="constant">2</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">2</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, <code class="constant">0</code>, k, <code class="constant">3</code>) = two*x(i, <code class="constant">1</code>, k, <code class="constant">3</code>) - x(i, <code class="constant">2</code>, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (.NOT.jmaxinternal) <code class="keyword">THEN</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, je, k, <code class="constant">1</code>) = two*x(i, jl, k, <code class="constant">1</code>) - x(i, ny, k, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, je, k, <code class="constant">2</code>) = two*x(i, jl, k, <code class="constant">2</code>) - x(i, ny, k, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, je, k, <code class="constant">3</code>) = two*x(i, jl, k, <code class="constant">3</code>) - x(i, ny, k, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Extrapolation in k-direction.</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>j=<code class="constant">0</code>,je</a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>i=<code class="constant">0</code>,ie</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (.NOT.kmininternal) <code class="keyword">THEN</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, j, <code class="constant">0</code>, <code class="constant">1</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, j, <code class="constant">0</code>, <code class="constant">2</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, j, <code class="constant">0</code>, <code class="constant">3</code>) = two*x(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - x(i, j, <code class="constant">2</code>, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (.NOT.kmaxinternal) <code class="keyword">THEN</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, j, ke, <code class="constant">1</code>) = two*x(i, j, kl, <code class="constant">1</code>) - x(i, j, nz, <code class="constant">1</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, j, ke, <code class="constant">2</code>) = two*x(i, j, kl, <code class="constant">2</code>) - x(i, j, nz, <code class="constant">2</code>)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x(i, j, ke, <code class="constant">3</code>) = two*x(i, j, kl, <code class="constant">3</code>) - x(i, j, nz, <code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          * Mirror the halo coordinates adjacent to the symmetry       *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          * planes                                                     *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          *                                                            *</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!          **************************************************************</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">!</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Loop over boundary subfaces.</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="label">loopbocos:</code><code class="keyword">DO </code>mm=<code class="constant">1</code>,nbocos</a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! The actual correction of the coordinates only takes</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! place for symmetry planes.</code></a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (bctype(mm) .EQ. symm) <code class="keyword">THEN</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Set some variables, depending on the block face on</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! which the subface is located.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">SELECT CASE </code> (bcfaceid(mm)) </a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(imin) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">ibeg = jnbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iend = jnend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iimax = jl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0 => x(<code class="constant">0</code>, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x1 => x(<code class="constant">1</code>, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x2 => x(<code class="constant">2</code>, :, :, :)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(imax) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">ibeg = jnbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iend = jnend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iimax = jl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0 => x(ie, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x1 => x(il, :, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x2 => x(nx, :, :, :)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(jmin) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">ibeg = inbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iend = inend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iimax = il</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0 => x(:, <code class="constant">0</code>, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x1 => x(:, <code class="constant">1</code>, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x2 => x(:, <code class="constant">2</code>, :, :)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(jmax) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">ibeg = inbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iend = inend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iimax = il</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jbeg = knbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jend = knend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jjmax = kl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0 => x(:, je, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x1 => x(:, jl, :, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x2 => x(:, ny, :, :)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(kmin) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">ibeg = inbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iend = inend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iimax = il</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jbeg = jnbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jend = jnend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jjmax = jl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0 => x(:, :, <code class="constant">0</code>, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x1 => x(:, :, <code class="constant">1</code>, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x2 => x(:, :, <code class="constant">2</code>, :)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">CASE </code>(kmax) </a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">ibeg = inbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iend = inend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">iimax = il</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jbeg = jnbeg(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jend = jnend(mm)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">jjmax = jl</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0 => x(:, :, ke, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x1 => x(:, :, kl, :)</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">x2 => x(:, :, nz, :)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END SELECT</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Determine the vector from the lower left corner to</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! the upper right corner. Due to the usage of pointers</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! an offset of +1 must be used, because the original</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! array x start at 0.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">v1(<code class="constant">1</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">v1(<code class="constant">2</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">v1(<code class="constant">3</code>) = x1(iimax+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! And the vector from the upper left corner to the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! lower right corner.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">v2(<code class="constant">1</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">1</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">1</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">v2(<code class="constant">2</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">2</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">2</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">v2(<code class="constant">3</code>) = x1(iimax+<code class="constant">1</code>, <code class="constant">1</code>+<code class="constant">1</code>, <code class="constant">3</code>) - x1(<code class="constant">1</code>+<code class="constant">1</code>, jjmax+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Determine the normal of the face by taking the cross</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! product of v1 and v2 and add it to norm.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">norm(<code class="constant">1</code>) = v1(<code class="constant">2</code>)*v2(<code class="constant">3</code>) - v1(<code class="constant">3</code>)*v2(<code class="constant">2</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">norm(<code class="constant">2</code>) = v1(<code class="constant">3</code>)*v2(<code class="constant">1</code>) - v1(<code class="constant">1</code>)*v2(<code class="constant">3</code>)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">norm(<code class="constant">3</code>) = v1(<code class="constant">1</code>)*v2(<code class="constant">2</code>) - v1(<code class="constant">2</code>)*v2(<code class="constant">1</code>)</a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Compute the length of the normal and test if this is</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! larger than eps. If this is the case this means that</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! it is a nonsingular subface and the coordinates are</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! corrected.</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">arg1 = norm(<code class="constant">1</code>)**<code class="constant">2 </code>+ norm(<code class="constant">2</code>)**<code class="constant">2 </code>+ norm(<code class="constant">3</code>)**<code class="constant">2</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile">length = <code class="funcname">SQRT</code>(arg1)</a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (length .GT. eps) <code class="keyword">THEN</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Compute the unit normal of the subface.</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">norm(<code class="constant">1</code>) = norm(<code class="constant">1</code>)/length</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">norm(<code class="constant">2</code>) = norm(<code class="constant">2</code>)/length</a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile">norm(<code class="constant">3</code>) = norm(<code class="constant">3</code>)/length</a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Add an overlap to the symmetry subface if the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! boundaries coincide with the block boundaries.</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! This way the indirect halo's are treated properly.</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (ibeg .EQ. <code class="constant">1</code>) ibeg = <code class="constant">0</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (iend .EQ. iimax) iend = iimax + <code class="constant">1</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (jbeg .EQ. <code class="constant">1</code>) jbeg = <code class="constant">0</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">IF</code> (jend .EQ. jjmax) jend = jjmax + <code class="constant">1</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Loop over the nodes of the subface and set the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! corresponding halo coordinates.</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>j=jbeg,jend</a>
          <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">DO </code>i=ibeg,iend</a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Determine the vector from the internal node to the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! node on the face. Again an offset of +1 must be</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! used, due to the usage of pointers.</code></a>
            <a href="xhalo_block_p.html#xhalo_block" target="origFile">v1(<code class="constant">1</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>)</a>
            <a href="xhalo_block_p.html#xhalo_block" target="origFile">v1(<code class="constant">2</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>)</a>
            <a href="xhalo_block_p.html#xhalo_block" target="origFile">v1(<code class="constant">3</code>) = x1(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) - x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! Determine two times the normal component of this</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! vector; this vector must be added to the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! coordinates of the internal node to obtain the</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="comment">! halo coordinates. Again the offset of +1.</code></a>
            <a href="xhalo_block_p.html#xhalo_block" target="origFile">dot = two*(v1(<code class="constant">1</code>)*norm(<code class="constant">1</code>)+v1(<code class="constant">2</code>)*norm(<code class="constant">2</code>)+v1(<code class="constant">3</code>)*norm(<code class="constant">3</code>))</a>
            <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">1</code>) + dot*norm(<code class="constant">1</code>)</a>
            <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">2</code>) + dot*norm(<code class="constant">2</code>)</a>
            <a href="xhalo_block_p.html#xhalo_block" target="origFile">x0(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) = x2(i+<code class="constant">1</code>, j+<code class="constant">1</code>, <code class="constant">3</code>) + dot*norm(<code class="constant">3</code>)</a>
          <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
        <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO</code></a>
      <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
    <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END IF</code></a>
  <a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END DO </code><code class="label">loopbocos</code></a>
<a href="xhalo_block_p.html#xhalo_block" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">XHALO_BLOCK_CD</code></a>
</pre>
</body>
