<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="viscousflux_cd"></a><a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * File:          viscousFlux.f90                                 *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * Author:        Edwin van der Weide                             *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * Starting date: 03-21-2003                                      *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * Last modified: 04-18-2005                                      *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">SUBROUTINE </code><code class="funcname">VISCOUSFLUX_CD</code>()</a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">ITERATION_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE_SPATIAL_D</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * viscousFlux computes the viscous fluxes using a central        *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * difference scheme for a block.                                 *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * It is assumed that the pointers in block pointer already point *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * to the correct block.                                          *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      Local parameter.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">twothird</code>=<code class="vardecl">two</code>*<code class="vardecl">third</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      Local variables.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">nn</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="vardecl">kk</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rfilv</code>, <code class="vardecl">por</code>, <code class="vardecl">mul</code>, <code class="vardecl">mue</code>, <code class="vardecl">mut</code>, <code class="vardecl">heatcoef</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">gm1</code>, <code class="vardecl">factlamheat</code>, <code class="vardecl">factturbheat</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">u_x</code>, <code class="vardecl">u_y</code>, <code class="vardecl">u_z</code>, <code class="vardecl">v_x</code>, <code class="vardecl">v_y</code>, <code class="vardecl">v_z</code>, <code class="vardecl">w_x</code>, <code class="vardecl">w_y</code>, <code class="vardecl">w_z</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">q_x</code>, <code class="vardecl">q_y</code>, <code class="vardecl">q_z</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">corr</code>, <code class="vardecl">ssx</code>, <code class="vardecl">ssy</code>, <code class="vardecl">ssz</code>, <code class="vardecl">ss</code>, <code class="vardecl">fracdiv</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxx</code>, <code class="vardecl">tauyy</code>, <code class="vardecl">tauzz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxy</code>, <code class="vardecl">tauxz</code>, <code class="vardecl">tauyz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmx</code>, <code class="vardecl">fmy</code>, <code class="vardecl">fmz</code>, <code class="vardecl">frhoe</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="vardecl">uz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="vardecl">qz</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">correctfork</code>, <code class="vardecl">storewalltensor</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! </code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">INTEGER </code>:: <code class="vardecl">unitvf</code>=<code class="constant">1011</code>, <code class="vardecl">ierror</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">result1</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a name="p18"></a>  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">OPEN</code>(<code class="keyword">unit</code>=unitvf, <code class="keyword">file</code>=<code class="string">'verifyvf.out'</code>, <code class="keyword">status</code>=<code class="string">'replace'</code>, <code class="keyword">action</code>=<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">& </code><code class="string">'write'</code>, <code class="keyword">iostat</code>=ierror) </a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (ierror .NE. <code class="constant">0</code>) </a><a href="msg.html#p18" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">CALL </code><code class="funcname">TERMINATE_CD</code>(<code class="string">'verifyvf'</code>, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&                                 </code><code class="string">'Something wrong when '</code>, <code class="string">'calling open'</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&                                </code>)</a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">PRINT*</code>, <code class="string">'ierror:'</code>, ierror</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Set rFilv to rFil to indicate that this is the viscous part.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! If rFilv == 0 the viscous residuals need not to be computed</code></a>
<a name="p19"></a><a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! and a return can be made.</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile">rfilv = rfil</a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (</a><a href="msg.html#p19" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="viscousflux_p.html#viscousflux" target="origFile">rfilv .EQ. zero) <code class="keyword">THEN</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">RETURN</code></a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">ELSE</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Determine whether or not the pressure must be corrected</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! for the presence of the turbulent kinetic energy.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (kpresent) <code class="keyword">THEN</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (currentlevel .LE. groundlevel .OR. turbcoupled) <code class="keyword">THEN</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">correctfork = <code class="constant">.true.</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">ELSE</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">correctfork = <code class="constant">.false.</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">ELSE</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile">correctfork = <code class="constant">.false.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Determine whether or not the wall stress tensor and wall heat</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! flux must be stored for viscous walls.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile">storewalltensor = <code class="constant">.false.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (wallfunctions) <code class="keyword">THEN</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile">storewalltensor = <code class="constant">.true.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">ELSE IF</code> (rkstage .EQ. <code class="constant">0 </code>.AND. currentlevel .EQ. groundlevel) <code class="keyword">THEN</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile">storewalltensor = <code class="constant">.true.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Store the speed of sound squared instead of the pressure.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! To be 100 percent correct, substract 2/3*rho*k (if present)</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! from the pressure to obtain the true presssure. First layer of</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! halo's, because that's what is needed by the viscous stencil.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (correctfork) p(i, j, k) = p(i, j, k) - twothird*w(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&              </code>, irho)*w(i, j, k, itu1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">p(i, j, k) = gamma(i, j, k)*p(i, j, k)/w(i, j, k, irho)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the nodal gradients for the nodes in the plane k = 1.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile">k = <code class="constant">1</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile">k1 = <code class="constant">1</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile">k2 = <code class="constant">2</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">CALL </code><code class="funcname">NODALGRADIENTS</code>(ux, uy, uz, vx, vy, vz, wx, wy, wz, qx, qy, qz)</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the viscous fluxes for the faces k == 1 and update</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the residuals for the cells k == 2.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile">mue = zero</a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! rFilv into account.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">por = half*rfilv</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (pork(i, j, <code class="constant">1</code>) .EQ. noflux) por = zero</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! flux.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">mul = por*(rlv(i, j, <code class="constant">1</code>)+rlv(i, j, <code class="constant">2</code>))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (eddymodel) mue = por*(rev(i, j, <code class="constant">1</code>)+rev(i, j, <code class="constant">2</code>))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">mut = mul + mue</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">gm1 = half*(gamma(i, j, <code class="constant">1</code>)+gamma(i, j, <code class="constant">2</code>)) - one</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">factlamheat = one/(prandtl*gm1)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! nodal values.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+ux(i, j-<code class="constant">1</code>, k1)+ux(i-<code class="constant">1</code>, j, k1)+ux(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uy(i, j-<code class="constant">1</code>, k1)+uy(i-<code class="constant">1</code>, j, k1)+uy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uz(i, j-<code class="constant">1</code>, k1)+uz(i-<code class="constant">1</code>, j, k1)+uz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vx(i, j-<code class="constant">1</code>, k1)+vx(i-<code class="constant">1</code>, j, k1)+vx(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vy(i, j-<code class="constant">1</code>, k1)+vy(i-<code class="constant">1</code>, j, k1)+vy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vz(i, j-<code class="constant">1</code>, k1)+vz(i-<code class="constant">1</code>, j, k1)+vz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wx(i, j-<code class="constant">1</code>, k1)+wx(i-<code class="constant">1</code>, j, k1)+wx(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wy(i, j-<code class="constant">1</code>, k1)+wy(i-<code class="constant">1</code>, j, k1)+wy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wz(i, j-<code class="constant">1</code>, k1)+wz(i-<code class="constant">1</code>, j, k1)+wz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qx(i, j-<code class="constant">1</code>, k1)+qx(i-<code class="constant">1</code>, j, k1)+qx(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qy(i, j-<code class="constant">1</code>, k1)+qy(i-<code class="constant">1</code>, j, k1)+qy(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qz(i, j-<code class="constant">1</code>, k1)+qz(i-<code class="constant">1</code>, j, k1)+qz(<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>i, j, k1))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! cell center k to cell center k+1.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! unit normal.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ss = one/result1</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = ss*ssx</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = ss*ssy</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Correct the gradients.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivx)-w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>k, ivx))*ss</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = u_x - corr*ssx</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = u_y - corr*ssy</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = u_z - corr*ssz</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivy)-w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>k, ivy))*ss</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = v_x - corr*ssx</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = v_y - corr*ssy</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = v_z - corr*ssz</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivz)-w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>k, ivz))*ss</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = w_x - corr*ssx</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = w_y - corr*ssy</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = w_z - corr*ssz</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j, k+<code class="constant">1</code>)-p(i, j, k))*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>ss</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = q_x - corr*ssx</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = q_y - corr*ssy</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">tauxy = mut*(u_y+v_x)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">tauxz = mut*(u_z+w_x)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">tauyz = mut*(v_z+w_y)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = heatcoef*q_x</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = heatcoef*q_y</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">ubar = half*(w(i, j, <code class="constant">1</code>, ivx)+w(i, j, <code class="constant">2</code>, ivx))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">vbar = half*(w(i, j, <code class="constant">1</code>, ivy)+w(i, j, <code class="constant">2</code>, ivy))</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">wbar = half*(w(i, j, <code class="constant">1</code>, ivz)+w(i, j, <code class="constant">2</code>, ivz))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the viscous fluxes for this k-face.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fmx = tauxx*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauxy*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauxz*sk(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fmy = tauxy*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyy*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauyz*sk(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fmz = tauxz*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyz*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauzz*sk(i, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + (ubar*tauxz<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>+vbar*tauyz+wbar*tauzz)*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - q_x*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&          </code>q_y*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - q_z*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Update the residuals of cell k == 2.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, <code class="constant">2</code>, imx) = fw(i, j, <code class="constant">2</code>, imx) + fmx</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, <code class="constant">2</code>, imy) = fw(i, j, <code class="constant">2</code>, imy) + fmy</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, <code class="constant">2</code>, imz) = fw(i, j, <code class="constant">2</code>, imz) + fmz</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, <code class="constant">2</code>, irhoe) = fw(i, j, <code class="constant">2</code>, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! face is part of a viscous subface.</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (storewalltensor .AND. visckminpointer(i, j) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">nn = visckminpointer(i, j)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = tauxx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = tauyy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = tauzz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = tauxy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = tauxz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = tauyz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">1</code>) = q_x</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">2</code>) = q_y</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">3</code>) = q_z</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Loop over the k-planes.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">kloop:</code><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Switch the indices k1 and k2.</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile">kk = k1</a>
      <a href="viscousflux_p.html#viscousflux" target="origFile">k1 = k2</a>
      <a href="viscousflux_p.html#viscousflux" target="origFile">k2 = kk</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the nodal gradients for the nodes in this k-plane.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! The results are stored in ux(:,:,k1), etc.</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">CALL </code><code class="funcname">NODALGRADIENTS</code>(ux, uy, uz, vx, vy, vz, wx, wy, wz, qx, qy, qz<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&                   </code>)</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        * Viscous fluxes in the k-direction.                           *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! rFilv into account.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">por = half*rfilv</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (pork(i, j, k) .EQ. noflux) por = zero</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! flux.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">mul = por*(rlv(i, j, k)+rlv(i, j, k+<code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (eddymodel) mue = por*(rev(i, j, k)+rev(i, j, k+<code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">mut = mul + mue</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">gm1 = half*(gamma(i, j, k)+gamma(i, j, k+<code class="constant">1</code>)) - one</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">factlamheat = one/(prandtl*gm1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! nodal values.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+ux(i, j-<code class="constant">1</code>, k1)+ux(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>ux(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uy(i, j-<code class="constant">1</code>, k1)+uy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>uy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uz(i, j-<code class="constant">1</code>, k1)+uz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>uz(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vx(i, j-<code class="constant">1</code>, k1)+vx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>vx(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vy(i, j-<code class="constant">1</code>, k1)+vy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>vy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vz(i, j-<code class="constant">1</code>, k1)+vz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>vz(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wx(i, j-<code class="constant">1</code>, k1)+wx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>wx(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wy(i, j-<code class="constant">1</code>, k1)+wy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>wy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wz(i, j-<code class="constant">1</code>, k1)+wz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>wz(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qx(i, j-<code class="constant">1</code>, k1)+qx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>qx(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qy(i, j-<code class="constant">1</code>, k1)+qy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>qy(i, j, k1))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qz(i, j-<code class="constant">1</code>, k1)+qz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>qz(i, j, k1))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!!$             write(unitvf,*) i,j,k, u_x, u_y, u_z</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! cell center k to cell center k+1.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! unit normal.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ss = one/result1</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = ss*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = ss*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Correct the gradients.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivx)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivx))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = u_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = u_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = u_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivy)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivy))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = v_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = v_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = v_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivz)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivz))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = w_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = w_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = w_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j, k+<code class="constant">1</code>)-p(i, j, k))<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = q_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = q_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxy = mut*(u_y+v_x)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxz = mut*(u_z+w_x)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauyz = mut*(v_z+w_y)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = heatcoef*q_x</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = heatcoef*q_y</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ubar = half*(w(i, j, k, ivx)+w(i, j, k+<code class="constant">1</code>, ivx))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">vbar = half*(w(i, j, k, ivy)+w(i, j, k+<code class="constant">1</code>, ivy))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">wbar = half*(w(i, j, k, ivz)+w(i, j, k+<code class="constant">1</code>, ivz))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the viscous fluxes for this k-face.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmx = tauxx*sk(i, j, k, <code class="constant">1</code>) + tauxy*sk(i, j, k, <code class="constant">2</code>) + tauxz*sk(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmy = tauxy*sk(i, j, k, <code class="constant">1</code>) + tauyy*sk(i, j, k, <code class="constant">2</code>) + tauyz*sk(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmz = tauxz*sk(i, j, k, <code class="constant">1</code>) + tauyz*sk(i, j, k, <code class="constant">2</code>) + tauzz*sk(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sk(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sk(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*sk(i, j, k, <code class="constant">3</code>) - q_x*sk(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*sk(i, j, k, <code class="constant">2</code>) - q_z*sk(i, j, k, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Update the residuals of cell k and k+1.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k+<code class="constant">1</code>, imx) = fw(i, j, k+<code class="constant">1</code>, imx) + fmx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k+<code class="constant">1</code>, imy) = fw(i, j, k+<code class="constant">1</code>, imy) + fmy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k+<code class="constant">1</code>, imz) = fw(i, j, k+<code class="constant">1</code>, imz) + fmz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k+<code class="constant">1</code>, irhoe) = fw(i, j, k+<code class="constant">1</code>, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! face is part of a viscous subface.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (k .EQ. kl .AND. storewalltensor .AND. visckmaxpointer(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">nn = visckmaxpointer(i, j)</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = tauxx</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = tauyy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = tauzz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = tauxy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = tauxz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = tauyz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, j, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        * Viscous fluxes in the j-direction.                           *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! rFilv into account.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">por = half*rfilv</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (porj(i, j, k) .EQ. noflux) por = zero</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! flux.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">mul = por*(rlv(i, j, k)+rlv(i, j+<code class="constant">1</code>, k))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (eddymodel) mue = por*(rev(i, j, k)+rev(i, j+<code class="constant">1</code>, k))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">mut = mul + mue</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">gm1 = half*(gamma(i, j, k)+gamma(i, j+<code class="constant">1</code>, k)) - one</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">factlamheat = one/(prandtl*gm1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! nodal values.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j, k1)+ux(i, j, k1)+ux(i-<code class="constant">1</code>, j, k2)+ux(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j, k1)+uy(i, j, k1)+uy(i-<code class="constant">1</code>, j, k2)+uy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j, k1)+uz(i, j, k1)+uz(i-<code class="constant">1</code>, j, k2)+uz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j, k1)+vx(i, j, k1)+vx(i-<code class="constant">1</code>, j, k2)+vx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j, k1)+vy(i, j, k1)+vy(i-<code class="constant">1</code>, j, k2)+vy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j, k1)+vz(i, j, k1)+vz(i-<code class="constant">1</code>, j, k2)+vz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j, k1)+wx(i, j, k1)+wx(i-<code class="constant">1</code>, j, k2)+wx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j, k1)+wy(i, j, k1)+wy(i-<code class="constant">1</code>, j, k2)+wy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j, k1)+wz(i, j, k1)+wz(i-<code class="constant">1</code>, j, k2)+wz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j, k1)+qx(i, j, k1)+qx(i-<code class="constant">1</code>, j, k2)+qx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j, k1)+qy(i, j, k1)+qy(i-<code class="constant">1</code>, j, k2)+qy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j, k1)+qz(i, j, k1)+qz(i-<code class="constant">1</code>, j, k2)+qz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! cell center j to cell center j+1.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! unit normal.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ss = one/result1</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = ss*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = ss*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Correct the gradients.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivx)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivx))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = u_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = u_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = u_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivy)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivy))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = v_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = v_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = v_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivz)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivz))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = w_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = w_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = w_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j+<code class="constant">1</code>, k)-p(i, j, k))<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = q_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = q_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxy = mut*(u_y+v_x)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxz = mut*(u_z+w_x)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauyz = mut*(v_z+w_y)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = heatcoef*q_x</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = heatcoef*q_y</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ubar = half*(w(i, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, ivx))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">vbar = half*(w(i, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, ivy))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">wbar = half*(w(i, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, ivz))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the viscous fluxes for this j-face.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmx = tauxx*sj(i, j, k, <code class="constant">1</code>) + tauxy*sj(i, j, k, <code class="constant">2</code>) + tauxz*sj(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmy = tauxy*sj(i, j, k, <code class="constant">1</code>) + tauyy*sj(i, j, k, <code class="constant">2</code>) + tauyz*sj(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmz = tauxz*sj(i, j, k, <code class="constant">1</code>) + tauyz*sj(i, j, k, <code class="constant">2</code>) + tauzz*sj(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sj(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sj(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*sj(i, j, k, <code class="constant">3</code>) - q_x*sj(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*sj(i, j, k, <code class="constant">2</code>) - q_z*sj(i, j, k, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Update the residuals of cell j and j+1.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j+<code class="constant">1</code>, k, imx) = fw(i, j+<code class="constant">1</code>, k, imx) + fmx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j+<code class="constant">1</code>, k, imy) = fw(i, j+<code class="constant">1</code>, k, imy) + fmy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j+<code class="constant">1</code>, k, imz) = fw(i, j+<code class="constant">1</code>, k, imz) + fmz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j+<code class="constant">1</code>, k, irhoe) = fw(i, j+<code class="constant">1</code>, k, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! face is part of a viscous subface. Both the cases j == 1</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! and j == jl must be tested.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (j .EQ. <code class="constant">1 </code>.AND. storewalltensor .AND. viscjminpointer(i, k)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&              </code>.GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">nn = viscjminpointer(i, k)</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">1</code>) = tauxx</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">2</code>) = tauyy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">3</code>) = tauzz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">4</code>) = tauxy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">5</code>) = tauxz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">6</code>) = tauyz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! And the j == jl case.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (j .EQ. jl .AND. storewalltensor .AND. viscjmaxpointer(i, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">nn = viscjmaxpointer(i, k)</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">1</code>) = tauxx</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">2</code>) = tauyy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">3</code>) = tauzz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">4</code>) = tauxy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">5</code>) = tauxz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(i, k, <code class="constant">6</code>) = tauyz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(i, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        * Viscous fluxes in the i-direction.                           *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">!</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! rFilv into account.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">por = half*rfilv</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (pori(i, j, k) .EQ. noflux) por = zero</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! multiplied the porosity. Compute the factor in front of</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! flux.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">mul = por*(rlv(i, j, k)+rlv(i+<code class="constant">1</code>, j, k))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (eddymodel) mue = por*(rev(i, j, k)+rev(i+<code class="constant">1</code>, j, k))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">mut = mul + mue</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">gm1 = half*(gamma(i, j, k)+gamma(i+<code class="constant">1</code>, j, k)) - one</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">factlamheat = one/(prandtl*gm1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">factturbheat = one/(prandtlturb*gm1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! nodal values.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = fourth*(ux(i, j-<code class="constant">1</code>, k1)+ux(i, j, k1)+ux(i, j-<code class="constant">1</code>, k2)+ux(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = fourth*(uy(i, j-<code class="constant">1</code>, k1)+uy(i, j, k1)+uy(i, j-<code class="constant">1</code>, k2)+uy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = fourth*(uz(i, j-<code class="constant">1</code>, k1)+uz(i, j, k1)+uz(i, j-<code class="constant">1</code>, k2)+uz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = fourth*(vx(i, j-<code class="constant">1</code>, k1)+vx(i, j, k1)+vx(i, j-<code class="constant">1</code>, k2)+vx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = fourth*(vy(i, j-<code class="constant">1</code>, k1)+vy(i, j, k1)+vy(i, j-<code class="constant">1</code>, k2)+vy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = fourth*(vz(i, j-<code class="constant">1</code>, k1)+vz(i, j, k1)+vz(i, j-<code class="constant">1</code>, k2)+vz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = fourth*(wx(i, j-<code class="constant">1</code>, k1)+wx(i, j, k1)+wx(i, j-<code class="constant">1</code>, k2)+wx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = fourth*(wy(i, j-<code class="constant">1</code>, k1)+wy(i, j, k1)+wy(i, j-<code class="constant">1</code>, k2)+wy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = fourth*(wz(i, j-<code class="constant">1</code>, k1)+wz(i, j, k1)+wz(i, j-<code class="constant">1</code>, k2)+wz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = fourth*(qx(i, j-<code class="constant">1</code>, k1)+qx(i, j, k1)+qx(i, j-<code class="constant">1</code>, k2)+qx(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = fourth*(qy(i, j-<code class="constant">1</code>, k1)+qy(i, j, k1)+qy(i, j-<code class="constant">1</code>, k2)+qy(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = fourth*(qz(i, j-<code class="constant">1</code>, k1)+qz(i, j, k1)+qz(i, j-<code class="constant">1</code>, k2)+qz(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k2))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! cell center i to cell center i+1.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! unit normal.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ss = one/result1</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssx = ss*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssy = ss*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ssz = ss*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Correct the gradients.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivx)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivx))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_x = u_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_y = u_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">u_z = u_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivy)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivy))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_x = v_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_y = v_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">v_z = v_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivz)-w(i, j<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, k, ivz))*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_x = w_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_y = w_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">w_z = w_z - corr*ssz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i+<code class="constant">1</code>, j, k)-p(i, j, k))<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>*ss</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = q_x - corr*ssx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = q_y - corr*ssy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = q_z - corr*ssz</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxx = mut*(two*u_x-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauyy = mut*(two*v_y-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauzz = mut*(two*w_z-fracdiv)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxy = mut*(u_y+v_x)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauxz = mut*(u_z+w_x)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">tauyz = mut*(v_z+w_y)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_x = heatcoef*q_x</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_y = heatcoef*q_y</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">q_z = heatcoef*q_z</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">ubar = half*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">vbar = half*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy))</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">wbar = half*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz))</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Compute the viscous fluxes for this i-face.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmx = tauxx*si(i, j, k, <code class="constant">1</code>) + tauxy*si(i, j, k, <code class="constant">2</code>) + tauxz*si(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmy = tauxy*si(i, j, k, <code class="constant">1</code>) + tauyy*si(i, j, k, <code class="constant">2</code>) + tauyz*si(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fmz = tauxz*si(i, j, k, <code class="constant">1</code>) + tauyz*si(i, j, k, <code class="constant">2</code>) + tauzz*si(i<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*si(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*si(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*si(i, j, k, <code class="constant">3</code>) - q_x*si(i, j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*si(i, j, k, <code class="constant">2</code>) - q_z*si(i, j, k, <code class="constant">3</code>)</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Update the residuals of cell i and i+1.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i+<code class="constant">1</code>, j, k, imx) = fw(i+<code class="constant">1</code>, j, k, imx) + fmx</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i+<code class="constant">1</code>, j, k, imy) = fw(i+<code class="constant">1</code>, j, k, imy) + fmy</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i+<code class="constant">1</code>, j, k, imz) = fw(i+<code class="constant">1</code>, j, k, imz) + fmz</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">fw(i+<code class="constant">1</code>, j, k, irhoe) = fw(i+<code class="constant">1</code>, j, k, irhoe) + frhoe</a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! face is part of a viscous subface. Both the cases i == 1</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! and i == il must be tested.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (i .EQ. <code class="constant">1 </code>.AND. storewalltensor .AND. visciminpointer(j, k)<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&              </code>.GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">nn = visciminpointer(j, k)</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">1</code>) = tauxx</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">2</code>) = tauyy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">3</code>) = tauzz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">4</code>) = tauxy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">5</code>) = tauxz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">6</code>) = tauyz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! And the i == il case.</code></a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (i .EQ. il .AND. storewalltensor .AND. viscimaxpointer(j, k<code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">nn = viscimaxpointer(j, k)</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">1</code>) = tauxx</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">2</code>) = tauyy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">3</code>) = tauzz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">4</code>) = tauxy</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">5</code>) = tauxz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%tau(j, k, <code class="constant">6</code>) = tauyz</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">viscsubface(nn)%q(j, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO </code><code class="label">kloop</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Restore the pressure in p. Again only the first layer of</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! halo cells.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile">p(i, j, k) = w(i, j, k, irho)*p(i, j, k)/gamma(i, j, k)</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">IF</code> (correctfork) <code class="keyword">THEN</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
            <a href="viscousflux_p.html#viscousflux" target="origFile">p(i, j, k) = p(i, j, k) + twothird*w(i, j, k, irho)*w(i, j, <code class="label">&</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="label">&              </code>k, itu1)</a>
          <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
        <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="comment">! Possibly correct the wall shear stress.</code></a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">CALL </code><code class="funcname">UTAUWF_CD</code>(rfilv)</a>
    <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">CLOSE</code>(unitvf) </a>
  <a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END IF</code></a>
<a href="viscousflux_p.html#viscousflux" target="origFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">VISCOUSFLUX_CD</code></a>
</pre>
</body>
