<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="residual_block"></a><a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      * File:          residual.f90                                    *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      * Author:        Edwin van der Weide, Steve Repsher (blanking)   *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      * Starting date: 03-15-2003                                      *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      * Last modified: 10-29-2007                                      *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">RESIDUAL_BLOCK</code>()</a>
  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTTIMESPECTRAL</code></a>
  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTDISCRETIZATION</code></a>
  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTITERATION</code></a>
  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">CGNSGRID</code></a>
  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE</code></a>
  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">USE </code><code class="funcname">ITERATION</code></a>
<a name="residual_blocki0"></a>  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!write(14,40),i,j,k,dw(i,j,k,l),fw(i,j,k,l)</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!      * residual computes the residual of the mean flow equations on   *</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!      * the current MG level.                                          *</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!      Local variables.</code></a>
<a name="residual_blocki1"></a><a href="residual_block.html#residual_blocki0" target="diffFile"><code class="comment">!</code></a>
<a name="residual_blocki2"></a>  <a href="residual_block.html#residual_blocki0" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">sps</code>, <code class="vardecl">nn</code>, <code class="vardecl">discr</code></a>
<a name="residual_blocki3"></a>  <a href="residual_block.html#residual_blocki1" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">l</code></a>
  <a href="residual_block.html#residual_blocki2" target="diffFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">finegrid</code></a>
<a name="residual_blocki4"></a>  <a href="residual_block.html#residual_blocki3" target="diffFile"><code class="typename">REAL </code>:: <code class="vardecl">result1</code></a>
<a name="residual_blocki5"></a>  <a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">REAL</code></a>
  <a href="residual_block.html#residual_blocki4" target="diffFile"><code class="keyword">IF</code> (smoother .EQ. rungekutta) <code class="keyword">THEN</code></a>
<a name="residual_blocki6"></a>    <a href="residual_block.html#residual_blocki5" target="diffFile">rfil = cdisrk(rkstage+<code class="constant">1</code>)</a>
  <a href="residual_block.html#residual_blocki4" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="residual_blocki7"></a>    <a href="residual_block.html#residual_blocki6" target="diffFile">rfil = one</a>
  <a href="residual_block.html#residual_blocki4" target="diffFile"><code class="keyword">END IF</code></a>
<a name="residual_blocki8"></a><a href="residual_block.html#residual_blocki7" target="diffFile"><code class="comment">! Initialize the local arrays to monitor the massflows to zero.</code></a>
<a name="residual_blocki9"></a>  <a href="residual_block.html#residual_blocki7" target="diffFile">massflowfamilyinv = zero</a>
  <a href="residual_block.html#residual_blocki8" target="diffFile">massflowfamilydiss = zero</a>
<a href="residual_block.html#residual_blocki9" target="diffFile"><code class="comment">! Set the value of the discretization, depending on the grid level,</code></a>
<a href="residual_block.html#residual_blocki9" target="diffFile"><code class="comment">! and the logical fineGrid, which indicates whether or not this</code></a>
<a name="residual_blocki11"></a><a name="residual_blocki10"></a><a href="residual_block.html#residual_blocki9" target="diffFile"><code class="comment">! is the finest grid level of the current mg cycle.</code></a>
<a name="residual_blocki12"></a>  <a href="residual_block.html#residual_blocki9" target="diffFile">discr = spacediscrcoarse</a>
<a name="residual_blocki14"></a><a name="residual_blocki13"></a>  <a href="residual_block.html#residual_blocki10" target="diffFile"><code class="keyword">IF</code> (currentlevel .EQ. <code class="constant">1</code>) </a><a href="residual_block.html#residual_blocki11" target="diffFile">discr = spacediscr</a>
<a name="residual_blocki15"></a>  <a href="residual_block.html#residual_blocki12" target="diffFile">finegrid = <code class="constant">.false.</code></a>
<a name="residual_blocki16"></a>  <a href="residual_block.html#residual_blocki13" target="diffFile"><code class="keyword">IF</code> (currentlevel .EQ. groundlevel) </a><a href="residual_block.html#residual_blocki14" target="diffFile">finegrid = <code class="constant">.true.</code></a>
<a name="residual_blocki17"></a>  <a href="residual_block.html#residual_blocki15" target="diffFile"><code class="keyword">IF</code> (finegrid .EQV. <code class="constant">.false.</code>) <code class="keyword">THEN</code></a>
    <a href="residual_block.html#residual_blocki16" target="diffFile"><code class="keyword">PRINT*</code>, <code class="string">'Fine Grid should not be false here'</code></a>
<a name="residual_blocki18"></a>    <a href="residual_block.html#residual_blocki17" target="diffFile"><code class="keyword">STOP</code></a>
<a name="residual_blocki19"></a>  <a href="residual_block.html#residual_blocki15" target="diffFile"><code class="keyword">ELSE</code></a>
    <a href="residual_block.html#residual_blocki18" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDCENTRALFLUX</code>()</a>
<a href="residual_block.html#residual_blocki19" target="diffFile"><code class="comment">! Compute the artificial dissipation fluxes.</code></a>
<a href="residual_block.html#residual_blocki19" target="diffFile"><code class="comment">! This depends on the parameter discr.</code></a>
<a name="residual_blocki20"></a>    <a href="residual_block.html#residual_blocki19" target="diffFile"><code class="keyword">SELECT CASE </code> (discr) </a>
    <a href="residual_block.html#residual_blocki19" target="diffFile"><code class="keyword">CASE </code>(dissscalar) </a>
<a name="residual_blocki21"></a><a href="residual_block.html#residual_blocki20" target="diffFile"><code class="comment">! Standard scalar dissipation scheme.</code></a>
      <a href="residual_block.html#residual_blocki20" target="diffFile"><code class="keyword">IF</code> (finegrid) <code class="keyword">THEN</code></a>
<a name="residual_blocki22"></a>        <a href="residual_block.html#residual_blocki21" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXSCALAR</code>()</a>
      <a href="residual_block.html#residual_blocki20" target="diffFile"><code class="keyword">ELSE</code></a>
        <a href="residual_block.html#residual_blocki22" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXSCALARCOARSE</code>()</a>
<a name="residual_blocki23"></a>      <a href="residual_block.html#residual_blocki20" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="residual_block.html#residual_blocki19" target="diffFile"><code class="keyword">CASE </code>(dissmatrix) </a>
<a href="residual_block.html#residual_blocki23" target="diffFile"><code class="comment">!===========================================================</code></a>
<a name="residual_blocki24"></a><a href="residual_block.html#residual_blocki23" target="diffFile"><code class="comment">! Matrix dissipation scheme.</code></a>
      <a href="residual_block.html#residual_blocki23" target="diffFile"><code class="keyword">IF</code> (finegrid) <code class="keyword">THEN</code></a>
<a name="residual_blocki25"></a>        <a href="residual_block.html#residual_blocki24" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXMATRIX</code>()</a>
      <a href="residual_block.html#residual_blocki23" target="diffFile"><code class="keyword">ELSE</code></a>
        <a href="residual_block.html#residual_blocki25" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXMATRIXCOARSE</code>()</a>
<a name="residual_blocki26"></a>      <a href="residual_block.html#residual_blocki23" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="residual_block.html#residual_blocki19" target="diffFile"><code class="keyword">CASE </code>(disscusp) </a>
<a href="residual_block.html#residual_blocki26" target="diffFile"><code class="comment">!===========================================================</code></a>
<a name="residual_blocki27"></a><a href="residual_block.html#residual_blocki26" target="diffFile"><code class="comment">! Cusp dissipation scheme.</code></a>
      <a href="residual_block.html#residual_blocki26" target="diffFile"><code class="keyword">IF</code> (finegrid) <code class="keyword">THEN</code></a>
<a name="residual_blocki28"></a>        <a href="residual_block.html#residual_blocki27" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXCUSP</code>()</a>
      <a href="residual_block.html#residual_blocki26" target="diffFile"><code class="keyword">ELSE</code></a>
        <a href="residual_block.html#residual_blocki28" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDDISSFLUXCUSPCOARSE</code>()</a>
<a name="residual_blocki29"></a>      <a href="residual_block.html#residual_blocki26" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="residual_block.html#residual_blocki19" target="diffFile"><code class="keyword">CASE </code>(upwind) </a>
<a href="residual_block.html#residual_blocki29" target="diffFile"><code class="comment">!===========================================================</code></a>
<a href="residual_block.html#residual_blocki29" target="diffFile"><code class="comment">! Dissipation via an upwind scheme.</code></a>
<a name="residual_blocki30"></a>      <a href="residual_block.html#residual_blocki29" target="diffFile"><code class="keyword">CALL </code><code class="funcname">INVISCIDUPWINDFLUX</code>(finegrid)</a>
<a name="residual_blocki31"></a>    <a href="residual_block.html#residual_blocki19" target="diffFile"><code class="keyword">END SELECT</code></a>
<a name="residual_blocki32"></a><a href="residual_block.html#residual_blocki30" target="diffFile"><code class="comment">! Compute the viscous flux in case of a viscous computation.</code></a>
    <a href="residual_block.html#residual_blocki30" target="diffFile"><code class="keyword">IF</code> (viscous) </a><a href="residual_block.html#residual_blocki31" target="diffFile"><code class="keyword">CALL </code><code class="funcname">VISCOUSFLUX</code>()</a>
<a href="residual_block.html#residual_blocki32" target="diffFile"><code class="comment">! add the dissipative and possibly viscous fluxes to the</code></a>
<a href="residual_block.html#residual_blocki32" target="diffFile"><code class="comment">! Euler fluxes. Loop over the owned cells and add fw to dw.</code></a>
<a href="residual_block.html#residual_blocki32" target="diffFile"><code class="comment">! Also multiply by iblank so that no updates occur in holes</code></a>
<a name="residual_blocki33"></a><a href="residual_block.html#residual_blocki32" target="diffFile"><code class="comment">! or on the overset boundary.</code></a>
<a name="residual_blocki34"></a>    <a href="residual_block.html#residual_blocki32" target="diffFile"><code class="keyword">DO </code>l=<code class="constant">1</code>,nwf</a>
<a name="residual_blocki35"></a>      <a href="residual_block.html#residual_blocki33" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
<a name="residual_blocki36"></a>        <a href="residual_block.html#residual_blocki34" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
<a name="residual_blocki37"></a>          <a href="residual_block.html#residual_blocki35" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
            <a href="residual_block.html#residual_blocki36" target="diffFile">result1 = <code class="funcname">REAL</code>(iblank(i, j, k), realtype)</a>
            <a href="residual_block.html#residual_blocki37" target="diffFile">dw(i, j, k, l) = (dw(i, j, k, l)+fw(i, j, k, l))*result1</a>
          <a href="residual_block.html#residual_blocki35" target="diffFile"><code class="keyword">END DO</code></a>
        <a href="residual_block.html#residual_blocki34" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="residual_block.html#residual_blocki33" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="residual_block.html#residual_blocki32" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="residual_block.html#residual_blocki15" target="diffFile"><code class="keyword">END IF</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">! Add the source terms from the level 0 cooling model.</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">!call level0CoolingModel</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">! Set the value of rFil, which controls the fraction of the old</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">! dissipation residual to be used. This is only for the runge-kutta</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">! schemes; for other smoothers rFil is simply set to 1.0.</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">! Note the index rkStage+1 for cdisRK. The reason is that the</code></a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="comment">! residual computation is performed before rkStage is incremented.</code></a>
 <a href="residual_block.html#residual_block" target="diffFile"><code class="label">40 </code><code class="keyword">FORMAT</code>(<code class="constant">1x,i4,i4,i4,e20.6,e20.6</code>)</a>
<a href="residual_block.html#residual_block" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">RESIDUAL_BLOCK</code></a>
</pre>
</body>
