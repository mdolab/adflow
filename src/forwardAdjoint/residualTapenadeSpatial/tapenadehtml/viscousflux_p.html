<title>Generated by TAPENADE</title>
<link type="text/CSS" rel="stylesheet" href="tapenade.css">
<link type="text/CSS" rel="stylesheet" href="fortranStyle.css">
<body>
<pre><a name="viscousflux"></a><a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!        Generated by TAPENADE     (INRIA, Tropics team)</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!  Tapenade 3.4 (r3375) - 10 Feb 2010 15:08</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      * File:          viscousFlux.f90                                 *</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      * Author:        Edwin van der Weide                             *</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      * Starting date: 03-21-2003                                      *</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      * Last modified: 04-18-2005                                      *</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">VISCOUSFLUX</code>()</a>
  <a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">USE </code><code class="funcname">INPUTPHYSICS</code></a>
  <a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">USE </code><code class="funcname">BLOCKPOINTERS</code></a>
  <a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">USE </code><code class="funcname">FLOWVARREFSTATE</code></a>
<a name="viscousfluxi0"></a>  <a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">USE </code><code class="funcname">ITERATION</code></a>
  <a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      * viscousFlux computes the viscous fluxes using a central        *</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      * difference scheme for a block.                                 *</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      * It is assumed that the pointers in block pointer already point *</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      * to the correct block.                                          *</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!      Local parameter.</code></a>
<a name="viscousfluxi1"></a><a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="comment">!</code></a>
  <a href="viscousflux.html#viscousfluxi0" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">PARAMETER </code>:: <code class="vardecl">twothird</code>=<code class="vardecl">two</code>*<code class="vardecl">third</code></a>
<a href="viscousflux.html#viscousfluxi1" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi1" target="diffFile"><code class="comment">!      Local variables.</code></a>
<a name="viscousfluxi2"></a><a href="viscousflux.html#viscousfluxi1" target="diffFile"><code class="comment">!</code></a>
<a name="viscousfluxi3"></a>  <a href="viscousflux.html#viscousfluxi1" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">i</code>, <code class="vardecl">j</code>, <code class="vardecl">k</code>, <code class="vardecl">nn</code></a>
<a name="viscousfluxi4"></a>  <a href="viscousflux.html#viscousfluxi2" target="diffFile"><code class="typename">INTEGER(</code><code class="keyword">kind</code>=<code class="modifier">inttype</code><code class="typename">) </code>:: <code class="vardecl">k1</code>, <code class="vardecl">k2</code>, <code class="vardecl">kk</code></a>
<a name="viscousfluxi5"></a>  <a href="viscousflux.html#viscousfluxi3" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">rfilv</code>, <code class="vardecl">por</code>, <code class="vardecl">mul</code>, <code class="vardecl">mue</code>, <code class="vardecl">mut</code>, <code class="vardecl">heatcoef</code></a>
<a name="viscousfluxi6"></a>  <a href="viscousflux.html#viscousfluxi4" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">gm1</code>, <code class="vardecl">factlamheat</code>, <code class="vardecl">factturbheat</code></a>
<a name="viscousfluxi7"></a>  <a href="viscousflux.html#viscousfluxi5" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">u_x</code>, <code class="vardecl">u_y</code>, <code class="vardecl">u_z</code>, <code class="vardecl">v_x</code>, <code class="vardecl">v_y</code>, <code class="vardecl">v_z</code>, <code class="vardecl">w_x</code>, <code class="vardecl">w_y</code>, <code class="vardecl">w_z</code></a>
<a name="viscousfluxi8"></a>  <a href="viscousflux.html#viscousfluxi6" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">q_x</code>, <code class="vardecl">q_y</code>, <code class="vardecl">q_z</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code></a>
<a name="viscousfluxi9"></a>  <a href="viscousflux.html#viscousfluxi7" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">corr</code>, <code class="vardecl">ssx</code>, <code class="vardecl">ssy</code>, <code class="vardecl">ssz</code>, <code class="vardecl">ss</code>, <code class="vardecl">fracdiv</code></a>
<a name="viscousfluxi10"></a>  <a href="viscousflux.html#viscousfluxi8" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxx</code>, <code class="vardecl">tauyy</code>, <code class="vardecl">tauzz</code></a>
<a name="viscousfluxi11"></a>  <a href="viscousflux.html#viscousfluxi9" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">tauxy</code>, <code class="vardecl">tauxz</code>, <code class="vardecl">tauyz</code></a>
<a name="viscousfluxi12"></a>  <a href="viscousflux.html#viscousfluxi10" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">fmx</code>, <code class="vardecl">fmy</code>, <code class="vardecl">fmz</code>, <code class="vardecl">frhoe</code></a>
<a name="viscousfluxi13"></a>  <a href="viscousflux.html#viscousfluxi11" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="vardecl">uz</code></a>
<a name="viscousfluxi14"></a>  <a href="viscousflux.html#viscousfluxi12" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code></a>
<a name="viscousfluxi15"></a>  <a href="viscousflux.html#viscousfluxi13" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code></a>
<a name="viscousfluxi16"></a>  <a href="viscousflux.html#viscousfluxi14" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">) </code>:: <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="vardecl">qz</code></a>
  <a href="viscousflux.html#viscousfluxi15" target="diffFile"><code class="typename">LOGICAL </code>:: <code class="vardecl">correctfork</code>, <code class="vardecl">storewalltensor</code></a>
<a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="comment">!      * Begin execution                                                *</code></a>
<a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="comment">!      *                                                                *</code></a>
<a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="comment">!      ******************************************************************</code></a>
<a name="viscousfluxi17"></a><a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="comment">! </code></a>
<a name="viscousfluxi18"></a>  <a href="viscousflux.html#viscousfluxi16" target="diffFile"><code class="typename">INTEGER </code>:: <code class="vardecl">unitvf</code>=<code class="constant">1011</code>, <code class="vardecl">ierror</code></a>
  <a href="viscousflux.html#viscousfluxi17" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">arg1</code></a>
<a name="viscousfluxi19"></a>  <a href="viscousflux.html#viscousfluxi18" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">result1</code></a>
  <a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">INTRINSIC </code><code class="funcname">SQRT</code></a>
<a name="p18"></a><a name="viscousfluxi21"></a><a name="viscousfluxi20"></a>  <a href="viscousflux.html#viscousfluxi19" target="diffFile"><code class="keyword">OPEN</code>(<code class="keyword">unit</code>=unitvf, <code class="keyword">file</code>=<code class="string">'verifyvf.out'</code>, <code class="keyword">status</code>=<code class="string">'replace'</code>, <code class="keyword">action</code>=<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi19" target="diffFile"><code class="label">& </code><code class="string">'write'</code>, <code class="keyword">iostat</code>=ierror) </a>
<a name="viscousfluxi22"></a>  <a href="viscousflux.html#viscousfluxi20" target="diffFile"><code class="keyword">IF</code> (ierror .NE. <code class="constant">0</code>) </a><a href="msg.html#p18" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="viscousflux.html#viscousfluxi21" target="diffFile"><code class="keyword">CALL </code><code class="funcname">TERMINATE</code>(<code class="string">'verifyvf'</code>, <code class="string">'Something wrong when '</code><code class="label">&</code></a>
<a name="viscousfluxi23"></a><a href="viscousflux.html#viscousfluxi21" target="diffFile"><code class="label">&                              </code>, <code class="string">'calling open'</code>)</a>
  <a href="viscousflux.html#viscousfluxi22" target="diffFile"><code class="keyword">PRINT*</code>, <code class="string">'ierror:'</code>, ierror</a>
<a href="viscousflux.html#viscousfluxi23" target="diffFile"><code class="comment">! Set rFilv to rFil to indicate that this is the viscous part.</code></a>
<a href="viscousflux.html#viscousfluxi23" target="diffFile"><code class="comment">! If rFilv == 0 the viscous residuals need not to be computed</code></a>
<a name="p19"></a><a name="viscousfluxi24"></a><a href="viscousflux.html#viscousfluxi23" target="diffFile"><code class="comment">! and a return can be made.</code></a>
<a name="viscousfluxi25"></a>  <a href="viscousflux.html#viscousfluxi23" target="diffFile">rfilv = rfil</a>
  <a href="viscousflux.html#viscousfluxi24" target="diffFile"><code class="keyword">IF</code> (</a><a href="msg.html#p19" target="msg"><code class="comment"><img src="danger.gif" align=middle border=0 alt="!" /></code></a><a href="viscousflux.html#viscousfluxi24" target="diffFile">rfilv .EQ. zero) <code class="keyword">THEN</code></a>
<a name="viscousfluxi26"></a>    <a href="viscousflux.html#viscousfluxi25" target="diffFile"><code class="keyword">RETURN</code></a>
  <a href="viscousflux.html#viscousfluxi24" target="diffFile"><code class="keyword">ELSE</code></a>
<a href="viscousflux.html#viscousfluxi26" target="diffFile"><code class="comment">! Determine whether or not the pressure must be corrected</code></a>
<a name="viscousfluxi27"></a><a href="viscousflux.html#viscousfluxi26" target="diffFile"><code class="comment">! for the presence of the turbulent kinetic energy.</code></a>
<a name="viscousfluxi28"></a>    <a href="viscousflux.html#viscousfluxi26" target="diffFile"><code class="keyword">IF</code> (kpresent) <code class="keyword">THEN</code></a>
      <a href="viscousflux.html#viscousfluxi27" target="diffFile"><code class="keyword">IF</code> (currentlevel .LE. groundlevel .OR. turbcoupled) <code class="keyword">THEN</code></a>
<a name="viscousfluxi29"></a>        <a href="viscousflux.html#viscousfluxi28" target="diffFile">correctfork = <code class="constant">.true.</code></a>
      <a href="viscousflux.html#viscousfluxi27" target="diffFile"><code class="keyword">ELSE</code></a>
        <a href="viscousflux.html#viscousfluxi29" target="diffFile">correctfork = <code class="constant">.false.</code></a>
<a name="viscousfluxi30"></a>      <a href="viscousflux.html#viscousfluxi27" target="diffFile"><code class="keyword">END IF</code></a>
    <a href="viscousflux.html#viscousfluxi26" target="diffFile"><code class="keyword">ELSE</code></a>
<a name="viscousfluxi31"></a>      <a href="viscousflux.html#viscousfluxi30" target="diffFile">correctfork = <code class="constant">.false.</code></a>
    <a href="viscousflux.html#viscousfluxi26" target="diffFile"><code class="keyword">END IF</code></a>
<a href="viscousflux.html#viscousfluxi31" target="diffFile"><code class="comment">! Determine whether or not the wall stress tensor and wall heat</code></a>
<a name="viscousfluxi32"></a><a href="viscousflux.html#viscousfluxi31" target="diffFile"><code class="comment">! flux must be stored for viscous walls.</code></a>
<a name="viscousfluxi33"></a>    <a href="viscousflux.html#viscousfluxi31" target="diffFile">storewalltensor = <code class="constant">.false.</code></a>
<a name="viscousfluxi34"></a>    <a href="viscousflux.html#viscousfluxi32" target="diffFile"><code class="keyword">IF</code> (wallfunctions) <code class="keyword">THEN</code></a>
<a name="viscousfluxi35"></a>      <a href="viscousflux.html#viscousfluxi33" target="diffFile">storewalltensor = <code class="constant">.true.</code></a>
    <a href="viscousflux.html#viscousfluxi32" target="diffFile"><code class="keyword">ELSE </code></a><a href="viscousflux.html#viscousfluxi34" target="diffFile"><code class="keyword">IF</code> (rkstage .EQ. <code class="constant">0 </code>.AND. currentlevel .EQ. groundlevel) <code class="keyword">THEN</code></a>
<a name="viscousfluxi36"></a>      <a href="viscousflux.html#viscousfluxi35" target="diffFile">storewalltensor = <code class="constant">.true.</code></a>
    <a href="viscousflux.html#viscousfluxi32" target="diffFile"><code class="keyword">END IF</code></a>
<a href="viscousflux.html#viscousfluxi36" target="diffFile"><code class="comment">! Store the speed of sound squared instead of the pressure.</code></a>
<a href="viscousflux.html#viscousfluxi36" target="diffFile"><code class="comment">! To be 100 percent correct, substract 2/3*rho*k (if present)</code></a>
<a href="viscousflux.html#viscousfluxi36" target="diffFile"><code class="comment">! from the pressure to obtain the true presssure. First layer of</code></a>
<a name="viscousfluxi37"></a><a href="viscousflux.html#viscousfluxi36" target="diffFile"><code class="comment">! halo's, because that's what is needed by the viscous stencil.</code></a>
<a name="viscousfluxi38"></a>    <a href="viscousflux.html#viscousfluxi36" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
<a name="viscousfluxi40"></a><a name="viscousfluxi39"></a>      <a href="viscousflux.html#viscousfluxi37" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
        <a href="viscousflux.html#viscousfluxi38" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
<a name="viscousfluxi41"></a>          <a href="viscousflux.html#viscousfluxi39" target="diffFile"><code class="keyword">IF</code> (correctfork) </a><a href="viscousflux.html#viscousfluxi40" target="diffFile">p(i, j, k) = p(i, j, k) - twothird*w(i, j, k<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi40" target="diffFile"><code class="label">&              </code>, irho)*w(i, j, k, itu1)</a>
          <a href="viscousflux.html#viscousfluxi41" target="diffFile">p(i, j, k) = gamma(i, j, k)*p(i, j, k)/w(i, j, k, irho)</a>
        <a href="viscousflux.html#viscousfluxi38" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi42"></a>      <a href="viscousflux.html#viscousfluxi37" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#viscousfluxi36" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi43"></a><a href="viscousflux.html#viscousfluxi42" target="diffFile"><code class="comment">! Compute the nodal gradients for the nodes in the plane k = 1.</code></a>
<a name="viscousfluxi44"></a>    <a href="viscousflux.html#viscousfluxi42" target="diffFile">k = <code class="constant">1</code></a>
<a name="viscousfluxi45"></a>    <a href="viscousflux.html#viscousfluxi43" target="diffFile">k1 = <code class="constant">1</code></a>
<a name="viscousfluxi46"></a>    <a href="viscousflux.html#viscousfluxi44" target="diffFile">k2 = <code class="constant">2</code></a>
    <a href="viscousflux.html#viscousfluxi45" target="diffFile"><code class="keyword">CALL </code><code class="funcname">NODALGRADIENTS</code>(ux, uy, uz, vx, vy, vz, wx, wy, wz, qx, qy, qz)</a>
<a href="viscousflux.html#viscousfluxi46" target="diffFile"><code class="comment">! Compute the viscous fluxes for the faces k == 1 and update</code></a>
<a name="viscousfluxi47"></a><a href="viscousflux.html#viscousfluxi46" target="diffFile"><code class="comment">! the residuals for the cells k == 2.</code></a>
<a name="viscousfluxi48"></a>    <a href="viscousflux.html#viscousfluxi46" target="diffFile">mue = zero</a>
<a name="viscousfluxi49"></a>    <a href="viscousflux.html#viscousfluxi47" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
      <a href="viscousflux.html#viscousfluxi48" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux.html#viscousfluxi49" target="diffFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux.html#viscousfluxi49" target="diffFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousfluxi51"></a><a name="viscousfluxi50"></a><a href="viscousflux.html#viscousfluxi49" target="diffFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousfluxi52"></a>        <a href="viscousflux.html#viscousfluxi49" target="diffFile">por = half*rfilv</a>
        <a href="viscousflux.html#viscousfluxi50" target="diffFile"><code class="keyword">IF</code> (pork(i, j, <code class="constant">1</code>) .EQ. noflux) </a><a href="viscousflux.html#viscousfluxi51" target="diffFile">por = zero</a>
<a href="viscousflux.html#viscousfluxi52" target="diffFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux.html#viscousfluxi52" target="diffFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux.html#viscousfluxi52" target="diffFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousfluxi54"></a><a name="viscousfluxi53"></a><a href="viscousflux.html#viscousfluxi52" target="diffFile"><code class="comment">! flux.</code></a>
<a name="viscousfluxi55"></a>        <a href="viscousflux.html#viscousfluxi52" target="diffFile">mul = por*(rlv(i, j, <code class="constant">1</code>)+rlv(i, j, <code class="constant">2</code>))</a>
<a name="viscousfluxi56"></a>        <a href="viscousflux.html#viscousfluxi53" target="diffFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux.html#viscousfluxi54" target="diffFile">mue = por*(rev(i, j, <code class="constant">1</code>)+rev(i, j, <code class="constant">2</code>))</a>
<a name="viscousfluxi57"></a>        <a href="viscousflux.html#viscousfluxi55" target="diffFile">mut = mul + mue</a>
<a name="viscousfluxi58"></a>        <a href="viscousflux.html#viscousfluxi56" target="diffFile">gm1 = half*(gamma(i, j, <code class="constant">1</code>)+gamma(i, j, <code class="constant">2</code>)) - one</a>
<a name="viscousfluxi59"></a>        <a href="viscousflux.html#viscousfluxi57" target="diffFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousfluxi60"></a>        <a href="viscousflux.html#viscousfluxi58" target="diffFile">factturbheat = one/(prandtlturb*gm1)</a>
        <a href="viscousflux.html#viscousfluxi59" target="diffFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux.html#viscousfluxi60" target="diffFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux.html#viscousfluxi60" target="diffFile"><code class="comment">! nodal values.</code></a>
<a name="viscousfluxi61"></a>        <a href="viscousflux.html#viscousfluxi60" target="diffFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+ux(i, j-<code class="constant">1</code>, k1)+ux(i-<code class="constant">1</code>, j, k1)+ux(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi60" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi62"></a>        <a href="viscousflux.html#viscousfluxi61" target="diffFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uy(i, j-<code class="constant">1</code>, k1)+uy(i-<code class="constant">1</code>, j, k1)+uy(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi61" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi63"></a>        <a href="viscousflux.html#viscousfluxi62" target="diffFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uz(i, j-<code class="constant">1</code>, k1)+uz(i-<code class="constant">1</code>, j, k1)+uz(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi62" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi64"></a>        <a href="viscousflux.html#viscousfluxi63" target="diffFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vx(i, j-<code class="constant">1</code>, k1)+vx(i-<code class="constant">1</code>, j, k1)+vx(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi63" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi65"></a>        <a href="viscousflux.html#viscousfluxi64" target="diffFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vy(i, j-<code class="constant">1</code>, k1)+vy(i-<code class="constant">1</code>, j, k1)+vy(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi64" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi66"></a>        <a href="viscousflux.html#viscousfluxi65" target="diffFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vz(i, j-<code class="constant">1</code>, k1)+vz(i-<code class="constant">1</code>, j, k1)+vz(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi65" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi67"></a>        <a href="viscousflux.html#viscousfluxi66" target="diffFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wx(i, j-<code class="constant">1</code>, k1)+wx(i-<code class="constant">1</code>, j, k1)+wx(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi66" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi68"></a>        <a href="viscousflux.html#viscousfluxi67" target="diffFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wy(i, j-<code class="constant">1</code>, k1)+wy(i-<code class="constant">1</code>, j, k1)+wy(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi67" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi69"></a>        <a href="viscousflux.html#viscousfluxi68" target="diffFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wz(i, j-<code class="constant">1</code>, k1)+wz(i-<code class="constant">1</code>, j, k1)+wz(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi68" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi70"></a>        <a href="viscousflux.html#viscousfluxi69" target="diffFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qx(i, j-<code class="constant">1</code>, k1)+qx(i-<code class="constant">1</code>, j, k1)+qx(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi69" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi71"></a>        <a href="viscousflux.html#viscousfluxi70" target="diffFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qy(i, j-<code class="constant">1</code>, k1)+qy(i-<code class="constant">1</code>, j, k1)+qy(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi70" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a name="viscousfluxi72"></a>        <a href="viscousflux.html#viscousfluxi71" target="diffFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qz(i, j-<code class="constant">1</code>, k1)+qz(i-<code class="constant">1</code>, j, k1)+qz(<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi71" target="diffFile"><code class="label">&          </code>i, j, k1))</a>
<a href="viscousflux.html#viscousfluxi72" target="diffFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux.html#viscousfluxi72" target="diffFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux.html#viscousfluxi72" target="diffFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux.html#viscousfluxi72" target="diffFile"><code class="comment">! cell center k to cell center k+1.</code></a>
        <a href="viscousflux.html#viscousfluxi72" target="diffFile">ssx = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a name="viscousfluxi73"></a><a href="viscousflux.html#viscousfluxi72" target="diffFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi72" target="diffFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
        <a href="viscousflux.html#viscousfluxi73" target="diffFile">ssy = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a name="viscousfluxi74"></a><a href="viscousflux.html#viscousfluxi73" target="diffFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi73" target="diffFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
        <a href="viscousflux.html#viscousfluxi74" target="diffFile">ssz = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j, <code class="label">&</code></a>
<a name="viscousfluxi75"></a><a href="viscousflux.html#viscousfluxi74" target="diffFile"><code class="label">&          </code>k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi74" target="diffFile"><code class="label">&          </code>x(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
<a href="viscousflux.html#viscousfluxi75" target="diffFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a name="viscousfluxi76"></a><a href="viscousflux.html#viscousfluxi75" target="diffFile"><code class="comment">! unit normal.</code></a>
<a name="viscousfluxi77"></a>        <a href="viscousflux.html#viscousfluxi75" target="diffFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
<a name="viscousfluxi78"></a>        <a href="viscousflux.html#viscousfluxi76" target="diffFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousfluxi79"></a>        <a href="viscousflux.html#viscousfluxi77" target="diffFile">ss = one/result1</a>
<a name="viscousfluxi80"></a>        <a href="viscousflux.html#viscousfluxi78" target="diffFile">ssx = ss*ssx</a>
<a name="viscousfluxi81"></a>        <a href="viscousflux.html#viscousfluxi79" target="diffFile">ssy = ss*ssy</a>
        <a href="viscousflux.html#viscousfluxi80" target="diffFile">ssz = ss*ssz</a>
<a href="viscousflux.html#viscousfluxi81" target="diffFile"><code class="comment">! Correct the gradients.</code></a>
<a name="viscousfluxi82"></a>        <a href="viscousflux.html#viscousfluxi81" target="diffFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivx)-w(i, j, <code class="label">&</code></a>
<a name="viscousfluxi83"></a><a href="viscousflux.html#viscousfluxi81" target="diffFile"><code class="label">&          </code>k, ivx))*ss</a>
<a name="viscousfluxi84"></a>        <a href="viscousflux.html#viscousfluxi82" target="diffFile">u_x = u_x - corr*ssx</a>
<a name="viscousfluxi85"></a>        <a href="viscousflux.html#viscousfluxi83" target="diffFile">u_y = u_y - corr*ssy</a>
        <a href="viscousflux.html#viscousfluxi84" target="diffFile">u_z = u_z - corr*ssz</a>
<a name="viscousfluxi86"></a>        <a href="viscousflux.html#viscousfluxi85" target="diffFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivy)-w(i, j, <code class="label">&</code></a>
<a name="viscousfluxi87"></a><a href="viscousflux.html#viscousfluxi85" target="diffFile"><code class="label">&          </code>k, ivy))*ss</a>
<a name="viscousfluxi88"></a>        <a href="viscousflux.html#viscousfluxi86" target="diffFile">v_x = v_x - corr*ssx</a>
<a name="viscousfluxi89"></a>        <a href="viscousflux.html#viscousfluxi87" target="diffFile">v_y = v_y - corr*ssy</a>
        <a href="viscousflux.html#viscousfluxi88" target="diffFile">v_z = v_z - corr*ssz</a>
<a name="viscousfluxi90"></a>        <a href="viscousflux.html#viscousfluxi89" target="diffFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivz)-w(i, j, <code class="label">&</code></a>
<a name="viscousfluxi91"></a><a href="viscousflux.html#viscousfluxi89" target="diffFile"><code class="label">&          </code>k, ivz))*ss</a>
<a name="viscousfluxi92"></a>        <a href="viscousflux.html#viscousfluxi90" target="diffFile">w_x = w_x - corr*ssx</a>
<a name="viscousfluxi93"></a>        <a href="viscousflux.html#viscousfluxi91" target="diffFile">w_y = w_y - corr*ssy</a>
        <a href="viscousflux.html#viscousfluxi92" target="diffFile">w_z = w_z - corr*ssz</a>
<a name="viscousfluxi94"></a>        <a href="viscousflux.html#viscousfluxi93" target="diffFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j, k+<code class="constant">1</code>)-p(i, j, k))*<code class="label">&</code></a>
<a name="viscousfluxi95"></a><a href="viscousflux.html#viscousfluxi93" target="diffFile"><code class="label">&          </code>ss</a>
<a name="viscousfluxi96"></a>        <a href="viscousflux.html#viscousfluxi94" target="diffFile">q_x = q_x - corr*ssx</a>
<a name="viscousfluxi97"></a>        <a href="viscousflux.html#viscousfluxi95" target="diffFile">q_y = q_y - corr*ssy</a>
        <a href="viscousflux.html#viscousfluxi96" target="diffFile">q_z = q_z - corr*ssz</a>
<a name="viscousfluxi98"></a><a href="viscousflux.html#viscousfluxi97" target="diffFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousfluxi99"></a>        <a href="viscousflux.html#viscousfluxi97" target="diffFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousfluxi100"></a>        <a href="viscousflux.html#viscousfluxi98" target="diffFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousfluxi101"></a>        <a href="viscousflux.html#viscousfluxi99" target="diffFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousfluxi102"></a>        <a href="viscousflux.html#viscousfluxi100" target="diffFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousfluxi103"></a>        <a href="viscousflux.html#viscousfluxi101" target="diffFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousfluxi104"></a>        <a href="viscousflux.html#viscousfluxi102" target="diffFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousfluxi105"></a>        <a href="viscousflux.html#viscousfluxi103" target="diffFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousfluxi106"></a>        <a href="viscousflux.html#viscousfluxi104" target="diffFile">q_x = heatcoef*q_x</a>
<a name="viscousfluxi107"></a>        <a href="viscousflux.html#viscousfluxi105" target="diffFile">q_y = heatcoef*q_y</a>
        <a href="viscousflux.html#viscousfluxi106" target="diffFile">q_z = heatcoef*q_z</a>
<a href="viscousflux.html#viscousfluxi107" target="diffFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a name="viscousfluxi108"></a><a href="viscousflux.html#viscousfluxi107" target="diffFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousfluxi109"></a>        <a href="viscousflux.html#viscousfluxi107" target="diffFile">ubar = half*(w(i, j, <code class="constant">1</code>, ivx)+w(i, j, <code class="constant">2</code>, ivx))</a>
<a name="viscousfluxi110"></a>        <a href="viscousflux.html#viscousfluxi108" target="diffFile">vbar = half*(w(i, j, <code class="constant">1</code>, ivy)+w(i, j, <code class="constant">2</code>, ivy))</a>
        <a href="viscousflux.html#viscousfluxi109" target="diffFile">wbar = half*(w(i, j, <code class="constant">1</code>, ivz)+w(i, j, <code class="constant">2</code>, ivz))</a>
<a href="viscousflux.html#viscousfluxi110" target="diffFile"><code class="comment">! Compute the viscous fluxes for this k-face.</code></a>
<a name="viscousfluxi111"></a>        <a href="viscousflux.html#viscousfluxi110" target="diffFile">fmx = tauxx*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauxy*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauxz*sk(i, <code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi110" target="diffFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="viscousfluxi112"></a>        <a href="viscousflux.html#viscousfluxi111" target="diffFile">fmy = tauxy*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyy*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauyz*sk(i, <code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi111" target="diffFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="viscousfluxi113"></a>        <a href="viscousflux.html#viscousfluxi112" target="diffFile">fmz = tauxz*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + tauyz*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + tauzz*sk(i, <code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi112" target="diffFile"><code class="label">&          </code>j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
        <a href="viscousflux.html#viscousfluxi113" target="diffFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi113" target="diffFile"><code class="label">&          </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) + (ubar*tauxz<code class="label">&</code></a>
<a name="viscousfluxi114"></a><a href="viscousflux.html#viscousfluxi113" target="diffFile"><code class="label">&          </code>+vbar*tauyz+wbar*tauzz)*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>) - q_x*sk(i, j, <code class="constant">1</code>, <code class="constant">1</code>) - <code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi113" target="diffFile"><code class="label">&          </code>q_y*sk(i, j, <code class="constant">1</code>, <code class="constant">2</code>) - q_z*sk(i, j, <code class="constant">1</code>, <code class="constant">3</code>)</a>
<a name="viscousfluxi115"></a><a href="viscousflux.html#viscousfluxi114" target="diffFile"><code class="comment">! Update the residuals of cell k == 2.</code></a>
<a name="viscousfluxi116"></a>        <a href="viscousflux.html#viscousfluxi114" target="diffFile">fw(i, j, <code class="constant">2</code>, imx) = fw(i, j, <code class="constant">2</code>, imx) + fmx</a>
<a name="viscousfluxi117"></a>        <a href="viscousflux.html#viscousfluxi115" target="diffFile">fw(i, j, <code class="constant">2</code>, imy) = fw(i, j, <code class="constant">2</code>, imy) + fmy</a>
<a name="viscousfluxi118"></a>        <a href="viscousflux.html#viscousfluxi116" target="diffFile">fw(i, j, <code class="constant">2</code>, imz) = fw(i, j, <code class="constant">2</code>, imz) + fmz</a>
        <a href="viscousflux.html#viscousfluxi117" target="diffFile">fw(i, j, <code class="constant">2</code>, irhoe) = fw(i, j, <code class="constant">2</code>, irhoe) + frhoe</a>
<a href="viscousflux.html#viscousfluxi118" target="diffFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a name="viscousfluxi119"></a><a href="viscousflux.html#viscousfluxi118" target="diffFile"><code class="comment">! face is part of a viscous subface.</code></a>
<a name="viscousfluxi120"></a>        <a href="viscousflux.html#viscousfluxi118" target="diffFile"><code class="keyword">IF</code> (storewalltensor .AND. visckminpointer(i, j) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="viscousfluxi121"></a>          <a href="viscousflux.html#viscousfluxi119" target="diffFile">nn = visckminpointer(i, j)</a>
<a name="viscousfluxi122"></a>          <a href="viscousflux.html#viscousfluxi120" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = tauxx</a>
<a name="viscousfluxi123"></a>          <a href="viscousflux.html#viscousfluxi121" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = tauyy</a>
<a name="viscousfluxi124"></a>          <a href="viscousflux.html#viscousfluxi122" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = tauzz</a>
<a name="viscousfluxi125"></a>          <a href="viscousflux.html#viscousfluxi123" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = tauxy</a>
<a name="viscousfluxi126"></a>          <a href="viscousflux.html#viscousfluxi124" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = tauxz</a>
<a name="viscousfluxi127"></a>          <a href="viscousflux.html#viscousfluxi125" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = tauyz</a>
<a name="viscousfluxi128"></a>          <a href="viscousflux.html#viscousfluxi126" target="diffFile">viscsubface(nn)%q(i, j, <code class="constant">1</code>) = q_x</a>
          <a href="viscousflux.html#viscousfluxi127" target="diffFile">viscsubface(nn)%q(i, j, <code class="constant">2</code>) = q_y</a>
          <a href="viscousflux.html#viscousfluxi128" target="diffFile">viscsubface(nn)%q(i, j, <code class="constant">3</code>) = q_z</a>
        <a href="viscousflux.html#viscousfluxi118" target="diffFile"><code class="keyword">END IF</code></a>
<a name="viscousfluxi129"></a>      <a href="viscousflux.html#viscousfluxi48" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#viscousfluxi47" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi130"></a><a href="viscousflux.html#viscousfluxi129" target="diffFile"><code class="comment">! Loop over the k-planes.</code></a>
<a href="viscousflux.html#viscousfluxi129" target="diffFile"><code class="label">kloop:</code><code class="keyword">DO </code>k=<code class="constant">2</code>,kl</a>
<a name="viscousfluxi131"></a><a href="viscousflux.html#viscousfluxi130" target="diffFile"><code class="comment">! Switch the indices k1 and k2.</code></a>
<a name="viscousfluxi132"></a>      <a href="viscousflux.html#viscousfluxi130" target="diffFile">kk = k1</a>
<a name="viscousfluxi133"></a>      <a href="viscousflux.html#viscousfluxi131" target="diffFile">k1 = k2</a>
      <a href="viscousflux.html#viscousfluxi132" target="diffFile">k2 = kk</a>
<a href="viscousflux.html#viscousfluxi133" target="diffFile"><code class="comment">! Compute the nodal gradients for the nodes in this k-plane.</code></a>
<a href="viscousflux.html#viscousfluxi133" target="diffFile"><code class="comment">! The results are stored in ux(:,:,k1), etc.</code></a>
<a name="viscousfluxi134"></a>      <a href="viscousflux.html#viscousfluxi133" target="diffFile"><code class="keyword">CALL </code><code class="funcname">NODALGRADIENTS</code>(ux, uy, uz, vx, vy, vz, wx, wy, wz, qx, qy, qz<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi133" target="diffFile"><code class="label">&                   </code>)</a>
<a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="comment">!        * Viscous fluxes in the k-direction.                           *</code></a>
<a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a name="viscousfluxi135"></a><a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="comment">!</code></a>
<a name="viscousfluxi136"></a>      <a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="viscousflux.html#viscousfluxi135" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux.html#viscousfluxi136" target="diffFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux.html#viscousfluxi136" target="diffFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousfluxi138"></a><a name="viscousfluxi137"></a><a href="viscousflux.html#viscousfluxi136" target="diffFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousfluxi139"></a>          <a href="viscousflux.html#viscousfluxi136" target="diffFile">por = half*rfilv</a>
          <a href="viscousflux.html#viscousfluxi137" target="diffFile"><code class="keyword">IF</code> (pork(i, j, k) .EQ. noflux) </a><a href="viscousflux.html#viscousfluxi138" target="diffFile">por = zero</a>
<a href="viscousflux.html#viscousfluxi139" target="diffFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux.html#viscousfluxi139" target="diffFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux.html#viscousfluxi139" target="diffFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousfluxi141"></a><a name="viscousfluxi140"></a><a href="viscousflux.html#viscousfluxi139" target="diffFile"><code class="comment">! flux.</code></a>
<a name="viscousfluxi142"></a>          <a href="viscousflux.html#viscousfluxi139" target="diffFile">mul = por*(rlv(i, j, k)+rlv(i, j, k+<code class="constant">1</code>))</a>
<a name="viscousfluxi143"></a>          <a href="viscousflux.html#viscousfluxi140" target="diffFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux.html#viscousfluxi141" target="diffFile">mue = por*(rev(i, j, k)+rev(i, j, k+<code class="constant">1</code>))</a>
<a name="viscousfluxi144"></a>          <a href="viscousflux.html#viscousfluxi142" target="diffFile">mut = mul + mue</a>
<a name="viscousfluxi145"></a>          <a href="viscousflux.html#viscousfluxi143" target="diffFile">gm1 = half*(gamma(i, j, k)+gamma(i, j, k+<code class="constant">1</code>)) - one</a>
<a name="viscousfluxi146"></a>          <a href="viscousflux.html#viscousfluxi144" target="diffFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousfluxi147"></a>          <a href="viscousflux.html#viscousfluxi145" target="diffFile">factturbheat = one/(prandtlturb*gm1)</a>
          <a href="viscousflux.html#viscousfluxi146" target="diffFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux.html#viscousfluxi147" target="diffFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux.html#viscousfluxi147" target="diffFile"><code class="comment">! nodal values.</code></a>
<a name="viscousfluxi148"></a>          <a href="viscousflux.html#viscousfluxi147" target="diffFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+ux(i, j-<code class="constant">1</code>, k1)+ux(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi147" target="diffFile"><code class="label">&            </code>ux(i, j, k1))</a>
<a name="viscousfluxi149"></a>          <a href="viscousflux.html#viscousfluxi148" target="diffFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uy(i, j-<code class="constant">1</code>, k1)+uy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi148" target="diffFile"><code class="label">&            </code>uy(i, j, k1))</a>
<a name="viscousfluxi150"></a>          <a href="viscousflux.html#viscousfluxi149" target="diffFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+uz(i, j-<code class="constant">1</code>, k1)+uz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi149" target="diffFile"><code class="label">&            </code>uz(i, j, k1))</a>
<a name="viscousfluxi151"></a>          <a href="viscousflux.html#viscousfluxi150" target="diffFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vx(i, j-<code class="constant">1</code>, k1)+vx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi150" target="diffFile"><code class="label">&            </code>vx(i, j, k1))</a>
<a name="viscousfluxi152"></a>          <a href="viscousflux.html#viscousfluxi151" target="diffFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vy(i, j-<code class="constant">1</code>, k1)+vy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi151" target="diffFile"><code class="label">&            </code>vy(i, j, k1))</a>
<a name="viscousfluxi153"></a>          <a href="viscousflux.html#viscousfluxi152" target="diffFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+vz(i, j-<code class="constant">1</code>, k1)+vz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi152" target="diffFile"><code class="label">&            </code>vz(i, j, k1))</a>
<a name="viscousfluxi154"></a>          <a href="viscousflux.html#viscousfluxi153" target="diffFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wx(i, j-<code class="constant">1</code>, k1)+wx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi153" target="diffFile"><code class="label">&            </code>wx(i, j, k1))</a>
<a name="viscousfluxi155"></a>          <a href="viscousflux.html#viscousfluxi154" target="diffFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wy(i, j-<code class="constant">1</code>, k1)+wy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi154" target="diffFile"><code class="label">&            </code>wy(i, j, k1))</a>
<a name="viscousfluxi156"></a>          <a href="viscousflux.html#viscousfluxi155" target="diffFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+wz(i, j-<code class="constant">1</code>, k1)+wz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi155" target="diffFile"><code class="label">&            </code>wz(i, j, k1))</a>
<a name="viscousfluxi157"></a>          <a href="viscousflux.html#viscousfluxi156" target="diffFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qx(i, j-<code class="constant">1</code>, k1)+qx(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi156" target="diffFile"><code class="label">&            </code>qx(i, j, k1))</a>
<a name="viscousfluxi158"></a>          <a href="viscousflux.html#viscousfluxi157" target="diffFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qy(i, j-<code class="constant">1</code>, k1)+qy(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi157" target="diffFile"><code class="label">&            </code>qy(i, j, k1))</a>
<a name="viscousfluxi159"></a>          <a href="viscousflux.html#viscousfluxi158" target="diffFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k1)+qz(i, j-<code class="constant">1</code>, k1)+qz(i-<code class="constant">1</code>, j, k1)+<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi158" target="diffFile"><code class="label">&            </code>qz(i, j, k1))</a>
<a href="viscousflux.html#viscousfluxi159" target="diffFile"><code class="comment">!!$             write(unitvf,*) i,j,k, u_x, u_y, u_z</code></a>
<a href="viscousflux.html#viscousfluxi159" target="diffFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux.html#viscousfluxi159" target="diffFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux.html#viscousfluxi159" target="diffFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux.html#viscousfluxi159" target="diffFile"><code class="comment">! cell center k to cell center k+1.</code></a>
          <a href="viscousflux.html#viscousfluxi159" target="diffFile">ssx = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi160"></a><a href="viscousflux.html#viscousfluxi159" target="diffFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi159" target="diffFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>))</a>
          <a href="viscousflux.html#viscousfluxi160" target="diffFile">ssy = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi161"></a><a href="viscousflux.html#viscousfluxi160" target="diffFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi160" target="diffFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>))</a>
          <a href="viscousflux.html#viscousfluxi161" target="diffFile">ssz = eighth*(x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi162"></a><a href="viscousflux.html#viscousfluxi161" target="diffFile"><code class="label">&            </code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi161" target="diffFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>))</a>
<a href="viscousflux.html#viscousfluxi162" target="diffFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a name="viscousfluxi163"></a><a href="viscousflux.html#viscousfluxi162" target="diffFile"><code class="comment">! unit normal.</code></a>
<a name="viscousfluxi164"></a>          <a href="viscousflux.html#viscousfluxi162" target="diffFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
<a name="viscousfluxi165"></a>          <a href="viscousflux.html#viscousfluxi163" target="diffFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousfluxi166"></a>          <a href="viscousflux.html#viscousfluxi164" target="diffFile">ss = one/result1</a>
<a name="viscousfluxi167"></a>          <a href="viscousflux.html#viscousfluxi165" target="diffFile">ssx = ss*ssx</a>
<a name="viscousfluxi168"></a>          <a href="viscousflux.html#viscousfluxi166" target="diffFile">ssy = ss*ssy</a>
          <a href="viscousflux.html#viscousfluxi167" target="diffFile">ssz = ss*ssz</a>
<a href="viscousflux.html#viscousfluxi168" target="diffFile"><code class="comment">! Correct the gradients.</code></a>
<a name="viscousfluxi169"></a>          <a href="viscousflux.html#viscousfluxi168" target="diffFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivx)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi170"></a><a href="viscousflux.html#viscousfluxi168" target="diffFile"><code class="label">&            </code>, k, ivx))*ss</a>
<a name="viscousfluxi171"></a>          <a href="viscousflux.html#viscousfluxi169" target="diffFile">u_x = u_x - corr*ssx</a>
<a name="viscousfluxi172"></a>          <a href="viscousflux.html#viscousfluxi170" target="diffFile">u_y = u_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi171" target="diffFile">u_z = u_z - corr*ssz</a>
<a name="viscousfluxi173"></a>          <a href="viscousflux.html#viscousfluxi172" target="diffFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivy)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi174"></a><a href="viscousflux.html#viscousfluxi172" target="diffFile"><code class="label">&            </code>, k, ivy))*ss</a>
<a name="viscousfluxi175"></a>          <a href="viscousflux.html#viscousfluxi173" target="diffFile">v_x = v_x - corr*ssx</a>
<a name="viscousfluxi176"></a>          <a href="viscousflux.html#viscousfluxi174" target="diffFile">v_y = v_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi175" target="diffFile">v_z = v_z - corr*ssz</a>
<a name="viscousfluxi177"></a>          <a href="viscousflux.html#viscousfluxi176" target="diffFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j, k+<code class="constant">1</code>, ivz)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi178"></a><a href="viscousflux.html#viscousfluxi176" target="diffFile"><code class="label">&            </code>, k, ivz))*ss</a>
<a name="viscousfluxi179"></a>          <a href="viscousflux.html#viscousfluxi177" target="diffFile">w_x = w_x - corr*ssx</a>
<a name="viscousfluxi180"></a>          <a href="viscousflux.html#viscousfluxi178" target="diffFile">w_y = w_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi179" target="diffFile">w_z = w_z - corr*ssz</a>
<a name="viscousfluxi181"></a>          <a href="viscousflux.html#viscousfluxi180" target="diffFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j, k+<code class="constant">1</code>)-p(i, j, k))<code class="label">&</code></a>
<a name="viscousfluxi182"></a><a href="viscousflux.html#viscousfluxi180" target="diffFile"><code class="label">&            </code>*ss</a>
<a name="viscousfluxi183"></a>          <a href="viscousflux.html#viscousfluxi181" target="diffFile">q_x = q_x - corr*ssx</a>
<a name="viscousfluxi184"></a>          <a href="viscousflux.html#viscousfluxi182" target="diffFile">q_y = q_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi183" target="diffFile">q_z = q_z - corr*ssz</a>
<a name="viscousfluxi185"></a><a href="viscousflux.html#viscousfluxi184" target="diffFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousfluxi186"></a>          <a href="viscousflux.html#viscousfluxi184" target="diffFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousfluxi187"></a>          <a href="viscousflux.html#viscousfluxi185" target="diffFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousfluxi188"></a>          <a href="viscousflux.html#viscousfluxi186" target="diffFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousfluxi189"></a>          <a href="viscousflux.html#viscousfluxi187" target="diffFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousfluxi190"></a>          <a href="viscousflux.html#viscousfluxi188" target="diffFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousfluxi191"></a>          <a href="viscousflux.html#viscousfluxi189" target="diffFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousfluxi192"></a>          <a href="viscousflux.html#viscousfluxi190" target="diffFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousfluxi193"></a>          <a href="viscousflux.html#viscousfluxi191" target="diffFile">q_x = heatcoef*q_x</a>
<a name="viscousfluxi194"></a>          <a href="viscousflux.html#viscousfluxi192" target="diffFile">q_y = heatcoef*q_y</a>
          <a href="viscousflux.html#viscousfluxi193" target="diffFile">q_z = heatcoef*q_z</a>
<a href="viscousflux.html#viscousfluxi194" target="diffFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a name="viscousfluxi195"></a><a href="viscousflux.html#viscousfluxi194" target="diffFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousfluxi196"></a>          <a href="viscousflux.html#viscousfluxi194" target="diffFile">ubar = half*(w(i, j, k, ivx)+w(i, j, k+<code class="constant">1</code>, ivx))</a>
<a name="viscousfluxi197"></a>          <a href="viscousflux.html#viscousfluxi195" target="diffFile">vbar = half*(w(i, j, k, ivy)+w(i, j, k+<code class="constant">1</code>, ivy))</a>
          <a href="viscousflux.html#viscousfluxi196" target="diffFile">wbar = half*(w(i, j, k, ivz)+w(i, j, k+<code class="constant">1</code>, ivz))</a>
<a href="viscousflux.html#viscousfluxi197" target="diffFile"><code class="comment">! Compute the viscous fluxes for this k-face.</code></a>
<a name="viscousfluxi198"></a>          <a href="viscousflux.html#viscousfluxi197" target="diffFile">fmx = tauxx*sk(i, j, k, <code class="constant">1</code>) + tauxy*sk(i, j, k, <code class="constant">2</code>) + tauxz*sk(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi197" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi199"></a>          <a href="viscousflux.html#viscousfluxi198" target="diffFile">fmy = tauxy*sk(i, j, k, <code class="constant">1</code>) + tauyy*sk(i, j, k, <code class="constant">2</code>) + tauyz*sk(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi198" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi200"></a>          <a href="viscousflux.html#viscousfluxi199" target="diffFile">fmz = tauxz*sk(i, j, k, <code class="constant">1</code>) + tauyz*sk(i, j, k, <code class="constant">2</code>) + tauzz*sk(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi199" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux.html#viscousfluxi200" target="diffFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sk(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi200" target="diffFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sk(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a name="viscousfluxi201"></a><a href="viscousflux.html#viscousfluxi200" target="diffFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*sk(i, j, k, <code class="constant">3</code>) - q_x*sk(i, j, k<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi200" target="diffFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*sk(i, j, k, <code class="constant">2</code>) - q_z*sk(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi202"></a><a href="viscousflux.html#viscousfluxi201" target="diffFile"><code class="comment">! Update the residuals of cell k and k+1.</code></a>
<a name="viscousfluxi203"></a>          <a href="viscousflux.html#viscousfluxi201" target="diffFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
<a name="viscousfluxi204"></a>          <a href="viscousflux.html#viscousfluxi202" target="diffFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
<a name="viscousfluxi205"></a>          <a href="viscousflux.html#viscousfluxi203" target="diffFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
<a name="viscousfluxi206"></a>          <a href="viscousflux.html#viscousfluxi204" target="diffFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
<a name="viscousfluxi207"></a>          <a href="viscousflux.html#viscousfluxi205" target="diffFile">fw(i, j, k+<code class="constant">1</code>, imx) = fw(i, j, k+<code class="constant">1</code>, imx) + fmx</a>
<a name="viscousfluxi208"></a>          <a href="viscousflux.html#viscousfluxi206" target="diffFile">fw(i, j, k+<code class="constant">1</code>, imy) = fw(i, j, k+<code class="constant">1</code>, imy) + fmy</a>
<a name="viscousfluxi209"></a>          <a href="viscousflux.html#viscousfluxi207" target="diffFile">fw(i, j, k+<code class="constant">1</code>, imz) = fw(i, j, k+<code class="constant">1</code>, imz) + fmz</a>
          <a href="viscousflux.html#viscousfluxi208" target="diffFile">fw(i, j, k+<code class="constant">1</code>, irhoe) = fw(i, j, k+<code class="constant">1</code>, irhoe) + frhoe</a>
<a href="viscousflux.html#viscousfluxi209" target="diffFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux.html#viscousfluxi209" target="diffFile"><code class="comment">! face is part of a viscous subface.</code></a>
<a name="viscousfluxi210"></a>          <a href="viscousflux.html#viscousfluxi209" target="diffFile"><code class="keyword">IF</code> (k .EQ. kl .AND. storewalltensor .AND. visckmaxpointer(i, j<code class="label">&</code></a>
<a name="viscousfluxi211"></a><a href="viscousflux.html#viscousfluxi209" target="diffFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="viscousfluxi212"></a>            <a href="viscousflux.html#viscousfluxi210" target="diffFile">nn = visckmaxpointer(i, j)</a>
<a name="viscousfluxi213"></a>            <a href="viscousflux.html#viscousfluxi211" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">1</code>) = tauxx</a>
<a name="viscousfluxi214"></a>            <a href="viscousflux.html#viscousfluxi212" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">2</code>) = tauyy</a>
<a name="viscousfluxi215"></a>            <a href="viscousflux.html#viscousfluxi213" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">3</code>) = tauzz</a>
<a name="viscousfluxi216"></a>            <a href="viscousflux.html#viscousfluxi214" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">4</code>) = tauxy</a>
<a name="viscousfluxi217"></a>            <a href="viscousflux.html#viscousfluxi215" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">5</code>) = tauxz</a>
<a name="viscousfluxi218"></a>            <a href="viscousflux.html#viscousfluxi216" target="diffFile">viscsubface(nn)%tau(i, j, <code class="constant">6</code>) = tauyz</a>
<a name="viscousfluxi219"></a>            <a href="viscousflux.html#viscousfluxi217" target="diffFile">viscsubface(nn)%q(i, j, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux.html#viscousfluxi218" target="diffFile">viscsubface(nn)%q(i, j, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux.html#viscousfluxi219" target="diffFile">viscsubface(nn)%q(i, j, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux.html#viscousfluxi209" target="diffFile"><code class="keyword">END IF</code></a>
<a name="viscousfluxi220"></a>        <a href="viscousflux.html#viscousfluxi135" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux.html#viscousfluxi134" target="diffFile"><code class="keyword">END DO</code></a>
<a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="comment">!        * Viscous fluxes in the j-direction.                           *</code></a>
<a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a name="viscousfluxi221"></a><a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="comment">!</code></a>
<a name="viscousfluxi222"></a>      <a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
        <a href="viscousflux.html#viscousfluxi221" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">2</code>,il</a>
<a href="viscousflux.html#viscousfluxi222" target="diffFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux.html#viscousfluxi222" target="diffFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousfluxi224"></a><a name="viscousfluxi223"></a><a href="viscousflux.html#viscousfluxi222" target="diffFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousfluxi225"></a>          <a href="viscousflux.html#viscousfluxi222" target="diffFile">por = half*rfilv</a>
          <a href="viscousflux.html#viscousfluxi223" target="diffFile"><code class="keyword">IF</code> (porj(i, j, k) .EQ. noflux) </a><a href="viscousflux.html#viscousfluxi224" target="diffFile">por = zero</a>
<a href="viscousflux.html#viscousfluxi225" target="diffFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux.html#viscousfluxi225" target="diffFile"><code class="comment">! multiplied by the porosity. Compute the factor in front of</code></a>
<a href="viscousflux.html#viscousfluxi225" target="diffFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousfluxi227"></a><a name="viscousfluxi226"></a><a href="viscousflux.html#viscousfluxi225" target="diffFile"><code class="comment">! flux.</code></a>
<a name="viscousfluxi228"></a>          <a href="viscousflux.html#viscousfluxi225" target="diffFile">mul = por*(rlv(i, j, k)+rlv(i, j+<code class="constant">1</code>, k))</a>
<a name="viscousfluxi229"></a>          <a href="viscousflux.html#viscousfluxi226" target="diffFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux.html#viscousfluxi227" target="diffFile">mue = por*(rev(i, j, k)+rev(i, j+<code class="constant">1</code>, k))</a>
<a name="viscousfluxi230"></a>          <a href="viscousflux.html#viscousfluxi228" target="diffFile">mut = mul + mue</a>
<a name="viscousfluxi231"></a>          <a href="viscousflux.html#viscousfluxi229" target="diffFile">gm1 = half*(gamma(i, j, k)+gamma(i, j+<code class="constant">1</code>, k)) - one</a>
<a name="viscousfluxi232"></a>          <a href="viscousflux.html#viscousfluxi230" target="diffFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousfluxi233"></a>          <a href="viscousflux.html#viscousfluxi231" target="diffFile">factturbheat = one/(prandtlturb*gm1)</a>
          <a href="viscousflux.html#viscousfluxi232" target="diffFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux.html#viscousfluxi233" target="diffFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux.html#viscousfluxi233" target="diffFile"><code class="comment">! nodal values.</code></a>
<a name="viscousfluxi234"></a>          <a href="viscousflux.html#viscousfluxi233" target="diffFile">u_x = fourth*(ux(i-<code class="constant">1</code>, j, k1)+ux(i, j, k1)+ux(i-<code class="constant">1</code>, j, k2)+ux(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi233" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi235"></a>          <a href="viscousflux.html#viscousfluxi234" target="diffFile">u_y = fourth*(uy(i-<code class="constant">1</code>, j, k1)+uy(i, j, k1)+uy(i-<code class="constant">1</code>, j, k2)+uy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi234" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi236"></a>          <a href="viscousflux.html#viscousfluxi235" target="diffFile">u_z = fourth*(uz(i-<code class="constant">1</code>, j, k1)+uz(i, j, k1)+uz(i-<code class="constant">1</code>, j, k2)+uz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi235" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi237"></a>          <a href="viscousflux.html#viscousfluxi236" target="diffFile">v_x = fourth*(vx(i-<code class="constant">1</code>, j, k1)+vx(i, j, k1)+vx(i-<code class="constant">1</code>, j, k2)+vx(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi236" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi238"></a>          <a href="viscousflux.html#viscousfluxi237" target="diffFile">v_y = fourth*(vy(i-<code class="constant">1</code>, j, k1)+vy(i, j, k1)+vy(i-<code class="constant">1</code>, j, k2)+vy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi237" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi239"></a>          <a href="viscousflux.html#viscousfluxi238" target="diffFile">v_z = fourth*(vz(i-<code class="constant">1</code>, j, k1)+vz(i, j, k1)+vz(i-<code class="constant">1</code>, j, k2)+vz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi238" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi240"></a>          <a href="viscousflux.html#viscousfluxi239" target="diffFile">w_x = fourth*(wx(i-<code class="constant">1</code>, j, k1)+wx(i, j, k1)+wx(i-<code class="constant">1</code>, j, k2)+wx(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi239" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi241"></a>          <a href="viscousflux.html#viscousfluxi240" target="diffFile">w_y = fourth*(wy(i-<code class="constant">1</code>, j, k1)+wy(i, j, k1)+wy(i-<code class="constant">1</code>, j, k2)+wy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi240" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi242"></a>          <a href="viscousflux.html#viscousfluxi241" target="diffFile">w_z = fourth*(wz(i-<code class="constant">1</code>, j, k1)+wz(i, j, k1)+wz(i-<code class="constant">1</code>, j, k2)+wz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi241" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi243"></a>          <a href="viscousflux.html#viscousfluxi242" target="diffFile">q_x = fourth*(qx(i-<code class="constant">1</code>, j, k1)+qx(i, j, k1)+qx(i-<code class="constant">1</code>, j, k2)+qx(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi242" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi244"></a>          <a href="viscousflux.html#viscousfluxi243" target="diffFile">q_y = fourth*(qy(i-<code class="constant">1</code>, j, k1)+qy(i, j, k1)+qy(i-<code class="constant">1</code>, j, k2)+qy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi243" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi245"></a>          <a href="viscousflux.html#viscousfluxi244" target="diffFile">q_z = fourth*(qz(i-<code class="constant">1</code>, j, k1)+qz(i, j, k1)+qz(i-<code class="constant">1</code>, j, k2)+qz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi244" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a href="viscousflux.html#viscousfluxi245" target="diffFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux.html#viscousfluxi245" target="diffFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux.html#viscousfluxi245" target="diffFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux.html#viscousfluxi245" target="diffFile"><code class="comment">! cell center j to cell center j+1.</code></a>
          <a href="viscousflux.html#viscousfluxi245" target="diffFile">ssx = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi246"></a><a href="viscousflux.html#viscousfluxi245" target="diffFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi245" target="diffFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>))</a>
          <a href="viscousflux.html#viscousfluxi246" target="diffFile">ssy = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi247"></a><a href="viscousflux.html#viscousfluxi246" target="diffFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi246" target="diffFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>))</a>
          <a href="viscousflux.html#viscousfluxi247" target="diffFile">ssz = eighth*(x(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i-<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi248"></a><a href="viscousflux.html#viscousfluxi247" target="diffFile"><code class="label">&            </code>+<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+x(i, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi247" target="diffFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>))</a>
<a href="viscousflux.html#viscousfluxi248" target="diffFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a name="viscousfluxi249"></a><a href="viscousflux.html#viscousfluxi248" target="diffFile"><code class="comment">! unit normal.</code></a>
<a name="viscousfluxi250"></a>          <a href="viscousflux.html#viscousfluxi248" target="diffFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
<a name="viscousfluxi251"></a>          <a href="viscousflux.html#viscousfluxi249" target="diffFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousfluxi252"></a>          <a href="viscousflux.html#viscousfluxi250" target="diffFile">ss = one/result1</a>
<a name="viscousfluxi253"></a>          <a href="viscousflux.html#viscousfluxi251" target="diffFile">ssx = ss*ssx</a>
<a name="viscousfluxi254"></a>          <a href="viscousflux.html#viscousfluxi252" target="diffFile">ssy = ss*ssy</a>
          <a href="viscousflux.html#viscousfluxi253" target="diffFile">ssz = ss*ssz</a>
<a href="viscousflux.html#viscousfluxi254" target="diffFile"><code class="comment">! Correct the gradients.</code></a>
<a name="viscousfluxi255"></a>          <a href="viscousflux.html#viscousfluxi254" target="diffFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivx)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi256"></a><a href="viscousflux.html#viscousfluxi254" target="diffFile"><code class="label">&            </code>, k, ivx))*ss</a>
<a name="viscousfluxi257"></a>          <a href="viscousflux.html#viscousfluxi255" target="diffFile">u_x = u_x - corr*ssx</a>
<a name="viscousfluxi258"></a>          <a href="viscousflux.html#viscousfluxi256" target="diffFile">u_y = u_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi257" target="diffFile">u_z = u_z - corr*ssz</a>
<a name="viscousfluxi259"></a>          <a href="viscousflux.html#viscousfluxi258" target="diffFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivy)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi260"></a><a href="viscousflux.html#viscousfluxi258" target="diffFile"><code class="label">&            </code>, k, ivy))*ss</a>
<a name="viscousfluxi261"></a>          <a href="viscousflux.html#viscousfluxi259" target="diffFile">v_x = v_x - corr*ssx</a>
<a name="viscousfluxi262"></a>          <a href="viscousflux.html#viscousfluxi260" target="diffFile">v_y = v_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi261" target="diffFile">v_z = v_z - corr*ssz</a>
<a name="viscousfluxi263"></a>          <a href="viscousflux.html#viscousfluxi262" target="diffFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i, j+<code class="constant">1</code>, k, ivz)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi264"></a><a href="viscousflux.html#viscousfluxi262" target="diffFile"><code class="label">&            </code>, k, ivz))*ss</a>
<a name="viscousfluxi265"></a>          <a href="viscousflux.html#viscousfluxi263" target="diffFile">w_x = w_x - corr*ssx</a>
<a name="viscousfluxi266"></a>          <a href="viscousflux.html#viscousfluxi264" target="diffFile">w_y = w_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi265" target="diffFile">w_z = w_z - corr*ssz</a>
<a name="viscousfluxi267"></a>          <a href="viscousflux.html#viscousfluxi266" target="diffFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i, j+<code class="constant">1</code>, k)-p(i, j, k))<code class="label">&</code></a>
<a name="viscousfluxi268"></a><a href="viscousflux.html#viscousfluxi266" target="diffFile"><code class="label">&            </code>*ss</a>
<a name="viscousfluxi269"></a>          <a href="viscousflux.html#viscousfluxi267" target="diffFile">q_x = q_x - corr*ssx</a>
<a name="viscousfluxi270"></a>          <a href="viscousflux.html#viscousfluxi268" target="diffFile">q_y = q_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi269" target="diffFile">q_z = q_z - corr*ssz</a>
<a name="viscousfluxi271"></a><a href="viscousflux.html#viscousfluxi270" target="diffFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousfluxi272"></a>          <a href="viscousflux.html#viscousfluxi270" target="diffFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousfluxi273"></a>          <a href="viscousflux.html#viscousfluxi271" target="diffFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousfluxi274"></a>          <a href="viscousflux.html#viscousfluxi272" target="diffFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousfluxi275"></a>          <a href="viscousflux.html#viscousfluxi273" target="diffFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousfluxi276"></a>          <a href="viscousflux.html#viscousfluxi274" target="diffFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousfluxi277"></a>          <a href="viscousflux.html#viscousfluxi275" target="diffFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousfluxi278"></a>          <a href="viscousflux.html#viscousfluxi276" target="diffFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousfluxi279"></a>          <a href="viscousflux.html#viscousfluxi277" target="diffFile">q_x = heatcoef*q_x</a>
<a name="viscousfluxi280"></a>          <a href="viscousflux.html#viscousfluxi278" target="diffFile">q_y = heatcoef*q_y</a>
          <a href="viscousflux.html#viscousfluxi279" target="diffFile">q_z = heatcoef*q_z</a>
<a href="viscousflux.html#viscousfluxi280" target="diffFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a name="viscousfluxi281"></a><a href="viscousflux.html#viscousfluxi280" target="diffFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousfluxi282"></a>          <a href="viscousflux.html#viscousfluxi280" target="diffFile">ubar = half*(w(i, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, ivx))</a>
<a name="viscousfluxi283"></a>          <a href="viscousflux.html#viscousfluxi281" target="diffFile">vbar = half*(w(i, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, ivy))</a>
          <a href="viscousflux.html#viscousfluxi282" target="diffFile">wbar = half*(w(i, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, ivz))</a>
<a href="viscousflux.html#viscousfluxi283" target="diffFile"><code class="comment">! Compute the viscous fluxes for this j-face.</code></a>
<a name="viscousfluxi284"></a>          <a href="viscousflux.html#viscousfluxi283" target="diffFile">fmx = tauxx*sj(i, j, k, <code class="constant">1</code>) + tauxy*sj(i, j, k, <code class="constant">2</code>) + tauxz*sj(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi283" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi285"></a>          <a href="viscousflux.html#viscousfluxi284" target="diffFile">fmy = tauxy*sj(i, j, k, <code class="constant">1</code>) + tauyy*sj(i, j, k, <code class="constant">2</code>) + tauyz*sj(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi284" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi286"></a>          <a href="viscousflux.html#viscousfluxi285" target="diffFile">fmz = tauxz*sj(i, j, k, <code class="constant">1</code>) + tauyz*sj(i, j, k, <code class="constant">2</code>) + tauzz*sj(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi285" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux.html#viscousfluxi286" target="diffFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*sj(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi286" target="diffFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*sj(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a name="viscousfluxi287"></a><a href="viscousflux.html#viscousfluxi286" target="diffFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*sj(i, j, k, <code class="constant">3</code>) - q_x*sj(i, j, k<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi286" target="diffFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*sj(i, j, k, <code class="constant">2</code>) - q_z*sj(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi288"></a><a href="viscousflux.html#viscousfluxi287" target="diffFile"><code class="comment">! Update the residuals of cell j and j+1.</code></a>
<a name="viscousfluxi289"></a>          <a href="viscousflux.html#viscousfluxi287" target="diffFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
<a name="viscousfluxi290"></a>          <a href="viscousflux.html#viscousfluxi288" target="diffFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
<a name="viscousfluxi291"></a>          <a href="viscousflux.html#viscousfluxi289" target="diffFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
<a name="viscousfluxi292"></a>          <a href="viscousflux.html#viscousfluxi290" target="diffFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
<a name="viscousfluxi293"></a>          <a href="viscousflux.html#viscousfluxi291" target="diffFile">fw(i, j+<code class="constant">1</code>, k, imx) = fw(i, j+<code class="constant">1</code>, k, imx) + fmx</a>
<a name="viscousfluxi294"></a>          <a href="viscousflux.html#viscousfluxi292" target="diffFile">fw(i, j+<code class="constant">1</code>, k, imy) = fw(i, j+<code class="constant">1</code>, k, imy) + fmy</a>
<a name="viscousfluxi295"></a>          <a href="viscousflux.html#viscousfluxi293" target="diffFile">fw(i, j+<code class="constant">1</code>, k, imz) = fw(i, j+<code class="constant">1</code>, k, imz) + fmz</a>
          <a href="viscousflux.html#viscousfluxi294" target="diffFile">fw(i, j+<code class="constant">1</code>, k, irhoe) = fw(i, j+<code class="constant">1</code>, k, irhoe) + frhoe</a>
<a href="viscousflux.html#viscousfluxi295" target="diffFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux.html#viscousfluxi295" target="diffFile"><code class="comment">! face is part of a viscous subface. Both the cases j == 1</code></a>
<a href="viscousflux.html#viscousfluxi295" target="diffFile"><code class="comment">! and j == jl must be tested.</code></a>
<a name="viscousfluxi296"></a>          <a href="viscousflux.html#viscousfluxi295" target="diffFile"><code class="keyword">IF</code> (j .EQ. <code class="constant">1 </code>.AND. storewalltensor .AND. viscjminpointer(i, k)<code class="label">&</code></a>
<a name="viscousfluxi297"></a><a href="viscousflux.html#viscousfluxi295" target="diffFile"><code class="label">&              </code>.GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="viscousfluxi298"></a>            <a href="viscousflux.html#viscousfluxi296" target="diffFile">nn = viscjminpointer(i, k)</a>
<a name="viscousfluxi299"></a>            <a href="viscousflux.html#viscousfluxi297" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousfluxi300"></a>            <a href="viscousflux.html#viscousfluxi298" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousfluxi301"></a>            <a href="viscousflux.html#viscousfluxi299" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousfluxi302"></a>            <a href="viscousflux.html#viscousfluxi300" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousfluxi303"></a>            <a href="viscousflux.html#viscousfluxi301" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousfluxi304"></a>            <a href="viscousflux.html#viscousfluxi302" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousfluxi305"></a>            <a href="viscousflux.html#viscousfluxi303" target="diffFile">viscsubface(nn)%q(i, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux.html#viscousfluxi304" target="diffFile">viscsubface(nn)%q(i, k, <code class="constant">2</code>) = q_y</a>
<a name="viscousfluxi306"></a>            <a href="viscousflux.html#viscousfluxi305" target="diffFile">viscsubface(nn)%q(i, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux.html#viscousfluxi295" target="diffFile"><code class="keyword">END IF</code></a>
<a href="viscousflux.html#viscousfluxi306" target="diffFile"><code class="comment">! And the j == jl case.</code></a>
<a name="viscousfluxi307"></a>          <a href="viscousflux.html#viscousfluxi306" target="diffFile"><code class="keyword">IF</code> (j .EQ. jl .AND. storewalltensor .AND. viscjmaxpointer(i, k<code class="label">&</code></a>
<a name="viscousfluxi308"></a><a href="viscousflux.html#viscousfluxi306" target="diffFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="viscousfluxi309"></a>            <a href="viscousflux.html#viscousfluxi307" target="diffFile">nn = viscjmaxpointer(i, k)</a>
<a name="viscousfluxi310"></a>            <a href="viscousflux.html#viscousfluxi308" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousfluxi311"></a>            <a href="viscousflux.html#viscousfluxi309" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousfluxi312"></a>            <a href="viscousflux.html#viscousfluxi310" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousfluxi313"></a>            <a href="viscousflux.html#viscousfluxi311" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousfluxi314"></a>            <a href="viscousflux.html#viscousfluxi312" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousfluxi315"></a>            <a href="viscousflux.html#viscousfluxi313" target="diffFile">viscsubface(nn)%tau(i, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousfluxi316"></a>            <a href="viscousflux.html#viscousfluxi314" target="diffFile">viscsubface(nn)%q(i, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux.html#viscousfluxi315" target="diffFile">viscsubface(nn)%q(i, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux.html#viscousfluxi316" target="diffFile">viscsubface(nn)%q(i, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux.html#viscousfluxi306" target="diffFile"><code class="keyword">END IF</code></a>
<a name="viscousfluxi317"></a>        <a href="viscousflux.html#viscousfluxi221" target="diffFile"><code class="keyword">END DO</code></a>
      <a href="viscousflux.html#viscousfluxi220" target="diffFile"><code class="keyword">END DO</code></a>
<a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="comment">!        * Viscous fluxes in the i-direction.                           *</code></a>
<a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a name="viscousfluxi318"></a><a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="comment">!</code></a>
<a name="viscousfluxi319"></a>      <a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">2</code>,jl</a>
        <a href="viscousflux.html#viscousfluxi318" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux.html#viscousfluxi319" target="diffFile"><code class="comment">! Set the value of the porosity. If not zero, it is set</code></a>
<a href="viscousflux.html#viscousfluxi319" target="diffFile"><code class="comment">! to average the eddy-viscosity and to take the factor</code></a>
<a name="viscousfluxi321"></a><a name="viscousfluxi320"></a><a href="viscousflux.html#viscousfluxi319" target="diffFile"><code class="comment">! rFilv into account.</code></a>
<a name="viscousfluxi322"></a>          <a href="viscousflux.html#viscousfluxi319" target="diffFile">por = half*rfilv</a>
          <a href="viscousflux.html#viscousfluxi320" target="diffFile"><code class="keyword">IF</code> (pori(i, j, k) .EQ. noflux) </a><a href="viscousflux.html#viscousfluxi321" target="diffFile">por = zero</a>
<a href="viscousflux.html#viscousfluxi322" target="diffFile"><code class="comment">! Compute the laminar and (if present) the eddy viscosities</code></a>
<a href="viscousflux.html#viscousfluxi322" target="diffFile"><code class="comment">! multiplied the porosity. Compute the factor in front of</code></a>
<a href="viscousflux.html#viscousfluxi322" target="diffFile"><code class="comment">! the gradients of the speed of sound squared for the heat</code></a>
<a name="viscousfluxi324"></a><a name="viscousfluxi323"></a><a href="viscousflux.html#viscousfluxi322" target="diffFile"><code class="comment">! flux.</code></a>
<a name="viscousfluxi325"></a>          <a href="viscousflux.html#viscousfluxi322" target="diffFile">mul = por*(rlv(i, j, k)+rlv(i+<code class="constant">1</code>, j, k))</a>
<a name="viscousfluxi326"></a>          <a href="viscousflux.html#viscousfluxi323" target="diffFile"><code class="keyword">IF</code> (eddymodel) </a><a href="viscousflux.html#viscousfluxi324" target="diffFile">mue = por*(rev(i, j, k)+rev(i+<code class="constant">1</code>, j, k))</a>
<a name="viscousfluxi327"></a>          <a href="viscousflux.html#viscousfluxi325" target="diffFile">mut = mul + mue</a>
<a name="viscousfluxi328"></a>          <a href="viscousflux.html#viscousfluxi326" target="diffFile">gm1 = half*(gamma(i, j, k)+gamma(i+<code class="constant">1</code>, j, k)) - one</a>
<a name="viscousfluxi329"></a>          <a href="viscousflux.html#viscousfluxi327" target="diffFile">factlamheat = one/(prandtl*gm1)</a>
<a name="viscousfluxi330"></a>          <a href="viscousflux.html#viscousfluxi328" target="diffFile">factturbheat = one/(prandtlturb*gm1)</a>
          <a href="viscousflux.html#viscousfluxi329" target="diffFile">heatcoef = mul*factlamheat + mue*factturbheat</a>
<a href="viscousflux.html#viscousfluxi330" target="diffFile"><code class="comment">! Compute the gradients at the face by averaging the four</code></a>
<a href="viscousflux.html#viscousfluxi330" target="diffFile"><code class="comment">! nodal values.</code></a>
<a name="viscousfluxi331"></a>          <a href="viscousflux.html#viscousfluxi330" target="diffFile">u_x = fourth*(ux(i, j-<code class="constant">1</code>, k1)+ux(i, j, k1)+ux(i, j-<code class="constant">1</code>, k2)+ux(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi330" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi332"></a>          <a href="viscousflux.html#viscousfluxi331" target="diffFile">u_y = fourth*(uy(i, j-<code class="constant">1</code>, k1)+uy(i, j, k1)+uy(i, j-<code class="constant">1</code>, k2)+uy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi331" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi333"></a>          <a href="viscousflux.html#viscousfluxi332" target="diffFile">u_z = fourth*(uz(i, j-<code class="constant">1</code>, k1)+uz(i, j, k1)+uz(i, j-<code class="constant">1</code>, k2)+uz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi332" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi334"></a>          <a href="viscousflux.html#viscousfluxi333" target="diffFile">v_x = fourth*(vx(i, j-<code class="constant">1</code>, k1)+vx(i, j, k1)+vx(i, j-<code class="constant">1</code>, k2)+vx(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi333" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi335"></a>          <a href="viscousflux.html#viscousfluxi334" target="diffFile">v_y = fourth*(vy(i, j-<code class="constant">1</code>, k1)+vy(i, j, k1)+vy(i, j-<code class="constant">1</code>, k2)+vy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi334" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi336"></a>          <a href="viscousflux.html#viscousfluxi335" target="diffFile">v_z = fourth*(vz(i, j-<code class="constant">1</code>, k1)+vz(i, j, k1)+vz(i, j-<code class="constant">1</code>, k2)+vz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi335" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi337"></a>          <a href="viscousflux.html#viscousfluxi336" target="diffFile">w_x = fourth*(wx(i, j-<code class="constant">1</code>, k1)+wx(i, j, k1)+wx(i, j-<code class="constant">1</code>, k2)+wx(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi336" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi338"></a>          <a href="viscousflux.html#viscousfluxi337" target="diffFile">w_y = fourth*(wy(i, j-<code class="constant">1</code>, k1)+wy(i, j, k1)+wy(i, j-<code class="constant">1</code>, k2)+wy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi337" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi339"></a>          <a href="viscousflux.html#viscousfluxi338" target="diffFile">w_z = fourth*(wz(i, j-<code class="constant">1</code>, k1)+wz(i, j, k1)+wz(i, j-<code class="constant">1</code>, k2)+wz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi338" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi340"></a>          <a href="viscousflux.html#viscousfluxi339" target="diffFile">q_x = fourth*(qx(i, j-<code class="constant">1</code>, k1)+qx(i, j, k1)+qx(i, j-<code class="constant">1</code>, k2)+qx(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi339" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi341"></a>          <a href="viscousflux.html#viscousfluxi340" target="diffFile">q_y = fourth*(qy(i, j-<code class="constant">1</code>, k1)+qy(i, j, k1)+qy(i, j-<code class="constant">1</code>, k2)+qy(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi340" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a name="viscousfluxi342"></a>          <a href="viscousflux.html#viscousfluxi341" target="diffFile">q_z = fourth*(qz(i, j-<code class="constant">1</code>, k1)+qz(i, j, k1)+qz(i, j-<code class="constant">1</code>, k2)+qz(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi341" target="diffFile"><code class="label">&            </code>, j, k2))</a>
<a href="viscousflux.html#viscousfluxi342" target="diffFile"><code class="comment">! The gradients in the normal direction are corrected, such</code></a>
<a href="viscousflux.html#viscousfluxi342" target="diffFile"><code class="comment">! that no averaging takes places here.</code></a>
<a href="viscousflux.html#viscousfluxi342" target="diffFile"><code class="comment">! First determine the vector in the direction from the</code></a>
<a href="viscousflux.html#viscousfluxi342" target="diffFile"><code class="comment">! cell center i to cell center i+1.</code></a>
          <a href="viscousflux.html#viscousfluxi342" target="diffFile">ssx = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi343"></a><a href="viscousflux.html#viscousfluxi342" target="diffFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi342" target="diffFile"><code class="label">&            </code>, <code class="constant">1</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>))</a>
          <a href="viscousflux.html#viscousfluxi343" target="diffFile">ssy = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi344"></a><a href="viscousflux.html#viscousfluxi343" target="diffFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi343" target="diffFile"><code class="label">&            </code>, <code class="constant">2</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>))</a>
          <a href="viscousflux.html#viscousfluxi344" target="diffFile">ssz = eighth*(x(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a name="viscousfluxi345"></a><a href="viscousflux.html#viscousfluxi344" target="diffFile"><code class="label">&            </code>-<code class="constant">1</code>, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k-<code class="constant">1</code><code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi344" target="diffFile"><code class="label">&            </code>, <code class="constant">3</code>)+x(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>)-x(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>))</a>
<a href="viscousflux.html#viscousfluxi345" target="diffFile"><code class="comment">! Determine the length of this vector and create the</code></a>
<a name="viscousfluxi346"></a><a href="viscousflux.html#viscousfluxi345" target="diffFile"><code class="comment">! unit normal.</code></a>
<a name="viscousfluxi347"></a>          <a href="viscousflux.html#viscousfluxi345" target="diffFile">arg1 = ssx*ssx + ssy*ssy + ssz*ssz</a>
<a name="viscousfluxi348"></a>          <a href="viscousflux.html#viscousfluxi346" target="diffFile">result1 = <code class="funcname">SQRT</code>(arg1)</a>
<a name="viscousfluxi349"></a>          <a href="viscousflux.html#viscousfluxi347" target="diffFile">ss = one/result1</a>
<a name="viscousfluxi350"></a>          <a href="viscousflux.html#viscousfluxi348" target="diffFile">ssx = ss*ssx</a>
<a name="viscousfluxi351"></a>          <a href="viscousflux.html#viscousfluxi349" target="diffFile">ssy = ss*ssy</a>
          <a href="viscousflux.html#viscousfluxi350" target="diffFile">ssz = ss*ssz</a>
<a href="viscousflux.html#viscousfluxi351" target="diffFile"><code class="comment">! Correct the gradients.</code></a>
<a name="viscousfluxi352"></a>          <a href="viscousflux.html#viscousfluxi351" target="diffFile">corr = u_x*ssx + u_y*ssy + u_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivx)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi353"></a><a href="viscousflux.html#viscousfluxi351" target="diffFile"><code class="label">&            </code>, k, ivx))*ss</a>
<a name="viscousfluxi354"></a>          <a href="viscousflux.html#viscousfluxi352" target="diffFile">u_x = u_x - corr*ssx</a>
<a name="viscousfluxi355"></a>          <a href="viscousflux.html#viscousfluxi353" target="diffFile">u_y = u_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi354" target="diffFile">u_z = u_z - corr*ssz</a>
<a name="viscousfluxi356"></a>          <a href="viscousflux.html#viscousfluxi355" target="diffFile">corr = v_x*ssx + v_y*ssy + v_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivy)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi357"></a><a href="viscousflux.html#viscousfluxi355" target="diffFile"><code class="label">&            </code>, k, ivy))*ss</a>
<a name="viscousfluxi358"></a>          <a href="viscousflux.html#viscousfluxi356" target="diffFile">v_x = v_x - corr*ssx</a>
<a name="viscousfluxi359"></a>          <a href="viscousflux.html#viscousfluxi357" target="diffFile">v_y = v_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi358" target="diffFile">v_z = v_z - corr*ssz</a>
<a name="viscousfluxi360"></a>          <a href="viscousflux.html#viscousfluxi359" target="diffFile">corr = w_x*ssx + w_y*ssy + w_z*ssz - (w(i+<code class="constant">1</code>, j, k, ivz)-w(i, j<code class="label">&</code></a>
<a name="viscousfluxi361"></a><a href="viscousflux.html#viscousfluxi359" target="diffFile"><code class="label">&            </code>, k, ivz))*ss</a>
<a name="viscousfluxi362"></a>          <a href="viscousflux.html#viscousfluxi360" target="diffFile">w_x = w_x - corr*ssx</a>
<a name="viscousfluxi363"></a>          <a href="viscousflux.html#viscousfluxi361" target="diffFile">w_y = w_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi362" target="diffFile">w_z = w_z - corr*ssz</a>
<a name="viscousfluxi364"></a>          <a href="viscousflux.html#viscousfluxi363" target="diffFile">corr = q_x*ssx + q_y*ssy + q_z*ssz + (p(i+<code class="constant">1</code>, j, k)-p(i, j, k))<code class="label">&</code></a>
<a name="viscousfluxi365"></a><a href="viscousflux.html#viscousfluxi363" target="diffFile"><code class="label">&            </code>*ss</a>
<a name="viscousfluxi366"></a>          <a href="viscousflux.html#viscousfluxi364" target="diffFile">q_x = q_x - corr*ssx</a>
<a name="viscousfluxi367"></a>          <a href="viscousflux.html#viscousfluxi365" target="diffFile">q_y = q_y - corr*ssy</a>
          <a href="viscousflux.html#viscousfluxi366" target="diffFile">q_z = q_z - corr*ssz</a>
<a name="viscousfluxi368"></a><a href="viscousflux.html#viscousfluxi367" target="diffFile"><code class="comment">! Compute the stress tensor and the heat flux vector.</code></a>
<a name="viscousfluxi369"></a>          <a href="viscousflux.html#viscousfluxi367" target="diffFile">fracdiv = twothird*(u_x+v_y+w_z)</a>
<a name="viscousfluxi370"></a>          <a href="viscousflux.html#viscousfluxi368" target="diffFile">tauxx = mut*(two*u_x-fracdiv)</a>
<a name="viscousfluxi371"></a>          <a href="viscousflux.html#viscousfluxi369" target="diffFile">tauyy = mut*(two*v_y-fracdiv)</a>
<a name="viscousfluxi372"></a>          <a href="viscousflux.html#viscousfluxi370" target="diffFile">tauzz = mut*(two*w_z-fracdiv)</a>
<a name="viscousfluxi373"></a>          <a href="viscousflux.html#viscousfluxi371" target="diffFile">tauxy = mut*(u_y+v_x)</a>
<a name="viscousfluxi374"></a>          <a href="viscousflux.html#viscousfluxi372" target="diffFile">tauxz = mut*(u_z+w_x)</a>
<a name="viscousfluxi375"></a>          <a href="viscousflux.html#viscousfluxi373" target="diffFile">tauyz = mut*(v_z+w_y)</a>
<a name="viscousfluxi376"></a>          <a href="viscousflux.html#viscousfluxi374" target="diffFile">q_x = heatcoef*q_x</a>
<a name="viscousfluxi377"></a>          <a href="viscousflux.html#viscousfluxi375" target="diffFile">q_y = heatcoef*q_y</a>
          <a href="viscousflux.html#viscousfluxi376" target="diffFile">q_z = heatcoef*q_z</a>
<a href="viscousflux.html#viscousfluxi377" target="diffFile"><code class="comment">! Compute the average velocities for the face. Remember that</code></a>
<a name="viscousfluxi378"></a><a href="viscousflux.html#viscousfluxi377" target="diffFile"><code class="comment">! the velocities are stored and not the momentum.</code></a>
<a name="viscousfluxi379"></a>          <a href="viscousflux.html#viscousfluxi377" target="diffFile">ubar = half*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx))</a>
<a name="viscousfluxi380"></a>          <a href="viscousflux.html#viscousfluxi378" target="diffFile">vbar = half*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy))</a>
          <a href="viscousflux.html#viscousfluxi379" target="diffFile">wbar = half*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz))</a>
<a href="viscousflux.html#viscousfluxi380" target="diffFile"><code class="comment">! Compute the viscous fluxes for this i-face.</code></a>
<a name="viscousfluxi381"></a>          <a href="viscousflux.html#viscousfluxi380" target="diffFile">fmx = tauxx*si(i, j, k, <code class="constant">1</code>) + tauxy*si(i, j, k, <code class="constant">2</code>) + tauxz*si(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi380" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi382"></a>          <a href="viscousflux.html#viscousfluxi381" target="diffFile">fmy = tauxy*si(i, j, k, <code class="constant">1</code>) + tauyy*si(i, j, k, <code class="constant">2</code>) + tauyz*si(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi381" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi383"></a>          <a href="viscousflux.html#viscousfluxi382" target="diffFile">fmz = tauxz*si(i, j, k, <code class="constant">1</code>) + tauyz*si(i, j, k, <code class="constant">2</code>) + tauzz*si(i<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi382" target="diffFile"><code class="label">&            </code>, j, k, <code class="constant">3</code>)</a>
          <a href="viscousflux.html#viscousfluxi383" target="diffFile">frhoe = (ubar*tauxx+vbar*tauxy+wbar*tauxz)*si(i, j, k, <code class="constant">1</code>) + (<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi383" target="diffFile"><code class="label">&            </code>ubar*tauxy+vbar*tauyy+wbar*tauyz)*si(i, j, k, <code class="constant">2</code>) + (ubar*<code class="label">&</code></a>
<a name="viscousfluxi384"></a><a href="viscousflux.html#viscousfluxi383" target="diffFile"><code class="label">&            </code>tauxz+vbar*tauyz+wbar*tauzz)*si(i, j, k, <code class="constant">3</code>) - q_x*si(i, j, k<code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi383" target="diffFile"><code class="label">&            </code>, <code class="constant">1</code>) - q_y*si(i, j, k, <code class="constant">2</code>) - q_z*si(i, j, k, <code class="constant">3</code>)</a>
<a name="viscousfluxi385"></a><a href="viscousflux.html#viscousfluxi384" target="diffFile"><code class="comment">! Update the residuals of cell i and i+1.</code></a>
<a name="viscousfluxi386"></a>          <a href="viscousflux.html#viscousfluxi384" target="diffFile">fw(i, j, k, imx) = fw(i, j, k, imx) - fmx</a>
<a name="viscousfluxi387"></a>          <a href="viscousflux.html#viscousfluxi385" target="diffFile">fw(i, j, k, imy) = fw(i, j, k, imy) - fmy</a>
<a name="viscousfluxi388"></a>          <a href="viscousflux.html#viscousfluxi386" target="diffFile">fw(i, j, k, imz) = fw(i, j, k, imz) - fmz</a>
<a name="viscousfluxi389"></a>          <a href="viscousflux.html#viscousfluxi387" target="diffFile">fw(i, j, k, irhoe) = fw(i, j, k, irhoe) - frhoe</a>
<a name="viscousfluxi390"></a>          <a href="viscousflux.html#viscousfluxi388" target="diffFile">fw(i+<code class="constant">1</code>, j, k, imx) = fw(i+<code class="constant">1</code>, j, k, imx) + fmx</a>
<a name="viscousfluxi391"></a>          <a href="viscousflux.html#viscousfluxi389" target="diffFile">fw(i+<code class="constant">1</code>, j, k, imy) = fw(i+<code class="constant">1</code>, j, k, imy) + fmy</a>
<a name="viscousfluxi392"></a>          <a href="viscousflux.html#viscousfluxi390" target="diffFile">fw(i+<code class="constant">1</code>, j, k, imz) = fw(i+<code class="constant">1</code>, j, k, imz) + fmz</a>
          <a href="viscousflux.html#viscousfluxi391" target="diffFile">fw(i+<code class="constant">1</code>, j, k, irhoe) = fw(i+<code class="constant">1</code>, j, k, irhoe) + frhoe</a>
<a href="viscousflux.html#viscousfluxi392" target="diffFile"><code class="comment">! Store the stress tensor and the heat flux vector if this</code></a>
<a href="viscousflux.html#viscousfluxi392" target="diffFile"><code class="comment">! face is part of a viscous subface. Both the cases i == 1</code></a>
<a href="viscousflux.html#viscousfluxi392" target="diffFile"><code class="comment">! and i == il must be tested.</code></a>
<a name="viscousfluxi393"></a>          <a href="viscousflux.html#viscousfluxi392" target="diffFile"><code class="keyword">IF</code> (i .EQ. <code class="constant">1 </code>.AND. storewalltensor .AND. visciminpointer(j, k)<code class="label">&</code></a>
<a name="viscousfluxi394"></a><a href="viscousflux.html#viscousfluxi392" target="diffFile"><code class="label">&              </code>.GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="viscousfluxi395"></a>            <a href="viscousflux.html#viscousfluxi393" target="diffFile">nn = visciminpointer(j, k)</a>
<a name="viscousfluxi396"></a>            <a href="viscousflux.html#viscousfluxi394" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousfluxi397"></a>            <a href="viscousflux.html#viscousfluxi395" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousfluxi398"></a>            <a href="viscousflux.html#viscousfluxi396" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousfluxi399"></a>            <a href="viscousflux.html#viscousfluxi397" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousfluxi400"></a>            <a href="viscousflux.html#viscousfluxi398" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousfluxi401"></a>            <a href="viscousflux.html#viscousfluxi399" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousfluxi402"></a>            <a href="viscousflux.html#viscousfluxi400" target="diffFile">viscsubface(nn)%q(j, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux.html#viscousfluxi401" target="diffFile">viscsubface(nn)%q(j, k, <code class="constant">2</code>) = q_y</a>
<a name="viscousfluxi403"></a>            <a href="viscousflux.html#viscousfluxi402" target="diffFile">viscsubface(nn)%q(j, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux.html#viscousfluxi392" target="diffFile"><code class="keyword">END IF</code></a>
<a href="viscousflux.html#viscousfluxi403" target="diffFile"><code class="comment">! And the i == il case.</code></a>
<a name="viscousfluxi404"></a>          <a href="viscousflux.html#viscousfluxi403" target="diffFile"><code class="keyword">IF</code> (i .EQ. il .AND. storewalltensor .AND. viscimaxpointer(j, k<code class="label">&</code></a>
<a name="viscousfluxi405"></a><a href="viscousflux.html#viscousfluxi403" target="diffFile"><code class="label">&              </code>) .GT. <code class="constant">0</code>) <code class="keyword">THEN</code></a>
<a name="viscousfluxi406"></a>            <a href="viscousflux.html#viscousfluxi404" target="diffFile">nn = viscimaxpointer(j, k)</a>
<a name="viscousfluxi407"></a>            <a href="viscousflux.html#viscousfluxi405" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">1</code>) = tauxx</a>
<a name="viscousfluxi408"></a>            <a href="viscousflux.html#viscousfluxi406" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">2</code>) = tauyy</a>
<a name="viscousfluxi409"></a>            <a href="viscousflux.html#viscousfluxi407" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">3</code>) = tauzz</a>
<a name="viscousfluxi410"></a>            <a href="viscousflux.html#viscousfluxi408" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">4</code>) = tauxy</a>
<a name="viscousfluxi411"></a>            <a href="viscousflux.html#viscousfluxi409" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">5</code>) = tauxz</a>
<a name="viscousfluxi412"></a>            <a href="viscousflux.html#viscousfluxi410" target="diffFile">viscsubface(nn)%tau(j, k, <code class="constant">6</code>) = tauyz</a>
<a name="viscousfluxi413"></a>            <a href="viscousflux.html#viscousfluxi411" target="diffFile">viscsubface(nn)%q(j, k, <code class="constant">1</code>) = q_x</a>
            <a href="viscousflux.html#viscousfluxi412" target="diffFile">viscsubface(nn)%q(j, k, <code class="constant">2</code>) = q_y</a>
            <a href="viscousflux.html#viscousfluxi413" target="diffFile">viscsubface(nn)%q(j, k, <code class="constant">3</code>) = q_z</a>
          <a href="viscousflux.html#viscousfluxi403" target="diffFile"><code class="keyword">END IF</code></a>
        <a href="viscousflux.html#viscousfluxi318" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi414"></a>      <a href="viscousflux.html#viscousfluxi317" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#viscousfluxi129" target="diffFile"><code class="keyword">END DO </code><code class="label">kloop</code></a>
<a href="viscousflux.html#viscousfluxi414" target="diffFile"><code class="comment">! Restore the pressure in p. Again only the first layer of</code></a>
<a name="viscousfluxi415"></a><a href="viscousflux.html#viscousfluxi414" target="diffFile"><code class="comment">! halo cells.</code></a>
<a name="viscousfluxi416"></a>    <a href="viscousflux.html#viscousfluxi414" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
<a name="viscousfluxi417"></a>      <a href="viscousflux.html#viscousfluxi415" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
        <a href="viscousflux.html#viscousfluxi416" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
          <a href="viscousflux.html#viscousfluxi417" target="diffFile">p(i, j, k) = w(i, j, k, irho)*p(i, j, k)/gamma(i, j, k)</a>
        <a href="viscousflux.html#viscousfluxi416" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi418"></a>      <a href="viscousflux.html#viscousfluxi415" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi419"></a>    <a href="viscousflux.html#viscousfluxi414" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi420"></a>    <a href="viscousflux.html#viscousfluxi418" target="diffFile"><code class="keyword">IF</code> (correctfork) <code class="keyword">THEN</code></a>
<a name="viscousfluxi421"></a>      <a href="viscousflux.html#viscousfluxi419" target="diffFile"><code class="keyword">DO </code>k=<code class="constant">1</code>,ke</a>
<a name="viscousfluxi422"></a>        <a href="viscousflux.html#viscousfluxi420" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
          <a href="viscousflux.html#viscousfluxi421" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
            <a href="viscousflux.html#viscousfluxi422" target="diffFile">p(i, j, k) = p(i, j, k) + twothird*w(i, j, k, irho)*w(i, j, <code class="label">&</code></a>
<a href="viscousflux.html#viscousfluxi422" target="diffFile"><code class="label">&              </code>k, itu1)</a>
          <a href="viscousflux.html#viscousfluxi421" target="diffFile"><code class="keyword">END DO</code></a>
        <a href="viscousflux.html#viscousfluxi420" target="diffFile"><code class="keyword">END DO</code></a>
<a name="viscousfluxi423"></a>      <a href="viscousflux.html#viscousfluxi419" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#viscousfluxi418" target="diffFile"><code class="keyword">END IF</code></a>
<a name="viscousfluxi424"></a><a href="viscousflux.html#viscousfluxi423" target="diffFile"><code class="comment">! Possibly correct the wall shear stress.</code></a>
    <a href="viscousflux.html#viscousfluxi423" target="diffFile"><code class="keyword">CALL </code><code class="funcname">UTAUWF</code>(rfilv)</a>
    <a href="viscousflux.html#viscousfluxi424" target="diffFile"><code class="keyword">CLOSE</code>(unitvf) </a>
  <a href="viscousflux.html#viscousfluxi24" target="diffFile"><code class="keyword">END IF</code></a>
<a name="nodalgradients"></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">CONTAINS</code></a>
  <a href="viscousflux.html#nodalgradients" target="diffFile"><code class="keyword">SUBROUTINE </code><code class="funcname">NODALGRADIENTS</code>(<code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="vardecl">uz</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code>, <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code>, <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="label">&</code></a>
<a name="nodalgradientsi0"></a><a href="viscousflux.html#nodalgradients" target="diffFile"><code class="label">&    </code><code class="vardecl">qz</code>)</a>
    <a href="viscousflux.html#nodalgradients" target="diffFile"><code class="keyword">IMPLICIT NONE</code></a>
<a href="viscousflux.html#nodalgradientsi0" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#nodalgradientsi0" target="diffFile"><code class="comment">!        Subroutine arguments</code></a>
<a href="viscousflux.html#nodalgradientsi0" target="diffFile"><code class="comment">!</code></a>
<a name="nodalgradientsi1"></a>    <a href="viscousflux.html#nodalgradientsi0" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">)</code>, <code class="typename">DIMENSION(</code>il, jl, <code class="constant">2</code><code class="typename">)</code>, <code class="typename">INTENT(INOUT) </code>:: <code class="vardecl">ux</code>, <code class="vardecl">uy</code>, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi0" target="diffFile"><code class="label">&    </code><code class="vardecl">uz</code>, <code class="vardecl">vx</code>, <code class="vardecl">vy</code>, <code class="vardecl">vz</code>, <code class="vardecl">wx</code>, <code class="vardecl">wy</code>, <code class="vardecl">wz</code>, <code class="vardecl">qx</code>, <code class="vardecl">qy</code>, <code class="vardecl">qz</code></a>
<a href="viscousflux.html#nodalgradientsi1" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#nodalgradientsi1" target="diffFile"><code class="comment">!        Local variables.</code></a>
<a name="nodalgradientsi2"></a><a href="viscousflux.html#nodalgradientsi1" target="diffFile"><code class="comment">!</code></a>
<a name="nodalgradientsi3"></a>    <a href="viscousflux.html#nodalgradientsi1" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">oneoverv</code>, <code class="vardecl">ubar</code>, <code class="vardecl">vbar</code>, <code class="vardecl">wbar</code>, <code class="vardecl">a2</code></a>
    <a href="viscousflux.html#nodalgradientsi2" target="diffFile"><code class="typename">REAL(</code><code class="keyword">kind</code>=<code class="modifier">realtype</code><code class="typename">) </code>:: <code class="vardecl">sx</code>, <code class="vardecl">sx1</code>, <code class="vardecl">sy</code>, <code class="vardecl">sy1</code>, <code class="vardecl">sz</code>, <code class="vardecl">sz1</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">!        * Begin execution                                              *</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">!        *                                                              *</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">!        ****************************************************************</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">!</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">! First part. Contribution in the k-direction. As the viscous</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">! fluxes are computed per k-plane, the values of the surface</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">! integrals in gauss's theorem are only scattered to one node.</code></a>
<a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">! Consequently this part is an initialization as well.</code></a>
<a name="nodalgradientsi4"></a><a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="comment">! Loop over the j and i direction.</code></a>
<a name="nodalgradientsi5"></a>    <a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux.html#nodalgradientsi4" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux.html#nodalgradientsi5" target="diffFile"><code class="comment">! Store 8 times the average normal for the contribution from</code></a>
<a href="viscousflux.html#nodalgradientsi5" target="diffFile"><code class="comment">! the k-layer of cells. The factor 8 drops out later when</code></a>
<a href="viscousflux.html#nodalgradientsi5" target="diffFile"><code class="comment">! dividing by the volume.</code></a>
<a name="nodalgradientsi6"></a>        <a href="viscousflux.html#nodalgradientsi5" target="diffFile">sx1 = sk(i, j, k, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi5" target="diffFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>)</a>
<a name="nodalgradientsi7"></a>        <a href="viscousflux.html#nodalgradientsi6" target="diffFile">sy1 = sk(i, j, k, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi6" target="diffFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>)</a>
<a name="nodalgradientsi8"></a>        <a href="viscousflux.html#nodalgradientsi7" target="diffFile">sz1 = sk(i, j, k, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + sk(<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi7" target="diffFile"><code class="label">&          </code>i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>)</a>
<a name="nodalgradientsi9"></a>        <a href="viscousflux.html#nodalgradientsi8" target="diffFile">sx = sx1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi8" target="diffFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="nodalgradientsi10"></a>        <a href="viscousflux.html#nodalgradientsi9" target="diffFile">sy = sy1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi9" target="diffFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">2</code>)</a>
<a name="nodalgradientsi11"></a>        <a href="viscousflux.html#nodalgradientsi10" target="diffFile">sz = sz1 + sk(i, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k-<code class="constant">1</code>, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k-<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi10" target="diffFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k-<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux.html#nodalgradientsi11" target="diffFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux.html#nodalgradientsi11" target="diffFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux.html#nodalgradientsi11" target="diffFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
<a name="nodalgradientsi12"></a>        <a href="viscousflux.html#nodalgradientsi11" target="diffFile">ubar = fourth*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi11" target="diffFile"><code class="label">&          </code>ivx)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivx))</a>
<a name="nodalgradientsi13"></a>        <a href="viscousflux.html#nodalgradientsi12" target="diffFile">vbar = fourth*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi12" target="diffFile"><code class="label">&          </code>ivy)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivy))</a>
<a name="nodalgradientsi14"></a>        <a href="viscousflux.html#nodalgradientsi13" target="diffFile">wbar = fourth*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi13" target="diffFile"><code class="label">&          </code>ivz)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k, ivz))</a>
<a name="nodalgradientsi15"></a>        <a href="viscousflux.html#nodalgradientsi14" target="diffFile">a2 = fourth*(p(i, j, k)+p(i+<code class="constant">1</code>, j, k)+p(i, j+<code class="constant">1</code>, k)+p(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k)<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi14" target="diffFile"><code class="label">&          </code>)</a>
<a href="viscousflux.html#nodalgradientsi15" target="diffFile"><code class="comment">! Set the velocity and speed of sound square gradients.</code></a>
<a href="viscousflux.html#nodalgradientsi15" target="diffFile"><code class="comment">! The minus sign is there, because these normals are inward</code></a>
<a href="viscousflux.html#nodalgradientsi15" target="diffFile"><code class="comment">! pointing for the nodal k-layer. The exception is a2,</code></a>
<a href="viscousflux.html#nodalgradientsi15" target="diffFile"><code class="comment">! because the gradient of -a2 is stored, as this is needed</code></a>
<a name="nodalgradientsi16"></a><a href="viscousflux.html#nodalgradientsi15" target="diffFile"><code class="comment">! in the heat fluxes.</code></a>
<a name="nodalgradientsi17"></a>        <a href="viscousflux.html#nodalgradientsi15" target="diffFile">ux(i, j, k1) = -(ubar*sx)</a>
<a name="nodalgradientsi18"></a>        <a href="viscousflux.html#nodalgradientsi16" target="diffFile">uy(i, j, k1) = -(ubar*sy)</a>
<a name="nodalgradientsi19"></a>        <a href="viscousflux.html#nodalgradientsi17" target="diffFile">uz(i, j, k1) = -(ubar*sz)</a>
<a name="nodalgradientsi20"></a>        <a href="viscousflux.html#nodalgradientsi18" target="diffFile">vx(i, j, k1) = -(vbar*sx)</a>
<a name="nodalgradientsi21"></a>        <a href="viscousflux.html#nodalgradientsi19" target="diffFile">vy(i, j, k1) = -(vbar*sy)</a>
<a name="nodalgradientsi22"></a>        <a href="viscousflux.html#nodalgradientsi20" target="diffFile">vz(i, j, k1) = -(vbar*sz)</a>
<a name="nodalgradientsi23"></a>        <a href="viscousflux.html#nodalgradientsi21" target="diffFile">wx(i, j, k1) = -(wbar*sx)</a>
<a name="nodalgradientsi24"></a>        <a href="viscousflux.html#nodalgradientsi22" target="diffFile">wy(i, j, k1) = -(wbar*sy)</a>
<a name="nodalgradientsi25"></a>        <a href="viscousflux.html#nodalgradientsi23" target="diffFile">wz(i, j, k1) = -(wbar*sz)</a>
<a name="nodalgradientsi26"></a>        <a href="viscousflux.html#nodalgradientsi24" target="diffFile">qx(i, j, k1) = a2*sx</a>
<a name="nodalgradientsi27"></a>        <a href="viscousflux.html#nodalgradientsi25" target="diffFile">qy(i, j, k1) = a2*sy</a>
        <a href="viscousflux.html#nodalgradientsi26" target="diffFile">qz(i, j, k1) = a2*sz</a>
<a href="viscousflux.html#nodalgradientsi27" target="diffFile"><code class="comment">! Store 8 times the average normal for the contribution from</code></a>
<a href="viscousflux.html#nodalgradientsi27" target="diffFile"><code class="comment">! the k+1 layer of cells. The factor 8 drops out later when</code></a>
<a href="viscousflux.html#nodalgradientsi27" target="diffFile"><code class="comment">! dividing by the volume.</code></a>
<a name="nodalgradientsi28"></a>        <a href="viscousflux.html#nodalgradientsi27" target="diffFile">sx = sx1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi27" target="diffFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">1</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
<a name="nodalgradientsi29"></a>        <a href="viscousflux.html#nodalgradientsi28" target="diffFile">sy = sy1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi28" target="diffFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">2</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
<a name="nodalgradientsi30"></a>        <a href="viscousflux.html#nodalgradientsi29" target="diffFile">sz = sz1 + sk(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sk(i, j+<code class="constant">1</code>, k+<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi29" target="diffFile"><code class="label">&          </code><code class="constant">1</code>, <code class="constant">3</code>) + sk(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux.html#nodalgradientsi30" target="diffFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux.html#nodalgradientsi30" target="diffFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux.html#nodalgradientsi30" target="diffFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
<a name="nodalgradientsi31"></a>        <a href="viscousflux.html#nodalgradientsi30" target="diffFile">ubar = fourth*(w(i, j, k+<code class="constant">1</code>, ivx)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi30" target="diffFile"><code class="label">&          </code>+<code class="constant">1</code>, ivx)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
<a name="nodalgradientsi32"></a>        <a href="viscousflux.html#nodalgradientsi31" target="diffFile">vbar = fourth*(w(i, j, k+<code class="constant">1</code>, ivy)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi31" target="diffFile"><code class="label">&          </code>+<code class="constant">1</code>, ivy)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
<a name="nodalgradientsi33"></a>        <a href="viscousflux.html#nodalgradientsi32" target="diffFile">wbar = fourth*(w(i, j, k+<code class="constant">1</code>, ivz)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz)+w(i, j+<code class="constant">1</code>, k<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi32" target="diffFile"><code class="label">&          </code>+<code class="constant">1</code>, ivz)+w(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
<a name="nodalgradientsi34"></a>        <a href="viscousflux.html#nodalgradientsi33" target="diffFile">a2 = fourth*(p(i, j, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+p(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi33" target="diffFile"><code class="label">&          </code>+<code class="constant">1</code>, k+<code class="constant">1</code>))</a>
<a href="viscousflux.html#nodalgradientsi34" target="diffFile"><code class="comment">! Update the velocity and (minus) the speed of sound</code></a>
<a href="viscousflux.html#nodalgradientsi34" target="diffFile"><code class="comment">! gradients. As the normals are now outward pointing for</code></a>
<a href="viscousflux.html#nodalgradientsi34" target="diffFile"><code class="comment">! the nodes in the k-layer, there is a plus sign for the</code></a>
<a href="viscousflux.html#nodalgradientsi34" target="diffFile"><code class="comment">! velocity gradients and a minus sign for minus the speed</code></a>
<a name="nodalgradientsi35"></a><a href="viscousflux.html#nodalgradientsi34" target="diffFile"><code class="comment">! of sound squared.</code></a>
<a name="nodalgradientsi36"></a>        <a href="viscousflux.html#nodalgradientsi34" target="diffFile">ux(i, j, k1) = ux(i, j, k1) + ubar*sx</a>
<a name="nodalgradientsi37"></a>        <a href="viscousflux.html#nodalgradientsi35" target="diffFile">uy(i, j, k1) = uy(i, j, k1) + ubar*sy</a>
<a name="nodalgradientsi38"></a>        <a href="viscousflux.html#nodalgradientsi36" target="diffFile">uz(i, j, k1) = uz(i, j, k1) + ubar*sz</a>
<a name="nodalgradientsi39"></a>        <a href="viscousflux.html#nodalgradientsi37" target="diffFile">vx(i, j, k1) = vx(i, j, k1) + vbar*sx</a>
<a name="nodalgradientsi40"></a>        <a href="viscousflux.html#nodalgradientsi38" target="diffFile">vy(i, j, k1) = vy(i, j, k1) + vbar*sy</a>
<a name="nodalgradientsi41"></a>        <a href="viscousflux.html#nodalgradientsi39" target="diffFile">vz(i, j, k1) = vz(i, j, k1) + vbar*sz</a>
<a name="nodalgradientsi42"></a>        <a href="viscousflux.html#nodalgradientsi40" target="diffFile">wx(i, j, k1) = wx(i, j, k1) + wbar*sx</a>
<a name="nodalgradientsi43"></a>        <a href="viscousflux.html#nodalgradientsi41" target="diffFile">wy(i, j, k1) = wy(i, j, k1) + wbar*sy</a>
<a name="nodalgradientsi44"></a>        <a href="viscousflux.html#nodalgradientsi42" target="diffFile">wz(i, j, k1) = wz(i, j, k1) + wbar*sz</a>
<a name="nodalgradientsi45"></a>        <a href="viscousflux.html#nodalgradientsi43" target="diffFile">qx(i, j, k1) = qx(i, j, k1) - a2*sx</a>
        <a href="viscousflux.html#nodalgradientsi44" target="diffFile">qy(i, j, k1) = qy(i, j, k1) - a2*sy</a>
        <a href="viscousflux.html#nodalgradientsi45" target="diffFile">qz(i, j, k1) = qz(i, j, k1) - a2*sz</a>
<a name="nodalgradientsi46"></a>      <a href="viscousflux.html#nodalgradientsi4" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#nodalgradientsi3" target="diffFile"><code class="keyword">END DO</code></a>
<a href="viscousflux.html#nodalgradientsi46" target="diffFile"><code class="comment">! Second part. Contribution in the j-direction.</code></a>
<a href="viscousflux.html#nodalgradientsi46" target="diffFile"><code class="comment">! The contribution is scattered to both the left and right node</code></a>
<a name="nodalgradientsi47"></a><a href="viscousflux.html#nodalgradientsi46" target="diffFile"><code class="comment">! in j-direction.</code></a>
<a name="nodalgradientsi48"></a>    <a href="viscousflux.html#nodalgradientsi46" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,je</a>
      <a href="viscousflux.html#nodalgradientsi47" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux.html#nodalgradientsi48" target="diffFile"><code class="comment">! Compute 8 times the average normal for this part of</code></a>
<a href="viscousflux.html#nodalgradientsi48" target="diffFile"><code class="comment">! the control volume. The factor 8 is taken care of later</code></a>
<a href="viscousflux.html#nodalgradientsi48" target="diffFile"><code class="comment">! on when the division by the volume takes place.</code></a>
        <a href="viscousflux.html#nodalgradientsi48" target="diffFile">sx = sj(i, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">1</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) <code class="label">&</code></a>
<a name="nodalgradientsi49"></a><a href="viscousflux.html#nodalgradientsi48" target="diffFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + sj(i, j, k, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi48" target="diffFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux.html#nodalgradientsi49" target="diffFile">sy = sj(i, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">2</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) <code class="label">&</code></a>
<a name="nodalgradientsi50"></a><a href="viscousflux.html#nodalgradientsi49" target="diffFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + sj(i, j, k, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi49" target="diffFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux.html#nodalgradientsi50" target="diffFile">sz = sj(i, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k, <code class="constant">3</code>) + sj(i, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) <code class="label">&</code></a>
<a name="nodalgradientsi51"></a><a href="viscousflux.html#nodalgradientsi50" target="diffFile"><code class="label">&          </code>+ sj(i+<code class="constant">1</code>, j-<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + sj(i, j, k, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j, k, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi50" target="diffFile"><code class="label">&          </code>sj(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + sj(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux.html#nodalgradientsi51" target="diffFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux.html#nodalgradientsi51" target="diffFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux.html#nodalgradientsi51" target="diffFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
<a name="nodalgradientsi52"></a>        <a href="viscousflux.html#nodalgradientsi51" target="diffFile">ubar = fourth*(w(i, j, k, ivx)+w(i+<code class="constant">1</code>, j, k, ivx)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi51" target="diffFile"><code class="label">&          </code>ivx)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivx))</a>
<a name="nodalgradientsi53"></a>        <a href="viscousflux.html#nodalgradientsi52" target="diffFile">vbar = fourth*(w(i, j, k, ivy)+w(i+<code class="constant">1</code>, j, k, ivy)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi52" target="diffFile"><code class="label">&          </code>ivy)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivy))</a>
<a name="nodalgradientsi54"></a>        <a href="viscousflux.html#nodalgradientsi53" target="diffFile">wbar = fourth*(w(i, j, k, ivz)+w(i+<code class="constant">1</code>, j, k, ivz)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi53" target="diffFile"><code class="label">&          </code>ivz)+w(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>, ivz))</a>
<a name="nodalgradientsi55"></a>        <a href="viscousflux.html#nodalgradientsi54" target="diffFile">a2 = fourth*(p(i, j, k)+p(i+<code class="constant">1</code>, j, k)+p(i, j, k+<code class="constant">1</code>)+p(i+<code class="constant">1</code>, j, k+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi54" target="diffFile"><code class="label">&          </code>)</a>
<a href="viscousflux.html#nodalgradientsi55" target="diffFile"><code class="comment">! Add the contributions to the surface integral to the node</code></a>
<a href="viscousflux.html#nodalgradientsi55" target="diffFile"><code class="comment">! j-1 and substract it from the node j. For the heat flux it</code></a>
<a href="viscousflux.html#nodalgradientsi55" target="diffFile"><code class="comment">! is reversed, because the negative of the gradient of the</code></a>
<a name="nodalgradientsi56"></a><a href="viscousflux.html#nodalgradientsi55" target="diffFile"><code class="comment">! speed of sound must be computed.</code></a>
<a name="nodalgradientsi57"></a>        <a href="viscousflux.html#nodalgradientsi55" target="diffFile"><code class="keyword">IF</code> (j .GT. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a name="nodalgradientsi58"></a>          <a href="viscousflux.html#nodalgradientsi56" target="diffFile">ux(i, j-<code class="constant">1</code>, k1) = ux(i, j-<code class="constant">1</code>, k1) + ubar*sx</a>
<a name="nodalgradientsi59"></a>          <a href="viscousflux.html#nodalgradientsi57" target="diffFile">uy(i, j-<code class="constant">1</code>, k1) = uy(i, j-<code class="constant">1</code>, k1) + ubar*sy</a>
<a name="nodalgradientsi60"></a>          <a href="viscousflux.html#nodalgradientsi58" target="diffFile">uz(i, j-<code class="constant">1</code>, k1) = uz(i, j-<code class="constant">1</code>, k1) + ubar*sz</a>
<a name="nodalgradientsi61"></a>          <a href="viscousflux.html#nodalgradientsi59" target="diffFile">vx(i, j-<code class="constant">1</code>, k1) = vx(i, j-<code class="constant">1</code>, k1) + vbar*sx</a>
<a name="nodalgradientsi62"></a>          <a href="viscousflux.html#nodalgradientsi60" target="diffFile">vy(i, j-<code class="constant">1</code>, k1) = vy(i, j-<code class="constant">1</code>, k1) + vbar*sy</a>
<a name="nodalgradientsi63"></a>          <a href="viscousflux.html#nodalgradientsi61" target="diffFile">vz(i, j-<code class="constant">1</code>, k1) = vz(i, j-<code class="constant">1</code>, k1) + vbar*sz</a>
<a name="nodalgradientsi64"></a>          <a href="viscousflux.html#nodalgradientsi62" target="diffFile">wx(i, j-<code class="constant">1</code>, k1) = wx(i, j-<code class="constant">1</code>, k1) + wbar*sx</a>
<a name="nodalgradientsi65"></a>          <a href="viscousflux.html#nodalgradientsi63" target="diffFile">wy(i, j-<code class="constant">1</code>, k1) = wy(i, j-<code class="constant">1</code>, k1) + wbar*sy</a>
<a name="nodalgradientsi66"></a>          <a href="viscousflux.html#nodalgradientsi64" target="diffFile">wz(i, j-<code class="constant">1</code>, k1) = wz(i, j-<code class="constant">1</code>, k1) + wbar*sz</a>
<a name="nodalgradientsi67"></a>          <a href="viscousflux.html#nodalgradientsi65" target="diffFile">qx(i, j-<code class="constant">1</code>, k1) = qx(i, j-<code class="constant">1</code>, k1) - a2*sx</a>
          <a href="viscousflux.html#nodalgradientsi66" target="diffFile">qy(i, j-<code class="constant">1</code>, k1) = qy(i, j-<code class="constant">1</code>, k1) - a2*sy</a>
<a name="nodalgradientsi68"></a>          <a href="viscousflux.html#nodalgradientsi67" target="diffFile">qz(i, j-<code class="constant">1</code>, k1) = qz(i, j-<code class="constant">1</code>, k1) - a2*sz</a>
<a name="nodalgradientsi69"></a>        <a href="viscousflux.html#nodalgradientsi55" target="diffFile"><code class="keyword">END IF</code></a>
<a name="nodalgradientsi70"></a>        <a href="viscousflux.html#nodalgradientsi68" target="diffFile"><code class="keyword">IF</code> (j .LT. je) <code class="keyword">THEN</code></a>
<a name="nodalgradientsi71"></a>          <a href="viscousflux.html#nodalgradientsi69" target="diffFile">ux(i, j, k1) = ux(i, j, k1) - ubar*sx</a>
<a name="nodalgradientsi72"></a>          <a href="viscousflux.html#nodalgradientsi70" target="diffFile">uy(i, j, k1) = uy(i, j, k1) - ubar*sy</a>
<a name="nodalgradientsi73"></a>          <a href="viscousflux.html#nodalgradientsi71" target="diffFile">uz(i, j, k1) = uz(i, j, k1) - ubar*sz</a>
<a name="nodalgradientsi74"></a>          <a href="viscousflux.html#nodalgradientsi72" target="diffFile">vx(i, j, k1) = vx(i, j, k1) - vbar*sx</a>
<a name="nodalgradientsi75"></a>          <a href="viscousflux.html#nodalgradientsi73" target="diffFile">vy(i, j, k1) = vy(i, j, k1) - vbar*sy</a>
<a name="nodalgradientsi76"></a>          <a href="viscousflux.html#nodalgradientsi74" target="diffFile">vz(i, j, k1) = vz(i, j, k1) - vbar*sz</a>
<a name="nodalgradientsi77"></a>          <a href="viscousflux.html#nodalgradientsi75" target="diffFile">wx(i, j, k1) = wx(i, j, k1) - wbar*sx</a>
<a name="nodalgradientsi78"></a>          <a href="viscousflux.html#nodalgradientsi76" target="diffFile">wy(i, j, k1) = wy(i, j, k1) - wbar*sy</a>
<a name="nodalgradientsi79"></a>          <a href="viscousflux.html#nodalgradientsi77" target="diffFile">wz(i, j, k1) = wz(i, j, k1) - wbar*sz</a>
<a name="nodalgradientsi80"></a>          <a href="viscousflux.html#nodalgradientsi78" target="diffFile">qx(i, j, k1) = qx(i, j, k1) + a2*sx</a>
          <a href="viscousflux.html#nodalgradientsi79" target="diffFile">qy(i, j, k1) = qy(i, j, k1) + a2*sy</a>
          <a href="viscousflux.html#nodalgradientsi80" target="diffFile">qz(i, j, k1) = qz(i, j, k1) + a2*sz</a>
        <a href="viscousflux.html#nodalgradientsi68" target="diffFile"><code class="keyword">END IF</code></a>
<a name="nodalgradientsi81"></a>      <a href="viscousflux.html#nodalgradientsi47" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#nodalgradientsi46" target="diffFile"><code class="keyword">END DO</code></a>
<a href="viscousflux.html#nodalgradientsi81" target="diffFile"><code class="comment">! Third part. Contribution in the i-direction.</code></a>
<a href="viscousflux.html#nodalgradientsi81" target="diffFile"><code class="comment">! The contribution is scattered to both the left and right node</code></a>
<a name="nodalgradientsi82"></a><a href="viscousflux.html#nodalgradientsi81" target="diffFile"><code class="comment">! in i-direction.</code></a>
<a name="nodalgradientsi83"></a>    <a href="viscousflux.html#nodalgradientsi81" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux.html#nodalgradientsi82" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,ie</a>
<a href="viscousflux.html#nodalgradientsi83" target="diffFile"><code class="comment">! Compute 8 times the average normal for this part of</code></a>
<a href="viscousflux.html#nodalgradientsi83" target="diffFile"><code class="comment">! the control volume. The factor 8 is taken care of later</code></a>
<a href="viscousflux.html#nodalgradientsi83" target="diffFile"><code class="comment">! on when the division by the volume takes place.</code></a>
        <a href="viscousflux.html#nodalgradientsi83" target="diffFile">sx = si(i-<code class="constant">1</code>, j, k, <code class="constant">1</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">1</code>) <code class="label">&</code></a>
<a name="nodalgradientsi84"></a><a href="viscousflux.html#nodalgradientsi83" target="diffFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>) + si(i, j, k, <code class="constant">1</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">1</code>) + <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi83" target="diffFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">1</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">1</code>)</a>
        <a href="viscousflux.html#nodalgradientsi84" target="diffFile">sy = si(i-<code class="constant">1</code>, j, k, <code class="constant">2</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">2</code>) <code class="label">&</code></a>
<a name="nodalgradientsi85"></a><a href="viscousflux.html#nodalgradientsi84" target="diffFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>) + si(i, j, k, <code class="constant">2</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">2</code>) + <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi84" target="diffFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">2</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">2</code>)</a>
        <a href="viscousflux.html#nodalgradientsi85" target="diffFile">sz = si(i-<code class="constant">1</code>, j, k, <code class="constant">3</code>) + si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + si(i-<code class="constant">1</code>, j, k+<code class="constant">1</code>, <code class="constant">3</code>) <code class="label">&</code></a>
<a name="nodalgradientsi86"></a><a href="viscousflux.html#nodalgradientsi85" target="diffFile"><code class="label">&          </code>+ si(i-<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>) + si(i, j, k, <code class="constant">3</code>) + si(i, j+<code class="constant">1</code>, k, <code class="constant">3</code>) + <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi85" target="diffFile"><code class="label">&          </code>si(i, j, k+<code class="constant">1</code>, <code class="constant">3</code>) + si(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, <code class="constant">3</code>)</a>
<a href="viscousflux.html#nodalgradientsi86" target="diffFile"><code class="comment">! Compute the average velocities and speed of sound squared</code></a>
<a href="viscousflux.html#nodalgradientsi86" target="diffFile"><code class="comment">! for this integration point. Node that these variables are</code></a>
<a href="viscousflux.html#nodalgradientsi86" target="diffFile"><code class="comment">! stored in w(ivx), w(ivy), w(ivz) and p.</code></a>
<a name="nodalgradientsi87"></a>        <a href="viscousflux.html#nodalgradientsi86" target="diffFile">ubar = fourth*(w(i, j, k, ivx)+w(i, j+<code class="constant">1</code>, k, ivx)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi86" target="diffFile"><code class="label">&          </code>ivx)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivx))</a>
<a name="nodalgradientsi88"></a>        <a href="viscousflux.html#nodalgradientsi87" target="diffFile">vbar = fourth*(w(i, j, k, ivy)+w(i, j+<code class="constant">1</code>, k, ivy)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi87" target="diffFile"><code class="label">&          </code>ivy)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivy))</a>
<a name="nodalgradientsi89"></a>        <a href="viscousflux.html#nodalgradientsi88" target="diffFile">wbar = fourth*(w(i, j, k, ivz)+w(i, j+<code class="constant">1</code>, k, ivz)+w(i, j, k+<code class="constant">1</code>, <code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi88" target="diffFile"><code class="label">&          </code>ivz)+w(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>, ivz))</a>
<a name="nodalgradientsi90"></a>        <a href="viscousflux.html#nodalgradientsi89" target="diffFile">a2 = fourth*(p(i, j, k)+p(i, j+<code class="constant">1</code>, k)+p(i, j, k+<code class="constant">1</code>)+p(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi89" target="diffFile"><code class="label">&          </code>)</a>
<a href="viscousflux.html#nodalgradientsi90" target="diffFile"><code class="comment">! Add the contributions to the surface integral to the node</code></a>
<a href="viscousflux.html#nodalgradientsi90" target="diffFile"><code class="comment">! j-1 and substract it from the node j. For the heat flux it</code></a>
<a href="viscousflux.html#nodalgradientsi90" target="diffFile"><code class="comment">! is reversed, because the negative of the gradient of the</code></a>
<a name="nodalgradientsi91"></a><a href="viscousflux.html#nodalgradientsi90" target="diffFile"><code class="comment">! speed of sound must be computed.</code></a>
<a name="nodalgradientsi92"></a>        <a href="viscousflux.html#nodalgradientsi90" target="diffFile"><code class="keyword">IF</code> (i .GT. <code class="constant">1</code>) <code class="keyword">THEN</code></a>
<a name="nodalgradientsi93"></a>          <a href="viscousflux.html#nodalgradientsi91" target="diffFile">ux(i-<code class="constant">1</code>, j, k1) = ux(i-<code class="constant">1</code>, j, k1) + ubar*sx</a>
<a name="nodalgradientsi94"></a>          <a href="viscousflux.html#nodalgradientsi92" target="diffFile">uy(i-<code class="constant">1</code>, j, k1) = uy(i-<code class="constant">1</code>, j, k1) + ubar*sy</a>
<a name="nodalgradientsi95"></a>          <a href="viscousflux.html#nodalgradientsi93" target="diffFile">uz(i-<code class="constant">1</code>, j, k1) = uz(i-<code class="constant">1</code>, j, k1) + ubar*sz</a>
<a name="nodalgradientsi96"></a>          <a href="viscousflux.html#nodalgradientsi94" target="diffFile">vx(i-<code class="constant">1</code>, j, k1) = vx(i-<code class="constant">1</code>, j, k1) + vbar*sx</a>
<a name="nodalgradientsi97"></a>          <a href="viscousflux.html#nodalgradientsi95" target="diffFile">vy(i-<code class="constant">1</code>, j, k1) = vy(i-<code class="constant">1</code>, j, k1) + vbar*sy</a>
<a name="nodalgradientsi98"></a>          <a href="viscousflux.html#nodalgradientsi96" target="diffFile">vz(i-<code class="constant">1</code>, j, k1) = vz(i-<code class="constant">1</code>, j, k1) + vbar*sz</a>
<a name="nodalgradientsi99"></a>          <a href="viscousflux.html#nodalgradientsi97" target="diffFile">wx(i-<code class="constant">1</code>, j, k1) = wx(i-<code class="constant">1</code>, j, k1) + wbar*sx</a>
<a name="nodalgradientsi100"></a>          <a href="viscousflux.html#nodalgradientsi98" target="diffFile">wy(i-<code class="constant">1</code>, j, k1) = wy(i-<code class="constant">1</code>, j, k1) + wbar*sy</a>
<a name="nodalgradientsi101"></a>          <a href="viscousflux.html#nodalgradientsi99" target="diffFile">wz(i-<code class="constant">1</code>, j, k1) = wz(i-<code class="constant">1</code>, j, k1) + wbar*sz</a>
<a name="nodalgradientsi102"></a>          <a href="viscousflux.html#nodalgradientsi100" target="diffFile">qx(i-<code class="constant">1</code>, j, k1) = qx(i-<code class="constant">1</code>, j, k1) - a2*sx</a>
          <a href="viscousflux.html#nodalgradientsi101" target="diffFile">qy(i-<code class="constant">1</code>, j, k1) = qy(i-<code class="constant">1</code>, j, k1) - a2*sy</a>
<a name="nodalgradientsi103"></a>          <a href="viscousflux.html#nodalgradientsi102" target="diffFile">qz(i-<code class="constant">1</code>, j, k1) = qz(i-<code class="constant">1</code>, j, k1) - a2*sz</a>
<a name="nodalgradientsi104"></a>        <a href="viscousflux.html#nodalgradientsi90" target="diffFile"><code class="keyword">END IF</code></a>
<a name="nodalgradientsi105"></a>        <a href="viscousflux.html#nodalgradientsi103" target="diffFile"><code class="keyword">IF</code> (i .LT. ie) <code class="keyword">THEN</code></a>
<a name="nodalgradientsi106"></a>          <a href="viscousflux.html#nodalgradientsi104" target="diffFile">ux(i, j, k1) = ux(i, j, k1) - ubar*sx</a>
<a name="nodalgradientsi107"></a>          <a href="viscousflux.html#nodalgradientsi105" target="diffFile">uy(i, j, k1) = uy(i, j, k1) - ubar*sy</a>
<a name="nodalgradientsi108"></a>          <a href="viscousflux.html#nodalgradientsi106" target="diffFile">uz(i, j, k1) = uz(i, j, k1) - ubar*sz</a>
<a name="nodalgradientsi109"></a>          <a href="viscousflux.html#nodalgradientsi107" target="diffFile">vx(i, j, k1) = vx(i, j, k1) - vbar*sx</a>
<a name="nodalgradientsi110"></a>          <a href="viscousflux.html#nodalgradientsi108" target="diffFile">vy(i, j, k1) = vy(i, j, k1) - vbar*sy</a>
<a name="nodalgradientsi111"></a>          <a href="viscousflux.html#nodalgradientsi109" target="diffFile">vz(i, j, k1) = vz(i, j, k1) - vbar*sz</a>
<a name="nodalgradientsi112"></a>          <a href="viscousflux.html#nodalgradientsi110" target="diffFile">wx(i, j, k1) = wx(i, j, k1) - wbar*sx</a>
<a name="nodalgradientsi113"></a>          <a href="viscousflux.html#nodalgradientsi111" target="diffFile">wy(i, j, k1) = wy(i, j, k1) - wbar*sy</a>
<a name="nodalgradientsi114"></a>          <a href="viscousflux.html#nodalgradientsi112" target="diffFile">wz(i, j, k1) = wz(i, j, k1) - wbar*sz</a>
<a name="nodalgradientsi115"></a>          <a href="viscousflux.html#nodalgradientsi113" target="diffFile">qx(i, j, k1) = qx(i, j, k1) + a2*sx</a>
          <a href="viscousflux.html#nodalgradientsi114" target="diffFile">qy(i, j, k1) = qy(i, j, k1) + a2*sy</a>
          <a href="viscousflux.html#nodalgradientsi115" target="diffFile">qz(i, j, k1) = qz(i, j, k1) + a2*sz</a>
        <a href="viscousflux.html#nodalgradientsi103" target="diffFile"><code class="keyword">END IF</code></a>
<a name="nodalgradientsi116"></a>      <a href="viscousflux.html#nodalgradientsi82" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#nodalgradientsi81" target="diffFile"><code class="keyword">END DO</code></a>
<a name="nodalgradientsi117"></a><a href="viscousflux.html#nodalgradientsi116" target="diffFile"><code class="comment">! Divide by 8 times the volume to obtain the correct gradients.</code></a>
<a name="nodalgradientsi118"></a>    <a href="viscousflux.html#nodalgradientsi116" target="diffFile"><code class="keyword">DO </code>j=<code class="constant">1</code>,jl</a>
      <a href="viscousflux.html#nodalgradientsi117" target="diffFile"><code class="keyword">DO </code>i=<code class="constant">1</code>,il</a>
<a href="viscousflux.html#nodalgradientsi118" target="diffFile"><code class="comment">! Compute the inverse of 8 times the volume for this node.</code></a>
        <a href="viscousflux.html#nodalgradientsi118" target="diffFile">oneoverv = one/(vol(i, j, k)+vol(i, j, k+<code class="constant">1</code>)+vol(i+<code class="constant">1</code>, j, k)+vol(i<code class="label">&</code></a>
<a name="nodalgradientsi119"></a><a href="viscousflux.html#nodalgradientsi118" target="diffFile"><code class="label">&          </code>+<code class="constant">1</code>, j, k+<code class="constant">1</code>)+vol(i, j+<code class="constant">1</code>, k)+vol(i, j+<code class="constant">1</code>, k+<code class="constant">1</code>)+vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k)+<code class="label">&</code></a>
<a href="viscousflux.html#nodalgradientsi118" target="diffFile"><code class="label">&          </code>vol(i+<code class="constant">1</code>, j+<code class="constant">1</code>, k+<code class="constant">1</code>))</a>
<a href="viscousflux.html#nodalgradientsi119" target="diffFile"><code class="comment">! Compute the correct velocity gradients and "unit" heat</code></a>
<a name="nodalgradientsi120"></a><a href="viscousflux.html#nodalgradientsi119" target="diffFile"><code class="comment">! fluxes. The velocity gradients are stored in ux, etc.</code></a>
<a name="nodalgradientsi121"></a>        <a href="viscousflux.html#nodalgradientsi119" target="diffFile">ux(i, j, k1) = ux(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi122"></a>        <a href="viscousflux.html#nodalgradientsi120" target="diffFile">uy(i, j, k1) = uy(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi123"></a>        <a href="viscousflux.html#nodalgradientsi121" target="diffFile">uz(i, j, k1) = uz(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi124"></a>        <a href="viscousflux.html#nodalgradientsi122" target="diffFile">vx(i, j, k1) = vx(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi125"></a>        <a href="viscousflux.html#nodalgradientsi123" target="diffFile">vy(i, j, k1) = vy(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi126"></a>        <a href="viscousflux.html#nodalgradientsi124" target="diffFile">vz(i, j, k1) = vz(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi127"></a>        <a href="viscousflux.html#nodalgradientsi125" target="diffFile">wx(i, j, k1) = wx(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi128"></a>        <a href="viscousflux.html#nodalgradientsi126" target="diffFile">wy(i, j, k1) = wy(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi129"></a>        <a href="viscousflux.html#nodalgradientsi127" target="diffFile">wz(i, j, k1) = wz(i, j, k1)*oneoverv</a>
<a name="nodalgradientsi130"></a>        <a href="viscousflux.html#nodalgradientsi128" target="diffFile">qx(i, j, k1) = qx(i, j, k1)*oneoverv</a>
        <a href="viscousflux.html#nodalgradientsi129" target="diffFile">qy(i, j, k1) = qy(i, j, k1)*oneoverv</a>
        <a href="viscousflux.html#nodalgradientsi130" target="diffFile">qz(i, j, k1) = qz(i, j, k1)*oneoverv</a>
      <a href="viscousflux.html#nodalgradientsi117" target="diffFile"><code class="keyword">END DO</code></a>
    <a href="viscousflux.html#nodalgradientsi116" target="diffFile"><code class="keyword">END DO</code></a>
  <a href="viscousflux.html#nodalgradients" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">NODALGRADIENTS</code></a>
<a href="viscousflux.html#viscousflux" target="diffFile"><code class="keyword">END SUBROUTINE </code><code class="funcname">VISCOUSFLUX</code></a>
</pre>
</body>
